<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Popbox Elite</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        /* PROFESYONEL SİYAH TEMA (GECE) */
        :root {
            --bg-primary: #0a0a0a;
            --bg-secondary: #111111;
            --bg-tertiary: #1a1a1a;
            --bg-overlay: rgba(0, 0, 0, 0.85);
            
            --border-light: #222222;
            --border-medium: #2a2a2a;
            --border-dark: #333333;
            
            --text-primary: #ffffff;
            --text-secondary: #b0b0b0;
            --text-tertiary: #888888;
            --text-muted: #666666;
            
            --accent-blue: #3b82f6;
            --accent-green: #10b981;
            --accent-red: #ef4444;
            --accent-orange: #f59e0b;
            --accent-purple: #8b5cf6;
            --accent-pink: #ec4899;
            
            --shadow-light: 0 1px 3px rgba(0, 0, 0, 0.3);
            --shadow-medium: 0 4px 12px rgba(0, 0, 0, 0.5);
            --shadow-heavy: 0 8px 32px rgba(0, 0, 0, 0.7);
            
            --radius-sm: 6px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;
            
            --font-primary: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            --font-mono: 'JetBrains Mono', 'SF Mono', 'Roboto Mono', monospace;
            
            --spacing-xs: 6px;
            --spacing-sm: 12px;
            --spacing-md: 18px;
            --spacing-lg: 24px;
            --spacing-xl: 32px;
        }

        /* GÜNDÜZ TEMA */
        body.day-mode {
            --bg-primary: #f8fafc;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f1f5f9;
            --bg-overlay: rgba(255, 255, 255, 0.95);
            
            --border-light: #e2e8f0;
            --border-medium: #cbd5e1;
            --border-dark: #94a3b8;
            
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --text-tertiary: #64748b;
            --text-muted: #94a3b8;
            
            --shadow-light: 0 1px 3px rgba(0, 0, 0, 0.05);
            --shadow-medium: 0 4px 12px rgba(0, 0, 0, 0.08);
            --shadow-heavy: 0 8px 32px rgba(0, 0, 0, 0.12);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-primary);
            background: var(--bg-primary);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
            font-size: 14px;
            line-height: 1.5;
            font-weight: 400;
            transition: background 0.3s ease, color 0.3s ease;
        }

        /* ÜST BAR - Navigation */
        .top-bar {
            height: 60px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-light);
            padding: 0 var(--spacing-lg);
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: relative;
            z-index: 100;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            font-weight: 600;
            font-size: 18px;
            color: var(--text-primary);
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 16px;
        }

        /* ÜST BAR'DA HİKAYELER */
        .top-stories {
            flex: 1;
            display: flex;
            gap: var(--spacing-md);
            overflow-x: auto;
            padding: 0 var(--spacing-lg);
            margin: 0 var(--spacing-lg);
            max-width: calc(100vw - 400px);
            scrollbar-width: none;
        }

        .top-stories::-webkit-scrollbar {
            display: none;
        }

        .top-story-item {
            flex: 0 0 auto;
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .top-story-item:hover {
            transform: scale(1.05);
        }

        .top-story-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            padding: 2px;
            background: linear-gradient(45deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888);
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .top-story-avatar-inner {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: var(--bg-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 14px;
            border: 2px solid var(--bg-secondary);
        }

        .top-story-username {
            font-size: 10px;
            color: var(--text-tertiary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 50px;
        }

        .nav-controls {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .nav-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: transparent;
            border: 1px solid var(--border-light);
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .nav-btn:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .nav-btn.disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .theme-toggle {
            position: relative;
            width: 60px;
            height: 28px;
            background: var(--bg-tertiary);
            border-radius: 14px;
            border: 1px solid var(--border-light);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .theme-toggle::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 22px;
            height: 22px;
            background: var(--accent-blue);
            border-radius: 50%;
            transition: transform 0.3s ease;
        }

        body.day-mode .theme-toggle::after {
            transform: translateX(32px);
            background: var(--accent-orange);
        }

        /* ANA LAYOUT */
        .app-container {
            display: flex;
            height: calc(100vh - 60px);
        }

        /* SOL PANEL - Online Listesi */
        .online-panel {
            width: 320px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border-light);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        .panel-header {
            padding: var(--spacing-md) var(--spacing-lg);
            border-bottom: 1px solid var(--border-light);
        }

        .panel-title {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--spacing-xs);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .online-count {
            font-size: 13px;
            color: var(--text-secondary);
            font-weight: 400;
        }

        .panel-subtitle {
            font-size: 13px;
            color: var(--text-tertiary);
        }

        .search-box {
            padding: var(--spacing-md) var(--spacing-lg) 0;
            margin-bottom: var(--spacing-md);
        }

        .search-input {
            width: 100%;
            padding: 10px var(--spacing-md);
            background: var(--bg-tertiary);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            font-size: 13px;
            font-family: inherit;
            transition: all 0.2s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--accent-blue);
            background: var(--bg-secondary);
        }

        .search-input::placeholder {
            color: var(--text-muted);
        }

        .user-list {
            flex: 1;
            overflow-y: auto;
            padding: 0 var(--spacing-lg);
        }

        .user-item {
            padding: var(--spacing-md) 0;
            border-bottom: 1px solid var(--border-light);
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .user-item:last-child {
            border-bottom: none;
        }

        .user-item:hover {
            background: var(--bg-tertiary);
            margin: 0 calc(var(--spacing-lg) * -1);
            padding: var(--spacing-md) var(--spacing-lg);
        }

        .user-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 16px;
            flex-shrink: 0;
            position: relative;
            border: 2px solid var(--bg-secondary);
        }

        .user-avatar.online::after {
            content: '';
            position: absolute;
            bottom: 2px;
            right: 2px;
            width: 12px;
            height: 12px;
            background: var(--accent-green);
            border-radius: 50%;
            border: 2px solid var(--bg-secondary);
        }

        .user-info {
            flex: 1;
            min-width: 0;
        }

        .user-name {
            font-weight: 500;
            font-size: 14px;
            color: var(--text-primary);
            margin-bottom: 2px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .user-role {
            font-size: 11px;
            padding: 2px 6px;
            border-radius: 10px;
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            font-weight: 500;
        }

        .user-role.owner { background: rgba(139, 92, 246, 0.1); color: var(--accent-purple); }
        .user-role.admin { background: rgba(59, 130, 246, 0.1); color: var(--accent-blue); }
        .user-role.mod { background: rgba(16, 185, 129, 0.1); color: var(--accent-green); }
        .user-role.operator { background: rgba(245, 158, 11, 0.1); color: var(--accent-orange); }
        .user-role.coadmin { background: rgba(236, 72, 153, 0.1); color: var(--accent-pink); }

        .user-status {
            font-size: 12px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 4px;
        }

        /* ORTA PANEL - Sohbet */
        .chat-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--bg-primary);
            position: relative;
        }

        .chat-header {
            padding: 0 var(--spacing-lg);
            height: 60px;
            border-bottom: 1px solid var(--border-light);
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: var(--bg-secondary);
        }

        .chat-info h2 {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 2px;
        }

        .chat-info p {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .header-actions {
            display: flex;
            gap: var(--spacing-xs);
            align-items: center;
            position: relative;
        }

        .notification-btn {
            position: relative;
            background: none;
            border: none;
            width: 36px;
            height: 36px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .notification-btn:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .notification-badge {
            position: absolute;
            top: -2px;
            right: -2px;
            background: var(--accent-red);
            color: white;
            font-size: 10px;
            min-width: 16px;
            height: 16px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            border: 2px solid var(--bg-secondary);
        }

        /* BİLDİRİM DROPDOWN (YouTube/Instagram tarzı) */
        .notification-dropdown {
            position: absolute;
            top: 50px;
            right: 0;
            width: 380px;
            max-height: 500px;
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-light);
            box-shadow: var(--shadow-heavy);
            display: none;
            flex-direction: column;
            z-index: 1000;
            overflow: hidden;
        }

        .notification-dropdown.active {
            display: flex;
        }

        .notification-header {
            padding: var(--spacing-md) var(--spacing-lg);
            border-bottom: 1px solid var(--border-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .notification-header h4 {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .clear-notifications {
            font-size: 12px;
            color: var(--accent-blue);
            background: none;
            border: none;
            cursor: pointer;
        }

        .notification-list {
            flex: 1;
            overflow-y: auto;
            max-height: 400px;
        }

        .notification-item {
            padding: var(--spacing-md) var(--spacing-lg);
            border-bottom: 1px solid var(--border-light);
            display: flex;
            gap: var(--spacing-md);
            align-items: flex-start;
            cursor: pointer;
            transition: background 0.2s;
        }

        .notification-item:hover {
            background: var(--bg-tertiary);
        }

        .notification-item.unread {
            background: rgba(59, 130, 246, 0.05);
        }

        .notification-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--bg-tertiary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--accent-blue);
            flex-shrink: 0;
        }

        .notification-content {
            flex: 1;
            min-width: 0;
        }

        .notification-text {
            font-size: 13px;
            color: var(--text-primary);
            margin-bottom: 4px;
            line-height: 1.4;
        }

        .notification-time {
            font-size: 11px;
            color: var(--text-tertiary);
        }

        .notification-actions {
            padding: var(--spacing-sm) var(--spacing-lg);
            border-top: 1px solid var(--border-light);
            text-align: center;
        }

        .view-all-notifications {
            font-size: 13px;
            color: var(--accent-blue);
            background: none;
            border: none;
            cursor: pointer;
            padding: 6px 12px;
            border-radius: var(--radius-md);
            transition: background 0.2s;
        }

        .view-all-notifications:hover {
            background: var(--bg-tertiary);
        }

        .admin-alert {
            color: var(--accent-orange);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* CHAT MESSAGES */
        .chat-messages {
            flex: 1;
            padding: var(--spacing-lg);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .message {
            display: flex;
            flex-direction: column;
            max-width: 80%;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message-incoming {
            align-self: flex-start;
        }

        .message-outgoing {
            align-self: flex-end;
            align-items: flex-end;
        }

        .message-sender {
            font-weight: 600;
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .message-outgoing .message-sender {
            color: var(--accent-blue);
        }

        .message-text {
            font-size: 14px;
            line-height: 1.5;
            color: var(--text-primary);
            padding: 2px 0;
        }

        .message-time {
            font-size: 11px;
            color: var(--text-tertiary);
            margin-top: 4px;
        }

        .message-system {
            text-align: center;
            font-size: 13px;
            color: var(--text-secondary);
            font-style: italic;
            padding: var(--spacing-sm) 0;
        }

        .message-media {
            margin-top: 8px;
            border-radius: var(--radius-md);
            overflow: hidden;
            max-width: 300px;
            cursor: pointer;
        }

        .message-media img {
            width: 100%;
            height: auto;
            display: block;
            border-radius: var(--radius-md);
        }

        .chat-input-area {
            padding: var(--spacing-lg);
            border-top: 1px solid var(--border-light);
            background: var(--bg-secondary);
        }

        .input-wrapper {
            display: flex;
            gap: var(--spacing-md);
            align-items: flex-end;
        }

        .message-input {
            flex: 1;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-md);
            padding: 12px 16px;
            color: var(--text-primary);
            font-family: inherit;
            font-size: 14px;
            resize: none;
            min-height: 44px;
            max-height: 120px;
            outline: none;
            transition: all 0.2s ease;
        }

        .message-input:focus {
            border-color: var(--accent-blue);
            background: var(--bg-secondary);
        }

        .message-input::placeholder {
            color: var(--text-muted);
        }

        .send-btn {
            width: 44px;
            height: 44px;
            border-radius: var(--radius-md);
            background: var(--accent-blue);
            border: none;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .send-btn:hover {
            background: #2563eb;
            transform: translateY(-1px);
        }

        /* SAĞ PANEL - Video (GÜNCELLENDİ) */
        .video-panel {
            width: 450px;
            background: #000;
            border-left: 1px solid var(--border-dark);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        .video-header {
            padding: var(--spacing-md) var(--spacing-lg);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .video-header h3 {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .video-header p {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.7);
        }

        .video-controls-bar {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .video-btn {
            padding: 6px 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            border-radius: var(--radius-md);
            font-size: 13px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s;
        }

        .video-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .video-btn.live {
            background: var(--accent-red);
            border-color: var(--accent-red);
        }

        .video-btn.live:hover {
            background: #dc2626;
        }

        .video-container {
            flex: 1;
            position: relative;
            overflow: hidden;
            background: #000;
        }

        .youtube-video {
            width: 100%;
            height: 100%;
            border: none;
        }

        .live-stream-container {
            width: 100%;
            height: 100%;
            background: #000;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .live-stream-container.active {
            display: flex;
        }

        .live-video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .live-controls {
            position: absolute;
            bottom: 20px;
            left: 0;
            right: 0;
            padding: 0 20px;
            display: flex;
            justify-content: center;
            gap: 20px;
            align-items: center;
            z-index: 10;
        }

        .live-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            backdrop-filter: blur(10px);
            transition: all 0.2s;
        }

        .live-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .live-btn.start {
            background: var(--accent-red);
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.5);
        }

        .live-btn.stop {
            background: var(--accent-red);
            animation: pulse-red 1.5s infinite;
        }

        @keyframes pulse-red {
            0%, 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            50% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
        }

        .camera-selector {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 10;
        }

        .camera-btn {
            padding: 8px 16px;
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            border-radius: var(--radius-md);
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
        }

        .camera-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .camera-btn.active {
            background: var(--accent-blue);
            border-color: var(--accent-blue);
        }

        .no-video-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: rgba(255, 255, 255, 0.7);
            z-index: 5;
        }

        .no-video-message i {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .video-info {
            padding: var(--spacing-md) var(--spacing-lg);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .video-title {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .video-stats {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
        }

        /* VIDEO YÖNETİM MODALI */
        .video-management-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-overlay);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            backdrop-filter: blur(5px);
        }

        .video-management-modal.active {
            display: flex;
        }

        .video-management-container {
            width: 500px;
            max-width: 90%;
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            overflow: hidden;
            border: 1px solid var(--border-light);
            box-shadow: var(--shadow-heavy);
        }

        .video-management-header {
            padding: var(--spacing-lg);
            background: var(--bg-tertiary);
            border-bottom: 1px solid var(--border-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .video-tabs {
            display: flex;
            background: var(--bg-tertiary);
            border-bottom: 1px solid var(--border-light);
        }

        .video-tab {
            flex: 1;
            padding: var(--spacing-md);
            text-align: center;
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .video-tab.active {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border-bottom: 2px solid var(--accent-blue);
        }

        .video-tab-content {
            padding: var(--spacing-lg);
            display: none;
        }

        .video-tab-content.active {
            display: block;
        }

        .video-url-input {
            width: 100%;
            padding: 12px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            margin-bottom: var(--spacing-md);
            font-size: 14px;
        }

        .video-url-input:focus {
            outline: none;
            border-color: var(--accent-blue);
        }

        .video-suggestions {
            margin-top: var(--spacing-lg);
        }

        .video-suggestion-title {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: var(--spacing-sm);
        }

        .suggested-video {
            padding: var(--spacing-md);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-md);
            margin-bottom: var(--spacing-sm);
            cursor: pointer;
            transition: all 0.2s;
        }

        .suggested-video:hover {
            background: var(--bg-tertiary);
            border-color: var(--accent-blue);
        }

        .suggested-video-title {
            font-weight: 500;
            margin-bottom: 4px;
        }

        .suggested-video-desc {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* STORY VIEWER - GÜNCELLENDİ */
        .story-viewer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            z-index: 3000;
            flex-direction: column;
        }

        .story-viewer.active {
            display: flex;
        }

        .story-header {
            padding: var(--spacing-lg);
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: white;
            position: relative;
        }

        .story-user {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .story-user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(45deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            padding: 2px;
        }

        .story-user-avatar-inner {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: #000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .story-controls {
            display: flex;
            gap: var(--spacing-md);
            align-items: center;
        }

        .story-report-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: var(--radius-md);
            cursor: pointer;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: background 0.2s;
        }

        .story-report-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .story-nav-btn {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: background 0.2s;
        }

        .story-nav-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .story-content {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .story-image {
            max-width: 90%;
            max-height: 80vh;
            object-fit: contain;
            border-radius: var(--radius-lg);
        }

        .story-video {
            max-width: 90%;
            max-height: 80vh;
            border-radius: var(--radius-lg);
        }

        .story-progress {
            position: absolute;
            top: var(--spacing-lg);
            left: var(--spacing-lg);
            right: var(--spacing-lg);
            display: flex;
            gap: 4px;
        }

        .story-progress-bar {
            flex: 1;
            height: 2px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 1px;
            overflow: hidden;
        }

        .story-progress-fill {
            height: 100%;
            background: white;
            width: 0%;
            transition: width 0.1s linear;
        }

        .story-actions {
            position: absolute;
            bottom: var(--spacing-xl);
            left: 0;
            right: 0;
            padding: 0 var(--spacing-xl);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .story-like-btn {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
            cursor: pointer;
            backdrop-filter: blur(10px);
            transition: background 0.2s;
        }

        .story-like-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .story-like-btn.liked {
            background: var(--accent-red);
        }

        .story-delete-btn {
            background: rgba(239, 68, 68, 0.2);
            color: var(--accent-red);
            border: 1px solid var(--accent-red);
            padding: 8px 16px;
            border-radius: var(--radius-md);
            cursor: pointer;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s;
        }

        .story-delete-btn:hover {
            background: rgba(239, 68, 68, 0.3);
        }

        /* STORY YÜKLEME MODALI */
        .story-upload-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-overlay);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2001;
            backdrop-filter: blur(5px);
        }

        .story-upload-modal.active {
            display: flex;
        }

        .story-upload-container {
            width: 400px;
            max-width: 90%;
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            overflow: hidden;
            border: 1px solid var(--border-light);
            box-shadow: var(--shadow-heavy);
        }

        .story-upload-area {
            padding: var(--spacing-xl);
            text-align: center;
            cursor: pointer;
            border: 2px dashed var(--border-medium);
            border-radius: var(--radius-md);
            margin: var(--spacing-lg);
            transition: all 0.2s;
        }

        .story-upload-area:hover {
            border-color: var(--accent-blue);
            background: var(--bg-tertiary);
        }

        .story-upload-area i {
            font-size: 48px;
            color: var(--text-secondary);
            margin-bottom: var(--spacing-md);
        }

        .story-preview {
            margin: var(--spacing-lg);
            text-align: center;
            display: none;
        }

        .story-preview-img {
            max-width: 100%;
            max-height: 300px;
            border-radius: var(--radius-md);
            margin-bottom: var(--spacing-md);
        }

        .story-preview-video {
            max-width: 100%;
            max-height: 300px;
            border-radius: var(--radius-md);
            margin-bottom: var(--spacing-md);
        }

        .story-upload-buttons {
            padding: var(--spacing-lg);
            display: flex;
            gap: var(--spacing-md);
            justify-content: flex-end;
        }

        /* GİRİŞ EKRANI */
        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 5000;
        }

        .login-container {
            width: 100%;
            max-width: 400px;
            padding: var(--spacing-xl);
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-light);
            box-shadow: var(--shadow-heavy);
        }

        .login-header {
            text-align: center;
            margin-bottom: var(--spacing-xl);
        }

        .login-logo {
            width: 64px;
            height: 64px;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            border-radius: 50%;
            margin: 0 auto var(--spacing-md);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 24px;
        }

        .login-title {
            font-size: 24px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .login-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .login-input {
            width: 100%;
            padding: 12px 16px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            font-size: 14px;
            font-family: inherit;
            margin-bottom: var(--spacing-md);
            transition: all 0.2s ease;
        }

        .login-input:focus {
            outline: none;
            border-color: var(--accent-blue);
            background: var(--bg-secondary);
        }

        .login-btn {
            width: 100%;
            padding: 14px;
            background: var(--accent-blue);
            color: white;
            border: none;
            border-radius: var(--radius-md);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-top: var(--spacing-md);
        }

        .login-btn:hover {
            background: #2563eb;
            transform: translateY(-1px);
        }

        .login-note {
            text-align: center;
            margin-top: var(--spacing-lg);
            font-size: 12px;
            color: var(--text-tertiary);
        }

        /* UTILITIES */
        .hidden {
            display: none !important;
        }

        .text-mono {
            font-family: var(--font-mono);
        }

        .text-sm {
            font-size: 12px;
        }

        .text-xs {
            font-size: 11px;
        }

        /* SCROLLBAR */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-medium);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--border-dark);
        }

        /* MEDIA QUERIES */
        @media (max-width: 1400px) {
            .video-panel {
                width: 400px;
            }
        }

        @media (max-width: 1200px) {
            .online-panel {
                width: 280px;
            }
            
            .video-panel {
                width: 350px;
            }
            
            .top-stories {
                max-width: calc(100vw - 300px);
            }
        }
    </style>
</head>
<body class="night-mode">
    <!-- GİRİŞ EKRANI -->
    <div id="loginScreen" class="login-screen">
        <div class="login-container">
            <div class="login-header">
                <div class="login-logo">P</div>
                <h1 class="login-title">Popbox Elite</h1>
                <p class="login-subtitle">Professional Chat Platform</p>
            </div>
            
            <input id="nickInput" class="login-input" type="text" placeholder="Kullanıcı adı" autofocus>
            <input id="passInput" class="login-input" type="password" placeholder="Şifre (opsiyonel)">
            
            <button class="login-btn" onclick="handleLogin()">Giriş Yap</button>
            
            <div class="login-note">
                <p>Demo: <strong>mateky</strong> / <strong>kumsal07@</strong> (owner)</p>
                <p>Diğer: <strong>admin</strong> / <strong>admin123</strong></p>
            </div>
        </div>
    </div>

    <!-- ANA UYGULAMA -->
    <div id="app" class="hidden">
        <!-- ÜST BAR -->
        <div class="top-bar">
            <div class="logo">
                <div class="logo-icon">P</div>
                <span>Popbox Elite</span>
            </div>
            
            <!-- ÜST BAR HİKAYELER -->
            <div class="top-stories" id="topStories">
                <!-- Hikayeler buraya eklenecek -->
            </div>
            
            <div class="nav-controls">
                <button class="nav-btn" onclick="openProfilePanel()" title="Profilim">
                    <i class="fas fa-user"></i>
                </button>
                <button class="nav-btn" onclick="toggleTheme()" title="Tema değiştir">
                    <i class="fas fa-moon"></i>
                </button>
                <div class="theme-toggle" onclick="toggleTheme()"></div>
                <button class="nav-btn" id="ircBtn" title="IRC Komutları" onclick="toggleIRCPanel()">
                    <i class="fas fa-terminal"></i>
                </button>
                <button class="nav-btn" id="ownerBtn" title="Owner Paneli" onclick="toggleOwnerPanel()">
                    <i class="fas fa-crown"></i>
                </button>
            </div>
        </div>

        <!-- ANA LAYOUT -->
        <div class="app-container">
            <!-- SOL PANEL - Online Listesi -->
            <div class="online-panel">
                <div class="panel-header">
                    <div class="panel-title">
                        Çevrimiçi Kullanıcılar
                        <span class="online-count" id="onlineCount">0</span>
                    </div>
                    <p class="panel-subtitle">Aktif kullanıcılar</p>
                </div>
                
                <div class="search-box">
                    <input type="text" class="search-input" placeholder="Kullanıcı ara..." onkeyup="searchUsers(this.value)">
                </div>
                
                <div class="user-list" id="userList">
                    <!-- Kullanıcılar buraya eklenecek -->
                </div>
            </div>

            <!-- ORTA PANEL - Ana Sohbet -->
            <div class="chat-panel">
                <div class="chat-header">
                    <div class="chat-info">
                        <h2>Genel Sohbet</h2>
                        <p>Toplam kullanıcı: <span id="totalUsers">0</span></p>
                    </div>
                    
                    <div class="header-actions">
                        <button class="notification-btn" onclick="toggleNotifications()" id="notificationBtn">
                            <i class="fas fa-bell"></i>
                            <span class="notification-badge" id="notificationBadge">0</span>
                        </button>
                    </div>
                </div>
                
                <div class="chat-messages" id="chatMessages">
                    <!-- Mesajlar buraya eklenecek -->
                </div>
                
                <div class="chat-input-area">
                    <div class="input-wrapper">
                        <textarea class="message-input" id="messageInput" placeholder="Mesaj yazın (IRC komutları için / kullanın)..." rows="1"></textarea>
                        <button class="send-btn" onclick="sendMessage()" title="Gönder">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- SAĞ PANEL - Video (GÜNCELLENDİ) -->
            <div class="video-panel">
                <div class="video-header">
                    <div>
                        <h3><i class="fas fa-play-circle"></i> Popbox Stream</h3>
                        <p id="videoStatus">YouTube Video Yayını</p>
                    </div>
                    
                    <div class="video-controls-bar">
                        <button class="video-btn" onclick="openVideoManagement()" title="Video Yönetimi">
                            <i class="fas fa-video"></i> Video Ekle/Değiştir
                        </button>
                        <button class="video-btn live" onclick="toggleLiveStream()" id="liveBtn">
                            <i class="fas fa-broadcast-tower"></i> Canlı Yayın
                        </button>
                    </div>
                </div>
                
                <div class="video-container">
                    <!-- YouTube Video -->
                    <iframe 
                        class="youtube-video"
                        id="youtubePlayer"
                        src="https://www.youtube.com/embed/videoseries?list=PL6k9a6aYB2zk0qSbXR-ZEiwqgdHymsRtQ&autoplay=1&mute=1"
                        frameborder="0"
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                        allowfullscreen>
                    </iframe>
                    
                    <!-- Canlı Yayın -->
                    <div class="live-stream-container" id="liveStreamContainer">
                        <video class="live-video" id="liveVideo" autoplay muted playsinline></video>
                        <div class="camera-selector">
                            <button class="camera-btn active" onclick="switchCamera('user')" id="frontCameraBtn">
                                <i class="fas fa-user"></i> Ön Kamera
                            </button>
                            <button class="camera-btn" onclick="switchCamera('environment')" id="backCameraBtn">
                                <i class="fas fa-camera"></i> Arka Kamera
                            </button>
                        </div>
                        <div class="live-controls">
                            <button class="live-btn stop" onclick="stopLiveStream()" id="stopLiveBtn">
                                <i class="fas fa-stop"></i>
                            </button>
                        </div>
                        <div class="no-video-message" id="noLiveMessage" style="display: none;">
                            <i class="fas fa-broadcast-tower"></i>
                            <p>Canlı yayın başlatılıyor...</p>
                        </div>
                    </div>
                    
                    <!-- Video yoksa mesaj -->
                    <div class="no-video-message" id="noVideoMessage" style="display: none;">
                        <i class="fas fa-video-slash"></i>
                        <p>Video yükleniyor veya bulunamadı</p>
                        <button class="video-btn" onclick="openVideoManagement()" style="margin-top: 16px;">
                            Video Ekle
                        </button>
                    </div>
                </div>
                
                <div class="video-info">
                    <div class="video-title" id="videoTitle">Popbox Music - Chill Mix</div>
                    <div class="video-stats">
                        <span><i class="fas fa-eye"></i> <span id="viewerCount">1.2K</span> izleyici</span>
                        <span><i class="fas fa-clock"></i> <span id="videoDuration">24/7</span></span>
                    </div>
                </div>
            </div>
        </div>

        <!-- VIDEO YÖNETİM MODALI -->
        <div class="video-management-modal" id="videoManagementModal">
            <div class="video-management-container">
                <div class="video-management-header">
                    <h3>Video Yönetimi</h3>
                    <button class="nav-btn close" onclick="closeVideoManagement()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="video-tabs">
                    <button class="video-tab active" onclick="switchVideoTab('youtube')">YouTube Video</button>
                    <button class="video-tab" onclick="switchVideoTab('playlist')">Oynatma Listesi</button>
                    <button class="video-tab" onclick="switchVideoTab('live')">Canlı Yayın</button>
                </div>
                
                <!-- YouTube Video Sekmesi -->
                <div class="video-tab-content active" id="youtubeTab">
                    <div style="margin-bottom: var(--spacing-lg);">
                        <h4 style="margin-bottom: var(--spacing-md);">YouTube Video URL'si</h4>
                        <input type="text" class="video-url-input" id="youtubeUrl" 
                               placeholder="https://www.youtube.com/watch?v=..." 
                               value="https://www.youtube.com/watch?v=jfKfPfyJRdk">
                        <button class="video-btn" onclick="loadYouTubeVideo()" style="width: 100%;">
                            <i class="fas fa-play"></i> Video Yükle
                        </button>
                    </div>
                    
                    <div class="video-suggestions">
                        <div class="video-suggestion-title">Önerilen Videolar:</div>
                        <div class="suggested-video" onclick="loadSuggestedVideo('jfKfPfyJRdk', 'Lofi Hip Hop Radio')">
                            <div class="suggested-video-title">🎵 Lofi Hip Hop Radio</div>
                            <div class="suggested-video-desc">24/7 chill beats to study/relax to</div>
                        </div>
                        <div class="suggested-video" onclick="loadSuggestedVideo('5qap5aO4i9A', 'Synthwave Radio')">
                            <div class="suggested-video-title">🌌 Synthwave Radio</div>
                            <div class="suggested-video-desc">Retro waves for your relaxation</div>
                        </div>
                    </div>
                </div>
                
                <!-- Oynatma Listesi Sekmesi -->
                <div class="video-tab-content" id="playlistTab">
                    <div style="margin-bottom: var(--spacing-lg);">
                        <h4 style="margin-bottom: var(--spacing-md);">YouTube Oynatma Listesi</h4>
                        <input type="text" class="video-url-input" id="playlistUrl" 
                               placeholder="https://www.youtube.com/playlist?list=..." 
                               value="https://www.youtube.com/playlist?list=PL6k9a6aYB2zk0qSbXR-ZEiwqgdHymsRtQ">
                        <button class="video-btn" onclick="loadYouTubePlaylist()" style="width: 100%;">
                            <i class="fas fa-list"></i> Oynatma Listesi Yükle
                        </button>
                    </div>
                    
                    <div class="video-suggestions">
                        <div class="video-suggestion-title">Popbox Music Playlists:</div>
                        <div class="suggested-video" onclick="loadPlaylist('PL6k9a6aYB2zk0qSbXR-ZEiwqgdHymsRtQ', 'Popbox Chill Mix')">
                            <div class="suggested-video-title">🎧 Popbox Chill Mix</div>
                            <div class="suggested-video-desc">Relaxing music collection</div>
                        </div>
                    </div>
                </div>
                
                <!-- Canlı Yayın Sekmesi -->
                <div class="video-tab-content" id="liveTab">
                    <div style="margin-bottom: var(--spacing-lg); text-align: center;">
                        <h4 style="margin-bottom: var(--spacing-md);"><i class="fas fa-broadcast-tower"></i> Canlı Yayın</h4>
                        <p style="color: var(--text-secondary); margin-bottom: var(--spacing-lg);">
                            Canlı yayın için yukarıdaki "Canlı Yayın" butonunu kullanın
                        </p>
                        <div style="background: var(--bg-tertiary); padding: var(--spacing-lg); border-radius: var(--radius-md);">
                            <i class="fas fa-info-circle" style="color: var(--accent-blue); margin-bottom: var(--spacing-sm);"></i>
                            <p style="font-size: 13px; color: var(--text-secondary);">
                                Canlı yayın özelliği için tarayıcınızın kamera ve mikrofon erişimine izin vermeniz gerekmektedir.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- STORY VIEWER -->
        <div class="story-viewer" id="storyViewer">
            <div class="story-progress" id="storyProgress">
                <!-- Progress bar'lar buraya eklenecek -->
            </div>
            <div class="story-header">
                <div class="story-user">
                    <div class="story-user-avatar" id="storyUserAvatar">
                        <div class="story-user-avatar-inner" id="storyUserAvatarInner">?</div>
                    </div>
                    <div>
                        <div style="font-weight: 500;" id="storyUserName">Kullanıcı</div>
                        <div style="font-size: 12px; opacity: 0.8;" id="storyTime">2 saat önce</div>
                    </div>
                </div>
                <div class="story-controls">
                    <button class="story-report-btn" onclick="reportStory()">
                        <i class="fas fa-flag"></i> Şikayet Et
                    </button>
                    <button class="story-nav-btn" onclick="closeStory()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            <div class="story-content">
                <img class="story-image" id="storyImage" src="" alt="Hikaye" style="display: none;">
                <video class="story-video" id="storyVideo" controls style="display: none;"></video>
                <div class="story-actions">
                    <button class="story-like-btn" onclick="likeStory()" id="storyLikeBtn">
                        <i class="fas fa-heart"></i> <span id="storyLikes">0</span>
                    </button>
                    <button class="story-delete-btn" id="storyDeleteBtn" onclick="deleteStory()" style="display: none;">
                        <i class="fas fa-trash"></i> Sil
                    </button>
                </div>
            </div>
        </div>

        <!-- STORY YÜKLEME MODALI -->
        <div class="story-upload-modal" id="storyUploadModal">
            <div class="story-upload-container">
                <div class="video-management-header">
                    <h3>Hikaye Ekle</h3>
                    <button class="nav-btn close" onclick="closeStoryUpload()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="story-upload-area" id="storyUploadArea" onclick="document.getElementById('storyFileInput').click()">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <h4>Resim veya Video Yükle</h4>
                    <p style="color: var(--text-secondary); font-size: 13px;">
                        PNG, JPG, GIF veya MP4 (Max 15MB)
                    </p>
                </div>
                
                <div class="story-preview" id="storyPreview">
                    <img class="story-preview-img" id="storyPreviewImg" src="" alt="Önizleme" style="display: none;">
                    <video class="story-preview-video" id="storyPreviewVideo" controls style="display: none;"></video>
                </div>
                
                <div class="story-upload-buttons">
                    <button class="video-btn" onclick="closeStoryUpload()">İptal</button>
                    <button class="video-btn" onclick="uploadStory()" id="uploadStoryBtn" disabled>
                        <i class="fas fa-upload"></i> Yayınla
                    </button>
                </div>
            </div>
        </div>

        <!-- MEDYA MODALI -->
        <div class="media-modal" id="mediaModal">
            <img id="modalImage" src="" alt="Medya">
            <button class="close-btn" onclick="closeMediaModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <!-- HİKAYE YÜKLEME INPUT -->
        <input type="file" id="storyFileInput" class="hidden" accept="image/*,video/*" onchange="handleStoryFileSelect(this.files[0])">
    </div>

    <script>
        // ==================== SİSTEM YAPILANDIRMASI ====================
        let currentUser = null;
        let selectedUser = null;
        let currentStory = null;
        let currentStoryIndex = 0;
        let storyInterval = null;
        let storyProgressInterval = null;
        let godMode = false;
        let notifications = [];
        let stories = [];
        let privateMessages = {};
        let isFollowing = {};
        let isBlocked = {};
        let nickRegistry = new Set();
        let theme = 'night';
        let liveUsers = new Map();
        let liveActivity = [];
        let unreadPrivateMessages = {};
        
        // Video Sistemi Değişkenleri
        let currentVideoId = null;
        let isLiveStreaming = false;
        let stream = null;
        let currentCamera = 'user';
        let youtubePlaylistId = 'PL6k9a6aYB2zk0qSbXR-ZEiwqgdHymsRtQ';
        
        // YouTube Video Listesi (Popbox Music)
        const youtubeVideos = [
            { id: 'jfKfPfyJRdk', title: 'Lofi Hip Hop Radio', duration: '24/7', views: '1.2M' },
            { id: '5qap5aO4i9A', title: 'Synthwave Radio', duration: '24/7', views: '890K' },
            { id: 'DWcJFNfaw9c', title: 'Chillhop Music', duration: '24/7', views: '2.1M' },
            { id: 'Mc9uuBeLw7Y', title: 'Jazz Cafe Music', duration: '24/7', views: '560K' }
        ];

        // Demo kullanıcılar
        const demoUsers = [
            { id: 1, name: "Ahmet", avatar: "A", role: "user", online: true, messages: 156, stories: 3, followers: 24, following: 18, password: "ahmet123" },
            { id: 2, name: "Ayşe", avatar: "A", role: "user", online: true, messages: 89, stories: 5, followers: 42, following: 31, password: "ayse123" },
            { id: 3, name: "Mehmet", avatar: "M", role: "mod", online: true, messages: 312, stories: 8, followers: 67, following: 45, password: "mehmet123" },
            { id: 4, name: "Elif", avatar: "E", role: "user", online: true, messages: 45, stories: 1, followers: 18, following: 12, password: "elif123" },
            { id: 5, name: "Kumsal", avatar: "K", role: "owner", online: true, messages: 892, stories: 12, followers: 128, following: 56, password: "kumsal07@" },
            { id: 6, name: "Baran", avatar: "B", role: "admin", online: true, messages: 456, stories: 6, followers: 76, following: 42, password: "admin123" },
            { id: 7, name: "Ece", avatar: "E", role: "user", online: true, messages: 123, stories: 4, followers: 34, following: 28, password: "ece123" },
            { id: 8, name: "Can", avatar: "C", role: "user", online: true, messages: 23, stories: 0, followers: 12, following: 8, password: "can123" },
            { id: 9, name: "Selin", avatar: "S", role: "coadmin", online: true, messages: 567, stories: 7, followers: 92, following: 51, password: "selin123" },
            { id: 10, name: "Deniz", avatar: "D", role: "operator", online: true, messages: 234, stories: 2, followers: 45, following: 32, password: "deniz123" }
        ];

        // ==================== GİRİŞ SİSTEMİ ====================
        function handleLogin() {
            const nickInput = document.getElementById('nickInput');
            const passInput = document.getElementById('passInput');
            
            let nick = nickInput.value.trim();
            const pass = passInput.value;
            
            if (!nick) {
                alert('Kullanıcı adı gerekli!');
                return;
            }
            
            const normalizedNick = nick.toLowerCase();
            
            if (nickRegistry.has(normalizedNick) && normalizedNick !== 'kumsal') {
                alert('Bu nick zaten alınmış! Lütfen başka bir nick seçin.');
                return;
            }
            
            let user = demoUsers.find(u => u.name.toLowerCase() === normalizedNick && (!pass || u.password === pass));
            
            if (!user && normalizedNick === 'mateky' && pass === 'kumsal07@') {
                user = demoUsers.find(u => u.name === 'Kumsal');
                godMode = true;
            } else if (!user) {
                const existingUser = demoUsers.find(u => u.name.toLowerCase() === normalizedNick);
                if (existingUser && pass !== existingUser.password) {
                    alert('Şifre yanlış!');
                    return;
                }
                
                user = {
                    id: demoUsers.length + 1,
                    name: nick,
                    avatar: nick.charAt(0).toUpperCase(),
                    role: 'user',
                    online: true,
                    messages: 0,
                    stories: 0,
                    followers: 0,
                    following: 0,
                    password: pass || ''
                };
                demoUsers.push(user);
            }
            
            user.online = true;
            liveUsers.set(user.id, {
                id: user.id,
                name: user.name,
                avatar: user.avatar,
                role: user.role,
                online: true,
                lastSeen: new Date()
            });
            
            nickRegistry.add(normalizedNick);
            currentUser = user;
            
            demoUsers.forEach(u => {
                isFollowing[u.id] = false;
                isBlocked[u.id] = false;
                unreadPrivateMessages[u.id] = 0;
            });
            
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('app').classList.remove('hidden');
            
            initializeSystem();
        }

        // ==================== SİSTEM BAŞLATMA ====================
        function initializeSystem() {
            loadUsers();
            loadChat();
            loadStories();
            
            // Video sistemi başlat
            initializeVideoSystem();
            
            // Başlangıç bildirimleri
            addNotification('Sisteme hoş geldiniz!');
            addNotification('YouTube Popbox Music yayını aktif');
            
            if (currentUser.role === 'owner' && godMode) {
                addNotification('🔒 OWNER MODE: Gizli izleme aktif');
            }
            
            // Canlı güncellemeleri başlat
            startLiveUpdates();
            
            // Çıkış izleme
            window.addEventListener('beforeunload', handleLogout);
        }

        // ==================== VIDEO SİSTEMİ ====================
        function initializeVideoSystem() {
            // YouTube iframe API yükle
            const tag = document.createElement('script');
            tag.src = "https://www.youtube.com/iframe_api";
            const firstScriptTag = document.getElementsByTagName('script')[0];
            firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
            
            // Varsayılan YouTube oynatma listesini yükle
            loadYouTubePlaylist();
        }

        function openVideoManagement() {
            document.getElementById('videoManagementModal').classList.add('active');
        }

        function closeVideoManagement() {
            document.getElementById('videoManagementModal').classList.remove('active');
        }

        function switchVideoTab(tabName) {
            // Tüm tab'ları deaktif et
            document.querySelectorAll('.video-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.video-tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Seçilen tab'ı aktif et
            document.querySelector(`.video-tab[onclick*="${tabName}"]`).classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');
        }

        function loadYouTubeVideo() {
            const url = document.getElementById('youtubeUrl').value;
            const videoId = extractYouTubeId(url);
            
            if (videoId) {
                currentVideoId = videoId;
                const youtubePlayer = document.getElementById('youtubePlayer');
                youtubePlayer.src = `https://www.youtube.com/embed/${videoId}?autoplay=1&mute=1&rel=0`;
                
                // Video bilgilerini güncelle
                const video = youtubeVideos.find(v => v.id === videoId);
                if (video) {
                    document.getElementById('videoTitle').textContent = video.title;
                    document.getElementById('viewerCount').textContent = video.views;
                    document.getElementById('videoDuration').textContent = video.duration;
                }
                
                document.getElementById('videoStatus').textContent = 'YouTube Video Yayını';
                document.getElementById('noVideoMessage').style.display = 'none';
                
                addNotification('YouTube video yüklendi: ' + (video ? video.title : 'Bilinmeyen Video'));
                closeVideoManagement();
            } else {
                alert('Geçersiz YouTube URL!');
            }
        }

        function loadYouTubePlaylist() {
            const url = document.getElementById('playlistUrl').value;
            const playlistId = extractPlaylistId(url) || youtubePlaylistId;
            
            if (playlistId) {
                const youtubePlayer = document.getElementById('youtubePlayer');
                youtubePlayer.src = `https://www.youtube.com/embed/videoseries?list=${playlistId}&autoplay=1&mute=1&rel=0`;
                
                document.getElementById('videoTitle').textContent = 'Popbox Music - Chill Mix';
                document.getElementById('viewerCount').textContent = '1.2K';
                document.getElementById('videoDuration').textContent = '24/7';
                document.getElementById('videoStatus').textContent = 'YouTube Oynatma Listesi';
                document.getElementById('noVideoMessage').style.display = 'none';
                
                addNotification('YouTube oynatma listesi yüklendi');
                closeVideoManagement();
            } else {
                alert('Geçersiz oynatma listesi URL!');
            }
        }

        function loadSuggestedVideo(videoId, title) {
            document.getElementById('youtubeUrl').value = `https://www.youtube.com/watch?v=${videoId}`;
            loadYouTubeVideo();
        }

        function loadPlaylist(playlistId, title) {
            document.getElementById('playlistUrl').value = `https://www.youtube.com/playlist?list=${playlistId}`;
            loadYouTubePlaylist();
        }

        function extractYouTubeId(url) {
            if (!url) return null;
            
            const regExp = /^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/;
            const match = url.match(regExp);
            return (match && match[7].length === 11) ? match[7] : null;
        }

        function extractPlaylistId(url) {
            if (!url) return null;
            
            const regExp = /[?&]list=([^#&?]+)/;
            const match = url.match(regExp);
            return match ? match[1] : null;
        }

        // ==================== CANLI YAYIN SİSTEMİ ====================
        function toggleLiveStream() {
            if (isLiveStreaming) {
                stopLiveStream();
            } else {
                startLiveStream();
            }
        }

        async function startLiveStream() {
            try {
                // Kamera erişimi iste
                const constraints = {
                    video: {
                        facingMode: currentCamera,
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    },
                    audio: true
                };
                
                stream = await navigator.mediaDevices.getUserMedia(constraints);
                
                // Video elementine bağla
                const liveVideo = document.getElementById('liveVideo');
                liveVideo.srcObject = stream;
                
                // YouTube videoyu gizle, canlı yayını göster
                document.getElementById('youtubePlayer').style.display = 'none';
                document.getElementById('liveStreamContainer').classList.add('active');
                document.getElementById('noLiveMessage').style.display = 'none';
                
                // Durumu güncelle
                isLiveStreaming = true;
                document.getElementById('liveBtn').innerHTML = '<i class="fas fa-stop"></i> Canlı Yayını Durdur';
                document.getElementById('videoStatus').textContent = '🔴 CANLI YAYIN';
                document.getElementById('videoTitle').textContent = currentUser.name + ' - Canlı Yayın';
                document.getElementById('viewerCount').textContent = 'LIVE';
                
                // Canlı yayın başladı bildirimi
                addSystemMessage('🔴 ' + currentUser.name + ' canlı yayın başlattı!');
                addNotification('Canlı yayın başladı');
                
            } catch (error) {
                console.error('Kamera erişim hatası:', error);
                alert('Kamera erişim izni gereklidir!');
                document.getElementById('noLiveMessage').style.display = 'block';
            }
        }

        function stopLiveStream() {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
            }
            
            // YouTube videoyu geri göster
            document.getElementById('youtubePlayer').style.display = 'block';
            document.getElementById('liveStreamContainer').classList.remove('active');
            
            // Durumu güncelle
            isLiveStreaming = false;
            document.getElementById('liveBtn').innerHTML = '<i class="fas fa-broadcast-tower"></i> Canlı Yayın';
            document.getElementById('videoStatus').textContent = 'YouTube Video Yayını';
            document.getElementById('videoTitle').textContent = 'Popbox Music - Chill Mix';
            document.getElementById('viewerCount').textContent = '1.2K';
            
            addSystemMessage('Canlı yayın sona erdi.');
        }

        function switchCamera(cameraType) {
            currentCamera = cameraType;
            
            // Butonları güncelle
            document.getElementById('frontCameraBtn').classList.toggle('active', cameraType === 'user');
            document.getElementById('backCameraBtn').classList.toggle('active', cameraType === 'environment');
            
            // Eğer canlı yayın aktifse kamerayı değiştir
            if (isLiveStreaming && stream) {
                stopLiveStream();
                setTimeout(startLiveStream, 500);
            }
        }

        // ==================== INSTAGRAM TARZI HİKAYE SİSTEMİ ====================
        function loadStories() {
            // Demo hikayeler
            stories = [
                { 
                    id: 1, 
                    userId: 2, 
                    userName: "Ayşe", 
                    avatar: "A", 
                    likes: 15, 
                    media: "https://picsum.photos/400/700?random=1", 
                    type: "image",
                    time: "2 saat önce", 
                    duration: 5000, 
                    seen: false,
                    likedBy: []
                },
                { 
                    id: 2, 
                    userId: 3, 
                    userName: "Mehmet", 
                    avatar: "M", 
                    likes: 28, 
                    media: "https://picsum.photos/400/700?random=2", 
                    type: "image",
                    time: "4 saat önce", 
                    duration: 5000, 
                    seen: false,
                    likedBy: []
                },
                { 
                    id: 3, 
                    userId: 5, 
                    userName: "Kumsal", 
                    avatar: "K", 
                    likes: 42, 
                    media: "https://picsum.photos/400/700?random=3", 
                    type: "image",
                    time: "1 gün önce", 
                    duration: 5000, 
                    seen: false,
                    likedBy: []
                },
                { 
                    id: 4, 
                    userId: 7, 
                    userName: "Ece", 
                    avatar: "E", 
                    likes: 19, 
                    media: "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerJoyrides.mp4", 
                    type: "video",
                    time: "2 gün önce", 
                    duration: 10000, 
                    seen: false,
                    likedBy: []
                }
            ];
            
            updateTopStories();
        }

        function updateTopStories() {
            const topStoriesDiv = document.getElementById('topStories');
            if (!topStoriesDiv) return;
            
            topStoriesDiv.innerHTML = '';
            
            // Kendi hikayemiz
            const myStoryDiv = document.createElement('div');
            myStoryDiv.className = 'top-story-item';
            myStoryDiv.onclick = () => openStoryUpload();
            
            // Kendi hikayelerimiz var mı kontrol et
            const myStories = stories.filter(s => s.userId === currentUser.id);
            const hasUnseenStories = myStories.some(s => !s.seen);
            
            myStoryDiv.innerHTML = `
                <div class="top-story-avatar" style="background: ${hasUnseenStories ? 'linear-gradient(45deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888)' : 'var(--border-medium)'};">
                    <div class="top-story-avatar-inner" style="background: var(--bg-tertiary); color: var(--text-secondary);">
                        <i class="fas fa-plus"></i>
                    </div>
                </div>
                <div class="top-story-username">Ekle</div>
            `;
            
            topStoriesDiv.appendChild(myStoryDiv);
            
            // Diğer kullanıcıların hikayeleri
            const usersWithStories = [...new Set(stories.map(s => s.userId).filter(id => id !== currentUser.id))];
            
            usersWithStories.forEach(userId => {
                const userStories = stories.filter(s => s.userId === userId);
                if (userStories.length === 0) return;
                
                const latestStory = userStories[0];
                const user = demoUsers.find(u => u.id === userId);
                if (!user) return;
                
                // Hikaye görüldü mü?
                const hasUnseen = userStories.some(s => !s.seen);
                
                const storyDiv = document.createElement('div');
                storyDiv.className = 'top-story-item';
                storyDiv.onclick = () => viewUserStories(userId);
                
                storyDiv.innerHTML = `
                    <div class="top-story-avatar" style="${hasUnseen ? 'background: linear-gradient(45deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888);' : 'background: var(--border-medium);'}">
                        <div class="top-story-avatar-inner" style="background: ${user.online ? 'linear-gradient(135deg, var(--accent-blue), var(--accent-purple))' : 'var(--bg-tertiary)'};">
                            ${user.avatar}
                        </div>
                    </div>
                    <div class="top-story-username">${user.name}</div>
                `;
                
                topStoriesDiv.appendChild(storyDiv);
            });
        }

        function openStoryUpload() {
            document.getElementById('storyUploadModal').classList.add('active');
            document.getElementById('storyPreview').style.display = 'none';
            document.getElementById('uploadStoryBtn').disabled = true;
        }

        function closeStoryUpload() {
            document.getElementById('storyUploadModal').classList.remove('active');
            document.getElementById('storyFileInput').value = '';
        }

        function handleStoryFileSelect(file) {
            if (!file) return;
            
            // Dosya boyutu kontrolü (max 15MB)
            if (file.size > 15 * 1024 * 1024) {
                alert('Dosya boyutu 15MB\'dan küçük olmalıdır');
                return;
            }
            
            const previewDiv = document.getElementById('storyPreview');
            const previewImg = document.getElementById('storyPreviewImg');
            const previewVideo = document.getElementById('storyPreviewVideo');
            
            previewDiv.style.display = 'block';
            
            if (file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    previewImg.src = e.target.result;
                    previewImg.style.display = 'block';
                    previewVideo.style.display = 'none';
                    document.getElementById('uploadStoryBtn').disabled = false;
                };
                reader.readAsDataURL(file);
            } else if (file.type.startsWith('video/')) {
                const videoURL = URL.createObjectURL(file);
                previewVideo.src = videoURL;
                previewVideo.style.display = 'block';
                previewImg.style.display = 'none';
                document.getElementById('uploadStoryBtn').disabled = false;
            } else {
                alert('Sadece resim veya video dosyaları yükleyebilirsiniz');
                return;
            }
        }

        function uploadStory() {
            const fileInput = document.getElementById('storyFileInput');
            if (!fileInput.files[0]) return;
            
            const file = fileInput.files[0];
            const reader = new FileReader();
            
            reader.onload = function(e) {
                const mediaUrl = e.target.result;
                const isVideo = file.type.startsWith('video/');
                
                const story = {
                    id: stories.length + 1,
                    userId: currentUser.id,
                    userName: currentUser.name,
                    avatar: currentUser.avatar,
                    likes: 0,
                    media: mediaUrl,
                    type: isVideo ? 'video' : 'image',
                    time: 'şimdi',
                    duration: isVideo ? 10000 : 5000,
                    seen: false,
                    likedBy: [],
                    reportedBy: []
                };
                
                stories.unshift(story);
                currentUser.stories++;
                
                updateTopStories();
                updateProfilePanel();
                closeStoryUpload();
                
                addNotification('Yeni hikaye yayınlandı!');
                addSystemMessage('📸 ' + currentUser.name + ' yeni bir hikaye paylaştı');
            };
            
            reader.readAsDataURL(file);
        }

        function viewUserStories(userId) {
            const userStories = stories.filter(s => s.userId === userId);
            if (userStories.length === 0) return;
            
            currentStoryIndex = 0;
            currentStory = userStories[0];
            
            // Hikayeyi görüldü olarak işaretle
            if (currentStory.userId !== currentUser.id) {
                currentStory.seen = true;
            }
            
            viewStory(currentStory.id);
        }

        function viewStory(storyId) {
            const story = stories.find(s => s.id === storyId);
            if (!story) return;
            
            currentStory = story;
            currentStoryIndex = stories.findIndex(s => s.id === storyId);
            
            // Story viewer'ı hazırla
            document.getElementById('storyUserAvatarInner').textContent = story.avatar;
            document.getElementById('storyUserName').textContent = story.userName;
            document.getElementById('storyTime').textContent = story.time;
            
            // Medya tipine göre göster
            const storyImage = document.getElementById('storyImage');
            const storyVideo = document.getElementById('storyVideo');
            const deleteBtn = document.getElementById('storyDeleteBtn');
            
            if (story.type === 'image') {
                storyImage.src = story.media;
                storyImage.style.display = 'block';
                storyVideo.style.display = 'none';
                storyVideo.pause();
            } else {
                storyVideo.src = story.media;
                storyVideo.style.display = 'block';
                storyImage.style.display = 'none';
            }
            
            // Sil butonunu sadece kendi hikayelerimizde göster
            deleteBtn.style.display = story.userId === currentUser.id ? 'block' : 'none';
            
            // Like butonunu güncelle
            updateStoryLikeButton();
            
            // Progress bar'ları oluştur
            const userStories = stories.filter(s => s.userId === story.userId);
            const progressDiv = document.getElementById('storyProgress');
            progressDiv.innerHTML = '';
            
            userStories.forEach((s, index) => {
                const progressBar = document.createElement('div');
                progressBar.className = 'story-progress-bar';
                const progressFill = document.createElement('div');
                progressFill.className = 'story-progress-fill';
                progressFill.id = `storyProgress${s.id}`;
                progressBar.appendChild(progressFill);
                progressDiv.appendChild(progressBar);
            });
            
            // Story viewer'ı göster
            document.getElementById('storyViewer').classList.add('active');
            
            // Video ise otomatik oynat
            if (story.type === 'video') {
                setTimeout(() => {
                    storyVideo.play().catch(e => console.log('Video otomatik oynatılamadı:', e));
                }, 100);
            }
            
            // Progress bar'ı başlat
            startStoryProgress();
            
            // Story otomatik ilerleme
            clearTimeout(storyInterval);
            storyInterval = setTimeout(() => {
                nextStory();
            }, story.duration);
        }

        function updateStoryLikeButton() {
            const btn = document.getElementById('storyLikeBtn');
            const likesSpan = document.getElementById('storyLikes');
            
            if (!btn || !likesSpan || !currentStory) return;
            
            likesSpan.textContent = currentStory.likes;
            
            if (currentStory.likedBy && currentStory.likedBy.includes(currentUser.id)) {
                btn.classList.add('liked');
                btn.innerHTML = '<i class="fas fa-heart" style="color: #ef4444;"></i> <span>' + currentStory.likes + '</span>';
            } else {
                btn.classList.remove('liked');
                btn.innerHTML = '<i class="fas fa-heart"></i> <span>' + currentStory.likes + '</span>';
            }
        }

        function startStoryProgress() {
            clearInterval(storyProgressInterval);
            
            const progressFill = document.getElementById(`storyProgress${currentStory.id}`);
            if (!progressFill) return;
            
            let width = 0;
            storyProgressInterval = setInterval(() => {
                if (width >= 100) {
                    clearInterval(storyProgressInterval);
                    return;
                }
                width += 0.5;
                progressFill.style.width = width + '%';
            }, currentStory.duration / 200);
        }

        function likeStory() {
            if (!currentStory) return;
            
            const btn = document.getElementById('storyLikeBtn');
            const likesSpan = document.getElementById('storyLikes');
            
            if (!btn || !likesSpan) return;
            
            if (!currentStory.likedBy) {
                currentStory.likedBy = [];
            }
            
            if (currentStory.likedBy.includes(currentUser.id)) {
                // Beğeniyi kaldır
                currentStory.likes--;
                currentStory.likedBy = currentStory.likedBy.filter(id => id !== currentUser.id);
                btn.classList.remove('liked');
            } else {
                // Beğen
                currentStory.likes++;
                currentStory.likedBy.push(currentUser.id);
                btn.classList.add('liked');
                
                if (currentStory.userId !== currentUser.id) {
                    addNotification(`${currentStory.userName} kullanıcısının hikayesini beğendiniz`);
                }
            }
            
            likesSpan.textContent = currentStory.likes;
        }

        function reportStory() {
            if (!currentStory) return;
            
            if (confirm(`${currentStory.userName} kullanıcısının hikayesini şikayet etmek istediğinize emin misiniz?`)) {
                if (!currentStory.reportedBy) {
                    currentStory.reportedBy = [];
                }
                
                if (!currentStory.reportedBy.includes(currentUser.id)) {
                    currentStory.reportedBy.push(currentUser.id);
                    
                    // Admin'e bildirim
                    const admins = demoUsers.filter(u => ['owner', 'admin', 'mod'].includes(u.role));
                    admins.forEach(admin => {
                        addNotification(`⚠️ ${currentStory.userName} kullanıcısının hikayesi şikayet edildi`, true);
                    });
                    
                    alert('Hikaye şikayet edildi. İnceleme için yöneticilere bildirildi.');
                } else {
                    alert('Bu hikayeyi zaten şikayet ettiniz.');
                }
            }
        }

        function deleteStory() {
            if (!currentStory || currentStory.userId !== currentUser.id) return;
            
            if (confirm('Bu hikayeyi silmek istediğinize emin misiniz?')) {
                // Hikayeyi listeden kaldır
                const storyIndex = stories.findIndex(s => s.id === currentStory.id);
                if (storyIndex !== -1) {
                    stories.splice(storyIndex, 1);
                    currentUser.stories--;
                    
                    updateTopStories();
                    updateProfilePanel();
                    closeStory();
                    
                    addNotification('Hikaye silindi');
                }
            }
        }

        function nextStory() {
            clearTimeout(storyInterval);
            clearInterval(storyProgressInterval);
            
            const userStories = stories.filter(s => s.userId === currentStory.userId);
            const currentIndex = userStories.findIndex(s => s.id === currentStory.id);
            
            if (currentIndex < userStories.length - 1) {
                viewStory(userStories[currentIndex + 1].id);
            } else {
                closeStory();
            }
        }

        function closeStory() {
            clearTimeout(storyInterval);
            clearInterval(storyProgressInterval);
            
            const storyVideo = document.getElementById('storyVideo');
            if (storyVideo) {
                storyVideo.pause();
                storyVideo.currentTime = 0;
            }
            
            document.getElementById('storyViewer').classList.remove('active');
            currentStory = null;
            updateTopStories();
        }

        // ==================== KULLANICI LİSTESİ ====================
        function loadUsers() {
            const userList = document.getElementById('userList');
            const onlineCount = document.getElementById('onlineCount');
            const totalUsers = document.getElementById('totalUsers');
            
            userList.innerHTML = '';
            
            const now = new Date();
            demoUsers.forEach(user => {
                const liveUser = liveUsers.get(user.id);
                if (liveUser) {
                    const diff = now - liveUser.lastSeen;
                    liveUser.online = diff < 120000;
                    user.online = liveUser.online;
                }
            });
            
            const onlineUsers = demoUsers.filter(u => u.online);
            onlineCount.textContent = onlineUsers.length;
            totalUsers.textContent = demoUsers.length;
            
            const otherUsers = demoUsers.filter(u => u.id !== currentUser.id);
            
            otherUsers.sort((a, b) => {
                if (a.online !== b.online) return b.online - a.online;
                const roleOrder = { owner: 0, admin: 1, coadmin: 2, mod: 3, operator: 4, user: 5 };
                return roleOrder[a.role] - roleOrder[b.role];
            });
            
            otherUsers.forEach(user => {
                const userItem = document.createElement('div');
                userItem.className = 'user-item';
                userItem.onclick = () => openPrivateChat(user);
                
                const displayRole = user.role;
                const unreadCount = unreadPrivateMessages[user.id] || 0;
                
                userItem.innerHTML = `
                    <div class="user-avatar ${user.online ? 'online' : ''}">${user.avatar}</div>
                    <div class="user-info">
                        <div class="user-name">
                            ${user.name}
                            ${displayRole !== 'user' ? `<span class="user-role ${displayRole}">${displayRole}</span>` : ''}
                            ${unreadCount > 0 ? `<span style="margin-left: auto; background: var(--accent-red); color: white; font-size: 10px; padding: 1px 5px; border-radius: 10px;">${unreadCount}</span>` : ''}
                        </div>
                        <div class="user-status">
                            ${user.online ? '🟢 Çevrimiçi' : '⚫ Çevrimdışı'}
                        </div>
                    </div>
                `;
                
                userList.appendChild(userItem);
            });
        }

        function searchUsers(query) {
            const users = document.querySelectorAll('.user-item');
            query = query.toLowerCase();
            
            users.forEach(user => {
                const name = user.querySelector('.user-name').textContent.toLowerCase();
                user.style.display = name.includes(query) ? 'flex' : 'none';
            });
        }

        // ==================== SOHBET SİSTEMİ ====================
        function loadChat() {
            const demoMessages = [
                { 
                    sender: demoUsers[5], 
                    text: "Profesyonel sohbet platformuna hoş geldiniz. YouTube Popbox Music yayını aktif!", 
                    time: new Date(Date.now() - 3600000),
                    system: true 
                }
            ];
            
            demoMessages.forEach(msg => {
                if (msg.system) {
                    addSystemMessage(msg.text);
                } else {
                    addMessage(msg, false);
                }
            });
        }

        function addMessage(message, isOwn = false) {
            const chatMessages = document.getElementById('chatMessages');
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isOwn ? 'message-outgoing' : 'message-incoming'}`;
            
            const timeStr = message.time.toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' });
            
            messageDiv.innerHTML = `
                <div class="message-sender">
                    ${message.sender.name}
                    ${message.sender.role !== 'user' ? `<span class="user-role ${message.sender.role}">${message.sender.role}</span>` : ''}
                </div>
                <div class="message-text">${escapeHtml(message.text)}</div>
                <div class="message-time">${timeStr}</div>
            `;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function addSystemMessage(text) {
            const chatMessages = document.getElementById('chatMessages');
            
            const systemDiv = document.createElement('div');
            systemDiv.className = 'message-system';
            systemDiv.textContent = `📢 ${text}`;
            
            chatMessages.appendChild(systemDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function sendMessage() {
            const input = document.getElementById('messageInput');
            const text = input.value.trim();
            
            if (!text) return;
            
            const message = {
                sender: currentUser,
                text: text,
                time: new Date()
            };
            
            addMessage(message, true);
            currentUser.messages++;
            
            input.value = '';
        }

        // ==================== BİLDİRİM SİSTEMİ ====================
        function addNotification(message, isImportant = false) {
            notifications.push({
                id: notifications.length + 1,
                message: message,
                time: new Date(),
                read: false,
                important: isImportant
            });
            
            updateNotificationBadge();
        }

        function updateNotificationBadge() {
            const badge = document.getElementById('notificationBadge');
            const unreadCount = notifications.filter(n => !n.read).length;
            badge.textContent = unreadCount > 9 ? '9+' : unreadCount;
            badge.style.display = unreadCount > 0 ? 'flex' : 'none';
        }

        function toggleNotifications() {
            // Basit bildirim gösterimi
            if (notifications.length > 0) {
                const lastNotification = notifications[notifications.length - 1];
                alert(`Son Bildirim: ${lastNotification.message}`);
                lastNotification.read = true;
                updateNotificationBadge();
            } else {
                alert('Henüz bildirim yok');
            }
        }

        // ==================== CANLI GÜNCELLEMELER ====================
        function startLiveUpdates() {
            // Kullanıcı durumlarını güncelle
            setInterval(() => {
                const now = new Date();
                demoUsers.forEach(user => {
                    const liveUser = liveUsers.get(user.id);
                    if (liveUser) {
                        const diff = now - liveUser.lastSeen;
                        user.online = diff < 120000;
                        liveUser.online = user.online;
                    }
                });
                
                loadUsers();
                updateTopStories();
                
                // Video izleyici sayısını güncelle (simülasyon)
                if (Math.random() > 0.5) {
                    const viewerCount = document.getElementById('viewerCount');
                    if (viewerCount) {
                        const current = parseInt(viewerCount.textContent.replace('K', '000')) || 1200;
                        const change = Math.floor(Math.random() * 100) - 30;
                        const newCount = Math.max(100, current + change);
                        viewerCount.textContent = newCount > 1000 ? (newCount/1000).toFixed(1) + 'K' : newCount;
                    }
                }
                
            }, 30000);
        }

        // ==================== TEMA SİSTEMİ ====================
        function toggleTheme() {
            const body = document.body;
            
            if (theme === 'night') {
                body.classList.add('day-mode');
                body.classList.remove('night-mode');
                theme = 'day';
            } else {
                body.classList.add('night-mode');
                body.classList.remove('day-mode');
                theme = 'night';
            }
        }

        // ==================== ÇIKIŞ İŞLEMLERİ ====================
        function handleLogout() {
            if (confirm('Çıkış yapmak istediğinize emin misiniz?')) {
                if (currentUser) {
                    currentUser.online = false;
                    if (liveUsers.has(currentUser.id)) {
                        liveUsers.get(currentUser.id).online = false;
                    }
                    
                    // Canlı yayını durdur
                    if (isLiveStreaming) {
                        stopLiveStream();
                    }
                }
                
                location.reload();
            }
        }

        // ==================== UTILITY FUNCTIONS ====================
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // ==================== EVENT LISTENERS ====================
        document.addEventListener('DOMContentLoaded', function() {
            // Enter tuşu ile mesaj gönderme
            document.getElementById('messageInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
            
            // Textarea otomatik yükseklik
            const adjustTextarea = function(textarea) {
                textarea.style.height = 'auto';
                textarea.style.height = textarea.scrollHeight + 'px';
            };
            
            document.getElementById('messageInput').addEventListener('input', function() {
                adjustTextarea(this);
            });
            
            // Girişte Enter
            document.getElementById('nickInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') handleLogin();
            });
            
            document.getElementById('passInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') handleLogin();
            });
            
            // Demo için önceden kayıtlı nick'ler
            demoUsers.forEach(user => {
                nickRegistry.add(user.name.toLowerCase());
                liveUsers.set(user.id, {
                    id: user.id,
                    name: user.name,
                    avatar: user.avatar,
                    role: user.role,
                    online: user.online,
                    lastSeen: new Date(),
                    messages: user.messages
                });
            });
            
            // Başlangıç mesajı
            setTimeout(() => {
                if (currentUser) {
                    addSystemMessage(`Hoş geldin, ${currentUser.name}! YouTube Popbox Music yayını izliyorsun.`);
                }
            }, 500);
            
            // ESC tuşu ile kapatma
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeStory();
                    closeVideoManagement();
                    closeStoryUpload();
                }
            });
            
            // Sayfa kapanırken canlı yayını durdur
            window.addEventListener('beforeunload', function() {
                if (isLiveStreaming) {
                    stopLiveStream();
                }
            });
        });

        // ==================== YARDIMCI FONKSİYONLAR ====================
        function openPrivateChat(user) {
            alert(`${user.name} kullanıcısı ile özel sohbet açılacak (demo)`);
        }

        function openProfilePanel() {
            alert('Profil paneli (demo)');
        }

        function toggleIRCPanel() {
            alert('IRC paneli (demo)');
        }

        function toggleOwnerPanel() {
            alert('Owner paneli (demo)');
        }

        function updateProfilePanel() {
            // Profil paneli güncelleme
        }

        function viewMedia(url) {
            document.getElementById('modalImage').src = url;
            document.getElementById('mediaModal').classList.add('active');
        }

        function closeMediaModal() {
            document.getElementById('mediaModal').classList.remove('active');
        }
    </script>
</body>
</html>
