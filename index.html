<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Live Chat</title>
    <style>
        /* BASƒ∞T CSS */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: Arial, sans-serif;
            background: #1a1a2e;
            color: white;
            height: 100vh;
            display: flex;
            padding: 10px;
            gap: 10px;
        }
        
        /* YouTube Kƒ±smƒ± */
        .youtube-box {
            flex: 3;
            background: #000;
            border-radius: 10px;
            overflow: hidden;
        }
        
        /* Sohbet Kƒ±smƒ± */
        .chat-box {
            flex: 1;
            background: #2d2d44;
            border-radius: 10px;
            min-width: 350px;
            display: flex;
            flex-direction: column;
        }
        
        /* Sohbet Ba≈ülƒ±ƒüƒ± */
        .chat-header {
            background: #3d3d5c;
            padding: 15px;
            border-radius: 10px 10px 0 0;
            text-align: center;
            font-weight: bold;
            border-bottom: 2px solid #4fc3f7;
        }
        
        /* Mesajlar Alanƒ± */
        .messages {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        /* Tek Mesaj */
        .message {
            background: #3d3d5c;
            padding: 10px;
            border-radius: 8px;
            border-left: 3px solid #4fc3f7;
        }
        
        /* Mesaj G√∂nderme */
        .input-area {
            padding: 15px;
            background: #3d3d5c;
            border-radius: 0 0 10px 10px;
            display: flex;
            gap: 10px;
        }
        
        .input-area input {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 5px;
            background: #4a4a6a;
            color: white;
        }
        
        .input-area button {
            padding: 12px 20px;
            background: #4fc3f7;
            border: none;
            border-radius: 5px;
            color: white;
            cursor: pointer;
            font-weight: bold;
        }
        
        /* Yetki Renkleri */
        .admin { color: #ff5555; }
        .coadmin { color: #ffaa00; }
        .operator { color: #55aaff; }
        .user { color: #aaa; }
        
        /* Popup (Popbox) */
        .popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #2d2d44;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #4fc3f7;
            z-index: 1000;
            min-width: 300px;
        }
        
        .popup h3 {
            margin-bottom: 15px;
            color: #4fc3f7;
        }
        
        .popup input, .popup select {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            border: 1px solid #4a4a6a;
            background: #3d3d5c;
            color: white;
        }
        
        .popup-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .popup-buttons button {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .popup-buttons .ok {
            background: #4fc3f7;
            color: white;
        }
        
        .popup-buttons .cancel {
            background: #666;
            color: white;
        }
        
        /* Overlay */
        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 999;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            body {
                flex-direction: column;
            }
            .chat-box {
                min-width: auto;
                max-height: 50vh;
            }
        }
    </style>
    
    <!-- YouTube API -->
    <script src="https://www.youtube.com/iframe_api"></script>
    <!-- Socket.io -->
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
</head>
<body>
    <!-- YouTube Player -->
    <div class="youtube-box">
        <div id="youtube-player"></div>
    </div>
    
    <!-- Sohbet Kutusu -->
    <div class="chat-box">
        <div class="chat-header">
            YouTube Live Chat
            <div style="font-size: 12px; color: #aaa;">Kullanƒ±cƒ±lar: <span id="userCount">1</span></div>
        </div>
        
        <div class="messages" id="messages">
            <div class="message">
                <span style="color: #4fc3f7">[Sistem]</span> Sohbete ho≈ü geldin!
            </div>
        </div>
        
        <div class="input-area">
            <input type="text" id="messageInput" placeholder="Mesajƒ±nƒ±z...">
            <button onclick="sendMessage()">G√∂nder</button>
        </div>
    </div>
    
    <!-- Admin Paneli Popup -->
    <div class="overlay" id="overlay"></div>
    <div class="popup" id="adminPopup">
        <h3>üîê Admin Giri≈üi</h3>
        <input type="password" id="adminPassword" placeholder="Admin ≈ûifresi" value="admin123">
        <div class="popup-buttons">
            <button class="ok" onclick="loginAdmin()">Giri≈ü Yap</button>
            <button class="cancel" onclick="closePopup()">ƒ∞ptal</button>
        </div>
    </div>
    
    <!-- Kullanƒ±cƒ± ƒ∞≈ülemleri Popup -->
    <div class="popup" id="userPopup">
        <h3>üë§ Kullanƒ±cƒ± ƒ∞≈ülemleri</h3>
        <select id="userSelect">
            <option value="">Kullanƒ±cƒ± se√ßin</option>
        </select>
        <select id="actionSelect">
            <option value="coadmin">Co-Admin Yap</option>
            <option value="operator">Operator Yap</option>
            <option value="kick">At</option>
        </select>
        <div class="popup-buttons">
            <button class="ok" onclick="performAction()">Uygula</button>
            <button class="cancel" onclick="closePopup()">Kapat</button>
        </div>
    </div>
    
    <script>
        // DEƒûƒ∞≈ûKENLER
        let player;
        let socket;
        let currentUser = {
            name: 'Kullanƒ±cƒ±_' + Math.floor(Math.random() * 1000),
            role: 'user' // user, operator, coadmin, admin
        };
        let isAdmin = false;
        
        // YOUTUBE PLAYER
        function onYouTubeIframeAPIReady() {
            player = new YT.Player('youtube-player', {
                height: '100%',
                width: '100%',
                videoId: 'dQw4w9WgXcQ', // BUNA KENDƒ∞ Vƒ∞DEO ID'Nƒ∞ YAZ
                playerVars: {
                    'autoplay': 0,
                    'controls': 1,
                    'rel': 0
                },
                events: {
                    'onReady': onPlayerReady
                }
            });
        }
        
        function onPlayerReady(event) {
            console.log('YouTube player hazƒ±r');
        }
        
        // SOCKET.IO BAƒûLANTISI
        function connectSocket() {
            socket = io('http://localhost:3000');
            
            socket.on('connect', () => {
                console.log('Sunucuya baƒülandƒ±');
                socket.emit('join', { 
                    name: currentUser.name,
                    role: currentUser.role 
                });
            });
            
            socket.on('chat', (data) => {
                addMessage(data.user, data.message, data.role);
            });
            
            socket.on('users', (users) => {
                updateUserList(users);
            });
            
            socket.on('system', (msg) => {
                addSystemMessage(msg);
            });
        }
        
        // MESAJ ƒ∞≈ûLEMLERƒ∞
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            if (message.startsWith('/')) {
                handleCommand(message);
            } else {
                socket.emit('message', {
                    user: currentUser.name,
                    message: message,
                    role: currentUser.role
                });
            }
            
            input.value = '';
            input.focus();
        }
        
        function handleCommand(cmd) {
            const parts = cmd.split(' ');
            const command = parts[0];
            
            switch(command) {
                case '/admin':
                    if (parts[1] === '123') {
                        currentUser.role = 'admin';
                        isAdmin = true;
                        addSystemMessage('Admin yetkisi alƒ±ndƒ±!');
                    }
                    break;
                    
                case '/popup':
                    showAdminPopup();
                    break;
                    
                case '/users':
                    showUserPopup();
                    break;
                    
                case '/clear':
                    if (isAdmin) {
                        document.getElementById('messages').innerHTML = '';
                        addSystemMessage('Chat temizlendi.');
                    }
                    break;
                    
                default:
                    addSystemMessage('Bilinmeyen komut: ' + command);
            }
        }
        
        // MESAJ G√ñSTERME
        function addMessage(user, message, role = 'user') {
            const messagesDiv = document.getElementById('messages');
            const msgDiv = document.createElement('div');
            msgDiv.className = 'message';
            
            let roleClass = role;
            let roleSymbol = '';
            
            if (role === 'admin') roleSymbol = 'üëë ';
            else if (role === 'coadmin') roleSymbol = '‚≠ê ';
            else if (role === 'operator') roleSymbol = 'üõ°Ô∏è ';
            
            msgDiv.innerHTML = `
                <span class="${roleClass}">${roleSymbol}${user}:</span> ${message}
                <span style="float: right; color: #666; font-size: 12px">
                    ${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}
                </span>
            `;
            
            messagesDiv.appendChild(msgDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }
        
        function addSystemMessage(message) {
            const messagesDiv = document.getElementById('messages');
            const msgDiv = document.createElement('div');
            msgDiv.className = 'message';
            msgDiv.innerHTML = `<span style="color: #4fc3f7">[Sistem]</span> ${message}`;
            messagesDiv.appendChild(msgDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }
        
        // POPUP ƒ∞≈ûLEMLERƒ∞
        function showAdminPopup() {
            if (!isAdmin) {
                document.getElementById('adminPopup').style.display = 'block';
                document.getElementById('overlay').style.display = 'block';
            } else {
                showUserPopup();
            }
        }
        
        function loginAdmin() {
            const password = document.getElementById('adminPassword').value;
            if (password === 'admin123') {
                currentUser.role = 'admin';
                isAdmin = true;
                socket.emit('role-change', { role: 'admin' });
                addSystemMessage('Admin paneline ho≈ü geldin!');
                closePopup();
                showUserPopup();
            } else {
                alert('Yanlƒ±≈ü ≈üifre!');
            }
        }
        
        function showUserPopup() {
            if (!isAdmin) {
                addSystemMessage('Bu i≈ülem i√ßin admin yetkisi gerekiyor!');
                return;
            }
            
            // Kullanƒ±cƒ± listesini doldur
            const select = document.getElementById('userSelect');
            select.innerHTML = '<option value="">Kullanƒ±cƒ± se√ßin</option>';
            
            // Burada socket'ten kullanƒ±cƒ± listesi alƒ±nacak
            // ≈ûimdilik √∂rnek
            ['Ahmet', 'Mehmet', 'Ay≈üe'].forEach(user => {
                if (user !== currentUser.name) {
                    const option = document.createElement('option');
                    option.value = user;
                    option.textContent = user;
                    select.appendChild(option);
                }
            });
            
            document.getElementById('userPopup').style.display = 'block';
            document.getElementById('overlay').style.display = 'block';
        }
        
        function performAction() {
            const user = document.getElementById('userSelect').value;
            const action = document.getElementById('actionSelect').value;
            
            if (!user) {
                alert('L√ºtfen bir kullanƒ±cƒ± se√ßin!');
                return;
            }
            
            socket.emit('admin-action', {
                target: user,
                action: action,
                by: currentUser.name
            });
            
            addSystemMessage(`${user} kullanƒ±cƒ±sƒ±na ${action} i≈ülemi uygulandƒ±.`);
            closePopup();
        }
        
        function closePopup() {
            document.getElementById('adminPopup').style.display = 'none';
            document.getElementById('userPopup').style.display = 'none';
            document.getElementById('overlay').style.display = 'none';
        }
        
        // KULLANICI Lƒ∞STESƒ∞
        function updateUserList(users) {
            document.getElementById('userCount').textContent = users.length;
        }
        
        // RESƒ∞M Y√úKLEME (Base64)
        function uploadImage(file) {
            if (!file.type.startsWith('image/')) {
                addSystemMessage('Sadece resim dosyalarƒ± y√ºklenebilir!');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const base64 = e.target.result;
                
                // Resmi g√∂nder
                socket.emit('image', {
                    user: currentUser.name,
                    image: base64,
                    role: currentUser.role
                });
                
                // √ñnizleme g√∂ster
                const img = document.createElement('img');
                img.src = base64;
                img.style.maxWidth = '200px';
                img.style.maxHeight = '200px';
                img.style.borderRadius = '5px';
                img.style.marginTop = '5px';
                
                addMessage(currentUser.name, 'Resim g√∂nderdi:');
                const lastMsg = document.getElementById('messages').lastChild;
                lastMsg.appendChild(img);
            };
            
            reader.readAsDataURL(file);
        }
        
        // SAYFA Y√úKLENƒ∞NCE
        document.addEventListener('DOMContentLoaded', function() {
            // Kullanƒ±cƒ± adƒ± sor
            const name = prompt('Kullanƒ±cƒ± adƒ±nƒ±z:', currentUser.name);
            if (name) currentUser.name = name;
            
            // Socket baƒülantƒ±sƒ±nƒ± kur
            connectSocket();
            
            // Enter tu≈üu ile mesaj g√∂nderme
            document.getElementById('messageInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') sendMessage();
            });
            
            // Admin ≈üifre input'u i√ßin Enter
            document.getElementById('adminPassword').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') loginAdmin();
            });
            
            // Overlay'e tƒ±klayƒ±nca popup'ƒ± kapat
            document.getElementById('overlay').addEventListener('click', closePopup);
            
            addSystemMessage(`Ho≈ü geldin, ${currentUser.name}!`);
            addSystemMessage('Komutlar: /admin [≈üifre], /popup, /users, /clear');
        });
    </script>
</body>
</html>
