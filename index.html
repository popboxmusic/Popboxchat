<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EliteChat - Profesyonel IRC Platformu</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* === TEMEL STƒ∞LLER === */
        :root {
            --bg-primary: #0a0a0a; --bg-secondary: #111111; --bg-tertiary: #1a1a1a;
            --text-primary: #ffffff; --text-secondary: #b0b0b0; --accent-blue: #3b82f6;
            --accent-green: #10b981; --accent-red: #ef4444; --border-light: #222222;
            --accent-purple: #8b5cf6; --accent-yellow: #f59e0b;
        }
        body.day-mode {
            --bg-primary: #f8fafc; --bg-secondary: #ffffff; --bg-tertiary: #f1f5f9;
            --text-primary: #0f172a; --text-secondary: #475569; --border-light: #e2e8f0;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body, html { height: 100%; width: 100%; overflow: hidden; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: var(--bg-primary); color: var(--text-primary);
            display: flex; flex-direction: column;
        }
        body::before {
            content: ''; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-image: 
                radial-gradient(circle at 25px 25px, rgba(255, 255, 255, 0.05) 2%, transparent 2.5%),
                radial-gradient(circle at 75px 75px, rgba(255, 255, 255, 0.05) 2%, transparent 2.5%);
            background-size: 100px 100px; pointer-events: none; z-index: -1;
        }
        body.day-mode::before {
            background-image: 
                radial-gradient(circle at 25px 25px, rgba(0, 0, 0, 0.03) 2%, transparent 2.5%),
                radial-gradient(circle at 75px 75px, rgba(0, 0, 0, 0.03) 2%, transparent 2.5%);
        }
        
        /* === Gƒ∞Rƒ∞≈û EKRANI === */
        .login-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.95); display: flex; align-items: center;
            justify-content: center; z-index: 1000;
        }
        .login-container {
            background: var(--bg-secondary); padding: 40px; border-radius: 12px;
            width: 420px; max-width: 90%; border: 1px solid var(--border-light);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }
        .login-input {
            width: 100%; padding: 14px; margin: 12px 0; background: var(--bg-tertiary);
            border: 1px solid var(--border-light); color: var(--text-primary);
            border-radius: 8px; font-size: 15px;
        }
        .login-btn {
            width: 100%; padding: 14px; background: var(--accent-blue); color: white;
            border: none; border-radius: 8px; cursor: pointer; font-size: 15px;
            font-weight: 600; margin-top: 15px; transition: background 0.2s;
        }
        .login-btn:hover { background: #2563eb; }
        
        /* === ANA UYGULAMA === */
        .app-container { display: flex; flex-direction: column; height: 100vh; width: 100vw; overflow: hidden; }
        
        /* √úST BAR */
        .top-bar {
            display: flex; height: 70px; min-height: 70px; background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-light); padding: 0 25px;
            align-items: center; justify-content: space-between; flex-shrink: 0;
        }
        .channel-tabs { display: flex; gap: 8px; overflow-x: auto; max-width: 600px; padding: 5px 0; flex: 1; margin: 0 20px; }
        .channel-tab {
            padding: 10px 18px; background: var(--bg-tertiary); border-radius: 8px;
            cursor: pointer; white-space: nowrap; font-size: 14px; transition: all 0.2s;
            border: 1px solid var(--border-light);
        }
        .channel-tab:hover { background: var(--bg-primary); }
        .channel-tab.active { background: var(--accent-blue); color: white; border-color: var(--accent-blue); }
        
        /* ANA ƒ∞√áERƒ∞K */
        .main-content { display: flex; flex: 1; overflow: hidden; min-height: 0; }
        
        /* SOL PANEL - Online Listesi & √ñzel Sohbetler */
        .left-panel {
            width: 320px; min-width: 320px; background: var(--bg-secondary);
            border-right: 1px solid var(--border-light); display: flex;
            flex-direction: column; flex-shrink: 0;
        }
        .panel-tabs {
            display: flex; border-bottom: 1px solid var(--border-light);
        }
        .panel-tab {
            flex: 1; padding: 15px; text-align: center; cursor: pointer;
            background: var(--bg-tertiary); border: none; color: var(--text-primary);
            font-weight: 500; transition: all 0.2s;
        }
        .panel-tab.active {
            background: var(--bg-secondary); border-bottom: 2px solid var(--accent-blue);
        }
        .panel-content {
            flex: 1; overflow-y: auto; display: flex; flex-direction: column;
        }
        .panel-section {
            padding: 20px; border-bottom: 1px solid var(--border-light);
        }
        .panel-section h3 {
            font-size: 14px; color: var(--text-secondary); margin-bottom: 15px;
            text-transform: uppercase; letter-spacing: 0.5px;
        }
        
        /* Kullanƒ±cƒ± Listesi */
        .user-list { flex: 1; padding: 10px; }
        .user-item {
            padding: 12px; border-radius: 8px; cursor: pointer; display: flex;
            align-items: center; gap: 12px; margin-bottom: 8px; transition: all 0.2s;
            border: 1px solid transparent;
        }
        .user-item:hover {
            background: var(--bg-tertiary); border-color: var(--border-light);
        }
        .user-item.active {
            background: var(--accent-blue); color: white; border-color: var(--accent-blue);
        }
        .user-item.active .user-status { color: rgba(255,255,255,0.8); }
        .user-avatar {
            width: 40px; height: 40px; border-radius: 50%; 
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            display: flex; align-items: center; justify-content: center; color: white;
            font-weight: bold; font-size: 16px; flex-shrink: 0; position: relative;
        }
        .user-avatar.online::after {
            content: ''; position: absolute; bottom: 0; right: 0;
            width: 10px; height: 10px; background: var(--accent-green);
            border-radius: 50%; border: 2px solid var(--bg-secondary);
        }
        .user-info { flex: 1; min-width: 0; }
        .user-name { 
            font-weight: 600; font-size: 14px; margin-bottom: 2px;
            display: flex; align-items: center; gap: 6px;
        }
        .user-status { font-size: 12px; color: var(--text-secondary); }
        
        /* √ñzel Sohbet Listesi */
        .pm-list { padding: 10px; }
        .pm-item {
            padding: 12px; border-radius: 8px; cursor: pointer; display: flex;
            align-items: center; gap: 12px; margin-bottom: 8px; transition: all 0.2s;
            border: 1px solid var(--border-light); background: var(--bg-tertiary);
        }
        .pm-item:hover { background: var(--bg-primary); }
        .pm-item.unread { border-color: var(--accent-blue); background: rgba(59, 130, 246, 0.1); }
        .pm-avatar {
            width: 36px; height: 36px; border-radius: 50%; 
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-blue));
            display: flex; align-items: center; justify-content: center; color: white;
            font-weight: bold; font-size: 14px; flex-shrink: 0;
        }
        .pm-info { flex: 1; min-width: 0; }
        .pm-name { font-weight: 600; font-size: 13px; margin-bottom: 2px; }
        .pm-preview { 
            font-size: 12px; color: var(--text-secondary);
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }
        .pm-time {
            font-size: 10px; color: var(--text-secondary); margin-left: 8px;
        }
        
        /* ORTA PANEL - Sohbet */
        .chat-panel { flex: 1; display: flex; flex-direction: column; min-width: 0; }
        .chat-header {
            padding: 0 25px; height: 70px; border-bottom: 1px solid var(--border-light);
            display: flex; align-items: center; justify-content: space-between;
            background: var(--bg-secondary); flex-shrink: 0;
        }
        .chat-header-info { flex: 1; }
        .chat-header-actions { display: flex; gap: 10px; }
        .chat-messages { 
            flex: 1; overflow-y: auto; padding: 20px; background: var(--bg-primary);
            display: flex; flex-direction: column;
        }
        .message { 
            margin-bottom: 15px; max-width: 75%; animation: fadeIn 0.3s ease;
            display: flex; flex-direction: column;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .message-outgoing { 
            margin-left: auto; align-items: flex-end;
        }
        .message-incoming { align-items: flex-start; }
        .message-sender { 
            font-size: 12px; color: var(--text-secondary); margin-bottom: 4px;
            display: flex; align-items: center; gap: 8px;
        }
        .message-text {
            background: var(--bg-tertiary); padding: 12px 16px; border-radius: 12px;
            font-size: 14px; line-height: 1.5; word-break: break-word;
            max-width: 100%;
        }
        .message-outgoing .message-text { 
            background: var(--accent-blue); color: white; 
            border-bottom-right-radius: 4px;
        }
        .message-incoming .message-text { border-bottom-left-radius: 4px; }
        .message-time {
            font-size: 10px; color: var(--text-secondary); margin-top: 4px;
            opacity: 0.7;
        }
        .message-media {
            margin-top: 8px; border-radius: 8px; overflow: hidden;
            max-width: 300px; cursor: pointer;
        }
        .message-media img, .message-media video {
            width: 100%; height: auto; display: block;
        }
        .chat-input-area {
            padding: 20px; border-top: 1px solid var(--border-light); 
            background: var(--bg-secondary); flex-shrink: 0;
        }
        .message-input-container {
            display: flex; gap: 10px; align-items: flex-end;
        }
        .message-input {
            flex: 1; padding: 14px; background: var(--bg-tertiary); 
            border: 1px solid var(--border-light); color: var(--text-primary);
            border-radius: 10px; resize: none; font-size: 14px; line-height: 1.5;
            min-height: 60px; max-height: 150px; font-family: inherit;
        }
        .message-input:focus { outline: none; border-color: var(--accent-blue); }
        .input-actions {
            display: flex; justify-content: space-between; margin-top: 12px;
        }
        
        /* SAƒû PANEL - Video */
        .right-panel {
            width: 400px; min-width: 400px; background: #000; 
            display: flex; flex-direction: column; flex-shrink: 0;
            border-left: 1px solid #333;
        }
        .video-header { 
            padding: 15px; background: rgba(0, 0, 0, 0.9); color: white; 
            border-bottom: 1px solid #333; flex-shrink: 0;
            display: flex; justify-content: space-between; align-items: center;
        }
        .video-container { 
            flex: 1; background: #000; position: relative; min-height: 0;
            display: flex; align-items: center; justify-content: center;
        }
        .youtube-video { 
            width: 100%; height: 100%; border: none; display: block;
        }
        .video-controls { 
            padding: 15px; background: rgba(0, 0, 0, 0.9); 
            border-top: 1px solid #333; flex-shrink: 0;
        }
        .video-info {
            display: flex; justify-content: space-between; align-items: center;
            font-size: 13px; color: rgba(255,255,255,0.7);
        }
        
        /* BUTONLAR */
        .btn {
            padding: 8px 16px; border-radius: 6px; border: none; 
            cursor: pointer; font-size: 13px; font-weight: 500; 
            transition: all 0.2s; display: inline-flex; align-items: center; gap: 6px;
        }
        .btn-sm { padding: 6px 12px; font-size: 12px; }
        .btn-primary { background: var(--accent-blue); color: white; }
        .btn-primary:hover { background: #2563eb; }
        .btn-secondary { 
            background: var(--bg-tertiary); color: var(--text-primary); 
            border: 1px solid var(--border-light);
        }
        .btn-secondary:hover { background: var(--bg-primary); }
        .btn-success { background: var(--accent-green); color: white; }
        .btn-success:hover { background: #059669; }
        .btn-danger { background: var(--accent-red); color: white; }
        .btn-danger:hover { background: #dc2626; }
        .btn-warning { background: var(--accent-yellow); color: white; }
        .btn-warning:hover { background: #d97706; }
        
        /* MODALLAR */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.8); display: none; align-items: center;
            justify-content: center; z-index: 2000; backdrop-filter: blur(5px);
        }
        .modal-content {
            background: var(--bg-secondary); padding: 24px; border-radius: 12px;
            max-width: 500px; width: 90%; max-height: 90vh; overflow-y: auto;
            border: 1px solid var(--border-light); box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
        }
        
        /* KAMERA MODALI */
        .camera-modal {
            max-width: 800px;
        }
        .camera-preview-container {
            width: 100%; height: 400px; background: #000; border-radius: 8px;
            overflow: hidden; margin-bottom: 15px; position: relative;
        }
        .camera-preview {
            width: 100%; height: 100%; object-fit: cover;
        }
        .camera-controls {
            display: flex; justify-content: center; gap: 15px; margin-top: 15px;
        }
        .camera-btn {
            padding: 10px 20px; border-radius: 50px; border: none;
            background: var(--accent-blue); color: white; cursor: pointer;
            font-weight: 500; display: flex; align-items: center; gap: 8px;
        }
        .camera-btn.danger { background: var(--accent-red); }
        .camera-btn.warning { background: var(--accent-yellow); }
        
        /* UTILITIES */
        .hidden { display: none !important; }
        .text-sm { font-size: 13px; }
        .text-muted { color: var(--text-secondary); }
        .flex { display: flex; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .gap-2 { gap: 8px; }
        .gap-3 { gap: 12px; }
        .w-full { width: 100%; }
        
        /* SCROLLBAR */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg-tertiary); border-radius: 3px; }
        ::-webkit-scrollbar-thumb { background: var(--border-light); border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #444; }
        
        /* ROL BADGELERƒ∞ */
        .role-badge {
            font-size: 10px; padding: 1px 6px; border-radius: 10px; 
            margin-left: 4px; font-weight: 600;
        }
        .role-owner { background: linear-gradient(135deg, var(--accent-purple), #3b82f6); color: white; }
        .role-admin { background: var(--accent-blue); color: white; }
        .role-coadmin { background: var(--accent-yellow); color: white; }
        .role-operator { background: var(--accent-green); color: white; }
        .role-voice { background: var(--accent-purple); color: white; opacity: 0.9; }
        
        /* RESPONSIVE */
        @media (max-width: 1200px) {
            .right-panel { width: 350px; min-width: 350px; }
            .left-panel { width: 280px; min-width: 280px; }
        }
        @media (max-width: 992px) {
            .right-panel { display: none; }
            .left-panel { width: 250px; min-width: 250px; }
        }
        @media (max-width: 768px) {
            .left-panel { display: none; }
            .channel-tabs { max-width: 300px; }
            .top-bar { padding: 0 15px; }
        }
        @media (max-width: 480px) {
            .channel-tabs { max-width: 200px; }
            .chat-header { padding: 0 15px; }
            .chat-messages { padding: 15px; }
            .chat-input-area { padding: 15px; }
        }
        
        /* √ñZEL SOHBET PENCERESƒ∞ */
        .pm-window {
            position: fixed; bottom: 0; right: 400px; width: calc(100% - 400px - 320px);
            height: 80vh; background: var(--bg-secondary); border-radius: 12px 12px 0 0;
            border: 1px solid var(--border-light); border-bottom: none;
            box-shadow: 0 -10px 30px rgba(0,0,0,0.3); display: flex; flex-direction: column;
            z-index: 100; transition: transform 0.3s ease;
        }
        @media (max-width: 992px) {
            .pm-window { right: 0; width: 100%; }
        }
        .pm-window.minimized { transform: translateY(calc(100% - 50px)); }
        .pm-window-header {
            padding: 15px; border-bottom: 1px solid var(--border-light); 
            background: var(--bg-tertiary); display: flex; justify-content: space-between;
            align-items: center; cursor: pointer;
        }
        .pm-window-messages {
            flex: 1; overflow-y: auto; padding: 20px; background: var(--bg-primary);
        }
        .pm-window-input {
            padding: 15px; border-top: 1px solid var(--border-light); 
            background: var(--bg-secondary);
        }
        
        /* PM MESAJ MEDYA */
        .pm-media-container {
            margin-top: 8px; border-radius: 8px; overflow: hidden;
            max-width: 250px; cursor: pointer; position: relative;
        }
        .pm-media-container img, .pm-media-container video {
            width: 100%; height: auto; display: block;
        }
        .pm-media-info {
            position: absolute; bottom: 0; left: 0; right: 0;
            background: rgba(0, 0, 0, 0.7); color: white;
            padding: 5px 10px; font-size: 11px;
        }
        
        /* LOADING */
        .loading { 
            display: inline-block; width: 20px; height: 20px;
            border: 2px solid var(--border-light); border-top-color: var(--accent-blue);
            border-radius: 50%; animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="night-mode">
    <!-- Gƒ∞Rƒ∞≈û EKRANI -->
    <div id="loginScreen" class="login-screen">
        <div class="login-container">
            <div style="text-align: center; margin-bottom: 30px;">
                <div style="width: 80px; height: 80px; background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple)); border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; color: white; font-size: 32px; font-weight: bold; margin-bottom: 15px;">EC</div>
                <h1 style="font-size: 28px; margin-bottom: 8px;">EliteChat</h1>
                <p class="text-muted">Profesyonel IRC Platformu</p>
            </div>
            
            <input type="text" id="nickInput" class="login-input" placeholder="Kullanƒ±cƒ± adƒ±" autofocus>
            <input type="password" id="passInput" class="login-input" placeholder="≈ûifre (isteƒüe baƒülƒ±)">
            
            <button class="login-btn" id="loginButton">
                <i class="fas fa-sign-in-alt"></i> Giri≈ü Yap
            </button>
            
            <div style="margin-top: 25px; padding-top: 20px; border-top: 1px solid var(--border-light);">
                <p class="text-sm text-muted" style="text-align: center;">
                    <strong>ƒ∞lk Giri≈ü:</strong><br>
                    Nickinizi ve ≈üifrenizi belirleyin<br>
                    ≈ûifre opsiyonel - ≈üifresiz giri≈ü misafir olur
                </p>
            </div>
        </div>
    </div>

    <!-- ANA UYGULAMA -->
    <div id="app" class="hidden">
        <div class="app-container">
            <!-- √úST BAR -->
            <div class="top-bar">
                <div class="flex items-center gap-3">
                    <div style="width: 36px; height: 36px; background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple)); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">EC</div>
                    <span style="font-size: 18px; font-weight: 600;">EliteChat</span>
                </div>

                <!-- KANAL SEKMELERƒ∞ -->
                <div class="channel-tabs" id="channelTabs">
                    <div class="channel-tab active" data-channel="general">
                        <i class="fas fa-hashtag"></i> Genel
                    </div>
                </div>

                <div class="flex items-center gap-2">
                    <button id="createChannelBtn" class="btn btn-success btn-sm">
                        <i class="fas fa-plus"></i> Kanal A√ß
                    </button>
                    <button id="settingsBtn" class="btn btn-secondary btn-sm">
                        <i class="fas fa-cog"></i>
                    </button>
                    <button id="themeBtn" class="btn btn-secondary btn-sm">
                        <i class="fas fa-moon"></i>
                    </button>
                </div>
            </div>

            <!-- ANA ƒ∞√áERƒ∞K -->
            <div class="main-content">
                <!-- SOL PANEL -->
                <div class="left-panel">
                    <div class="panel-tabs">
                        <button class="panel-tab active" data-panel="online">
                            <i class="fas fa-users"></i> Online
                        </button>
                        <button class="panel-tab" data-panel="pm">
                            <i class="fas fa-comments"></i> √ñzel
                        </button>
                    </div>
                    
                    <!-- ONLINE Lƒ∞STESƒ∞ -->
                    <div class="panel-content" id="onlinePanel">
                        <div class="panel-section">
                            <h3>√áevrimi√ßi Kullanƒ±cƒ±lar <span id="onlineCount">(0)</span></h3>
                            <div class="user-list" id="userList">
                                <!-- Kullanƒ±cƒ±lar buraya gelecek -->
                            </div>
                        </div>
                        
                        <div class="panel-section">
                            <h3>Kanal Bilgisi</h3>
                            <div style="font-size: 13px;">
                                <div style="margin-bottom: 8px;">
                                    <strong>Kanal:</strong> <span id="panelChannelName">#Genel</span>
                                </div>
                                <div style="margin-bottom: 8px;">
                                    <strong>Konu:</strong> <span id="panelChannelTopic">EliteChat Ho≈ü Geldiniz</span>
                                </div>
                                <div>
                                    <strong>Video:</strong> <span id="panelChannelVideo">Lofi Hip Hop Radio üìö</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- √ñZEL MESAJ Lƒ∞STESƒ∞ -->
                    <div class="panel-content hidden" id="pmPanel">
                        <div class="panel-section">
                            <h3>√ñzel Sohbetler</h3>
                            <div class="pm-list" id="pmConversationList">
                                <!-- √ñzel sohbetler buraya gelecek -->
                            </div>
                        </div>
                        
                        <div class="panel-section">
                            <button id="newPmBtn" class="btn btn-primary w-full">
                                <i class="fas fa-plus"></i> Yeni √ñzel Sohbet
                            </button>
                        </div>
                    </div>
                </div>

                <!-- ORTA PANEL - SOHBET -->
                <div class="chat-panel">
                    <div class="chat-header">
                        <div class="chat-header-info">
                            <h2 style="font-size: 18px; margin-bottom: 4px;">
                                <i class="fas fa-hashtag"></i> <span id="currentChannel">Genel</span>
                            </h2>
                            <p class="text-muted" style="font-size: 14px;">
                                <span id="channelUsers">0</span> kullanƒ±cƒ± ‚Ä¢ 
                                <span id="channelTopic">EliteChat Ho≈ü Geldiniz</span>
                            </p>
                        </div>
                        <div class="chat-header-actions">
                            <button id="videoManagerBtn" class="btn btn-secondary btn-sm">
                                <i class="fas fa-video"></i> Video
                            </button>
                            <button id="channelInfoBtn" class="btn btn-secondary btn-sm">
                                <i class="fas fa-info-circle"></i>
                            </button>
                        </div>
                    </div>

                    <div class="chat-messages" id="chatMessages">
                        <div style="text-align: center; padding: 40px 20px; color: var(--text-secondary);">
                            <i class="fas fa-comments" style="font-size: 48px; margin-bottom: 15px; opacity: 0.5;"></i>
                            <h3 style="margin-bottom: 10px;">EliteChat'e Ho≈ü Geldiniz</h3>
                            <p>Mesaj yazmaya ba≈ülayƒ±n veya birine √∂zel mesaj g√∂nderin</p>
                        </div>
                    </div>

                    <div class="chat-input-area">
                        <div class="message-input-container">
                            <textarea class="message-input" id="messageInput" 
                                      placeholder="Mesaj yazƒ±n... (IRC komutlarƒ± i√ßin / kullanƒ±n)" 
                                      rows="3"></textarea>
                        </div>
                        <div class="input-actions">
                            <div style="flex: 1;"></div>
                            <button id="sendBtn" class="btn btn-primary">
                                <i class="fas fa-paper-plane"></i> G√∂nder
                            </button>
                        </div>
                    </div>
                </div>

                <!-- SAƒû PANEL - Vƒ∞DEO -->
                <div class="right-panel">
                    <div class="video-header">
                        <div>
                            <h3 style="font-size: 16px; margin-bottom: 2px;">
                                <i class="fas fa-play-circle"></i> <span id="videoTitle">Lofi Hip Hop Radio üìö</span>
                            </h3>
                            <p style="font-size: 12px; color: rgba(255,255,255,0.7);">
                                <i class="fas fa-hashtag"></i> <span id="videoChannel">Genel</span>
                            </p>
                        </div>
                        <div class="flex gap-2">
                            <button id="changeVideoBtn" class="btn btn-sm" style="background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.2);">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button id="fullscreenBtn" class="btn btn-sm" style="background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.2);">
                                <i class="fas fa-expand"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="video-container">
                        <iframe class="youtube-video" id="youtubePlayer" 
                                src="https://www.youtube-nocookie.com/embed/jfKfPfyJRdk?autoplay=1&mute=1&rel=0&controls=1&modestbranding=1" 
                                frameborder="0" 
                                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                                allowfullscreen>
                        </iframe>
                    </div>
                    
                    <div class="video-controls">
                        <div class="video-info">
                            <div>
                                <i class="fas fa-eye"></i> <span id="viewerCount">1.2K</span> izleyici
                            </div>
                            <div>
                                <i class="fas fa-clock"></i> 24/7
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODALLAR -->
    <!-- Video Deƒüi≈ütirme Modal -->
    <div id="videoModal" class="modal-overlay">
        <div class="modal-content">
            <div class="flex items-center justify-between" style="margin-bottom: 20px;">
                <h3 style="font-size: 18px;">Video Y√∂netimi</h3>
                <button id="closeVideoModal" style="background: none; border: none; color: var(--text-secondary); font-size: 24px; cursor: pointer;">√ó</button>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px;">
                    YouTube URL veya Video ID
                </label>
                <input type="text" id="videoUrl" class="login-input" 
                       placeholder="√ñrnek: https://youtube.com/watch?v=VIDEO_ID veya sadece VIDEO_ID">
            </div>
            
            <div style="margin-bottom: 25px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px;">
                    Video Ba≈ülƒ±ƒüƒ±
                </label>
                <input type="text" id="videoTitleInput" class="login-input" 
                       placeholder="Video ba≈ülƒ±ƒüƒ± (isteƒüe baƒülƒ±)">
            </div>
            
            <div class="flex gap-2">
                <button id="cancelVideo" class="btn btn-secondary" style="flex: 1;">ƒ∞ptal</button>
                <button id="saveVideo" class="btn btn-primary" style="flex: 1;">
                    <i class="fas fa-save"></i> Kaydet
                </button>
            </div>
        </div>
    </div>

    <!-- Kanal Olu≈üturma Modal -->
    <div id="channelModal" class="modal-overlay">
        <div class="modal-content">
            <div class="flex items-center justify-between" style="margin-bottom: 20px;">
                <h3 style="font-size: 18px;">Yeni Kanal Olu≈ütur</h3>
                <button id="closeChannelModal" style="background: none; border: none; color: var(--text-secondary); font-size: 24px; cursor: pointer;">√ó</button>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px;">Kanal Adƒ±</label>
                <input type="text" id="channelName" class="login-input" placeholder="#kanal_adi">
            </div>
            
            <div style="margin-bottom: 25px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px;">Kanal T√ºr√º</label>
                <select id="channelType" class="login-input">
                    <option value="public">Public - Herkes katƒ±labilir</option>
                    <option value="private">Private - Sadece davetliler</option>
                    <option value="secret">Secret - Gizli kanal</option>
                </select>
            </div>
            
            <div style="margin-bottom: 25px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px;">Kanal Konusu</label>
                <input type="text" id="channelTopicInput" class="login-input" placeholder="Kanal konusu">
            </div>
            
            <div class="flex gap-2">
                <button id="cancelChannel" class="btn btn-secondary" style="flex: 1;">ƒ∞ptal</button>
                <button id="createChannel" class="btn btn-success" style="flex: 1;">
                    <i class="fas fa-plus"></i> Olu≈ütur
                </button>
            </div>
        </div>
    </div>

    <!-- Yeni √ñzel Sohbet Modal -->
    <div id="newPmModal" class="modal-overlay">
        <div class="modal-content">
            <div class="flex items-center justify-between" style="margin-bottom: 20px;">
                <h3 style="font-size: 18px;">Yeni √ñzel Sohbet</h3>
                <button id="closeNewPmModal" style="background: none; border: none; color: var(--text-secondary); font-size: 24px; cursor: pointer;">√ó</button>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px;">Kullanƒ±cƒ± Adƒ±</label>
                <input type="text" id="pmUserInput" class="login-input" placeholder="Kullanƒ±cƒ± adƒ± yazƒ±n">
                <div id="pmUserSuggestions" style="margin-top: 10px; max-height: 200px; overflow-y: auto;"></div>
            </div>
            
            <div style="margin-bottom: 25px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px;">ƒ∞lk Mesaj</label>
                <textarea id="pmFirstMessage" class="login-input" placeholder="ƒ∞lk mesajƒ±nƒ±z..." rows="3"></textarea>
            </div>
            
            <div class="flex gap-2">
                <button id="cancelNewPm" class="btn btn-secondary" style="flex: 1;">ƒ∞ptal</button>
                <button id="startNewPm" class="btn btn-primary" style="flex: 1;">
                    <i class="fas fa-paper-plane"></i> Ba≈ülat
                </button>
            </div>
        </div>
    </div>

    <!-- Kanal Bilgisi Modal -->
    <div id="channelInfoModal" class="modal-overlay">
        <div class="modal-content">
            <div class="flex items-center justify-between" style="margin-bottom: 20px;">
                <h3 style="font-size: 18px;">Kanal Bilgisi</h3>
                <button id="closeChannelInfo" style="background: none; border: none; color: var(--text-secondary); font-size: 24px; cursor: pointer;">√ó</button>
            </div>
            
            <div style="margin-bottom: 20px;">
                <div style="font-size: 14px; margin-bottom: 10px;">
                    <strong>Kanal:</strong> <span id="infoChannelName">#Genel</span>
                </div>
                <div style="font-size: 14px; margin-bottom: 10px;">
                    <strong>Konu:</strong> <span id="infoChannelTopic">EliteChat Ho≈ü Geldiniz</span>
                </div>
                <div style="font-size: 14px; margin-bottom: 10px;">
                    <strong>Sahibi:</strong> <span id="infoChannelOwner">System</span>
                </div>
                <div style="font-size: 14px; margin-bottom: 10px;">
                    <strong>T√ºr:</strong> <span id="infoChannelType">Public</span>
                </div>
                <div style="font-size: 14px; margin-bottom: 10px;">
                    <strong>Video:</strong> <span id="infoChannelVideo">Lofi Hip Hop Radio üìö</span>
                </div>
                <div style="font-size: 14px;">
                    <strong>Kullanƒ±cƒ±lar:</strong> <span id="infoChannelUsers">0</span>
                </div>
            </div>
            
            <div id="channelInfoActions" class="flex gap-2">
                <!-- Yetkili butonlarƒ± buraya dinamik eklenecek -->
            </div>
        </div>
    </div>

    <!-- Ayarlar Modal -->
    <div id="settingsModal" class="modal-overlay">
        <div class="modal-content">
            <div class="flex items-center justify-between" style="margin-bottom: 20px;">
                <h3 style="font-size: 18px;">Ayarlar</h3>
                <button id="closeSettings" style="background: none; border: none; color: var(--text-secondary); font-size: 24px; cursor: pointer;">√ó</button>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px;">Kullanƒ±cƒ± Adƒ±</label>
                <input type="text" id="settingsNick" class="login-input" value="">
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px;">Avatar</label>
                <div style="display: flex; align-items: center; gap: 15px;">
                    <div id="settingsAvatar" style="width: 60px; height: 60px; border-radius: 50%; background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple)); display: flex; align-items: center; justify-content: center; color: white; font-size: 24px; font-weight: bold; cursor: pointer;"></div>
                    <button id="changeAvatarBtn" class="btn btn-secondary">
                        <i class="fas fa-edit"></i> Deƒüi≈ütir
                    </button>
                </div>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px;">Biyografi</label>
                <textarea id="settingsBio" class="login-input" placeholder="Kendinizden bahsedin..." rows="3"></textarea>
            </div>
            
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 25px; padding: 15px; background: var(--bg-tertiary); border-radius: 8px;">
                <div>
                    <div style="font-weight: 500; font-size: 14px;">G√∂r√ºnmez Mod</div>
                    <div class="text-sm text-muted">√áevrimi√ßi g√∂r√ºnmez olun</div>
                </div>
                <label style="position: relative; display: inline-block; width: 50px; height: 26px;">
                    <input type="checkbox" id="settingsInvisible" style="opacity: 0; width: 0; height: 0;">
                    <span style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background: var(--bg-primary); border-radius: 34px; transition: .4s;"></span>
                    <span style="position: absolute; content: ''; height: 18px; width: 18px; left: 4px; bottom: 4px; background: white; border-radius: 50%; transition: .4s;"></span>
                </label>
            </div>
            
            <div class="flex gap-2">
                <button id="cancelSettings" class="btn btn-secondary" style="flex: 1;">ƒ∞ptal</button>
                <button id="saveSettings" class="btn btn-primary" style="flex: 1;">
                    <i class="fas fa-save"></i> Kaydet
                </button>
            </div>
        </div>
    </div>

    <!-- KAMERA MODALI -->
    <div id="cameraModal" class="modal-overlay">
        <div class="modal-content camera-modal">
            <div class="flex items-center justify-between" style="margin-bottom: 20px;">
                <h3 style="font-size: 18px;">Kamera</h3>
                <button id="closeCameraModal" style="background: none; border: none; color: var(--text-secondary); font-size: 24px; cursor: pointer;">√ó</button>
            </div>
            
            <div class="camera-preview-container">
                <video id="cameraPreview" class="camera-preview" autoplay playsinline></video>
                <canvas id="cameraCanvas" style="display: none;"></canvas>
            </div>
            
            <div class="camera-controls">
                <button id="switchCameraBtn" class="camera-btn warning">
                    <i class="fas fa-sync-alt"></i> Kamera Deƒüi≈ütir
                </button>
                <button id="captureImageBtn" class="camera-btn">
                    <i class="fas fa-camera"></i> Fotoƒüraf √áek
                </button>
                <button id="recordVideoBtn" class="camera-btn danger">
                    <i class="fas fa-video"></i> Video Kaydet
                </button>
                <button id="stopRecordingBtn" class="camera-btn danger" style="display: none;">
                    <i class="fas fa-stop"></i> Durdur
                </button>
            </div>
            
            <div id="cameraPreviewArea" style="margin-top: 20px; display: none;">
                <!-- √ñnizleme buraya gelecek -->
            </div>
            
            <div class="flex gap-2" style="margin-top: 20px;">
                <button id="cancelCamera" class="btn btn-secondary" style="flex: 1;">ƒ∞ptal</button>
                <button id="sendCameraMedia" class="btn btn-primary" style="flex: 1;" disabled>
                    <i class="fas fa-paper-plane"></i> G√∂nder
                </button>
            </div>
        </div>
    </div>

    <!-- DOSYA Y√úKLEME MODAL -->
    <div id="uploadModal" class="modal-overlay">
        <div class="modal-content">
            <div class="flex items-center justify-between" style="margin-bottom: 20px;">
                <h3 style="font-size: 18px;" id="uploadTitle">Dosya G√∂nder</h3>
                <button id="closeUploadModal" style="background: none; border: none; color: var(--text-secondary); font-size: 24px; cursor: pointer;">√ó</button>
            </div>
            
            <div style="text-align: center; margin-bottom: 25px;">
                <div id="uploadDropZone" style="border: 2px dashed var(--border-light); border-radius: 12px; padding: 40px 20px; cursor: pointer; transition: all 0.2s;">
                    <i class="fas fa-cloud-upload-alt" style="font-size: 48px; color: var(--text-secondary); margin-bottom: 15px;"></i>
                    <div style="font-size: 16px; margin-bottom: 8px;">Dosyayƒ± buraya s√ºr√ºkleyin</div>
                    <div class="text-sm text-muted">veya tƒ±klayarak se√ßin</div>
                    <div class="text-sm text-muted" style="margin-top: 10px;">Max: 10MB</div>
                </div>
                <input type="file" id="fileInput" style="display: none;" accept="image/*,video/*,.mp4,.avi,.mov">
            </div>
            
            <div id="uploadPreview" style="display: none; margin-bottom: 20px;">
                <!-- √ñnizleme buraya gelecek -->
            </div>
            
            <div id="uploadProgress" style="display: none; margin-bottom: 20px;">
                <div style="background: var(--bg-tertiary); height: 6px; border-radius: 3px; overflow: hidden;">
                    <div id="uploadProgressBar" style="background: var(--accent-blue); height: 100%; width: 0%; transition: width 0.3s;"></div>
                </div>
                <div style="text-align: center; margin-top: 8px; font-size: 12px; color: var(--text-secondary);">
                    <span id="uploadProgressText">%0</span>
                </div>
            </div>
            
            <div class="flex gap-2">
                <button id="cancelUpload" class="btn btn-secondary" style="flex: 1;">ƒ∞ptal</button>
                <button id="sendUpload" class="btn btn-primary" style="flex: 1;" disabled>
                    <i class="fas fa-paper-plane"></i> G√∂nder
                </button>
            </div>
        </div>
    </div>

    <!-- √ñZEL SOHBET PENCERESƒ∞ (Dinamik olu≈üturulacak) -->

    <script>
        // ==================== G√úVENLƒ∞K FONKSƒ∞YONLARI ====================
        function escapeHtml(text) {
            if (!text) return '';
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;',
                '`': '&#x60;',
                '=': '&#x3D;'
            };
            return String(text).replace(/[&<>"'`=]/g, m => map[m]);
        }

        function hashPassword(password) {
            if (!password) return '';
            let hash = 0;
            for (let i = 0; i < password.length; i++) {
                const char = password.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            return 'hashed_' + Math.abs(hash).toString(36);
        }

        function clearContainer(containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;
            while (container.firstChild) {
                container.removeChild(container.firstChild);
            }
        }

        // ==================== Sƒ∞STEM DEƒûƒ∞≈ûKENLERƒ∞ ====================
        const SYSTEM = {
            currentUser: null,
            currentChannel: 'general',
            activePM: null,
            pmWindows: {},
            uploadType: null,
            theme: 'night',
            messageCounter: 1,
            intervals: [],
            cameraStream: null,
            mediaRecorder: null,
            recordedChunks: [],
            isRecording: false,
            facingMode: 'user'
        };

        const DATA = {
            users: {},
            channels: {
                general: {
                    id: 'general',
                    name: '#Genel',
                    owner: 'mate',
                    type: 'public',
                    topic: 'EliteChat Ho≈ü Geldiniz',
                    users: new Set(),
                    operators: new Set(),
                    voices: new Set(),
                    bans: new Map(),
                    mutes: new Map(),
                    slowmode: 0,
                    locked: false,
                    userLimit: 0,
                    messages: [],
                    video: { 
                        id: 'jfKfPfyJRdk', 
                        title: 'Lofi Hip Hop Radio üìö',
                        channel: 'Genel'
                    }
                }
            },
            privateMessages: new Map(),
            registeredUsers: new Map(),
            onlineUsers: new Set(),
            userChannels: new Map(),
            globalBans: new Set(),
            globalMutes: new Set()
        };

        // ==================== MATE BOT Sƒ∞STEMƒ∞ ====================
        class MateBot {
            constructor() {
                this.id = 'mate';
                this.name = 'ü§ñMate';
                this.role = 'owner';
                this.registered = true;
                this.online = true;
                this.invisible = false;
                this.avatar = 'M';
                this.bio = 'G√ºvenlik Botu - Sadece g√ºvenlik ve owner mesajlarƒ±nƒ± iletirim';
                this.joinDate = new Date();
                this.lastSeen = new Date();
                
                DATA.users[this.id] = this;
                DATA.onlineUsers.add(this.id);
                DATA.registeredUsers.set(this.id, {
                    password: hashPassword('mate123'),
                    role: 'owner',
                    bio: this.bio,
                    joinDate: this.joinDate
                });
                
                Object.values(DATA.channels).forEach(channel => {
                    channel.users.add(this.id);
                });
            }
            
            sendSecurityAlert(message, channelId = 'general') {
                const channel = DATA.channels[channelId];
                if (!channel) return;
                
                const alertMessage = {
                    id: 'alert_' + Date.now(),
                    type: 'security',
                    userId: this.id,
                    text: `üîí **G√úVENLƒ∞K**: ${message}`,
                    time: new Date(),
                    channel: channelId
                };
                
                channel.messages.push(alertMessage);
                
                if (SYSTEM.currentChannel === channelId) {
                    this.displayMessage(alertMessage);
                }
                
                if (DATA.users['mateky'] && DATA.users['mateky'].online) {
                    this.sendPrivateAlert(message, 'mateky');
                }
            }
            
            sendPrivateAlert(message, userId) {
                const user = DATA.users[userId];
                if (!user) return;
                
                const pmKey = [this.id, userId].sort().join('_');
                if (!DATA.privateMessages.has(pmKey)) {
                    DATA.privateMessages.set(pmKey, []);
                }
                
                const messages = DATA.privateMessages.get(pmKey);
                const alertMessage = {
                    id: 'pm_alert_' + Date.now(),
                    type: 'pm',
                    from: this.id,
                    to: userId,
                    text: `üîê **Sƒ∞STEM ALERT**: ${message}`,
                    time: new Date(),
                    read: false
                };
                
                messages.push(alertMessage);
                
                if (SYSTEM.pmWindows[userId]) {
                    this.displayPMMessage(alertMessage, userId);
                }
                
                showNotification('ü§ñ Mate Alert', message, 'security');
            }
            
            displayMessage(message) {
                const container = document.getElementById('chatMessages');
                if (!container) return;
                
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message';
                messageDiv.dataset.messageId = message.id;
                
                messageDiv.innerHTML = `
                    <div class="message-sender">
                        <span style="font-weight: 500; color: var(--accent-red);">${this.name}</span>
                        ${getRoleBadge(this.role)}
                    </div>
                    <div class="message-text" style="background: rgba(239, 68, 68, 0.1); border-left: 3px solid var(--accent-red);">
                        ${escapeHtml(message.text)}
                    </div>
                    <div class="message-time">${formatTime(message.time)}</div>
                `;
                
                container.appendChild(messageDiv);
                container.scrollTop = container.scrollHeight;
            }
            
            displayPMMessage(message, userId) {
                const container = document.getElementById(`pm-messages-${userId}`);
                if (!container) return;
                
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message message-incoming';
                messageDiv.dataset.messageId = message.id;
                
                messageDiv.innerHTML = `
                    <div class="message-sender">
                        <span style="font-weight: 500; color: var(--accent-red);">${this.name}</span>
                        ${getRoleBadge(this.role)}
                    </div>
                    <div class="message-text" style="background: rgba(239, 68, 68, 0.1); border-left: 3px solid var(--accent-red);">
                        ${escapeHtml(message.text)}
                    </div>
                    <div class="message-time">${formatTime(message.time)}</div>
                `;
                
                container.appendChild(messageDiv);
                container.scrollTop = container.scrollHeight;
            }
            
            checkUserSecurity(userId) {
                const user = DATA.users[userId];
                if (!user) return true;
                
                if (DATA.globalBans.has(userId)) {
                    this.sendSecurityAlert(`${user.name} global banlƒ±!`, 'general');
                    return false;
                }
                
                if (DATA.globalMutes.has(userId)) {
                    this.sendSecurityAlert(`${user.name} global susturulmu≈ü!`, 'general');
                    return false;
                }
                
                return true;
            }
            
            broadcastOwnerMessage(message, targetUser = null) {
                if (targetUser) {
                    this.sendPrivateAlert(`üì® Owner Mesajƒ±: ${message}`, targetUser);
                } else {
                    Object.keys(DATA.channels).forEach(channelId => {
                        this.sendSecurityAlert(`üì¢ Owner Duyurusu: ${message}`, channelId);
                    });
                }
            }
        }

        const mateBot = new MateBot();

        // ==================== UTILITY FONKSƒ∞YONLARI ====================
        function generateMessageId() {
            return Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        function formatTime(date = new Date()) {
            return date.toLocaleTimeString('tr-TR', { 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: false
            });
        }

        function getRoleBadge(role) {
            const badges = {
                'owner': '<span class="role-badge role-owner">O</span>',
                'admin': '<span class="role-badge role-admin">A</span>',
                'coadmin': '<span class="role-badge role-coadmin">C</span>',
                'operator': '<span class="role-badge role-operator">OP</span>',
                'voice': '<span class="role-badge role-voice">V</span>'
            };
            return badges[role] || '';
        }

        function showNotification(title, message, type = 'info') {
            console.log(`[${type.toUpperCase()}] ${title}: ${message}`);
            
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification(title, { body: message });
            }
        }

        function hasVideoPermission(channelId) {
            const channel = DATA.channels[channelId];
            if (!channel) return false;
            
            const user = SYSTEM.currentUser;
            if (!user) return false;
            
            if (user.role === 'owner') return true;
            if (user.role === 'admin') return true;
            if (user.role === 'coadmin' && channel.owner === user.id) return true;
            if (channel.owner === user.id) return true;
            
            return false;
        }

        // ==================== Gƒ∞Rƒ∞≈û Sƒ∞STEMƒ∞ ====================
        function handleLogin() {
            const nickInput = document.getElementById('nickInput');
            const passInput = document.getElementById('passInput');
            const nick = nickInput.value.trim();
            const pass = passInput.value;
            
            // √ñzel karakterleri temizle
            const cleanNick = nick.replace(/[^a-zA-Z0-9._]/g, '');
            
            if (!cleanNick || cleanNick.length < 2) {
                alert('Kullanƒ±cƒ± adƒ± en az 2 karakter olmalƒ±dƒ±r (sadece harf, rakam, . ve _)');
                nickInput.value = '';
                nickInput.focus();
                return;
            }
            
            const userId = cleanNick.toLowerCase();
            
            if (userId === 'mate') {
                alert('Bu kullanƒ±cƒ± adƒ± sistem tarafƒ±ndan kullanƒ±lƒ±yor!');
                nickInput.value = '';
                nickInput.focus();
                return;
            }
            
            if (!mateBot.checkUserSecurity(userId)) {
                alert('Giri≈ü engellendi!');
                nickInput.value = '';
                passInput.value = '';
                nickInput.focus();
                return;
            }
            
            // Basitle≈ütirilmi≈ü giri≈ü sistemi
            if (DATA.registeredUsers.has(userId)) {
                const userData = DATA.registeredUsers.get(userId);
                const hashedPass = hashPassword(pass);
                if (hashedPass !== userData.password) {
                    alert('Yanlƒ±≈ü ≈üifre!');
                    mateBot.sendSecurityAlert(`${cleanNick} yanlƒ±≈ü ≈üifre denemesi!`);
                    passInput.value = '';
                    passInput.focus();
                    return;
                }
                
                SYSTEM.currentUser = {
                    id: userId,
                    name: cleanNick,
                    role: userData.role || 'user',
                    registered: true,
                    online: true,
                    invisible: false,
                    avatar: cleanNick.charAt(0).toUpperCase(),
                    bio: userData.bio || '',
                    joinDate: userData.joinDate || new Date(),
                    lastSeen: new Date()
                };
            } else {
                SYSTEM.currentUser = {
                    id: userId,
                    name: cleanNick,
                    role: 'user',
                    registered: !!pass,
                    online: true,
                    invisible: false,
                    avatar: cleanNick.charAt(0).toUpperCase(),
                    bio: '',
                    joinDate: new Date(),
                    lastSeen: new Date()
                };
                
                if (pass) {
                    DATA.registeredUsers.set(userId, {
                        password: hashPassword(pass),
                        role: 'user',
                        bio: '',
                        joinDate: new Date()
                    });
                    
                    if (userId === 'mateky') {
                        SYSTEM.currentUser.role = 'owner';
                        DATA.registeredUsers.get(userId).role = 'owner';
                        mateBot.broadcastOwnerMessage('Owner sisteme giri≈ü yaptƒ±!');
                    }
                }
                
                mateBot.sendSecurityAlert(`Yeni kullanƒ±cƒ±: ${cleanNick} ${pass ? '(kayƒ±tlƒ±)' : '(misafir)'}`);
            }
            
            nickInput.value = '';
            passInput.value = '';
            
            DATA.users[userId] = SYSTEM.currentUser;
            DATA.onlineUsers.add(userId);
            DATA.channels.general.users.add(userId);
            
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('app').classList.remove('hidden');
            
            addSystemMessage(`üéâ ${SYSTEM.currentUser.name} sohbete katƒ±ldƒ±!`);
            
            updateOnlineList();
            updatePanelInfo();
            loadChannelMessages('general');
            
            startAutoUpdates();
        }

        // ==================== ONLINE Lƒ∞STE Sƒ∞STEMƒ∞ ====================
        function updateOnlineList() {
            const container = document.getElementById('userList');
            const countElement = document.getElementById('onlineCount');
            
            if (!container) return;
            
            clearContainer('userList');
            
            const channel = DATA.channels[SYSTEM.currentChannel];
            if (!channel) return;
            
            const channelUsers = Array.from(channel.users)
                .map(userId => DATA.users[userId])
                .filter(user => user && !user.invisible)
                .sort((a, b) => {
                    const roleOrder = { owner: 1, admin: 2, coadmin: 3, operator: 4, voice: 5, user: 6 };
                    const roleDiff = roleOrder[a.role] - roleOrder[b.role];
                    if (roleDiff !== 0) return roleDiff;
                    return a.name.localeCompare(b.name);
                });
            
            const onlineCount = channelUsers.filter(u => u.online).length;
            if (countElement) {
                countElement.textContent = `(${onlineCount})`;
            }
            
            const channelUsersElement = document.getElementById('channelUsers');
            if (channelUsersElement) {
                channelUsersElement.textContent = channelUsers.length;
            }
            
            if (channelUsers.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 30px 20px; color: var(--text-secondary);">
                        <i class="fas fa-user-slash" style="font-size: 32px; margin-bottom: 10px; opacity: 0.5;"></i>
                        <div style="font-size: 13px;">Hen√ºz kullanƒ±cƒ± yok</div>
                    </div>
                `;
                return;
            }
            
            channelUsers.forEach(user => {
                const item = document.createElement('div');
                item.className = `user-item ${user.online ? 'online' : ''}`;
                if (SYSTEM.activePM === user.id) {
                    item.classList.add('active');
                }
                
                const displayName = user.id === 'mate' ? 'ü§ñMate' : user.name;
                
                item.innerHTML = `
                    <div class="user-avatar ${user.online ? 'online' : ''}">
                        ${user.avatar}
                    </div>
                    <div class="user-info">
                        <div class="user-name">
                            ${escapeHtml(displayName)}
                            ${getRoleBadge(user.role)}
                        </div>
                        <div class="user-status">
                            ${user.online ? 'üü¢ √áevrimi√ßi' : '‚ö´ √áevrimdƒ±≈üƒ±'}
                        </div>
                    </div>
                `;
                
                item.addEventListener('click', () => {
                    if (user.id !== SYSTEM.currentUser.id) {
                        openPrivateChat(user.id);
                    }
                });
                
                container.appendChild(item);
            });
            
            updatePMConversationList();
        }

        // ==================== SOHBET Sƒ∞STEMƒ∞ ====================
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const text = input.value.trim();
            
            if (!text) return;
            
            if (text.startsWith('/')) {
                handleIRCCommand(text);
                input.value = '';
                return;
            }
            
            if (SYSTEM.activePM) {
                sendPrivateMessage(SYSTEM.activePM, text);
            } else {
                sendChannelMessage(text);
            }
            
            input.value = '';
            input.focus();
        }

        function sendChannelMessage(text) {
            const channel = DATA.channels[SYSTEM.currentChannel];
            if (!channel) return;
            
            if (DATA.globalMutes.has(SYSTEM.currentUser.id)) {
                addSystemMessage('‚ö†Ô∏è Global susturulmu≈üsunuz! Mesaj g√∂nderemezsiniz.');
                return;
            }
            
            if (channel.mutes.has(SYSTEM.currentUser.id)) {
                const muteEnd = channel.mutes.get(SYSTEM.currentUser.id);
                if (new Date() < muteEnd) {
                    addSystemMessage('‚ö†Ô∏è Bu kanalda susturulmu≈üsunuz! Mesaj g√∂nderemezsiniz.');
                    return;
                }
                channel.mutes.delete(SYSTEM.currentUser.id);
            }
            
            if (channel.slowmode > 0) {
                const lastMessage = channel.messages
                    .filter(m => m.userId === SYSTEM.currentUser.id)
                    .pop();
                if (lastMessage) {
                    const timeDiff = (new Date() - new Date(lastMessage.time)) / 1000;
                    if (timeDiff < channel.slowmode) {
                        addSystemMessage(`‚è±Ô∏è Yava≈ü mod aktif! ${Math.ceil(channel.slowmode - timeDiff)} saniye bekleyin.`);
                        return;
                    }
                }
            }
            
            const message = {
                id: generateMessageId(),
                type: 'message',
                userId: SYSTEM.currentUser.id,
                text: text,
                time: new Date(),
                channel: SYSTEM.currentChannel
            };
            
            channel.messages.push(message);
            addMessageToChat(message, SYSTEM.currentUser);
            
            if (text.length > 500) {
                mateBot.sendSecurityAlert(`${SYSTEM.currentUser.name} uzun mesaj g√∂nderdi (${text.length} karakter)`);
            }
        }

        function sendPrivateMessage(toUserId, text) {
            if (!DATA.users[toUserId]) {
                addSystemMessage('‚ùå Kullanƒ±cƒ± bulunamadƒ±!');
                return;
            }
            
            const pmKey = [SYSTEM.currentUser.id, toUserId].sort().join('_');
            
            if (!DATA.privateMessages.has(pmKey)) {
                DATA.privateMessages.set(pmKey, []);
            }
            
            const messages = DATA.privateMessages.get(pmKey);
            const message = {
                id: generateMessageId(),
                type: 'pm',
                from: SYSTEM.currentUser.id,
                to: toUserId,
                text: text,
                time: new Date(),
                read: false
            };
            
            messages.push(message);
            
            if (SYSTEM.pmWindows[toUserId]) {
                addMessageToPMWindow(toUserId, message);
            }
            
            updatePMConversationList();
            
            if (toUserId !== SYSTEM.currentUser.id) {
                showNotification(DATA.users[toUserId].name, text, 'pm');
            }
            
            if (text.toLowerCase().includes('≈üifre') || text.toLowerCase().includes('password')) {
                mateBot.sendSecurityAlert(`${SYSTEM.currentUser.name} ≈üifre i√ßeren √∂zel mesaj g√∂nderdi: ${toUserId} kullanƒ±cƒ±sƒ±na`);
            }
        }

        function addMessageToChat(message, user) {
            const container = document.getElementById('chatMessages');
            if (!container) return;
            
            if (container.children.length === 1 && 
                container.children[0].querySelector('.fas.fa-comments')) {
                clearContainer('chatMessages');
            }
            
            const isOutgoing = user.id === SYSTEM.currentUser.id;
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isOutgoing ? 'message-outgoing' : 'message-incoming'}`;
            messageDiv.dataset.messageId = message.id;
            
            const displayName = user.id === 'mate' ? 'ü§ñMate' : user.name;
            
            messageDiv.innerHTML = `
                <div class="message-sender">
                    <span style="font-weight: 500;">${escapeHtml(displayName)}</span>
                    ${getRoleBadge(user.role)}
                    ${user.registered ? '<i class="fas fa-check-circle" style="color: var(--accent-blue); font-size: 10px;"></i>' : ''}
                </div>
                <div class="message-text">${escapeHtml(message.text)}</div>
                <div class="message-time">${formatTime(message.time)}</div>
            `;
            
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }

        function addSystemMessage(text) {
            const container = document.getElementById('chatMessages');
            if (!container) return;
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message';
            messageDiv.style.textAlign = 'center';
            messageDiv.style.maxWidth = '100%';
            
            messageDiv.innerHTML = `
                <div style="display: inline-block; background: var(--bg-tertiary); padding: 8px 16px; border-radius: 16px; color: var(--text-secondary); font-style: italic; font-size: 13px;">
                    ${escapeHtml(text)}
                </div>
            `;
            
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }

        function loadChannelMessages(channelId) {
            const container = document.getElementById('chatMessages');
            if (!container) return;
            
            clearContainer('chatMessages');
            
            const channel = DATA.channels[channelId];
            if (!channel || !channel.messages || channel.messages.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px; color: var(--text-secondary);">
                        <i class="fas fa-comments" style="font-size: 48px; margin-bottom: 15px; opacity: 0.5;"></i>
                        <h3 style="margin-bottom: 10px;">${channel.name.replace('#', '')} Kanalƒ±</h3>
                        <p>Bu kanalda hen√ºz mesaj yok. ƒ∞lk mesajƒ± siz g√∂nderin!</p>
                    </div>
                `;
                return;
            }
            
            channel.messages.forEach(msg => {
                const user = DATA.users[msg.userId];
                if (user) {
                    addMessageToChat(msg, user);
                }
            });
            
            container.scrollTop = container.scrollHeight;
        }

        // ==================== KANAL Sƒ∞STEMƒ∞ ====================
        function switchChannel(channelId) {
            if (!DATA.channels[channelId]) return;
            
            SYSTEM.currentChannel = channelId;
            SYSTEM.activePM = null;
            
            document.querySelectorAll('.channel-tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.dataset.channel === channelId) {
                    tab.classList.add('active');
                }
            });
            
            const channel = DATA.channels[channelId];
            document.getElementById('currentChannel').textContent = channel.name.replace('#', '');
            document.getElementById('channelTopic').textContent = channel.topic;
            document.getElementById('panelChannelName').textContent = channel.name;
            document.getElementById('panelChannelTopic').textContent = channel.topic;
            document.getElementById('panelChannelVideo').textContent = channel.video.title;
            document.getElementById('videoChannel').textContent = channel.name.replace('#', '');
            
            const videoBtn = document.getElementById('videoManagerBtn');
            const changeVideoBtn = document.getElementById('changeVideoBtn');
            
            if (hasVideoPermission(channelId)) {
                videoBtn.classList.remove('hidden');
                changeVideoBtn.classList.remove('hidden');
            } else {
                videoBtn.classList.add('hidden');
                changeVideoBtn.classList.add('hidden');
            }
            
            loadChannelMessages(channelId);
            updateOnlineList();
            loadChannelVideo();
            
            Object.keys(SYSTEM.pmWindows).forEach(userId => {
                closePMWindow(userId);
            });
        }

        function createNewChannel() {
            const nameInput = document.getElementById('channelName');
            const typeSelect = document.getElementById('channelType');
            const topicInput = document.getElementById('channelTopicInput');
            
            const name = nameInput.value.trim();
            const type = typeSelect.value;
            const topic = topicInput.value.trim() || 'Yeni sohbet kanalƒ±';
            
            if (!name || !name.startsWith('#')) {
                alert('Kanal adƒ± # ile ba≈ülamalƒ±!');
                return;
            }
            
            const channelId = name.substring(1).toLowerCase().replace(/[^a-z0-9]/g, '_');
            
            if (DATA.channels[channelId]) {
                alert('Bu kanal adƒ± zaten kullanƒ±lƒ±yor!');
                return;
            }
            
            if (DATA.userChannels.has(SYSTEM.currentUser.id)) {
                alert('Zaten bir kanalƒ±nƒ±z var! Her kullanƒ±cƒ± sadece 1 kanal a√ßabilir.');
                return;
            }
            
            DATA.channels[channelId] = {
                id: channelId,
                name: name,
                owner: SYSTEM.currentUser.id,
                type: type,
                topic: topic,
                users: new Set([SYSTEM.currentUser.id, 'mate']),
                operators: new Set(),
                voices: new Set(),
                bans: new Map(),
                mutes: new Map(),
                slowmode: 0,
                locked: false,
                userLimit: 0,
                messages: [],
                video: {
                    id: 'jfKfPfyJRdk',
                    title: 'Lofi Hip Hop Radio üìö',
                    channel: name.replace('#', '')
                }
            };
            
            DATA.userChannels.set(SYSTEM.currentUser.id, channelId);
            
            mateBot.sendSecurityAlert(`Yeni kanal olu≈üturuldu: ${name} (${SYSTEM.currentUser.name} tarafƒ±ndan)`, channelId);
            
            const tabsContainer = document.getElementById('channelTabs');
            const tab = document.createElement('div');
            tab.className = 'channel-tab';
            tab.dataset.channel = channelId;
            tab.innerHTML = `<i class="fas fa-hashtag"></i> ${name.substring(1)}`;
            tab.addEventListener('click', () => switchChannel(channelId));
            tabsContainer.appendChild(tab);
            
            switchChannel(channelId);
            closeModal('channelModal');
            
            nameInput.value = '';
            topicInput.value = '';
            
            addSystemMessage(`üéä ${SYSTEM.currentUser.name} yeni kanal olu≈üturdu: ${name}`);
        }

        // ==================== VIDEO Sƒ∞STEMƒ∞ ====================
        function loadChannelVideo() {
            const channel = DATA.channels[SYSTEM.currentChannel];
            if (!channel || !channel.video) return;
            
            const player = document.getElementById('youtubePlayer');
            const titleElement = document.getElementById('videoTitle');
            
            if (player && titleElement) {
                player.src = `https://www.youtube-nocookie.com/embed/${channel.video.id}?autoplay=1&mute=1&rel=0&controls=1&modestbranding=1`;
                titleElement.textContent = channel.video.title;
                document.getElementById('panelChannelVideo').textContent = channel.video.title;
            }
        }

        function changeChannelVideo() {
            const channel = DATA.channels[SYSTEM.currentChannel];
            if (!channel) return;
            
            if (!hasVideoPermission(SYSTEM.currentChannel)) {
                alert('Video deƒüi≈ütirme yetkiniz yok!');
                return;
            }
            
            document.getElementById('videoUrl').value = '';
            document.getElementById('videoTitleInput').value = channel.video.title || '';
            openModal('videoModal');
        }

        function saveChannelVideo() {
            const urlInput = document.getElementById('videoUrl');
            const titleInput = document.getElementById('videoTitleInput');
            
            const url = urlInput.value.trim();
            const title = titleInput.value.trim() || 'YouTube Video';
            
            if (!url) {
                alert('YouTube URL veya Video ID gerekli!');
                return;
            }
            
            let videoId = url;
            
            try {
                if (url.includes('youtube.com') || url.includes('youtu.be')) {
                    const urlObj = new URL(url.includes('http') ? url : 'https://' + url);
                    if (urlObj.hostname.includes('youtu.be')) {
                        videoId = urlObj.pathname.substring(1);
                    } else {
                        videoId = urlObj.searchParams.get('v') || url.split('v=')[1]?.split('&')[0];
                    }
                }
                
                if (!videoId || videoId.length !== 11) {
                    throw new Error('Ge√ßersiz Video ID');
                }
            } catch (e) {
                if (url.length === 11) {
                    videoId = url;
                } else {
                    alert('Ge√ßerli bir YouTube URL veya Video ID girin!');
                    return;
                }
            }
            
            const channel = DATA.channels[SYSTEM.currentChannel];
            if (channel) {
                channel.video = {
                    id: videoId,
                    title: title,
                    channel: channel.name.replace('#', '')
                };
                
                loadChannelVideo();
                
                mateBot.sendSecurityAlert(`${SYSTEM.currentUser.name} video deƒüi≈ütirdi: ${title}`, SYSTEM.currentChannel);
                
                addSystemMessage(`üé• ${SYSTEM.currentUser.name} kanal videosunu deƒüi≈ütirdi: ${title}`);
                closeModal('videoModal');
            }
        }

        // ==================== KAMERA Sƒ∞STEMƒ∞ (SADECE √ñZEL SOHBET) ====================
        async function openCameraModal(targetUserId = null) {
            try {
                if (!targetUserId) {
                    alert('Kamera sadece √∂zel sohbetlerde kullanƒ±labilir!');
                    return;
                }
                
                SYSTEM.uploadType = { 
                    type: 'camera', 
                    target: targetUserId,
                    isPM: true,
                    facingMode: SYSTEM.facingMode 
                };
                
                openModal('cameraModal');
                
                const constraints = {
                    video: { 
                        facingMode: SYSTEM.facingMode,
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    },
                    audio: true
                };
                
                if (SYSTEM.cameraStream) {
                    stopCamera();
                }
                
                SYSTEM.cameraStream = await navigator.mediaDevices.getUserMedia(constraints);
                const preview = document.getElementById('cameraPreview');
                preview.srcObject = SYSTEM.cameraStream;
                
                document.getElementById('captureImageBtn').disabled = false;
                document.getElementById('recordVideoBtn').disabled = false;
                document.getElementById('switchCameraBtn').disabled = false;
                
            } catch (err) {
                console.error('Kamera hatasƒ±:', err);
                alert('Kamera eri≈üim izni gerekiyor!');
                closeModal('cameraModal');
            }
        }

        async function switchCamera() {
            if (!SYSTEM.cameraStream) return;
            
            stopCamera();
            
            SYSTEM.facingMode = SYSTEM.facingMode === 'user' ? 'environment' : 'user';
            SYSTEM.uploadType.facingMode = SYSTEM.facingMode;
            
            await openCameraModal(SYSTEM.uploadType?.target);
        }

        function stopCamera() {
            if (SYSTEM.cameraStream) {
                SYSTEM.cameraStream.getTracks().forEach(track => track.stop());
                SYSTEM.cameraStream = null;
            }
            
            if (SYSTEM.mediaRecorder && SYSTEM.isRecording) {
                SYSTEM.mediaRecorder.stop();
                SYSTEM.isRecording = false;
            }
            
            const preview = document.getElementById('cameraPreview');
            if (preview) {
                preview.srcObject = null;
            }
        }

        function captureImage() {
            const video = document.getElementById('cameraPreview');
            const canvas = document.getElementById('cameraCanvas');
            const previewArea = document.getElementById('cameraPreviewArea');
            const sendBtn = document.getElementById('sendCameraMedia');
            
            if (!video || !canvas) return;
            
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            
            const imageData = canvas.toDataURL('image/jpeg');
            
            previewArea.style.display = 'block';
            previewArea.innerHTML = `
                <h4 style="margin-bottom: 10px; font-size: 14px;">Fotoƒüraf √ñnizleme:</h4>
                <img src="${imageData}" style="max-width: 100%; max-height: 200px; border-radius: 8px; border: 2px solid var(--accent-blue);">
                <div style="margin-top: 10px; font-size: 12px; color: var(--text-secondary);">
                    Fotoƒüraf hazƒ±r! G√∂ndermek i√ßin "G√∂nder" butonuna basƒ±n.
                </div>
            `;
            
            sendBtn.disabled = false;
            SYSTEM.uploadType.mediaData = imageData;
            SYSTEM.uploadType.mediaType = 'image';
        }

        function startRecording() {
            if (!SYSTEM.cameraStream) return;
            
            const recordBtn = document.getElementById('recordVideoBtn');
            const stopBtn = document.getElementById('stopRecordingBtn');
            const sendBtn = document.getElementById('sendCameraMedia');
            
            SYSTEM.recordedChunks = [];
            SYSTEM.mediaRecorder = new MediaRecorder(SYSTEM.cameraStream, {
                mimeType: 'video/webm;codecs=vp9'
            });
            
            SYSTEM.mediaRecorder.ondataavailable = (event) => {
                if (event.data.size > 0) {
                    SYSTEM.recordedChunks.push(event.data);
                }
            };
            
            SYSTEM.mediaRecorder.onstop = () => {
                const blob = new Blob(SYSTEM.recordedChunks, { type: 'video/webm' });
                const url = URL.createObjectURL(blob);
                
                const previewArea = document.getElementById('cameraPreviewArea');
                previewArea.style.display = 'block';
                previewArea.innerHTML = `
                    <h4 style="margin-bottom: 10px; font-size: 14px;">Video √ñnizleme:</h4>
                    <video src="${url}" controls style="max-width: 100%; max-height: 200px; border-radius: 8px; border: 2px solid var(--accent-blue);"></video>
                    <div style="margin-top: 10px; font-size: 12px; color: var(--text-secondary);">
                        Video hazƒ±r! G√∂ndermek i√ßin "G√∂nder" butonuna basƒ±n.
                    </div>
                `;
                
                sendBtn.disabled = false;
                SYSTEM.uploadType.mediaData = url;
                SYSTEM.uploadType.mediaType = 'video';
                SYSTEM.uploadType.mediaBlob = blob;
            };
            
            SYSTEM.mediaRecorder.start();
            SYSTEM.isRecording = true;
            
            recordBtn.style.display = 'none';
            stopBtn.style.display = 'inline-flex';
        }

        function stopRecording() {
            if (SYSTEM.mediaRecorder && SYSTEM.isRecording) {
                SYSTEM.mediaRecorder.stop();
                SYSTEM.isRecording = false;
                
                const recordBtn = document.getElementById('recordVideoBtn');
                const stopBtn = document.getElementById('stopRecordingBtn');
                
                recordBtn.style.display = 'inline-flex';
                stopBtn.style.display = 'none';
            }
        }

        function sendCameraMedia() {
            if (!SYSTEM.uploadType || !SYSTEM.uploadType.mediaData || !SYSTEM.uploadType.target) return;
            
            const uploadType = SYSTEM.uploadType;
            
            if (uploadType.mediaType === 'image') {
                sendPrivateMediaMessage(uploadType.target, uploadType.mediaData, 'image');
            } else if (uploadType.mediaType === 'video') {
                sendPrivateMediaMessage(uploadType.target, uploadType.mediaData, 'video');
            }
            
            document.getElementById('cameraPreviewArea').style.display = 'none';
            document.getElementById('sendCameraMedia').disabled = true;
            
            stopCamera();
            closeModal('cameraModal');
            
            showNotification('Kamera', `${uploadType.mediaType} ba≈üarƒ±yla g√∂nderildi.`);
        }

        function sendPrivateMediaMessage(userId, mediaData, mediaType) {
            if (!DATA.users[userId]) return;
            
            const pmKey = [SYSTEM.currentUser.id, userId].sort().join('_');
            
            if (!DATA.privateMessages.has(pmKey)) {
                DATA.privateMessages.set(pmKey, []);
            }
            
            const messages = DATA.privateMessages.get(pmKey);
            const message = {
                id: generateMessageId(),
                type: 'pm',
                from: SYSTEM.currentUser.id,
                to: userId,
                text: `[${mediaType.toUpperCase()}] Kamera ile g√∂nderildi`,
                mediaType: mediaType,
                mediaData: mediaData,
                time: new Date(),
                read: false
            };
            
            messages.push(message);
            
            if (SYSTEM.pmWindows[userId]) {
                addMediaToPMWindow(userId, message);
            }
            
            updatePMConversationList();
            showNotification(DATA.users[userId].name, `${mediaType} g√∂nderildi`, 'pm');
        }

        // ==================== √ñZEL SOHBET Sƒ∞STEMƒ∞ ====================
        function openPrivateChat(userId) {
            if (!DATA.users[userId] || userId === SYSTEM.currentUser.id) return;
            
            SYSTEM.activePM = userId;
            
            if (SYSTEM.pmWindows[userId]) {
                SYSTEM.pmWindows[userId].classList.remove('minimized');
                return;
            }
            
            createPMWindow(userId);
            updateOnlineList();
            updatePMConversationList();
        }

        function createPMWindow(userId) {
            const user = DATA.users[userId];
            if (!user) return;
            
            const pmWindow = document.createElement('div');
            pmWindow.className = 'pm-window';
            pmWindow.id = `pm-window-${userId}`;
            
            const displayName = user.id === 'mate' ? 'ü§ñMate' : user.name;
            
            pmWindow.innerHTML = `
                <div class="pm-window-header" data-user-id="${userId}">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div class="user-avatar ${user.online ? 'online' : ''}" style="width: 30px; height: 30px; font-size: 14px;">
                            ${user.avatar}
                        </div>
                        <div>
                            <div style="font-weight: 600; font-size: 14px;">
                                ${escapeHtml(displayName)}
                                ${getRoleBadge(user.role)}
                            </div>
                            <div style="font-size: 11px; color: var(--text-secondary);">
                                ${user.online ? 'üü¢ √áevrimi√ßi' : '‚ö´ √áevrimdƒ±≈üƒ±'}
                            </div>
                        </div>
                    </div>
                    <div style="display: flex; gap: 5px;">
                        <button class="btn btn-sm btn-minimize-pm" style="background: none; border: none; color: var(--text-secondary); padding: 4px 8px;">
                            <i class="fas fa-minus"></i>
                        </button>
                        <button class="btn btn-sm btn-close-pm" style="background: none; border: none; color: var(--text-secondary); padding: 4px 8px;">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
                <div class="pm-window-messages" id="pm-messages-${userId}">
                    <!-- Mesajlar buraya gelecek -->
                </div>
                <div class="pm-window-input">
                    <div class="message-input-container">
                        <textarea class="message-input pm-input" id="pm-input-${userId}" 
                                  placeholder="${displayName} ile mesajla≈üƒ±n..." 
                                  rows="2"></textarea>
                    </div>
                    <div class="input-actions" style="margin-top: 10px;">
                        <div class="flex gap-2">
                            <button class="btn btn-secondary btn-sm btn-pm-image" data-user-id="${userId}">
                                <i class="fas fa-image"></i>
                            </button>
                            <button class="btn btn-secondary btn-sm btn-pm-camera" data-user-id="${userId}">
                                <i class="fas fa-camera"></i>
                            </button>
                        </div>
                        <button class="btn btn-primary btn-send-pm" data-user-id="${userId}">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(pmWindow);
            SYSTEM.pmWindows[userId] = pmWindow;
            
            const header = pmWindow.querySelector('.pm-window-header');
            const minimizeBtn = pmWindow.querySelector('.btn-minimize-pm');
            const closeBtn = pmWindow.querySelector('.btn-close-pm');
            const sendBtn = pmWindow.querySelector('.btn-send-pm');
            const input = pmWindow.querySelector(`#pm-input-${userId}`);
            
            header.addEventListener('click', (e) => {
                if (e.target === header || e.target.closest('.pm-window-header') === header) {
                    pmWindow.classList.toggle('minimized');
                }
            });
            
            minimizeBtn?.addEventListener('click', (e) => {
                e.stopPropagation();
                pmWindow.classList.toggle('minimized');
            });
            
            closeBtn?.addEventListener('click', () => {
                closePMWindow(userId);
            });
            
            sendBtn?.addEventListener('click', () => {
                const text = input.value.trim();
                if (text) {
                    sendPrivateMessage(userId, text);
                    input.value = '';
                    input.focus();
                }
            });
            
            input?.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    const text = input.value.trim();
                    if (text) {
                        sendPrivateMessage(userId, text);
                        input.value = '';
                    }
                }
            });
            
            pmWindow.querySelector('.btn-pm-image')?.addEventListener('click', () => {
                SYSTEM.uploadType = { type: 'image', target: userId, isPM: true };
                openUploadModal('Resim G√∂nder');
            });
            
            pmWindow.querySelector('.btn-pm-camera')?.addEventListener('click', () => {
                openCameraModal(userId);
            });
            
            loadPMMessages(userId);
        }

        function closePMWindow(userId) {
            const pmWindow = document.getElementById(`pm-window-${userId}`);
            if (pmWindow) {
                pmWindow.remove();
                delete SYSTEM.pmWindows[userId];
                
                if (SYSTEM.activePM === userId) {
                    SYSTEM.activePM = null;
                    updateOnlineList();
                }
            }
        }

        function loadPMMessages(userId) {
            const container = document.getElementById(`pm-messages-${userId}`);
            if (!container) return;
            
            clearContainer(`pm-messages-${userId}`);
            
            const pmKey = [SYSTEM.currentUser.id, userId].sort().join('_');
            const messages = DATA.privateMessages.get(pmKey) || [];
            
            if (messages.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px; color: var(--text-secondary);">
                        <i class="fas fa-comment" style="font-size: 48px; margin-bottom: 15px; opacity: 0.5;"></i>
                        <h3 style="margin-bottom: 10px;">${DATA.users[userId]?.name} ile Sohbet</h3>
                        <p>Hen√ºz mesaj yok. ƒ∞lk mesajƒ± siz g√∂nderin!</p>
                    </div>
                `;
                return;
            }
            
            messages.forEach(msg => {
                const isOutgoing = msg.from === SYSTEM.currentUser.id;
                const sender = DATA.users[msg.from];
                if (!sender) return;
                
                const displayName = sender.id === 'mate' ? 'ü§ñMate' : sender.name;
                
                if (msg.mediaType) {
                    addMediaToPMWindowElement(container, msg, sender, isOutgoing, displayName);
                } else {
                    const messageDiv = document.createElement('div');
                    messageDiv.className = `message ${isOutgoing ? 'message-outgoing' : 'message-incoming'}`;
                    messageDiv.dataset.messageId = msg.id;
                    
                    messageDiv.innerHTML = `
                        <div class="message-sender">
                            <span style="font-weight: 500;">${escapeHtml(displayName)}</span>
                            ${getRoleBadge(sender.role)}
                        </div>
                        <div class="message-text">${escapeHtml(msg.text)}</div>
                        <div class="message-time">${formatTime(msg.time)}</div>
                    `;
                    
                    container.appendChild(messageDiv);
                }
            });
            
            container.scrollTop = container.scrollHeight;
        }

        function addMediaToPMWindowElement(container, msg, sender, isOutgoing, displayName) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isOutgoing ? 'message-outgoing' : 'message-incoming'}`;
            messageDiv.dataset.messageId = msg.id;
            messageDiv.dataset.mediaType = msg.mediaType;
            
            let mediaHtml = '';
            if (msg.mediaType === 'image') {
                mediaHtml = `
                    <div class="pm-media-container">
                        <img src="${msg.mediaData}" alt="G√∂nderilen resim">
                        <div class="pm-media-info">üì∏ Kamera</div>
                    </div>
                `;
            } else if (msg.mediaType === 'video') {
                mediaHtml = `
                    <div class="pm-media-container">
                        <video src="${msg.mediaData}" controls></video>
                        <div class="pm-media-info">üé• Kamera Video</div>
                    </div>
                `;
            }
            
            messageDiv.innerHTML = `
                <div class="message-sender">
                    <span style="font-weight: 500;">${escapeHtml(displayName)}</span>
                    ${getRoleBadge(sender.role)}
                </div>
                ${mediaHtml}
                <div class="message-text" style="margin-top: 8px;">${escapeHtml(msg.text)}</div>
                <div class="message-time">${formatTime(msg.time)}</div>
            `;
            
            container.appendChild(messageDiv);
        }

        function addMessageToPMWindow(userId, message) {
            const container = document.getElementById(`pm-messages-${userId}`);
            if (!container) return;
            
            if (container.children.length === 1 && 
                container.children[0].querySelector('.fas.fa-comment')) {
                clearContainer(`pm-messages-${userId}`);
            }
            
            const isOutgoing = message.from === SYSTEM.currentUser.id;
            const sender = DATA.users[message.from];
            if (!sender) return;
            
            const displayName = sender.id === 'mate' ? 'ü§ñMate' : sender.name;
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isOutgoing ? 'message-outgoing' : 'message-incoming'}`;
            messageDiv.dataset.messageId = message.id;
            
            messageDiv.innerHTML = `
                <div class="message-sender">
                    <span style="font-weight: 500;">${escapeHtml(displayName)}</span>
                    ${getRoleBadge(sender.role)}
                </div>
                <div class="message-text">${escapeHtml(message.text)}</div>
                <div class="message-time">${formatTime(message.time)}</div>
            `;
            
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }

        function addMediaToPMWindow(userId, message) {
            const container = document.getElementById(`pm-messages-${userId}`);
            if (!container) return;
            
            if (container.children.length === 1 && 
                container.children[0].querySelector('.fas.fa-comment')) {
                clearContainer(`pm-messages-${userId}`);
            }
            
            const isOutgoing = message.from === SYSTEM.currentUser.id;
            const sender = DATA.users[message.from];
            if (!sender) return;
            
            const displayName = sender.id === 'mate' ? 'ü§ñMate' : sender.name;
            
            addMediaToPMWindowElement(container, message, sender, isOutgoing, displayName);
            container.scrollTop = container.scrollHeight;
        }

        function updatePMConversationList() {
            const container = document.getElementById('pmConversationList');
            if (!container) return;
            
            clearContainer('pmConversationList');
            
            const conversations = new Map();
            
            DATA.privateMessages.forEach((messages, pmKey) => {
                const [user1, user2] = pmKey.split('_');
                const otherUserId = user1 === SYSTEM.currentUser.id ? user2 : 
                                  user2 === SYSTEM.currentUser.id ? user1 : null;
                
                if (otherUserId && DATA.users[otherUserId]) {
                    const lastMessage = messages[messages.length - 1];
                    const unreadCount = messages.filter(m => 
                        m.from !== SYSTEM.currentUser.id && !m.read
                    ).length;
                    
                    conversations.set(otherUserId, {
                        user: DATA.users[otherUserId],
                        lastMessage: lastMessage,
                        unreadCount: unreadCount,
                        messageCount: messages.length
                    });
                }
            });
            
            const sortedConversations = Array.from(conversations.values())
                .sort((a, b) => {
                    if (!a.lastMessage) return 1;
                    if (!b.lastMessage) return -1;
                    return new Date(b.lastMessage.time) - new Date(a.lastMessage.time);
                });
            
            if (sortedConversations.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 30px 20px; color: var(--text-secondary);">
                        <i class="fas fa-comments" style="font-size: 32px; margin-bottom: 10px; opacity: 0.5;"></i>
                        <div style="font-size: 13px;">Hen√ºz √∂zel sohbetiniz yok</div>
                    </div>
                `;
                return;
            }
            
            sortedConversations.forEach(conv => {
                const item = document.createElement('div');
                item.className = `pm-item ${conv.unreadCount > 0 ? 'unread' : ''}`;
                
                const displayName = conv.user.id === 'mate' ? 'ü§ñMate' : conv.user.name;
                
                const lastMessageText = conv.lastMessage ? 
                    (conv.lastMessage.text.length > 30 ? 
                     conv.lastMessage.text.substring(0, 30) + '...' : 
                     conv.lastMessage.text) : 
                    'Mesaj yok';
                
                const lastMessageTime = conv.lastMessage ? 
                    formatTime(conv.lastMessage.time) : '';
                
                item.innerHTML = `
                    <div class="pm-avatar">
                        ${conv.user.avatar}
                    </div>
                    <div class="pm-info">
                        <div class="pm-name">
                            ${escapeHtml(displayName)}
                            ${conv.unreadCount > 0 ? 
                              `<span style="background: var(--accent-blue); color: white; font-size: 10px; padding: 1px 5px; border-radius: 10px; margin-left: 5px;">${conv.unreadCount}</span>` : 
                              ''}
                        </div>
                        <div class="pm-preview">${escapeHtml(lastMessageText)}</div>
                    </div>
                    <div class="pm-time">${lastMessageTime}</div>
                `;
                
                item.addEventListener('click', () => {
                    openPrivateChat(conv.user.id);
                });
                
                container.appendChild(item);
            });
        }

        // ==================== DOSYA Y√úKLEME Sƒ∞STEMƒ∞ (SADECE √ñZEL SOHBET) ====================
        function openUploadModal(title) {
            const modal = document.getElementById('uploadModal');
            const titleElement = document.getElementById('uploadTitle');
            const dropZone = document.getElementById('uploadDropZone');
            const fileInput = document.getElementById('fileInput');
            const preview = document.getElementById('uploadPreview');
            const progress = document.getElementById('uploadProgress');
            const sendBtn = document.getElementById('sendUpload');
            
            if (!modal || !titleElement) return;
            
            // Sadece √∂zel sohbet i√ßin dosya g√∂nderme izni
            if (!SYSTEM.uploadType || !SYSTEM.uploadType.isPM) {
                alert('Dosya g√∂nderme sadece √∂zel sohbetlerde m√ºmk√ºnd√ºr!');
                return;
            }
            
            titleElement.textContent = title;
            preview.style.display = 'none';
            preview.innerHTML = '';
            progress.style.display = 'none';
            sendBtn.disabled = true;
            fileInput.value = '';
            
            dropZone.onclick = () => fileInput.click();
            
            dropZone.ondragover = (e) => {
                e.preventDefault();
                dropZone.style.borderColor = 'var(--accent-blue)';
                dropZone.style.background = 'var(--bg-tertiary)';
            };
            
            dropZone.ondragleave = () => {
                dropZone.style.borderColor = 'var(--border-light)';
                dropZone.style.background = 'transparent';
            };
            
            dropZone.ondrop = (e) => {
                e.preventDefault();
                dropZone.style.borderColor = 'var(--border-light)';
                dropZone.style.background = 'transparent';
                
                if (e.dataTransfer.files.length > 0) {
                    handleFileSelect(e.dataTransfer.files[0]);
                }
            };
            
            fileInput.onchange = () => {
                if (fileInput.files.length > 0) {
                    handleFileSelect(fileInput.files[0]);
                }
            };
            
            modal.style.display = 'flex';
        }

        function handleFileSelect(file) {
            if (!file) return;
            
            if (file.size > 10 * 1024 * 1024) {
                alert('Dosya √ßok b√ºy√ºk! Maksimum 10MB.');
                return;
            }
            
            const preview = document.getElementById('uploadPreview');
            const sendBtn = document.getElementById('sendUpload');
            
            preview.style.display = 'block';
            
            if (file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    preview.innerHTML = `
                        <div style="text-align: center;">
                            <img src="${e.target.result}" style="max-width: 100%; max-height: 200px; border-radius: 8px;">
                            <div style="margin-top: 10px; font-size: 13px;">
                                ${escapeHtml(file.name)} (${(file.size / 1024).toFixed(1)} KB)
                            </div>
                        </div>
                    `;
                    sendBtn.disabled = false;
                    SYSTEM.uploadType.fileData = e.target.result;
                    SYSTEM.uploadType.fileName = file.name;
                    SYSTEM.uploadType.fileSize = file.size;
                    SYSTEM.uploadType.fileType = 'image';
                };
                reader.readAsDataURL(file);
            } else if (file.type.startsWith('video/')) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    preview.innerHTML = `
                        <div style="text-align: center;">
                            <div style="background: var(--bg-tertiary); padding: 20px; border-radius: 8px; margin-bottom: 10px;">
                                <i class="fas fa-video" style="font-size: 48px; color: var(--text-secondary);"></i>
                            </div>
                            <div style="font-size: 13px;">
                                ${escapeHtml(file.name)} (${(file.size / 1024).toFixed(1)} KB)
                            </div>
                            <div style="font-size: 12px; color: var(--text-secondary); margin-top: 5px;">
                                ${escapeHtml(file.type)}
                            </div>
                        </div>
                    `;
                    sendBtn.disabled = false;
                    SYSTEM.uploadType.fileData = e.target.result;
                    SYSTEM.uploadType.fileName = file.name;
                    SYSTEM.uploadType.fileSize = file.size;
                    SYSTEM.uploadType.fileType = 'video';
                };
                reader.readAsDataURL(file);
            } else {
                preview.innerHTML = `
                    <div style="text-align: center;">
                        <div style="background: var(--bg-tertiary); padding: 20px; border-radius: 8px; margin-bottom: 10px;">
                            <i class="fas fa-file" style="font-size: 48px; color: var(--text-secondary);"></i>
                        </div>
                        <div style="font-size: 13px;">
                            ${escapeHtml(file.name)} (${(file.size / 1024).toFixed(1)} KB)
                        </div>
                        <div style="font-size: 12px; color: var(--text-secondary); margin-top: 5px;">
                            ${escapeHtml(file.type || 'Bilinmeyen dosya t√ºr√º')}
                        </div>
                    </div>
                `;
                sendBtn.disabled = false;
                SYSTEM.uploadType.fileData = null;
                SYSTEM.uploadType.fileName = file.name;
                SYSTEM.uploadType.fileSize = file.size;
                SYSTEM.uploadType.fileType = 'file';
            }
        }

        function uploadFile() {
            const uploadType = SYSTEM.uploadType;
            
            if (!uploadType || !uploadType.isPM || !uploadType.target) {
                alert('Dosya g√∂nderme hatasƒ±!');
                return;
            }
            
            const progress = document.getElementById('uploadProgress');
            const progressBar = document.getElementById('uploadProgressBar');
            const progressText = document.getElementById('uploadProgressText');
            const sendBtn = document.getElementById('sendUpload');
            
            progress.style.display = 'block';
            sendBtn.disabled = true;
            
            let progressValue = 0;
            const interval = setInterval(() => {
                progressValue += 5 + Math.random() * 10;
                if (progressValue > 100) progressValue = 100;
                
                progressBar.style.width = `${progressValue}%`;
                progressText.textContent = `%${Math.round(progressValue)}`;
                
                if (progressValue >= 100) {
                    clearInterval(interval);
                    
                    setTimeout(() => {
                        const fileName = escapeHtml(uploadType.fileName);
                        const fileSize = (uploadType.fileSize / 1024).toFixed(1);
                        
                        sendPrivateMessage(uploadType.target, 
                            `[${uploadType.fileType.toUpperCase()}] ${fileName} (${fileSize} KB)`);
                        
                        if (uploadType.fileData && (uploadType.fileType === 'image' || uploadType.fileType === 'video')) {
                            const pmKey = [SYSTEM.currentUser.id, uploadType.target].sort().join('_');
                            
                            if (!DATA.privateMessages.has(pmKey)) {
                                DATA.privateMessages.set(pmKey, []);
                            }
                            
                            const messages = DATA.privateMessages.get(pmKey);
                            const message = {
                                id: generateMessageId(),
                                type: 'pm',
                                from: SYSTEM.currentUser.id,
                                to: uploadType.target,
                                text: `[${uploadType.fileType.toUpperCase()}] ${fileName}`,
                                mediaType: uploadType.fileType,
                                mediaData: uploadType.fileData,
                                time: new Date(),
                                read: false
                            };
                            
                            messages.push(message);
                            
                            if (SYSTEM.pmWindows[uploadType.target]) {
                                addMediaToPMWindow(uploadType.target, message);
                            }
                        }
                        
                        closeModal('uploadModal');
                        showNotification('Dosya G√∂nderildi', `${fileName} ba≈üarƒ±yla g√∂nderildi.`);
                        
                        mateBot.sendSecurityAlert(`${SYSTEM.currentUser.name} dosya g√∂nderdi: ${fileName} (${fileSize} KB)`);
                    }, 500);
                }
            }, 100);
        }

        // ==================== IRC KOMUT Sƒ∞STEMƒ∞ ====================
        function handleIRCCommand(fullCommand) {
            const parts = fullCommand.split(' ');
            const cmd = parts[0].toLowerCase();
            const args = parts.slice(1);
            
            const commands = {
                '/nick': () => {
                    if (args.length >= 1) changeNick(args[0]);
                    else addSystemMessage('‚ùå Kullanƒ±m: /nick yeni_nick');
                },
                '/join': () => {
                    if (args.length >= 1) {
                        let channelName = args[0];
                        if (!channelName.startsWith('#')) channelName = '#' + channelName;
                        joinChannel(channelName);
                    } else {
                        addSystemMessage('‚ùå Kullanƒ±m: /join #kanal');
                    }
                },
                '/leave': () => leaveChannel(),
                '/part': () => leaveChannel(),
                '/msg': () => {
                    if (args.length >= 2) {
                        const target = args[0];
                        const message = args.slice(1).join(' ');
                        sendPrivateMessage(target.toLowerCase(), message);
                    } else {
                        addSystemMessage('‚ùå Kullanƒ±m: /msg nick mesaj');
                    }
                },
                '/me': () => {
                    if (args.length >= 1) {
                        const action = args.join(' ');
                        sendChannelMessage(`* ${SYSTEM.currentUser.name} ${action}`);
                    } else {
                        addSystemMessage('‚ùå Kullanƒ±m: /me eylem');
                    }
                },
                '/who': () => listChannelUsers(),
                '/whois': () => {
                    if (args.length >= 1) showUserInfo(args[0]);
                    else addSystemMessage('‚ùå Kullanƒ±m: /whois nick');
                },
                '/clear': () => clearChat(),
                '/topic': () => {
                    if (args.length >= 1) changeTopic(args.join(' '));
                    else addSystemMessage('‚ùå Kullanƒ±m: /topic yeni_konu');
                },
                '/help': () => showIRCHelp(),
                '/kick': () => {
                    if (args.length >= 1) kickUser(args[0], args[1]);
                    else addSystemMessage('‚ùå Kullanƒ±m: /kick nick [sebep]');
                },
                '/ban': () => {
                    if (args.length >= 1) banUser(args[0], args.slice(1).join(' '));
                    else addSystemMessage('‚ùå Kullan√ºm: /ban nick [sebep]');
                },
                '/mute': () => {
                    if (args.length >= 2) muteUser(args[0], parseInt(args[1]));
                    else addSystemMessage('‚ùå Kullanƒ±m: /mute nick s√ºre_saniye');
                },
                '/op': () => {
                    if (args.length >= 1) opUser(args[0]);
                    else addSystemMessage('‚ùå Kullanƒ±m: /op nick');
                },
                '/voice': () => {
                    if (args.length >= 1) voiceUser(args[0]);
                    else addSystemMessage('‚ùå Kullanƒ±m: /voice nick');
                },
                '/lock': () => lockChannel(),
                '/unlock': () => unlockChannel(),
                '/limit': () => {
                    if (args.length >= 1) setUserLimit(parseInt(args[0]));
                    else addSystemMessage('‚ùå Kullanƒ±m: /limit sayƒ±');
                },
                '/slowmode': () => {
                    if (args.length >= 1) setSlowmode(parseInt(args[0]));
                    else addSystemMessage('‚ùå Kullanƒ±m: /slowmode saniye');
                },
                '/gban': () => {
                    if (args.length >= 1) globalBan(args[0], args.slice(1).join(' '));
                    else addSystemMessage('‚ùå Kullanƒ±m: /gban nick [sebep]');
                },
                '/gmute': () => {
                    if (args.length >= 1) globalMute(args[0], args.slice(1).join(' '));
                    else addSystemMessage('‚ùå Kullanƒ±m: /gmute nick [sebep]');
                },
                '/duyuru': () => {
                    if (args.length >= 1) sendAnnouncement(args.join(' '));
                    else addSystemMessage('‚ùå Kullanƒ±m: /duyuru mesaj');
                },
                '/yetki': () => {
                    if (args.length >= 3) manageRole(args[1], args[2], args[3]);
                    else addSystemMessage('‚ùå Kullanƒ±m: /yetki ver/al nick rol');
                },
                '/invite': () => {
                    if (args.length >= 2) inviteUser(args[0], args[1]);
                    else addSystemMessage('‚ùå Kullanƒ±m: /invite nick #kanal');
                },
                '/mode': () => {
                    if (args.length >= 2) changeMode(args[0], args.slice(1));
                    else addSystemMessage('‚ùå Kullanƒ±m: /mode +/-mod parametre');
                },
                '/list': () => listChannels(),
                '/names': () => listChannelUsers(),
                '/quit': () => {
                    addSystemMessage('üëã √áƒ±kƒ±≈ü yapƒ±lƒ±yor...');
                    setTimeout(() => {
                        window.location.reload();
                    }, 1000);
                },
                '/ping': () => addSystemMessage('üèì Pong!'),
                '/time': () => addSystemMessage(`üïí ${new Date().toLocaleString('tr-TR')}`),
                '/version': () => addSystemMessage('‚ÑπÔ∏è EliteChat v2.0 - Profesyonel IRC Platformu'),
                '/stats': () => showStats()
            };
            
            if (commands[cmd]) {
                commands[cmd]();
            } else {
                addSystemMessage(`‚ùå Bilinmeyen komut: ${cmd}. /help yazarak yardƒ±m alƒ±n.`);
            }
        }

        // IRC komut fonksiyonlarƒ± (kƒ±saltƒ±lmƒ±≈ü)
        function changeNick(newNick) {
            if (!newNick || newNick.length < 2) {
                addSystemMessage('‚ùå Ge√ßersiz nick! (min 2 karakter)');
                return;
            }
            
            const cleanNick = newNick.replace(/[^a-zA-Z0-9._]/g, '');
            const userId = cleanNick.toLowerCase();
            
            if (userId === 'mate') {
                addSystemMessage('‚ùå Bu kullanƒ±cƒ± adƒ± sistem tarafƒ±ndan kullanƒ±lƒ±yor!');
                return;
            }
            
            if (DATA.users[userId] && userId !== SYSTEM.currentUser.id) {
                addSystemMessage('‚ùå Bu kullanƒ±cƒ± adƒ± zaten kullanƒ±lƒ±yor!');
                return;
            }
            
            const oldNick = SYSTEM.currentUser.name;
            const oldUserId = SYSTEM.currentUser.id;
            
            SYSTEM.currentUser.name = cleanNick;
            SYSTEM.currentUser.avatar = cleanNick.charAt(0).toUpperCase();
            
            delete DATA.users[oldUserId];
            DATA.users[userId] = SYSTEM.currentUser;
            
            DATA.onlineUsers.delete(oldUserId);
            DATA.onlineUsers.add(userId);
            
            Object.values(DATA.channels).forEach(channel => {
                if (channel.users.has(oldUserId)) {
                    channel.users.delete(oldUserId);
                    channel.users.add(userId);
                }
            });
            
            addSystemMessage(`‚úÖ Nick deƒüi≈ütirildi: ${oldNick} ‚Üí ${cleanNick}`);
            mateBot.sendSecurityAlert(`${oldNick} nick deƒüi≈ütirdi: ${cleanNick}`);
            updateOnlineList();
        }

        function joinChannel(channelName) {
            const channelId = channelName.substring(1).toLowerCase().replace(/[^a-z0-9]/g, '_');
            
            if (!DATA.channels[channelId]) {
                addSystemMessage(`‚ùå Kanal bulunamadƒ±: ${channelName}`);
                return;
            }
            
            const channel = DATA.channels[channelId];
            
            if (channel.bans.has(SYSTEM.currentUser.id)) {
                const banInfo = channel.bans.get(SYSTEM.currentUser.id);
                addSystemMessage(`‚ùå Bu kanaldan banlƒ±sƒ±nƒ±z! Sebep: ${banInfo.reason}`);
                return;
            }
            
            if (channel.locked && !channel.users.has(SYSTEM.currentUser.id)) {
                addSystemMessage('‚ùå Kanal kilitli!');
                return;
            }
            
            if (channel.userLimit > 0 && channel.users.size >= channel.userLimit) {
                addSystemMessage('‚ùå Kanal doldu!');
                return;
            }
            
            if (channel.type !== 'public' && !channel.users.has(SYSTEM.currentUser.id)) {
                addSystemMessage('‚ùå Bu kanala eri≈üim izniniz yok!');
                return;
            }
            
            channel.users.add(SYSTEM.currentUser.id);
            
            let tabExists = false;
            document.querySelectorAll('.channel-tab').forEach(tab => {
                if (tab.dataset.channel === channelId) {
                    tabExists = true;
                }
            });
            
            if (!tabExists) {
                const tabsContainer = document.getElementById('channelTabs');
                const tab = document.createElement('div');
                tab.className = 'channel-tab';
                tab.dataset.channel = channelId;
                tab.innerHTML = `<i class="fas fa-hashtag"></i> ${channel.name.substring(1)}`;
                tab.addEventListener('click', () => switchChannel(channelId));
                tabsContainer.appendChild(tab);
            }
            
            switchChannel(channelId);
            addSystemMessage(`‚úÖ ${channelName} kanalƒ±na katƒ±ldƒ±nƒ±z`);
        }

        function leaveChannel() {
            if (SYSTEM.currentChannel === 'general') {
                addSystemMessage('‚ùå Genel kanaldan ayrƒ±lamazsƒ±nƒ±z!');
                return;
            }
            
            const channel = DATA.channels[SYSTEM.currentChannel];
            const channelName = channel.name;
            
            channel.users.delete(SYSTEM.currentUser.id);
            
            const tab = document.querySelector(`.channel-tab[data-channel="${SYSTEM.currentChannel}"]`);
            if (tab) tab.remove();
            
            switchChannel('general');
            addSystemMessage(`‚úÖ ${channelName} kanalƒ±ndan ayrƒ±ldƒ±nƒ±z`);
        }

        function listChannelUsers() {
            const channel = DATA.channels[SYSTEM.currentChannel];
            if (!channel) return;
            
            const users = Array.from(channel.users)
                .map(id => DATA.users[id])
                .filter(u => u)
                .sort((a, b) => {
                    const roleOrder = { owner: 1, admin: 2, coadmin: 3, operator: 4, voice: 5, user: 6 };
                    const roleDiff = roleOrder[a.role] - roleOrder[b.role];
                    if (roleDiff !== 0) return roleDiff;
                    return a.name.localeCompare(b.name);
                });
            
            let message = `üë• ${channel.name} Kullanƒ±cƒ±larƒ± (${users.length}):\n`;
            users.forEach(user => {
                const displayName = user.id === 'mate' ? 'ü§ñMate' : user.name;
                message += `‚Ä¢ ${displayName} ${getRoleBadge(user.role)}\n`;
            });
            
            const lines = message.split('\n');
            lines.forEach(line => {
                if (line.trim()) {
                    addSystemMessage(line);
                }
            });
        }

        function showUserInfo(nick) {
            const userId = nick.toLowerCase();
            const user = DATA.users[userId];
            
            if (!user) {
                addSystemMessage(`‚ùå Kullanƒ±cƒ± bulunamadƒ±: ${nick}`);
                return;
            }
            
            const displayName = user.id === 'mate' ? 'ü§ñMate' : user.name;
            
            let info = `üë§ ${displayName} Bilgisi:\n`;
            info += `Rol: ${user.role}\n`;
            info += `Durum: ${user.online ? 'üü¢ √áevrimi√ßi' : '‚ö´ √áevrimdƒ±≈üƒ±'}\n`;
            info += `Kayƒ±tlƒ±: ${user.registered ? 'Evet ‚úì' : 'Hayƒ±r ‚úó'}\n`;
            info += `G√∂r√ºnmez: ${user.invisible ? 'Evet' : 'Hayƒ±r'}\n`;
            info += `Katƒ±lma: ${user.joinDate.toLocaleDateString('tr-TR')}\n`;
            info += `Son G√∂r√ºlme: ${user.lastSeen.toLocaleTimeString('tr-TR')}`;
            
            const userChannels = [];
            Object.values(DATA.channels).forEach(channel => {
                if (channel.users.has(userId)) {
                    userChannels.push(channel.name);
                }
            });
            
            if (userChannels.length > 0) {
                info += `\nKanallar: ${userChannels.join(', ')}`;
            }
            
            addSystemMessage(info);
        }

        function changeTopic(newTopic) {
            const channel = DATA.channels[SYSTEM.currentChannel];
            if (!channel) return;
            
            if (channel.owner !== SYSTEM.currentUser.id && 
                SYSTEM.currentUser.role !== 'owner' && 
                SYSTEM.currentUser.role !== 'admin') {
                addSystemMessage('‚ùå Kanal konusunu deƒüi≈ütirme yetkiniz yok!');
                return;
            }
            
            const oldTopic = channel.topic;
            channel.topic = newTopic;
            
            document.getElementById('channelTopic').textContent = newTopic;
            document.getElementById('panelChannelTopic').textContent = newTopic;
            
            addSystemMessage(`üìù Kanal konusu deƒüi≈ütirildi: "${oldTopic}" ‚Üí "${newTopic}"`);
            mateBot.sendSecurityAlert(`${SYSTEM.currentUser.name} kanal konusunu deƒüi≈ütirdi: "${newTopic}"`, SYSTEM.currentChannel);
        }

        function clearChat() {
            const container = document.getElementById('chatMessages');
            if (container) {
                clearContainer('chatMessages');
                addSystemMessage('‚úÖ Sohbet temizlendi');
            }
        }

        function listChannels() {
            const channels = Object.values(DATA.channels)
                .filter(channel => channel.type === 'public' || channel.users.has(SYSTEM.currentUser.id))
                .sort((a, b) => a.name.localeCompare(b.name));
            
            if (channels.length === 0) {
                addSystemMessage('‚ùå Hi√ß kanal bulunamadƒ±');
                return;
            }
            
            let message = `üìã Kanallar (${channels.length}):\n`;
            channels.forEach(channel => {
                const userCount = Array.from(channel.users).filter(id => DATA.users[id] && !DATA.users[id].invisible).length;
                const topic = channel.topic.length > 30 ? channel.topic.substring(0, 30) + '...' : channel.topic;
                message += `‚Ä¢ ${channel.name} (${userCount} ki≈üi) - ${topic}\n`;
            });
            
            const lines = message.split('\n');
            lines.forEach(line => {
                if (line.trim()) {
                    addSystemMessage(line);
                }
            });
        }

        function showStats() {
            const totalUsers = Object.keys(DATA.users).length;
            const onlineUsers = Array.from(DATA.onlineUsers).filter(id => DATA.users[id] && !DATA.users[id].invisible).length;
            const totalChannels = Object.keys(DATA.channels).length;
            const totalMessages = Object.values(DATA.channels).reduce((sum, channel) => sum + channel.messages.length, 0);
            const totalPMs = Array.from(DATA.privateMessages.values()).reduce((sum, messages) => sum + messages.length, 0);
            
            let stats = `üìä EliteChat ƒ∞statistikleri:\n`;
            stats += `Toplam Kullanƒ±cƒ±: ${totalUsers}\n`;
            stats += `√áevrimi√ßi: ${onlineUsers}\n`;
            stats += `Kanallar: ${totalChannels}\n`;
            stats += `Kanal Mesajlarƒ±: ${totalMessages}\n`;
            stats += `√ñzel Mesajlar: ${totalPMs}\n`;
            stats += `Kayƒ±tlƒ± Kullanƒ±cƒ±lar: ${DATA.registeredUsers.size}\n`;
            stats += `Sistem: EliteChat v2.0`;
            
            addSystemMessage(stats);
        }

        function showIRCHelp() {
            const helpText = `
üìã IRC KOMUTLARI:

üë§ GENEL KOMUTLAR:
/nick yeni_nick       - Kullanƒ±cƒ± adƒ±nƒ± deƒüi≈ütir
/join #kanal          - Kanala katƒ±l
/leave, /part         - Kanaldan ayrƒ±l
/msg nick mesaj       - √ñzel mesaj g√∂nder
/me eylem             - Eylem mesajƒ± g√∂nder
/who, /names          - Kanal kullanƒ±cƒ±larƒ±nƒ± listele
/whois nick           - Kullanƒ±cƒ± bilgisi g√∂ster
/list                 - Kanallarƒ± listele
/clear                - Sohbeti temizle
/topic yeni_konu      - Kanal konusunu deƒüi≈ütir
/invite nick #kanal   - Kullanƒ±cƒ±yƒ± kanala davet et
/ping                 - Ping kontrol√º
/time                 - Zamanƒ± g√∂ster
/version              - S√ºr√ºm bilgisi
/stats                - ƒ∞statistikleri g√∂ster
/help                 - Bu yardƒ±mƒ± g√∂ster
/quit                 - √áƒ±kƒ±≈ü yap

üõ°Ô∏è YETKƒ∞Lƒ∞ KOMUTLARI (OP/Channel Owner):
/kick nick [sebep]    - Kullanƒ±cƒ±yƒ± at
/ban nick [sebep]     - Kullanƒ±cƒ±yƒ± banla
/mute nick s√ºre       - Kullanƒ±cƒ±yƒ± sustur (saniye)
/op nick              - OP yetkisi ver
/voice nick           - Voice yetkisi ver
/lock                 - Kanalƒ± kilitle
/unlock               - Kanalƒ±n kilidini a√ß
/limit sayƒ±           - Kullanƒ±cƒ± limiti koy
/slowmode saniye      - Yava≈ü mod a√ß
/mode +/-mod param    - Kanal modlarƒ±nƒ± deƒüi≈ütir

üëë Sƒ∞STEM KOMUTLARI (Owner/Admin):
/gban nick [sebep]    - Global ban
/gmute nick [sebep]   - Global sustur
/duyuru mesaj         - Sistem duyurusu
/yetki ver nick rol   - Yetki ver (owner/admin/coadmin)
/yetki al nick        - Yetki al
            `;
            
            helpText.trim().split('\n').forEach(line => {
                if (line.trim()) {
                    addSystemMessage(line);
                }
            });
        }

        // ==================== OTOMATƒ∞K G√úNCELLEMELER ====================
        function startAutoUpdates() {
            const interval1 = setInterval(() => {
                const viewerCount = document.getElementById('viewerCount');
                if (viewerCount) {
                    const current = parseInt(viewerCount.textContent.replace(/[^0-9]/g, '')) || 1200;
                    const change = Math.floor(Math.random() * 100) - 50;
                    const newCount = Math.max(100, current + change);
                    viewerCount.textContent = newCount >= 1000 ? (newCount/1000).toFixed(1) + 'K' : newCount.toString();
                }
            }, 30000);
            
            SYSTEM.intervals.push(interval1);
            
            const interval2 = setInterval(() => {
                updatePMConversationList();
                
                const channel = DATA.channels[SYSTEM.currentChannel];
                if (channel && channel.messages.length > 0) {
                    const lastMessage = channel.messages[channel.messages.length - 1];
                    const lastMessageTime = new Date(lastMessage.time);
                    const now = new Date();
                    
                    if ((now - lastMessageTime) > 10000 && 
                        Math.random() > 0.7 &&
                        lastMessage.userId !== SYSTEM.currentUser.id &&
                        lastMessage.userId !== 'mate') {
                        
                        const otherUsers = Array.from(channel.users)
                            .map(id => DATA.users[id])
                            .filter(u => u && u.id !== SYSTEM.currentUser.id && u.online && u.registered && u.id !== 'mate');
                        
                        if (otherUsers.length > 0) {
                            const randomUser = otherUsers[Math.floor(Math.random() * otherUsers.length)];
                            const replies = [
                                "G√ºzel noktaya deƒüindin!",
                                "Katƒ±lƒ±yorum üëç",
                                "Harika bir fikir!",
                                "Bu konuda daha fazla konu≈üalƒ±m",
                                "Te≈üekk√ºrler payla≈üƒ±m i√ßin"
                            ];
                            const replyText = replies[Math.floor(Math.random() * replies.length)];
                            
                            const replyMessage = {
                                id: generateMessageId(),
                                type: 'message',
                                userId: randomUser.id,
                                text: replyText,
                                time: new Date(),
                                channel: SYSTEM.currentChannel
                            };
                            
                            channel.messages.push(replyMessage);
                            addMessageToChat(replyMessage, randomUser);
                        }
                    }
                }
            }, 5000);
            
            SYSTEM.intervals.push(interval2);
            
            const interval3 = setInterval(() => {
                if (SYSTEM.currentUser && DATA.globalBans.has(SYSTEM.currentUser.id)) {
                    addSystemMessage('‚ùå Global banlƒ±sƒ±nƒ±z! Sistemden √ßƒ±kartƒ±lƒ±yorsunuz...');
                    setTimeout(() => {
                        window.location.reload();
                    }, 3000);
                }
                
                const channel = DATA.channels[SYSTEM.currentChannel];
                if (channel) {
                    const now = new Date();
                    channel.mutes.forEach((muteEnd, userId) => {
                        if (now > muteEnd) {
                            channel.mutes.delete(userId);
                            if (userId === SYSTEM.currentUser.id) {
                                addSystemMessage('‚úÖ Susturma s√ºreniz doldu. Artƒ±k mesaj g√∂nderebilirsiniz.');
                            }
                        }
                    });
                }
            }, 10000);
            
            SYSTEM.intervals.push(interval3);
        }

        function stopAutoUpdates() {
            SYSTEM.intervals.forEach(interval => clearInterval(interval));
            SYSTEM.intervals = [];
        }

        // ==================== PANEL Y√ñNETƒ∞Mƒ∞ ====================
        function updatePanelInfo() {
            const channel = DATA.channels[SYSTEM.currentChannel];
            if (!channel) return;
            
            document.getElementById('panelChannelName').textContent = channel.name;
            document.getElementById('panelChannelTopic').textContent = channel.topic;
            document.getElementById('panelChannelVideo').textContent = channel.video.title;
        }

        function switchPanel(panelName) {
            document.getElementById('onlinePanel').classList.add('hidden');
            document.getElementById('pmPanel').classList.add('hidden');
            
            document.querySelectorAll('.panel-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(`${panelName}Panel`).classList.remove('hidden');
            document.querySelector(`.panel-tab[data-panel="${panelName}"]`).classList.add('active');
            
            if (panelName === 'pm') {
                updatePMConversationList();
            }
        }

        // ==================== MODAL Y√ñNETƒ∞Mƒ∞ ====================
        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'flex';
            }
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'none';
                
                if (modalId === 'cameraModal') {
                    stopCamera();
                }
                
                SYSTEM.uploadType = null;
            }
        }

        function closeAllModals() {
            const modals = document.querySelectorAll('.modal-overlay');
            modals.forEach(modal => {
                modal.style.display = 'none';
            });
            
            stopCamera();
            SYSTEM.uploadType = null;
        }

        // ==================== TEMA Sƒ∞STEMƒ∞ ====================
        function toggleTheme() {
            if (SYSTEM.theme === 'night') {
                document.body.classList.add('day-mode');
                document.body.classList.remove('night-mode');
                SYSTEM.theme = 'day';
            } else {
                document.body.classList.add('night-mode');
                document.body.classList.remove('day-mode');
                SYSTEM.theme = 'night';
            }
        }

        // ==================== AYARLAR Sƒ∞STEMƒ∞ ====================
        function openSettings() {
            const settings = SYSTEM.currentUser;
            if (!settings) return;
            
            document.getElementById('settingsNick').value = settings.name;
            document.getElementById('settingsAvatar').textContent = settings.avatar;
            document.getElementById('settingsBio').value = settings.bio || '';
            document.getElementById('settingsInvisible').checked = settings.invisible;
            
            openModal('settingsModal');
        }

        function saveSettings() {
            const nickInput = document.getElementById('settingsNick');
            const bioInput = document.getElementById('settingsBio');
            const invisibleInput = document.getElementById('settingsInvisible');
            
            const newNick = nickInput.value.trim();
            const bio = bioInput.value.trim();
            const invisible = invisibleInput.checked;
            
            if (newNick && newNick !== SYSTEM.currentUser.name) {
                changeNick(newNick);
            }
            
            SYSTEM.currentUser.bio = bio;
            SYSTEM.currentUser.invisible = invisible;
            
            closeModal('settingsModal');
            updateOnlineList();
            addSystemMessage('‚úÖ Ayarlarƒ±nƒ±z g√ºncellendi.');
        }

        function changeAvatar() {
            const newAvatar = prompt('Yeni avatar karakteri (1 karakter):', SYSTEM.currentUser.avatar);
            if (newAvatar && newAvatar.length === 1) {
                SYSTEM.currentUser.avatar = newAvatar;
                document.getElementById('settingsAvatar').textContent = newAvatar;
                updateOnlineList();
            }
        }

        // ==================== EVENT LISTENERS ====================
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('loginButton').addEventListener('click', handleLogin);
            
            document.getElementById('nickInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') handleLogin();
            });
            document.getElementById('passInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') handleLogin();
            });
            
            document.getElementById('sendBtn').addEventListener('click', sendMessage);
            document.getElementById('messageInput').addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
            
            document.querySelectorAll('.panel-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    switchPanel(tab.dataset.panel);
                });
            });
            
            document.getElementById('captureImageBtn')?.addEventListener('click', captureImage);
            document.getElementById('recordVideoBtn')?.addEventListener('click', startRecording);
            document.getElementById('stopRecordingBtn')?.addEventListener('click', stopRecording);
            document.getElementById('switchCameraBtn')?.addEventListener('click', switchCamera);
            document.getElementById('sendCameraMedia')?.addEventListener('click', sendCameraMedia);
            
            document.getElementById('closeCameraModal')?.addEventListener('click', () => closeModal('cameraModal'));
            document.getElementById('cancelCamera')?.addEventListener('click', () => closeModal('cameraModal'));
            
            const buttonEvents = {
                'createChannelBtn': () => openModal('channelModal'),
                'settingsBtn': openSettings,
                'themeBtn': toggleTheme,
                'videoManagerBtn': changeChannelVideo,
                'changeVideoBtn': changeChannelVideo,
                'fullscreenBtn': () => {
                    const player = document.getElementById('youtubePlayer');
                    if (player.requestFullscreen) {
                        player.requestFullscreen();
                    }
                },
                'channelInfoBtn': () => {
                    const channel = DATA.channels[SYSTEM.currentChannel];
                    if (!channel) return;
                    
                    document.getElementById('infoChannelName').textContent = channel.name;
                    document.getElementById('infoChannelTopic').textContent = channel.topic;
                    document.getElementById('infoChannelOwner').textContent = 
                        DATA.users[channel.owner]?.name || channel.owner;
                    document.getElementById('infoChannelType').textContent = 
                        channel.type === 'public' ? 'Public' : 
                        channel.type === 'private' ? 'Private' : 'Secret';
                    document.getElementById('infoChannelVideo').textContent = channel.video.title;
                    document.getElementById('infoChannelUsers').textContent = channel.users.size;
                    
                    openModal('channelInfoModal');
                },
                'newPmBtn': () => openModal('newPmModal'),
                
                'closeVideoModal': () => closeModal('videoModal'),
                'cancelVideo': () => closeModal('videoModal'),
                'saveVideo': saveChannelVideo,
                'closeChannelModal': () => closeModal('channelModal'),
                'cancelChannel': () => closeModal('channelModal'),
                'createChannel': createNewChannel,
                'closeChannelInfo': () => closeModal('channelInfoModal'),
                'closeSettings': () => closeModal('settingsModal'),
                'cancelSettings': () => closeModal('settingsModal'),
                'saveSettings': saveSettings,
                'changeAvatarBtn': changeAvatar,
                'closeNewPmModal': () => closeModal('newPmModal'),
                'cancelNewPm': () => closeModal('newPmModal'),
                'startNewPm': () => {
                    const userInput = document.getElementById('pmUserInput');
                    const messageInput = document.getElementById('pmFirstMessage');
                    
                    const targetUser = userInput.value.trim().toLowerCase();
                    const message = messageInput.value.trim();
                    
                    if (!targetUser) {
                        alert('Kullanƒ±cƒ± adƒ± gerekli!');
                        return;
                    }
                    
                    if (!DATA.users[targetUser]) {
                        alert('Kullanƒ±cƒ± bulunamadƒ±!');
                        return;
                    }
                    
                    if (targetUser === SYSTEM.currentUser.id) {
                        alert('Kendinize mesaj g√∂nderemezsiniz!');
                        return;
                    }
                    
                    closeModal('newPmModal');
                    openPrivateChat(targetUser);
                    
                    if (message) {
                        sendPrivateMessage(targetUser, message);
                    }
                    
                    userInput.value = '';
                    messageInput.value = '';
                },
                
                'closeUploadModal': () => closeModal('uploadModal'),
                'cancelUpload': () => closeModal('uploadModal'),
                'sendUpload': uploadFile
            };
            
            Object.keys(buttonEvents).forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('click', buttonEvents[id]);
                }
            });
            
            const pmUserInput = document.getElementById('pmUserInput');
            if (pmUserInput) {
                pmUserInput.addEventListener('input', function() {
                    const query = this.value.trim().toLowerCase();
                    const suggestions = document.getElementById('pmUserSuggestions');
                    
                    if (!query) {
                        suggestions.innerHTML = '';
                        return;
                    }
                    
                    const matches = Object.values(DATA.users)
                        .filter(user => 
                            user.id !== SYSTEM.currentUser.id && 
                            user.id.includes(query) &&
                            user.id !== 'mate')
                        .slice(0, 5);
                    
                    suggestions.innerHTML = '';
                    
                    if (matches.length === 0) {
                        suggestions.innerHTML = '<div style="padding: 10px; text-align: center; color: var(--text-secondary); font-size: 13px;">Kullanƒ±cƒ± bulunamadƒ±</div>';
                        return;
                    }
                    
                    matches.forEach(user => {
                        const div = document.createElement('div');
                        div.style.padding = '8px';
                        div.style.cursor = 'pointer';
                        div.style.borderBottom = '1px solid var(--border-light)';
                        div.style.display = 'flex';
                        div.style.alignItems = 'center';
                        div.style.gap = '10px';
                        
                        div.innerHTML = `
                            <div style="width: 30px; height: 30px; border-radius: 50%; background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple)); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">${escapeHtml(user.avatar)}</div>
                            <div>
                                <div style="font-weight: 500;">${escapeHtml(user.name)}</div>
                                <div style="font-size: 11px; color: var(--text-secondary);">
                                    ${user.online ? 'üü¢ √áevrimi√ßi' : '‚ö´ √áevrimdƒ±≈üƒ±'}
                                </div>
                            </div>
                        `;
                        
                        div.addEventListener('click', () => {
                            pmUserInput.value = user.name;
                            suggestions.innerHTML = '';
                        });
                        
                        suggestions.appendChild(div);
                    });
                });
            }
            
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    closeAllModals();
                }
            });
            
            document.querySelectorAll('.modal-overlay').forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.style.display = 'none';
                        SYSTEM.uploadType = null;
                        stopCamera();
                    }
                });
            });
            
            window.addEventListener('beforeunload', () => {
                stopAutoUpdates();
                stopCamera();
            });
            
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission();
            }
            
            setTimeout(() => {
                if (SYSTEM.currentUser) {
                    addSystemMessage('ü§ñ EliteChat sistemine ho≈ü geldiniz! Mate g√ºvenlik botu aktif.');
                }
            }, 1000);
        });
        // ==================== GER√áEK ZAMANLI SUNUCU Sƒ∞STEMƒ∞ ====================
class EliteChatServer {
    constructor() {
        this.connections = new Map(); // userId -> WebSocket
        this.users = new Map(); // userId -> userData
        this.channels = new Map(); // channelId -> channelData
        this.initializeChannels();
    }
    
    initializeChannels() {
        this.channels.set('general', {
            id: 'general',
            name: '#Genel',
            owner: 'mate',
            type: 'public',
            topic: 'EliteChat Ho≈ü Geldiniz',
            users: new Set(),
            operators: new Set(['mate']),
            voices: new Set(),
            bans: new Map(),
            mutes: new Map(),
            messages: []
        });
    }
    
    // WebSocket sunucusunu ba≈ülat
    startServer(port = 8080) {
        console.log('WebSocket sunucusu ba≈ülatƒ±lƒ±yor...');
        
        // Tarayƒ±cƒ±da WebSocket sunucusu olu≈ütur (Node.js benzeri davranƒ±≈ü)
        this.simulateWebSocketServer();
        
        // Her 5 saniyede bir sunucu durumunu g√∂ster
        setInterval(() => {
            console.log(`üåê Sunucu Durumu: ${this.users.size} kullanƒ±cƒ±, ${this.channels.size} kanal`);
        }, 5000);
    }
    
    simulateWebSocketServer() {
        console.log('‚ö†Ô∏è UYARI: Bu sim√ºle edilmi≈ü bir sunucudur. Ger√ßek sunucu i√ßin Node.js kullanmalƒ±sƒ±nƒ±z.');
        
        // Tarayƒ±cƒ±da sim√ºle edilmi≈ü WebSocket baƒülantƒ±larƒ±
        if (typeof window !== 'undefined') {
            // Tarayƒ±cƒ±da localStorage √ºzerinden ileti≈üim
            this.setupLocalStorageSync();
        }
    }
    
    setupLocalStorageSync() {
        // T√ºm tarayƒ±cƒ±lar/sekme arasƒ±nda senkronizasyon
        setInterval(() => {
            this.syncUsers();
            this.syncMessages();
            this.syncChannels();
        }, 1000);
    }
    
    // Kullanƒ±cƒ± senkronizasyonu
    syncUsers() {
        const serverUsers = localStorage.getItem('elitechat_server_users');
        if (serverUsers) {
            const users = JSON.parse(serverUsers);
            users.forEach(user => {
                if (!this.users.has(user.id)) {
                    this.users.set(user.id, user);
                }
            });
        }
        
        // G√ºncel kullanƒ±cƒ± listesini kaydet
        const userArray = Array.from(this.users.values());
        localStorage.setItem('elitechat_server_users', JSON.stringify(userArray));
    }
    
    // Mesaj senkronizasyonu
    syncMessages() {
        const serverMessages = localStorage.getItem('elitechat_server_messages');
        if (serverMessages) {
            const allMessages = JSON.parse(serverMessages);
            
            // Mesajlarƒ± kanallara daƒüƒ±t
            allMessages.forEach(msg => {
                const channel = this.channels.get(msg.channel);
                if (channel) {
                    // Aynƒ± mesajƒ± ekleme
                    const exists = channel.messages.some(m => m.id === msg.id);
                    if (!exists) {
                        channel.messages.push(msg);
                        // Son 100 mesajƒ± tut
                        if (channel.messages.length > 100) {
                            channel.messages = channel.messages.slice(-100);
                        }
                    }
                }
            });
        }
    }
    
    // Kanal senkronizasyonu
    syncChannels() {
        const serverChannels = localStorage.getItem('elitechat_server_channels');
        if (serverChannels) {
            const channels = JSON.parse(serverChannels);
            channels.forEach(ch => {
                if (!this.channels.has(ch.id)) {
                    this.channels.set(ch.id, {
                        ...ch,
                        users: new Set(ch.users || []),
                        operators: new Set(ch.operators || []),
                        voices: new Set(ch.voices || []),
                        bans: new Map(Object.entries(ch.bans || {})),
                        mutes: new Map(Object.entries(ch.mutes || {}))
                    });
                }
            });
        }
    }
    
    // Yeni kullanƒ±cƒ± kaydet
    registerUser(userData) {
        this.users.set(userData.id, userData);
        
        // Kullanƒ±cƒ±yƒ± genel kanala ekle
        const generalChannel = this.channels.get('general');
        if (generalChannel) {
            generalChannel.users.add(userData.id);
        }
        
        // Diƒüer kullanƒ±cƒ±lara broadcast
        this.broadcastToAll({
            type: 'user_joined',
            user: userData,
            timestamp: new Date().toISOString()
        });
        
        return userData;
    }
    
    // Mesaj g√∂nder
    sendMessage(messageData) {
        const channel = this.channels.get(messageData.channel);
        if (!channel) return null;
        
        const message = {
            id: `msg_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
            type: 'message',
            userId: messageData.userId,
            text: messageData.text,
            time: new Date().toISOString(),
            channel: messageData.channel
        };
        
        channel.messages.push(message);
        
        // Mesajƒ± kaydet
        this.saveMessageToStorage(message);
        
        // T√ºm kullanƒ±cƒ±lara g√∂nder
        this.broadcastToAll({
            type: 'new_message',
            message: message,
            channel: messageData.channel
        });
        
        return message;
    }
    
    // √ñzel mesaj g√∂nder
    sendPrivateMessage(pmData) {
        const message = {
            id: `pm_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
            type: 'pm',
            from: pmData.from,
            to: pmData.to,
            text: pmData.text,
            time: new Date().toISOString(),
            read: false
        };
        
        // √ñzel mesajƒ± kaydet
        this.savePrivateMessageToStorage(message);
        
        // Alƒ±cƒ±ya g√∂nder (eƒüer online ise)
        this.sendToUser(pmData.to, {
            type: 'private_message',
            message: message
        });
        
        return message;
    }
    
    // Kanal olu≈ütur
    createChannel(channelData) {
        const channelId = channelData.name.substring(1).toLowerCase().replace(/[^a-z0-9]/g, '_');
        
        if (this.channels.has(channelId)) {
            return null;
        }
        
        const newChannel = {
            id: channelId,
            name: channelData.name,
            owner: channelData.owner,
            type: channelData.type || 'public',
            topic: channelData.topic || 'Yeni sohbet kanalƒ±',
            users: new Set([channelData.owner, 'mate']),
            operators: new Set(),
            voices: new Set(),
            bans: new Map(),
            mutes: new Map(),
            messages: []
        };
        
        this.channels.set(channelId, newChannel);
        
        // T√ºm kullanƒ±cƒ±lara yeni kanalƒ± bildir
        this.broadcastToAll({
            type: 'channel_created',
            channel: newChannel
        });
        
        return newChannel;
    }
    
    // T√ºm kullanƒ±cƒ±lara mesaj g√∂nder
    broadcastToAll(data) {
        const eventData = JSON.stringify(data);
        
        // LocalStorage √ºzerinden broadcast
        const broadcastEvents = JSON.parse(localStorage.getItem('elitechat_broadcast') || '[]');
        broadcastEvents.push({
            ...data,
            _timestamp: Date.now()
        });
        
        // Son 50 event'i tut
        if (broadcastEvents.length > 50) {
            broadcastEvents.splice(0, broadcastEvents.length - 50);
        }
        
        localStorage.setItem('elitechat_broadcast', JSON.stringify(broadcastEvents));
        
        // Event trigger
        window.dispatchEvent(new CustomEvent('elitechat_broadcast', { detail: data }));
    }
    
    // Belirli kullanƒ±cƒ±ya mesaj g√∂nder
    sendToUser(userId, data) {
        const userEvents = JSON.parse(localStorage.getItem(`elitechat_user_${userId}`) || '[]');
        userEvents.push({
            ...data,
            _timestamp: Date.now()
        });
        
        // Son 20 event'i tut
        if (userEvents.length > 20) {
            userEvents.splice(0, userEvents.length - 20);
        }
        
        localStorage.setItem(`elitechat_user_${userId}`, JSON.stringify(userEvents));
        
        // Event trigger
        window.dispatchEvent(new CustomEvent(`elitechat_user_${userId}`, { detail: data }));
    }
    
    // Mesajƒ± depolamaya kaydet
    saveMessageToStorage(message) {
        const allMessages = JSON.parse(localStorage.getItem('elitechat_server_messages') || '[]');
        allMessages.push(message);
        
        // Son 500 mesajƒ± tut
        if (allMessages.length > 500) {
            allMessages.splice(0, allMessages.length - 500);
        }
        
        localStorage.setItem('elitechat_server_messages', JSON.stringify(allMessages));
    }
    
    // √ñzel mesajƒ± depolamaya kaydet
    savePrivateMessageToStorage(message) {
        const pmKey = [message.from, message.to].sort().join('_');
        const allPMs = JSON.parse(localStorage.getItem('elitechat_server_pms') || '{}');
        
        if (!allPMs[pmKey]) {
            allPMs[pmKey] = [];
        }
        
        allPMs[pmKey].push(message);
        
        // Her konu≈üma i√ßin son 200 mesaj
        if (allPMs[pmKey].length > 200) {
            allPMs[pmKey].splice(0, allPMs[pmKey].length - 200);
        }
        
        localStorage.setItem('elitechat_server_pms', JSON.stringify(allPMs));
    }
    
    // Kullanƒ±cƒ± baƒülantƒ±sƒ±nƒ± kapat
    disconnectUser(userId) {
        this.users.delete(userId);
        
        // Kullanƒ±cƒ±yƒ± t√ºm kanallardan √ßƒ±kar
        this.channels.forEach(channel => {
            channel.users.delete(userId);
        });
        
        // Diƒüer kullanƒ±cƒ±lara bildir
        this.broadcastToAll({
            type: 'user_left',
            userId: userId,
            timestamp: new Date().toISOString()
        });
    }
}

// ==================== ƒ∞STEMCƒ∞ (CLIENT) Sƒ∞STEMƒ∞ ====================
class EliteChatClient {
    constructor() {
        this.userId = null;
        this.isConnected = false;
        this.eventListeners = new Map();
        this.server = window.eliteChatServer;
        
        // Sunucu event'lerini dinle
        this.setupEventListeners();
        
        // Periyodik senkronizasyon
        this.startSync();
    }
    
    // Sunucuya baƒülan
    connect(userData) {
        if (!this.server) return false;
        
        this.userId = userData.id;
        this.isConnected = true;
        
        // Kullanƒ±cƒ±yƒ± sunucuya kaydet
        this.server.registerUser(userData);
        
        // Baƒülantƒ± ba≈üarƒ±lƒ±
        console.log(`‚úÖ Baƒülantƒ± kuruldu: ${userData.name}`);
        
        // Event fire
        this.emit('connected', { user: userData });
        
        return true;
    }
    
    // Mesaj g√∂nder
    sendMessage(channelId, text) {
        if (!this.isConnected || !this.userId) return null;
        
        const messageData = {
            userId: this.userId,
            text: text,
            channel: channelId
        };
        
        return this.server.sendMessage(messageData);
    }
    
    // √ñzel mesaj g√∂nder
    sendPrivateMessage(toUserId, text) {
        if (!this.isConnected || !this.userId) return null;
        
        const pmData = {
            from: this.userId,
            to: toUserId,
            text: text
        };
        
        return this.server.sendPrivateMessage(pmData);
    }
    
    // Kanal olu≈ütur
    createChannel(channelData) {
        if (!this.isConnected) return null;
        
        return this.server.createChannel(channelData);
    }
    
    // Event listener ekle
    on(event, callback) {
        if (!this.eventListeners.has(event)) {
            this.eventListeners.set(event, []);
        }
        this.eventListeners.get(event).push(callback);
    }
    
    // Event tetikle
    emit(event, data) {
        const listeners = this.eventListeners.get(event);
        if (listeners) {
            listeners.forEach(callback => {
                try {
                    callback(data);
                } catch (err) {
                    console.error(`Event callback error (${event}):`, err);
                }
            });
        }
    }
    
    // Sunucu event'lerini dinle
    setupEventListeners() {
        // Broadcast event'lerini dinle
        window.addEventListener('elitechat_broadcast', (e) => {
            const data = e.detail;
            this.handleServerEvent(data);
        });
        
        // Kullanƒ±cƒ±ya √∂zel event'leri dinle
        const checkUserEvents = () => {
            if (this.userId) {
                const userEvents = JSON.parse(localStorage.getItem(`elitechat_user_${this.userId}`) || '[]');
                
                // Yeni event'leri i≈üle
                userEvents.forEach(event => {
                    if (event._timestamp > (this.lastEventTime || 0)) {
                        this.handleServerEvent(event);
                        this.lastEventTime = event._timestamp;
                    }
                });
            }
        };
        
        // Her saniye kontrol et
        setInterval(checkUserEvents, 1000);
    }
    
    // Sunucudan gelen event'leri i≈üle
    handleServerEvent(data) {
        switch (data.type) {
            case 'new_message':
                this.emit('new_message', data);
                break;
                
            case 'private_message':
                this.emit('private_message', data);
                break;
                
            case 'user_joined':
                this.emit('user_joined', data);
                break;
                
            case 'user_left':
                this.emit('user_left', data);
                break;
                
            case 'channel_created':
                this.emit('channel_created', data);
                break;
        }
    }
    
    // Periyodik senkronizasyon ba≈ülat
    startSync() {
        setInterval(() => {
            if (this.isConnected) {
                this.syncWithServer();
            }
        }, 2000);
    }
    
    // Sunucu ile senkronize ol
    syncWithServer() {
        // Kullanƒ±cƒ± listesini g√ºncelle
        this.emit('sync_users', {
            users: Array.from(this.server?.users?.values() || [])
        });
        
        // Kanal listesini g√ºncelle
        this.emit('sync_channels', {
            channels: Array.from(this.server?.channels?.values() || [])
        });
    }
    
    // Baƒülantƒ±yƒ± kes
    disconnect() {
        if (this.userId && this.server) {
            this.server.disconnectUser(this.userId);
        }
        
        this.isConnected = false;
        this.userId = null;
        
        this.emit('disconnected', {});
    }
}

// ==================== MEVCUT Sƒ∞STEME ENTEGRASYON ====================

// Sayfa y√ºklendiƒüinde sunucuyu ba≈ülat
document.addEventListener('DOMContentLoaded', function() {
    // Global sunucu instance'ƒ± olu≈ütur
    if (!window.eliteChatServer) {
        window.eliteChatServer = new EliteChatServer();
        window.eliteChatServer.startServer();
    }
    
    // Global client instance'ƒ±
    window.eliteChatClient = new EliteChatClient();
    
    // Mevcut login sistemini g√ºncelle
    const originalHandleLogin = window.handleLogin;
    
    window.handleLogin = function() {
        const nickInput = document.getElementById('nickInput');
        const passInput = document.getElementById('passInput');
        const nick = nickInput.value.trim();
        const pass = passInput.value;
        
        // √ñzel karakterleri temizle
        const cleanNick = nick.replace(/[^a-zA-Z0-9._]/g, '');
        
        if (!cleanNick || cleanNick.length < 2) {
            alert('Kullanƒ±cƒ± adƒ± en az 2 karakter olmalƒ±dƒ±r (sadece harf, rakam, . ve _)');
            nickInput.value = '';
            nickInput.focus();
            return;
        }
        
        const userId = cleanNick.toLowerCase();
        
        if (userId === 'mate') {
            alert('Bu kullanƒ±cƒ± adƒ± sistem tarafƒ±ndan kullanƒ±lƒ±yor!');
            nickInput.value = '';
            nickInput.focus();
            return;
        }
        
        // Kullanƒ±cƒ± verisini olu≈ütur
        const userData = {
            id: userId,
            name: cleanNick,
            role: 'user',
            registered: !!pass,
            online: true,
            invisible: false,
            avatar: cleanNick.charAt(0).toUpperCase(),
            bio: '',
            joinDate: new Date().toISOString(),
            lastSeen: new Date().toISOString()
        };
        
        // Sunucuya baƒülan
        const client = window.eliteChatClient;
        const connected = client.connect(userData);
        
        if (!connected) {
            alert('Sunucuya baƒülanƒ±lamadƒ±!');
            return;
        }
        
        // Mevcut sistemi g√ºncelle
        SYSTEM.currentUser = userData;
        DATA.users[userId] = userData;
        DATA.onlineUsers.add(userId);
        
        // Giri≈ü ekranƒ±nƒ± kapat
        document.getElementById('loginScreen').classList.add('hidden');
        document.getElementById('app').classList.remove('hidden');
        
        // Event listener'larƒ± kur
        setupRealtimeListeners();
        
        // ƒ∞lk mesajƒ± g√∂ster
        addSystemMessage(`üéâ ${SYSTEM.currentUser.name} sohbete katƒ±ldƒ±!`);
        
        // Sunucudan kullanƒ±cƒ± ve kanal verilerini senkronize et
        syncWithServer();
        
        // Otomatik g√ºncellemeleri ba≈ülat
        startAutoUpdates();
    };
    
    // Mevcut mesaj g√∂nderme sistemini g√ºncelle
    const originalSendChannelMessage = window.sendChannelMessage;
    
    window.sendChannelMessage = function(text) {
        const channel = DATA.channels[SYSTEM.currentChannel];
        if (!channel) return;
        
        // Global susturma kontrol√º
        if (DATA.globalMutes.has(SYSTEM.currentUser.id)) {
            addSystemMessage('‚ö†Ô∏è Global susturulmu≈üsunuz! Mesaj g√∂nderemezsiniz.');
            return;
        }
        
        // Kanal susturma kontrol√º
        if (channel.mutes.has(SYSTEM.currentUser.id)) {
            const muteEnd = channel.mutes.get(SYSTEM.currentUser.id);
            if (new Date() < muteEnd) {
                addSystemMessage('‚ö†Ô∏è Bu kanalda susturulmu≈üsunuz! Mesaj g√∂nderemezsiniz.');
                return;
            }
            channel.mutes.delete(SYSTEM.currentUser.id);
        }
        
        // Sunucuya mesaj g√∂nder
        const client = window.eliteChatClient;
        const serverMessage = client.sendMessage(SYSTEM.currentChannel, text);
        
        if (serverMessage) {
            // Mesajƒ± lokal olarak da ekle (anƒ±nda g√∂r√ºns√ºn)
            const localMessage = {
                id: serverMessage.id,
                type: 'message',
                userId: SYSTEM.currentUser.id,
                text: text,
                time: new Date(),
                channel: SYSTEM.currentChannel
            };
            
            channel.messages.push(localMessage);
            addMessageToChat(localMessage, SYSTEM.currentUser);
        }
    };
    
    // Mevcut √∂zel mesaj sistemini g√ºncelle
    const originalSendPrivateMessage = window.sendPrivateMessage;
    
    window.sendPrivateMessage = function(toUserId, text) {
        if (!DATA.users[toUserId]) {
            addSystemMessage('‚ùå Kullanƒ±cƒ± bulunamadƒ±!');
            return;
        }
        
        // Sunucuya √∂zel mesaj g√∂nder
        const client = window.eliteChatClient;
        const serverPM = client.sendPrivateMessage(toUserId, text);
        
        if (serverPM) {
            // Mesajƒ± lokal olarak da ekle
            const pmKey = [SYSTEM.currentUser.id, toUserId].sort().join('_');
            
            if (!DATA.privateMessages.has(pmKey)) {
                DATA.privateMessages.set(pmKey, []);
            }
            
            const messages = DATA.privateMessages.get(pmKey);
            const localMessage = {
                id: serverPM.id,
                type: 'pm',
                from: SYSTEM.currentUser.id,
                to: toUserId,
                text: text,
                time: new Date(),
                read: false
            };
            
            messages.push(localMessage);
            
            if (SYSTEM.pmWindows[toUserId]) {
                addMessageToPMWindow(toUserId, localMessage);
            }
            
            updatePMConversationList();
            
            showNotification(DATA.users[toUserId].name, text, 'pm');
        }
    };
    
    // Ger√ßek zamanlƒ± event listener'larƒ± kur
    function setupRealtimeListeners() {
        const client = window.eliteChatClient;
        
        if (!client) return;
        
        // Yeni mesaj geldiƒüinde
        client.on('new_message', (data) => {
            // Eƒüer mesaj bu kanalsa ve ba≈ükasƒ±ndan geldiyse
            if (data.channel === SYSTEM.currentChannel && 
                data.message.userId !== SYSTEM.currentUser.id) {
                
                const user = DATA.users[data.message.userId];
                if (user) {
                    const localMessage = {
                        id: data.message.id,
                        type: 'message',
                        userId: data.message.userId,
                        text: data.message.text,
                        time: new Date(data.message.time),
                        channel: data.message.channel
                    };
                    
                    // Mesajƒ± lokal kanala ekle (zaten yoksa)
                    const channel = DATA.channels[data.message.channel];
                    if (channel) {
                        const exists = channel.messages.some(m => m.id === data.message.id);
                        if (!exists) {
                            channel.messages.push(localMessage);
                        }
                    }
                    
                    // Mesajƒ± ekranda g√∂ster
                    addMessageToChat(localMessage, user);
                }
            }
        });
        
        // √ñzel mesaj geldiƒüinde
        client.on('private_message', (data) => {
            const message = data.message;
            
            // Eƒüer bu mesaj bana geldiyse
            if (message.to === SYSTEM.currentUser.id) {
                const pmKey = [message.from, message.to].sort().join('_');
                
                if (!DATA.privateMessages.has(pmKey)) {
                    DATA.privateMessages.set(pmKey, []);
                }
                
                const messages = DATA.privateMessages.get(pmKey);
                const localMessage = {
                    id: message.id,
                    type: 'pm',
                    from: message.from,
                    to: message.to,
                    text: message.text,
                    time: new Date(message.time),
                    read: false
                };
                
                messages.push(localMessage);
                
                // PM penceresi a√ßƒ±ksa g√∂ster
                if (SYSTEM.pmWindows[message.from]) {
                    addMessageToPMWindow(message.from, localMessage);
                }
                
                updatePMConversationList();
                
                // Bildirim g√∂ster
                const sender = DATA.users[message.from];
                if (sender) {
                    showNotification(sender.name, message.text, 'pm');
                }
            }
        });
        
        // Yeni kullanƒ±cƒ± katƒ±ldƒ±ƒüƒ±nda
        client.on('user_joined', (data) => {
            const user = data.user;
            
            // Kullanƒ±cƒ±yƒ± lokal veriye ekle
            DATA.users[user.id] = user;
            DATA.onlineUsers.add(user.id);
            
            // Genel kanala ekle
            const generalChannel = DATA.channels.general;
            if (generalChannel) {
                generalChannel.users.add(user.id);
            }
            
            // Eƒüer genel kanaldaysak mesaj g√∂ster
            if (SYSTEM.currentChannel === 'general') {
                addSystemMessage(`üéâ ${user.name} sohbete katƒ±ldƒ±!`);
            }
            
            // Online listeyi g√ºncelle
            updateOnlineList();
        });
        
        // Kullanƒ±cƒ± ayrƒ±ldƒ±ƒüƒ±nda
        client.on('user_left', (data) => {
            const userId = data.userId;
            
            // Kullanƒ±cƒ±yƒ± √ßevrimdƒ±≈üƒ± yap
            if (DATA.users[userId]) {
                DATA.users[userId].online = false;
                DATA.onlineUsers.delete(userId);
            }
            
            // T√ºm kanallardan √ßƒ±kar
            Object.values(DATA.channels).forEach(channel => {
                channel.users.delete(userId);
            });
            
            // Online listeyi g√ºncelle
            updateOnlineList();
        });
        
        // Yeni kanal olu≈üturulduƒüunda
        client.on('channel_created', (data) => {
            const channel = data.channel;
            
            // Kanalƒ± lokal veriye ekle
            DATA.channels[channel.id] = {
                ...channel,
                users: new Set(channel.users),
                operators: new Set(channel.operators),
                voices: new Set(channel.voices),
                bans: new Map(Object.entries(channel.bans || {})),
                mutes: new Map(Object.entries(channel.mutes || {})),
                messages: channel.messages || []
            };
            
            // Eƒüer bu kanalƒ±n sekmesi yoksa ekle
            let tabExists = false;
            document.querySelectorAll('.channel-tab').forEach(tab => {
                if (tab.dataset.channel === channel.id) {
                    tabExists = true;
                }
            });
            
            if (!tabExists) {
                const tabsContainer = document.getElementById('channelTabs');
                const tab = document.createElement('div');
                tab.className = 'channel-tab';
                tab.dataset.channel = channel.id;
                tab.innerHTML = `<i class="fas fa-hashtag"></i> ${channel.name.substring(1)}`;
                tab.addEventListener('click', () => switchChannel(channel.id));
                tabsContainer.appendChild(tab);
            }
            
            // Sistem mesajƒ± g√∂ster
            addSystemMessage(`üì¢ Yeni kanal olu≈üturuldu: ${channel.name}`);
        });
        
        // Kullanƒ±cƒ± senkronizasyonu
        client.on('sync_users', (data) => {
            const serverUsers = data.users;
            
            // Sunucudaki kullanƒ±cƒ±larƒ± lokal veriyle birle≈ütir
            serverUsers.forEach(serverUser => {
                if (!DATA.users[serverUser.id]) {
                    DATA.users[serverUser.id] = serverUser;
                    DATA.onlineUsers.add(serverUser.id);
                }
            });
            
            // Online listeyi g√ºncelle
            updateOnlineList();
        });
        
        // Kanal senkronizasyonu
        client.on('sync_channels', (data) => {
            const serverChannels = data.channels;
            
            serverChannels.forEach(serverChannel => {
                if (!DATA.channels[serverChannel.id]) {
                    DATA.channels[serverChannel.id] = {
                        ...serverChannel,
                        users: new Set(serverChannel.users || []),
                        operators: new Set(serverChannel.operators || []),
                        voices: new Set(serverChannel.voices || []),
                        bans: new Map(Object.entries(serverChannel.bans || {})),
                        mutes: new Map(Object.entries(serverChannel.mutes || {})),
                        messages: serverChannel.messages || []
                    };
                }
            });
        });
    }
    
    // Sunucudan veri senkronizasyonu
    function syncWithServer() {
        // Sunucudaki t√ºm mesajlarƒ± √ßek
        const allMessages = JSON.parse(localStorage.getItem('elitechat_server_messages') || '[]');
        
        // Mesajlarƒ± kanallara daƒüƒ±t
        allMessages.forEach(msg => {
            const channel = DATA.channels[msg.channel];
            if (channel) {
                const exists = channel.messages.some(m => m.id === msg.id);
                if (!exists) {
                    channel.messages.push({
                        ...msg,
                        time: new Date(msg.time)
                    });
                }
            }
        });
        
        // Eƒüer genel kanaldaysak mesajlarƒ± y√ºkle
        if (SYSTEM.currentChannel === 'general') {
            loadChannelMessages('general');
        }
        
        // Sunucudaki kullanƒ±cƒ±larƒ± √ßek
        const serverUsers = JSON.parse(localStorage.getItem('elitechat_server_users') || '[]');
        serverUsers.forEach(user => {
            if (!DATA.users[user.id]) {
                DATA.users[user.id] = user;
                DATA.onlineUsers.add(user.id);
            }
        });
        
        // Online listeyi g√ºncelle
        updateOnlineList();
    }
    
    // Sayfa kapatƒ±lƒ±rken baƒülantƒ±yƒ± kes
    window.addEventListener('beforeunload', function() {
        const client = window.eliteChatClient;
        if (client && client.isConnected) {
            client.disconnect();
        }
        
        stopAutoUpdates();
    });
    
    console.log('‚úÖ Ger√ßek zamanlƒ± sohbet sistemi aktif!');
});
    </script>
</body>
</html>
