<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EliteChat - Profesyonel IRC Platformu</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* === TEMEL STÄ°LLER === */
        :root {
            --bg-primary: #0a0a0a; --bg-secondary: #111111; --bg-tertiary: #1a1a1a;
            --text-primary: #ffffff; --text-secondary: #b0b0b0; --accent-blue: #3b82f6;
            --accent-green: #10b981; --accent-red: #ef4444; --border-light: #222222;
            --accent-purple: #8b5cf6; --accent-yellow: #f59e0b;
        }
        body.day-mode {
            --bg-primary: #f8fafc; --bg-secondary: #ffffff; --bg-tertiary: #f1f5f9;
            --text-primary: #0f172a; --text-secondary: #475569; --border-light: #e2e8f0;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body, html { height: 100%; width: 100%; overflow: hidden; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: var(--bg-primary); color: var(--text-primary);
            display: flex; flex-direction: column;
        }
        body::before {
            content: ''; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-image: 
                radial-gradient(circle at 25px 25px, rgba(255, 255, 255, 0.05) 2%, transparent 2.5%),
                radial-gradient(circle at 75px 75px, rgba(255, 255, 255, 0.05) 2%, transparent 2.5%);
            background-size: 100px 100px; pointer-events: none; z-index: -1;
        }
        body.day-mode::before {
            background-image: 
                radial-gradient(circle at 25px 25px, rgba(0, 0, 0, 0.03) 2%, transparent 2.5%),
                radial-gradient(circle at 75px 75px, rgba(0, 0, 0, 0.03) 2%, transparent 2.5%);
        }
        
        /* === GÄ°RÄ°Åž EKRANI === */
        .login-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.95); display: flex; align-items: center;
            justify-content: center; z-index: 1000;
        }
        .login-container {
            background: var(--bg-secondary); padding: 40px; border-radius: 12px;
            width: 420px; max-width: 90%; border: 1px solid var(--border-light);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }
        .login-input {
            width: 100%; padding: 14px; margin: 12px 0; background: var(--bg-tertiary);
            border: 1px solid var(--border-light); color: var(--text-primary);
            border-radius: 8px; font-size: 15px;
        }
        .login-btn {
            width: 100%; padding: 14px; background: var(--accent-blue); color: white;
            border: none; border-radius: 8px; cursor: pointer; font-size: 15px;
            font-weight: 600; margin-top: 15px; transition: background 0.2s;
        }
        .login-btn:hover { background: #2563eb; }
        
        /* === ANA UYGULAMA === */
        .app-container { display: flex; flex-direction: column; height: 100vh; width: 100vw; overflow: hidden; }
        
        /* ÃœST BAR */
        .top-bar {
            display: flex; height: 70px; min-height: 70px; background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-light); padding: 0 25px;
            align-items: center; justify-content: space-between; flex-shrink: 0;
        }
        .channel-tabs { display: flex; gap: 8px; overflow-x: auto; max-width: 600px; padding: 5px 0; flex: 1; margin: 0 20px; }
        .channel-tab {
            padding: 10px 18px; background: var(--bg-tertiary); border-radius: 8px;
            cursor: pointer; white-space: nowrap; font-size: 14px; transition: all 0.2s;
            border: 1px solid var(--border-light);
        }
        .channel-tab:hover { background: var(--bg-primary); }
        .channel-tab.active { background: var(--accent-blue); color: white; border-color: var(--accent-blue); }
        
        /* ANA Ä°Ã‡ERÄ°K */
        .main-content { display: flex; flex: 1; overflow: hidden; min-height: 0; }
        
        /* SOL PANEL - Online Listesi & Ã–zel Sohbetler */
        .left-panel {
            width: 320px; min-width: 320px; background: var(--bg-secondary);
            border-right: 1px solid var(--border-light); display: flex;
            flex-direction: column; flex-shrink: 0;
        }
        .panel-tabs {
            display: flex; border-bottom: 1px solid var(--border-light);
        }
        .panel-tab {
            flex: 1; padding: 15px; text-align: center; cursor: pointer;
            background: var(--bg-tertiary); border: none; color: var(--text-primary);
            font-weight: 500; transition: all 0.2s;
        }
        .panel-tab.active {
            background: var(--bg-secondary); border-bottom: 2px solid var(--accent-blue);
        }
        .panel-content {
            flex: 1; overflow-y: auto; display: flex; flex-direction: column;
        }
        .panel-section {
            padding: 20px; border-bottom: 1px solid var(--border-light);
        }
        .panel-section h3 {
            font-size: 14px; color: var(--text-secondary); margin-bottom: 15px;
            text-transform: uppercase; letter-spacing: 0.5px;
        }
        
        /* KullanÄ±cÄ± Listesi */
        .user-list { flex: 1; padding: 10px; }
        .user-item {
            padding: 12px; border-radius: 8px; cursor: pointer; display: flex;
            align-items: center; gap: 12px; margin-bottom: 8px; transition: all 0.2s;
            border: 1px solid transparent;
        }
        .user-item:hover {
            background: var(--bg-tertiary); border-color: var(--border-light);
        }
        .user-item.active {
            background: var(--accent-blue); color: white; border-color: var(--accent-blue);
        }
        .user-item.active .user-status { color: rgba(255,255,255,0.8); }
        .user-avatar {
            width: 40px; height: 40px; border-radius: 50%; 
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            display: flex; align-items: center; justify-content: center; color: white;
            font-weight: bold; font-size: 16px; flex-shrink: 0; position: relative;
        }
        .user-avatar.online::after {
            content: ''; position: absolute; bottom: 0; right: 0;
            width: 10px; height: 10px; background: var(--accent-green);
            border-radius: 50%; border: 2px solid var(--bg-secondary);
        }
        .user-info { flex: 1; min-width: 0; }
        .user-name { 
            font-weight: 600; font-size: 14px; margin-bottom: 2px;
            display: flex; align-items: center; gap: 6px;
        }
        .user-status { font-size: 12px; color: var(--text-secondary); }
        
        /* Ã–zel Sohbet Listesi */
        .pm-list { padding: 10px; }
        .pm-item {
            padding: 12px; border-radius: 8px; cursor: pointer; display: flex;
            align-items: center; gap: 12px; margin-bottom: 8px; transition: all 0.2s;
            border: 1px solid var(--border-light); background: var(--bg-tertiary);
        }
        .pm-item:hover { background: var(--bg-primary); }
        .pm-item.unread { border-color: var(--accent-blue); background: rgba(59, 130, 246, 0.1); }
        .pm-avatar {
            width: 36px; height: 36px; border-radius: 50%; 
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-blue));
            display: flex; align-items: center; justify-content: center; color: white;
            font-weight: bold; font-size: 14px; flex-shrink: 0;
        }
        .pm-info { flex: 1; min-width: 0; }
        .pm-name { font-weight: 600; font-size: 13px; margin-bottom: 2px; }
        .pm-preview { 
            font-size: 12px; color: var(--text-secondary);
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }
        .pm-time {
            font-size: 10px; color: var(--text-secondary); margin-left: 8px;
        }
        
        /* ORTA PANEL - Sohbet */
        .chat-panel { flex: 1; display: flex; flex-direction: column; min-width: 0; }
        .chat-header {
            padding: 0 25px; height: 70px; border-bottom: 1px solid var(--border-light);
            display: flex; align-items: center; justify-content: space-between;
            background: var(--bg-secondary); flex-shrink: 0;
        }
        .chat-header-info { flex: 1; }
        .chat-header-actions { display: flex; gap: 10px; }
        .chat-messages { 
            flex: 1; overflow-y: auto; padding: 20px; background: var(--bg-primary);
            display: flex; flex-direction: column;
        }
        .message { 
            margin-bottom: 15px; max-width: 75%; animation: fadeIn 0.3s ease;
            display: flex; flex-direction: column;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .message-outgoing { 
            margin-left: auto; align-items: flex-end;
        }
        .message-incoming { align-items: flex-start; }
        .message-sender { 
            font-size: 12px; color: var(--text-secondary); margin-bottom: 4px;
            display: flex; align-items: center; gap: 8px;
        }
        .message-text {
            background: var(--bg-tertiary); padding: 12px 16px; border-radius: 12px;
            font-size: 14px; line-height: 1.5; word-break: break-word;
            max-width: 100%;
        }
        .message-outgoing .message-text { 
            background: var(--accent-blue); color: white; 
            border-bottom-right-radius: 4px;
        }
        .message-incoming .message-text { border-bottom-left-radius: 4px; }
        .message-time {
            font-size: 10px; color: var(--text-secondary); margin-top: 4px;
            opacity: 0.7;
        }
        .message-media {
            margin-top: 8px; border-radius: 8px; overflow: hidden;
            max-width: 300px; cursor: pointer;
        }
        .message-media img, .message-media video {
            width: 100%; height: auto; display: block;
        }
        .chat-input-area {
            padding: 20px; border-top: 1px solid var(--border-light); 
            background: var(--bg-secondary); flex-shrink: 0;
        }
        .message-input-container {
            display: flex; gap: 10px; align-items: flex-end;
        }
        .message-input {
            flex: 1; padding: 14px; background: var(--bg-tertiary); 
            border: 1px solid var(--border-light); color: var(--text-primary);
            border-radius: 10px; resize: none; font-size: 14px; line-height: 1.5;
            min-height: 60px; max-height: 150px; font-family: inherit;
        }
        .message-input:focus { outline: none; border-color: var(--accent-blue); }
        .input-actions {
            display: flex; justify-content: space-between; margin-top: 12px;
        }
        .media-buttons {
            display: flex; gap: 8px;
        }
        .media-btn {
            padding: 8px 12px; background: var(--bg-tertiary); 
            border: 1px solid var(--border-light); border-radius: 6px;
            color: var(--text-primary); cursor: pointer; font-size: 13px;
            display: flex; align-items: center; gap: 6px; transition: all 0.2s;
        }
        .media-btn:hover {
            background: var(--bg-primary); border-color: var(--accent-blue);
        }
        
        /* SAÄž PANEL - Video */
        .right-panel {
            width: 400px; min-width: 400px; background: #000; 
            display: flex; flex-direction: column; flex-shrink: 0;
            border-left: 1px solid #333;
        }
        .video-header { 
            padding: 15px; background: rgba(0, 0, 0, 0.9); color: white; 
            border-bottom: 1px solid #333; flex-shrink: 0;
            display: flex; justify-content: space-between; align-items: center;
        }
        .video-container { 
            flex: 1; background: #000; position: relative; min-height: 0;
            display: flex; align-items: center; justify-content: center;
        }
        .youtube-video { 
            width: 100%; height: 100%; border: none; display: block;
        }
        .video-controls { 
            padding: 15px; background: rgba(0, 0, 0, 0.9); 
            border-top: 1px solid #333; flex-shrink: 0;
        }
        .video-info {
            display: flex; justify-content: space-between; align-items: center;
            font-size: 13px; color: rgba(255,255,255,0.7);
        }
        
        /* BUTONLAR */
        .btn {
            padding: 8px 16px; border-radius: 6px; border: none; 
            cursor: pointer; font-size: 13px; font-weight: 500; 
            transition: all 0.2s; display: inline-flex; align-items: center; gap: 6px;
        }
        .btn-sm { padding: 6px 12px; font-size: 12px; }
        .btn-primary { background: var(--accent-blue); color: white; }
        .btn-primary:hover { background: #2563eb; }
        .btn-secondary { 
            background: var(--bg-tertiary); color: var(--text-primary); 
            border: 1px solid var(--border-light);
        }
        .btn-secondary:hover { background: var(--bg-primary); }
        .btn-success { background: var(--accent-green); color: white; }
        .btn-success:hover { background: #059669; }
        .btn-danger { background: var(--accent-red); color: white; }
        .btn-danger:hover { background: #dc2626; }
        .btn-warning { background: var(--accent-yellow); color: white; }
        .btn-warning:hover { background: #d97706; }
        
        /* MODALLAR */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.8); display: none; align-items: center;
            justify-content: center; z-index: 2000; backdrop-filter: blur(5px);
        }
        .modal-content {
            background: var(--bg-secondary); padding: 24px; border-radius: 12px;
            max-width: 500px; width: 90%; max-height: 90vh; overflow-y: auto;
            border: 1px solid var(--border-light); box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
        }
        
        /* UTILITIES */
        .hidden { display: none !important; }
        .text-sm { font-size: 13px; }
        .text-muted { color: var(--text-secondary); }
        .flex { display: flex; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .gap-2 { gap: 8px; }
        .gap-3 { gap: 12px; }
        .w-full { width: 100%; }
        
        /* SCROLLBAR */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg-tertiary); border-radius: 3px; }
        ::-webkit-scrollbar-thumb { background: var(--border-light); border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #444; }
        
        /* ROL BADGELERÄ° */
        .role-badge {
            font-size: 10px; padding: 1px 6px; border-radius: 10px; 
            margin-left: 4px; font-weight: 600;
        }
        .role-owner { background: linear-gradient(135deg, var(--accent-purple), #3b82f6); color: white; }
        .role-admin { background: var(--accent-blue); color: white; }
        .role-coadmin { background: var(--accent-yellow); color: white; }
        .role-operator { background: var(--accent-green); color: white; }
        .role-voice { background: var(--accent-purple); color: white; opacity: 0.9; }
        
        /* RESPONSIVE */
        @media (max-width: 1200px) {
            .right-panel { width: 350px; min-width: 350px; }
            .left-panel { width: 280px; min-width: 280px; }
        }
        @media (max-width: 992px) {
            .right-panel { display: none; }
            .left-panel { width: 250px; min-width: 250px; }
        }
        @media (max-width: 768px) {
            .left-panel { display: none; }
            .channel-tabs { max-width: 300px; }
            .top-bar { padding: 0 15px; }
        }
        @media (max-width: 480px) {
            .channel-tabs { max-width: 200px; }
            .chat-header { padding: 0 15px; }
            .chat-messages { padding: 15px; }
            .chat-input-area { padding: 15px; }
        }
        
        /* Ã–ZEL SOHBET PENCERESÄ° */
        .pm-window {
            position: fixed; bottom: 0; right: 400px; width: calc(100% - 400px - 320px);
            height: 80vh; background: var(--bg-secondary); border-radius: 12px 12px 0 0;
            border: 1px solid var(--border-light); border-bottom: none;
            box-shadow: 0 -10px 30px rgba(0,0,0,0.3); display: flex; flex-direction: column;
            z-index: 100; transition: transform 0.3s ease;
        }
        @media (max-width: 992px) {
            .pm-window { right: 0; width: 100%; }
        }
        .pm-window.minimized { transform: translateY(calc(100% - 50px)); }
        .pm-window-header {
            padding: 15px; border-bottom: 1px solid var(--border-light); 
            background: var(--bg-tertiary); display: flex; justify-content: space-between;
            align-items: center; cursor: pointer;
        }
        .pm-window-messages {
            flex: 1; overflow-y: auto; padding: 20px; background: var(--bg-primary);
        }
        .pm-window-input {
            padding: 15px; border-top: 1px solid var(--border-light); 
            background: var(--bg-secondary);
        }
        
        /* LOADING */
        .loading { 
            display: inline-block; width: 20px; height: 20px;
            border: 2px solid var(--border-light); border-top-color: var(--accent-blue);
            border-radius: 50%; animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="night-mode">
    <!-- GÄ°RÄ°Åž EKRANI -->
    <div id="loginScreen" class="login-screen">
        <div class="login-container">
            <div style="text-align: center; margin-bottom: 30px;">
                <div style="width: 80px; height: 80px; background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple)); border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; color: white; font-size: 32px; font-weight: bold; margin-bottom: 15px;">EC</div>
                <h1 style="font-size: 28px; margin-bottom: 8px;">EliteChat</h1>
                <p class="text-muted">Profesyonel IRC Platformu</p>
            </div>
            
            <input type="text" id="nickInput" class="login-input" placeholder="KullanÄ±cÄ± adÄ±" autofocus>
            <input type="password" id="passInput" class="login-input" placeholder="Åžifre (isteÄŸe baÄŸlÄ±)">
            
            <button class="login-btn" id="loginButton">
                <i class="fas fa-sign-in-alt"></i> GiriÅŸ Yap
            </button>
            
            <div style="margin-top: 25px; padding-top: 20px; border-top: 1px solid var(--border-light);">
                <p class="text-sm text-muted" style="text-align: center;">
                    <strong>Ä°lk GiriÅŸ:</strong><br>
                    Nickinizi ve ÅŸifrenizi belirleyin<br>
                    Åžifre opsiyonel - ÅŸifresiz giriÅŸ misafir olur
                </p>
            </div>
        </div>
    </div>

    <!-- ANA UYGULAMA -->
    <div id="app" class="hidden">
        <div class="app-container">
            <!-- ÃœST BAR -->
            <div class="top-bar">
                <div class="flex items-center gap-3">
                    <div style="width: 36px; height: 36px; background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple)); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">EC</div>
                    <span style="font-size: 18px; font-weight: 600;">EliteChat</span>
                </div>

                <!-- KANAL SEKMELERÄ° -->
                <div class="channel-tabs" id="channelTabs">
                    <div class="channel-tab active" data-channel="general">
                        <i class="fas fa-hashtag"></i> Genel
                    </div>
                </div>

                <div class="flex items-center gap-2">
                    <button id="createChannelBtn" class="btn btn-success btn-sm">
                        <i class="fas fa-plus"></i> Kanal AÃ§
                    </button>
                    <button id="settingsBtn" class="btn btn-secondary btn-sm">
                        <i class="fas fa-cog"></i>
                    </button>
                    <button id="themeBtn" class="btn btn-secondary btn-sm">
                        <i class="fas fa-moon"></i>
                    </button>
                </div>
            </div>

            <!-- ANA Ä°Ã‡ERÄ°K -->
            <div class="main-content">
                <!-- SOL PANEL -->
                <div class="left-panel">
                    <div class="panel-tabs">
                        <button class="panel-tab active" data-panel="online">
                            <i class="fas fa-users"></i> Online
                        </button>
                        <button class="panel-tab" data-panel="pm">
                            <i class="fas fa-comments"></i> Ã–zel
                        </button>
                    </div>
                    
                    <!-- ONLINE LÄ°STESÄ° -->
                    <div class="panel-content" id="onlinePanel">
                        <div class="panel-section">
                            <h3>Ã‡evrimiÃ§i KullanÄ±cÄ±lar <span id="onlineCount">(0)</span></h3>
                            <div class="user-list" id="userList">
                                <!-- KullanÄ±cÄ±lar buraya gelecek -->
                            </div>
                        </div>
                        
                        <div class="panel-section">
                            <h3>Kanal Bilgisi</h3>
                            <div style="font-size: 13px;">
                                <div style="margin-bottom: 8px;">
                                    <strong>Kanal:</strong> <span id="panelChannelName">#Genel</span>
                                </div>
                                <div style="margin-bottom: 8px;">
                                    <strong>Konu:</strong> <span id="panelChannelTopic">Popbox IRC Sistemi</span>
                                </div>
                                <div>
                                    <strong>Video:</strong> <span id="panelChannelVideo">Popbox Music</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Ã–ZEL MESAJ LÄ°STESÄ° -->
                    <div class="panel-content hidden" id="pmPanel">
                        <div class="panel-section">
                            <h3>Ã–zel Sohbetler</h3>
                            <div class="pm-list" id="pmConversationList">
                                <!-- Ã–zel sohbetler buraya gelecek -->
                            </div>
                        </div>
                        
                        <div class="panel-section">
                            <button id="newPmBtn" class="btn btn-primary w-full">
                                <i class="fas fa-plus"></i> Yeni Ã–zel Sohbet
                            </button>
                        </div>
                    </div>
                </div>

                <!-- ORTA PANEL - SOHBET -->
                <div class="chat-panel">
                    <div class="chat-header">
                        <div class="chat-header-info">
                            <h2 style="font-size: 18px; margin-bottom: 4px;">
                                <i class="fas fa-hashtag"></i> <span id="currentChannel">Genel</span>
                            </h2>
                            <p class="text-muted" style="font-size: 14px;">
                                <span id="channelUsers">0</span> kullanÄ±cÄ± â€¢ 
                                <span id="channelTopic">Popbox IRC Sistemi</span>
                            </p>
                        </div>
                        <div class="chat-header-actions">
                            <button id="videoManagerBtn" class="btn btn-secondary btn-sm hidden">
                                <i class="fas fa-video"></i> Video
                            </button>
                            <button id="channelInfoBtn" class="btn btn-secondary btn-sm">
                                <i class="fas fa-info-circle"></i>
                            </button>
                        </div>
                    </div>

                    <div class="chat-messages" id="chatMessages">
                        <div style="text-align: center; padding: 40px 20px; color: var(--text-secondary);">
                            <i class="fas fa-comments" style="font-size: 48px; margin-bottom: 15px; opacity: 0.5;"></i>
                            <h3 style="margin-bottom: 10px;">EliteChat'e HoÅŸ Geldiniz</h3>
                            <p>Mesaj yazmaya baÅŸlayÄ±n veya birine Ã¶zel mesaj gÃ¶nderin</p>
                        </div>
                    </div>

                    <div class="chat-input-area">
                        <div class="message-input-container">
                            <textarea class="message-input" id="messageInput" 
                                      placeholder="Mesaj yazÄ±n... (IRC komutlarÄ± iÃ§in / kullanÄ±n)" 
                                      rows="3"></textarea>
                        </div>
                        <div class="input-actions">
                            <div class="media-buttons">
                                <button class="media-btn" id="imageBtn">
                                    <i class="fas fa-image"></i> Resim
                                </button>
                                <button class="media-btn" id="videoBtn">
                                    <i class="fas fa-video"></i> Video
                                </button>
                                <button class="media-btn" id="fileBtn">
                                    <i class="fas fa-paperclip"></i> Dosya
                                </button>
                            </div>
                            <button id="sendBtn" class="btn btn-primary">
                                <i class="fas fa-paper-plane"></i> GÃ¶nder
                            </button>
                        </div>
                    </div>
                </div>

                <!-- SAÄž PANEL - VÄ°DEO -->
                <div class="right-panel">
                    <div class="video-header">
                        <div>
                            <h3 style="font-size: 16px; margin-bottom: 2px;">
                                <i class="fas fa-play-circle"></i> <span id="videoTitle">Popbox Music</span>
                            </h3>
                            <p style="font-size: 12px; color: rgba(255,255,255,0.7);">
                                <i class="fas fa-hashtag"></i> <span id="videoChannel">Genel</span>
                            </p>
                        </div>
                        <div class="flex gap-2">
                            <button id="changeVideoBtn" class="btn btn-sm" style="background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.2);">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button id="fullscreenBtn" class="btn btn-sm" style="background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.2);">
                                <i class="fas fa-expand"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="video-container">
                        <iframe class="youtube-video" id="youtubePlayer" 
                                src="https://www.youtube.com/embed/jfKfPfyJRdk?autoplay=1&mute=1&rel=0&controls=1&modestbranding=1" 
                                frameborder="0" 
                                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                                allowfullscreen>
                        </iframe>
                    </div>
                    
                    <div class="video-controls">
                        <div class="video-info">
                            <div>
                                <i class="fas fa-eye"></i> <span id="viewerCount">1.2M</span> izleyici
                            </div>
                            <div>
                                <i class="fas fa-clock"></i> 24/7
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODALLAR -->
    <!-- Video DeÄŸiÅŸtirme Modal -->
    <div id="videoModal" class="modal-overlay">
        <div class="modal-content">
            <div class="flex items-center justify-between" style="margin-bottom: 20px;">
                <h3 style="font-size: 18px;">Video YÃ¶netimi</h3>
                <button id="closeVideoModal" style="background: none; border: none; color: var(--text-secondary); font-size: 24px; cursor: pointer;">Ã—</button>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px;">
                    YouTube URL veya Video ID
                </label>
                <input type="text" id="videoUrl" class="login-input" 
                       placeholder="Ã–rnek: https://youtube.com/watch?v=VIDEO_ID veya sadece VIDEO_ID">
            </div>
            
            <div style="margin-bottom: 25px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px;">
                    Video BaÅŸlÄ±ÄŸÄ±
                </label>
                <input type="text" id="videoTitleInput" class="login-input" 
                       placeholder="Video baÅŸlÄ±ÄŸÄ± (isteÄŸe baÄŸlÄ±)">
            </div>
            
            <div class="flex gap-2">
                <button id="cancelVideo" class="btn btn-secondary" style="flex: 1;">Ä°ptal</button>
                <button id="saveVideo" class="btn btn-primary" style="flex: 1;">
                    <i class="fas fa-save"></i> Kaydet
                </button>
            </div>
        </div>
    </div>

    <!-- Kanal OluÅŸturma Modal -->
    <div id="channelModal" class="modal-overlay">
        <div class="modal-content">
            <div class="flex items-center justify-between" style="margin-bottom: 20px;">
                <h3 style="font-size: 18px;">Yeni Kanal OluÅŸtur</h3>
                <button id="closeChannelModal" style="background: none; border: none; color: var(--text-secondary); font-size: 24px; cursor: pointer;">Ã—</button>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px;">Kanal AdÄ±</label>
                <input type="text" id="channelName" class="login-input" placeholder="#kanal_adi">
            </div>
            
            <div style="margin-bottom: 25px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px;">Kanal TÃ¼rÃ¼</label>
                <select id="channelType" class="login-input">
                    <option value="public">Public - Herkes katÄ±labilir</option>
                    <option value="private">Private - Sadece davetliler</option>
                    <option value="secret">Secret - Gizli kanal</option>
                </select>
            </div>
            
            <div style="margin-bottom: 25px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px;">Kanal Konusu</label>
                <input type="text" id="channelTopicInput" class="login-input" placeholder="Kanal konusu">
            </div>
            
            <div class="flex gap-2">
                <button id="cancelChannel" class="btn btn-secondary" style="flex: 1;">Ä°ptal</button>
                <button id="createChannel" class="btn btn-success" style="flex: 1;">
                    <i class="fas fa-plus"></i> OluÅŸtur
                </button>
            </div>
        </div>
    </div>

    <!-- Yeni Ã–zel Sohbet Modal -->
    <div id="newPmModal" class="modal-overlay">
        <div class="modal-content">
            <div class="flex items-center justify-between" style="margin-bottom: 20px;">
                <h3 style="font-size: 18px;">Yeni Ã–zel Sohbet</h3>
                <button id="closeNewPmModal" style="background: none; border: none; color: var(--text-secondary); font-size: 24px; cursor: pointer;">Ã—</button>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px;">KullanÄ±cÄ± AdÄ±</label>
                <input type="text" id="pmUserInput" class="login-input" placeholder="KullanÄ±cÄ± adÄ± yazÄ±n">
                <div id="pmUserSuggestions" style="margin-top: 10px; max-height: 200px; overflow-y: auto;"></div>
            </div>
            
            <div style="margin-bottom: 25px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px;">Ä°lk Mesaj</label>
                <textarea id="pmFirstMessage" class="login-input" placeholder="Ä°lk mesajÄ±nÄ±z..." rows="3"></textarea>
            </div>
            
            <div class="flex gap-2">
                <button id="cancelNewPm" class="btn btn-secondary" style="flex: 1;">Ä°ptal</button>
                <button id="startNewPm" class="btn btn-primary" style="flex: 1;">
                    <i class="fas fa-paper-plane"></i> BaÅŸlat
                </button>
            </div>
        </div>
    </div>

    <!-- Kanal Bilgisi Modal -->
    <div id="channelInfoModal" class="modal-overlay">
        <div class="modal-content">
            <div class="flex items-center justify-between" style="margin-bottom: 20px;">
                <h3 style="font-size: 18px;">Kanal Bilgisi</h3>
                <button id="closeChannelInfo" style="background: none; border: none; color: var(--text-secondary); font-size: 24px; cursor: pointer;">Ã—</button>
            </div>
            
            <div style="margin-bottom: 20px;">
                <div style="font-size: 14px; margin-bottom: 10px;">
                    <strong>Kanal:</strong> <span id="infoChannelName">#Genel</span>
                </div>
                <div style="font-size: 14px; margin-bottom: 10px;">
                    <strong>Konu:</strong> <span id="infoChannelTopic">Popbox IRC Sistemi</span>
                </div>
                <div style="font-size: 14px; margin-bottom: 10px;">
                    <strong>Sahibi:</strong> <span id="infoChannelOwner">System</span>
                </div>
                <div style="font-size: 14px; margin-bottom: 10px;">
                    <strong>TÃ¼r:</strong> <span id="infoChannelType">Public</span>
                </div>
                <div style="font-size: 14px; margin-bottom: 10px;">
                    <strong>Video:</strong> <span id="infoChannelVideo">Popbox Music</span>
                </div>
                <div style="font-size: 14px;">
                    <strong>KullanÄ±cÄ±lar:</strong> <span id="infoChannelUsers">0</span>
                </div>
            </div>
            
            <div id="channelInfoActions" class="flex gap-2">
                <!-- Yetkili butonlarÄ± buraya dinamik eklenecek -->
            </div>
        </div>
    </div>

    <!-- Ayarlar Modal -->
    <div id="settingsModal" class="modal-overlay">
        <div class="modal-content">
            <div class="flex items-center justify-between" style="margin-bottom: 20px;">
                <h3 style="font-size: 18px;">Ayarlar</h3>
                <button id="closeSettings" style="background: none; border: none; color: var(--text-secondary); font-size: 24px; cursor: pointer;">Ã—</button>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px;">KullanÄ±cÄ± AdÄ±</label>
                <input type="text" id="settingsNick" class="login-input" value="">
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px;">Avatar</label>
                <div style="display: flex; align-items: center; gap: 15px;">
                    <div id="settingsAvatar" style="width: 60px; height: 60px; border-radius: 50%; background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple)); display: flex; align-items: center; justify-content: center; color: white; font-size: 24px; font-weight: bold; cursor: pointer;"></div>
                    <button id="changeAvatarBtn" class="btn btn-secondary">
                        <i class="fas fa-edit"></i> DeÄŸiÅŸtir
                    </button>
                </div>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px;">Biyografi</label>
                <textarea id="settingsBio" class="login-input" placeholder="Kendinizden bahsedin..." rows="3"></textarea>
            </div>
            
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 25px; padding: 15px; background: var(--bg-tertiary); border-radius: 8px;">
                <div>
                    <div style="font-weight: 500; font-size: 14px;">GÃ¶rÃ¼nmez Mod</div>
                    <div class="text-sm text-muted">Ã‡evrimiÃ§i gÃ¶rÃ¼nmez olun</div>
                </div>
                <label style="position: relative; display: inline-block; width: 50px; height: 26px;">
                    <input type="checkbox" id="settingsInvisible" style="opacity: 0; width: 0; height: 0;">
                    <span style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background: var(--bg-primary); border-radius: 34px; transition: .4s;"></span>
                    <span style="position: absolute; content: ''; height: 18px; width: 18px; left: 4px; bottom: 4px; background: white; border-radius: 50%; transition: .4s;"></span>
                </label>
            </div>
            
            <div class="flex gap-2">
                <button id="cancelSettings" class="btn btn-secondary" style="flex: 1;">Ä°ptal</button>
                <button id="saveSettings" class="btn btn-primary" style="flex: 1;">
                    <i class="fas fa-save"></i> Kaydet
                </button>
            </div>
        </div>
    </div>

    <!-- DOSYA YÃœKLEME MODAL -->
    <div id="uploadModal" class="modal-overlay">
        <div class="modal-content">
            <div class="flex items-center justify-between" style="margin-bottom: 20px;">
                <h3 style="font-size: 18px;" id="uploadTitle">Dosya YÃ¼kle</h3>
                <button id="closeUploadModal" style="background: none; border: none; color: var(--text-secondary); font-size: 24px; cursor: pointer;">Ã—</button>
            </div>
            
            <div style="text-align: center; margin-bottom: 25px;">
                <div id="uploadDropZone" style="border: 2px dashed var(--border-light); border-radius: 12px; padding: 40px 20px; cursor: pointer; transition: all 0.2s;">
                    <i class="fas fa-cloud-upload-alt" style="font-size: 48px; color: var(--text-secondary); margin-bottom: 15px;"></i>
                    <div style="font-size: 16px; margin-bottom: 8px;">DosyayÄ± buraya sÃ¼rÃ¼kleyin</div>
                    <div class="text-sm text-muted">veya tÄ±klayarak seÃ§in</div>
                    <div class="text-sm text-muted" style="margin-top: 10px;">Max: 10MB</div>
                </div>
                <input type="file" id="fileInput" style="display: none;" accept="image/*,video/*,.mp4,.avi,.mov">
            </div>
            
            <div id="uploadPreview" style="display: none; margin-bottom: 20px;">
                <!-- Ã–nizleme buraya gelecek -->
            </div>
            
            <div id="uploadProgress" style="display: none; margin-bottom: 20px;">
                <div style="background: var(--bg-tertiary); height: 6px; border-radius: 3px; overflow: hidden;">
                    <div id="uploadProgressBar" style="background: var(--accent-blue); height: 100%; width: 0%; transition: width 0.3s;"></div>
                </div>
                <div style="text-align: center; margin-top: 8px; font-size: 12px; color: var(--text-secondary);">
                    <span id="uploadProgressText">%0</span>
                </div>
            </div>
            
            <div class="flex gap-2">
                <button id="cancelUpload" class="btn btn-secondary" style="flex: 1;">Ä°ptal</button>
                <button id="sendUpload" class="btn btn-primary" style="flex: 1;" disabled>
                    <i class="fas fa-paper-plane"></i> GÃ¶nder
                </button>
            </div>
        </div>
    </div>

    <!-- Ã–ZEL SOHBET PENCERESÄ° (Dinamik oluÅŸturulacak) -->

    <script>
        // ==================== SÄ°STEM DEÄžÄ°ÅžKENLERÄ° ====================
        const SYSTEM = {
            currentUser: null,
            currentChannel: 'general',
            activePM: null,
            pmWindows: {},
            uploadType: null,
            theme: 'night',
            messageCounter: 1
        };

        const DATA = {
            users: {},
            channels: {
                general: {
                    id: 'general',
                    name: '#Genel',
                    owner: 'system',
                    type: 'public',
                    topic: 'EliteChat HoÅŸ Geldiniz',
                    users: new Set(),
                    operators: new Set(),
                    voices: new Set(),
                    bans: new Map(),
                    mutes: new Map(),
                    slowmode: 0,
                    locked: false,
                    userLimit: 0,
                    messages: [],
                    video: { 
                        id: 'jfKfPfyJRdk', 
                        title: 'Lofi Hip Hop Radio ðŸ“š',
                        channel: 'Genel'
                    }
                }
            },
            privateMessages: new Map(),
            registeredUsers: new Map(),
            onlineUsers: new Set(),
            userChannels: new Map()
        };

        // ==================== UTILITY FONKSÄ°YONLARI ====================
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function generateMessageId() {
            return Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        function formatTime(date = new Date()) {
            return date.toLocaleTimeString('tr-TR', { 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: false
            });
        }

        function getRoleBadge(role) {
            const badges = {
                'owner': '<span class="role-badge role-owner">O</span>',
                'admin': '<span class="role-badge role-admin">A</span>',
                'coadmin': '<span class="role-badge role-coadmin">C</span>',
                'operator': '<span class="role-badge role-operator">OP</span>',
                'voice': '<span class="role-badge role-voice">V</span>'
            };
            return badges[role] || '';
        }

        function showNotification(title, message, type = 'info') {
            // Basit notification sistemi
            console.log(`[${type.toUpperCase()}] ${title}: ${message}`);
            
            // Ses efekti (isteÄŸe baÄŸlÄ±)
            if (type === 'pm') {
                try {
                    const audio = new Audio('data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEAQB8AAEAfAAABAAgAZGF0YQ');
                    audio.play();
                } catch (e) {}
            }
        }

        // ==================== GÄ°RÄ°Åž SÄ°STEMÄ° ====================
        function handleLogin() {
            const nickInput = document.getElementById('nickInput');
            const passInput = document.getElementById('passInput');
            const nick = nickInput.value.trim();
            const pass = passInput.value;
            
            if (!nick || nick.length < 2) {
                alert('GeÃ§erli bir kullanÄ±cÄ± adÄ± girin (min 2 karakter)');
                return;
            }
            
            const userId = nick.toLowerCase();
            
            // KullanÄ±cÄ±yÄ± kaydet/oluÅŸtur
            if (DATA.registeredUsers.has(userId)) {
                const userData = DATA.registeredUsers.get(userId);
                if (pass !== userData.password) {
                    alert('YanlÄ±ÅŸ ÅŸifre!');
                    return;
                }
                // KayÄ±tlÄ± kullanÄ±cÄ± giriÅŸi
                SYSTEM.currentUser = {
                    id: userId,
                    name: nick,
                    role: userData.role || 'user',
                    registered: true,
                    online: true,
                    invisible: false,
                    avatar: nick.charAt(0).toUpperCase(),
                    bio: userData.bio || '',
                    joinDate: userData.joinDate || new Date(),
                    lastSeen: new Date()
                };
            } else {
                // Yeni kullanÄ±cÄ±
                SYSTEM.currentUser = {
                    id: userId,
                    name: nick,
                    role: 'user',
                    registered: !!pass,
                    online: true,
                    invisible: false,
                    avatar: nick.charAt(0).toUpperCase(),
                    bio: '',
                    joinDate: new Date(),
                    lastSeen: new Date()
                };
                
                if (pass) {
                    // Åžifre ile kayÄ±t
                    DATA.registeredUsers.set(userId, {
                        password: pass,
                        role: 'user',
                        bio: '',
                        joinDate: new Date()
                    });
                    
                    // Owner kontrolÃ¼ (sadece mateky)
                    if (userId === 'mateky') {
                        SYSTEM.currentUser.role = 'owner';
                        DATA.registeredUsers.get(userId).role = 'owner';
                    }
                }
            }
            
            // KullanÄ±cÄ±yÄ± data'ya ekle
            DATA.users[userId] = SYSTEM.currentUser;
            DATA.onlineUsers.add(userId);
            
            // Genel kanala ekle
            DATA.channels.general.users.add(userId);
            
            // ArayÃ¼zÃ¼ gÃ¶ster
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('app').classList.remove('hidden');
            
            // Sistem mesajÄ±
            addSystemMessage(`ðŸŽ‰ ${SYSTEM.currentUser.name} sohbete katÄ±ldÄ±!`);
            
            // Ä°lk yÃ¼klemeler
            updateOnlineList();
            updatePanelInfo();
            loadChannelMessages('general');
            
            // Fake kullanÄ±cÄ±lar ekle (test iÃ§in)
            if (Object.keys(DATA.users).length < 3) {
                addFakeUsers();
            }
            
            // Otomatik gÃ¼ncelleme baÅŸlat
            startAutoUpdates();
        }

        function addFakeUsers() {
            const fakeUsers = [
                { name: 'Ahmet', role: 'user' },
                { name: 'Zeynep', role: 'user' },
                { name: 'Can', role: 'user' },
                { name: 'Elif', role: 'operator' }
            ];
            
            fakeUsers.forEach(fake => {
                const userId = fake.name.toLowerCase();
                if (!DATA.users[userId]) {
                    const user = {
                        id: userId,
                        name: fake.name,
                        role: fake.role,
                        registered: true,
                        online: Math.random() > 0.3,
                        invisible: false,
                        avatar: fake.name.charAt(0).toUpperCase(),
                        bio: '',
                        joinDate: new Date(Date.now() - Math.random() * 30 * 24 * 60 * 60 * 1000),
                        lastSeen: new Date()
                    };
                    
                    DATA.users[userId] = user;
                    if (user.online) {
                        DATA.onlineUsers.add(userId);
                    }
                    DATA.channels.general.users.add(userId);
                }
            });
            
            updateOnlineList();
        }

        // ==================== ONLINE LÄ°STE SÄ°STEMÄ° ====================
        function updateOnlineList() {
            const container = document.getElementById('userList');
            const countElement = document.getElementById('onlineCount');
            
            if (!container) return;
            
            container.innerHTML = '';
            
            const channel = DATA.channels[SYSTEM.currentChannel];
            if (!channel) return;
            
            // Kanaldaki kullanÄ±cÄ±larÄ± al
            const channelUsers = Array.from(channel.users)
                .map(userId => DATA.users[userId])
                .filter(user => user && !user.invisible)
                .sort((a, b) => {
                    // Ã–nce roller, sonra isim
                    const roleOrder = { owner: 1, admin: 2, coadmin: 3, operator: 4, voice: 5, user: 6 };
                    const roleDiff = roleOrder[a.role] - roleOrder[b.role];
                    if (roleDiff !== 0) return roleDiff;
                    return a.name.localeCompare(b.name);
                });
            
            // Online sayÄ±sÄ±nÄ± gÃ¼ncelle
            const onlineCount = channelUsers.filter(u => u.online).length;
            if (countElement) {
                countElement.textContent = `(${onlineCount})`;
            }
            
            // KullanÄ±cÄ± sayÄ±sÄ±nÄ± gÃ¼ncelle
            const channelUsersElement = document.getElementById('channelUsers');
            if (channelUsersElement) {
                channelUsersElement.textContent = channelUsers.length;
            }
            
            // KullanÄ±cÄ±larÄ± gÃ¶ster
            channelUsers.forEach(user => {
                const item = document.createElement('div');
                item.className = `user-item ${user.online ? 'online' : ''}`;
                if (SYSTEM.activePM === user.id) {
                    item.classList.add('active');
                }
                
                item.innerHTML = `
                    <div class="user-avatar ${user.online ? 'online' : ''}">
                        ${user.avatar}
                    </div>
                    <div class="user-info">
                        <div class="user-name">
                            ${user.name}
                            ${getRoleBadge(user.role)}
                        </div>
                        <div class="user-status">
                            ${user.online ? 'ðŸŸ¢ Ã‡evrimiÃ§i' : 'âš« Ã‡evrimdÄ±ÅŸÄ±'}
                        </div>
                    </div>
                `;
                
                item.addEventListener('click', () => {
                    if (user.id !== SYSTEM.currentUser.id) {
                        openPrivateChat(user.id);
                    }
                });
                
                container.appendChild(item);
            });
            
            // Ã–zel sohbet listesini gÃ¼ncelle
            updatePMConversationList();
        }

        // ==================== SOHBET SÄ°STEMÄ° ====================
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const text = input.value.trim();
            
            if (!text) return;
            
            // IRC komut kontrolÃ¼
            if (text.startsWith('/')) {
                handleIRCCommand(text);
                input.value = '';
                return;
            }
            
            // Ã–zel sohbet mi kanal sohbeti mi?
            if (SYSTEM.activePM) {
                sendPrivateMessage(SYSTEM.activePM, text);
            } else {
                sendChannelMessage(text);
            }
            
            input.value = '';
            input.focus();
        }

        function sendChannelMessage(text) {
            const channel = DATA.channels[SYSTEM.currentChannel];
            if (!channel) return;
            
            // Mute kontrolÃ¼
            if (channel.mutes.has(SYSTEM.currentUser.id)) {
                const muteEnd = channel.mutes.get(SYSTEM.currentUser.id);
                if (new Date() < muteEnd) {
                    addSystemMessage('âš ï¸ SusturulmuÅŸsunuz! Mesaj gÃ¶nderemezsiniz.');
                    return;
                }
                channel.mutes.delete(SYSTEM.currentUser.id);
            }
            
            // Mesaj oluÅŸtur
            const message = {
                id: generateMessageId(),
                type: 'message',
                userId: SYSTEM.currentUser.id,
                text: text,
                time: new Date(),
                channel: SYSTEM.currentChannel
            };
            
            // Kanal mesajlarÄ±na ekle
            channel.messages.push(message);
            
            // ArayÃ¼zde gÃ¶ster
            addMessageToChat(message, SYSTEM.currentUser);
            
            // Otomatik cevaplar (bot benzeri)
            if (Math.random() > 0.7 && SYSTEM.currentChannel === 'general') {
                setTimeout(() => {
                    const otherUsers = Array.from(channel.users)
                        .map(id => DATA.users[id])
                        .filter(u => u && u.id !== SYSTEM.currentUser.id && u.online);
                    
                    if (otherUsers.length > 0) {
                        const randomUser = otherUsers[Math.floor(Math.random() * otherUsers.length)];
                        const replies = [
                            "GÃ¼zel noktaya deÄŸindin!",
                            "KatÄ±lÄ±yorum ðŸ‘",
                            "Harika bir fikir!",
                            "Bu konuda daha fazla konuÅŸalÄ±m",
                            "TeÅŸekkÃ¼rler paylaÅŸÄ±m iÃ§in"
                        ];
                        const replyText = replies[Math.floor(Math.random() * replies.length)];
                        
                        const replyMessage = {
                            id: generateMessageId(),
                            type: 'message',
                            userId: randomUser.id,
                            text: replyText,
                            time: new Date(),
                            channel: SYSTEM.currentChannel
                        };
                        
                        channel.messages.push(replyMessage);
                        addMessageToChat(replyMessage, randomUser);
                    }
                }, 1000 + Math.random() * 2000);
            }
        }

        function sendPrivateMessage(toUserId, text) {
            if (!DATA.users[toUserId]) {
                addSystemMessage('âŒ KullanÄ±cÄ± bulunamadÄ±!');
                return;
            }
            
            // Ã–zel mesaj anahtarÄ±nÄ± oluÅŸtur
            const pmKey = [SYSTEM.currentUser.id, toUserId].sort().join('_');
            
            // Ã–zel mesaj verisini al veya oluÅŸtur
            if (!DATA.privateMessages.has(pmKey)) {
                DATA.privateMessages.set(pmKey, []);
            }
            
            const messages = DATA.privateMessages.get(pmKey);
            
            // Mesaj oluÅŸtur
            const message = {
                id: generateMessageId(),
                type: 'pm',
                from: SYSTEM.currentUser.id,
                to: toUserId,
                text: text,
                time: new Date(),
                read: false
            };
            
            // MesajÄ± kaydet
            messages.push(message);
            
            // ArayÃ¼zde gÃ¶ster (eÄŸer pencere aÃ§Ä±ksa)
            if (SYSTEM.pmWindows[toUserId]) {
                addMessageToPMWindow(toUserId, message);
            }
            
            // Ã–zel sohbet listesini gÃ¼ncelle
            updatePMConversationList();
            
            // Bildirim gÃ¶ster
            if (toUserId !== SYSTEM.currentUser.id) {
                showNotification(DATA.users[toUserId].name, text, 'pm');
            }
        }

        function addMessageToChat(message, user) {
            const container = document.getElementById('chatMessages');
            if (!container) return;
            
            // Ä°lk mesaj boÅŸsa temizle
            if (container.children.length === 1 && 
                container.children[0].querySelector('.fas.fa-comments')) {
                container.innerHTML = '';
            }
            
            const isOutgoing = user.id === SYSTEM.currentUser.id;
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isOutgoing ? 'message-outgoing' : 'message-incoming'}`;
            messageDiv.dataset.messageId = message.id;
            
            messageDiv.innerHTML = `
                <div class="message-sender">
                    <span style="font-weight: 500;">${user.name}</span>
                    ${getRoleBadge(user.role)}
                    ${user.registered ? '<i class="fas fa-check-circle" style="color: var(--accent-blue); font-size: 10px;"></i>' : ''}
                </div>
                <div class="message-text">${escapeHtml(message.text)}</div>
                <div class="message-time">${formatTime(message.time)}</div>
            `;
            
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }

        function addSystemMessage(text) {
            const container = document.getElementById('chatMessages');
            if (!container) return;
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message';
            messageDiv.style.textAlign = 'center';
            messageDiv.style.maxWidth = '100%';
            
            messageDiv.innerHTML = `
                <div style="display: inline-block; background: var(--bg-tertiary); padding: 8px 16px; border-radius: 16px; color: var(--text-secondary); font-style: italic; font-size: 13px;">
                    ${escapeHtml(text)}
                </div>
            `;
            
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }

        function loadChannelMessages(channelId) {
            const container = document.getElementById('chatMessages');
            if (!container) return;
            
            container.innerHTML = '';
            
            const channel = DATA.channels[channelId];
            if (!channel || !channel.messages || channel.messages.length === 0) {
                // BoÅŸ kanal mesajÄ±
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px; color: var(--text-secondary);">
                        <i class="fas fa-comments" style="font-size: 48px; margin-bottom: 15px; opacity: 0.5;"></i>
                        <h3 style="margin-bottom: 10px;">${channel.name.replace('#', '')} KanalÄ±</h3>
                        <p>Bu kanalda henÃ¼z mesaj yok. Ä°lk mesajÄ± siz gÃ¶nderin!</p>
                    </div>
                `;
                return;
            }
            
            // MesajlarÄ± yÃ¼kle
            channel.messages.forEach(msg => {
                const user = DATA.users[msg.userId];
                if (user) {
                    addMessageToChat(msg, user);
                }
            });
            
            container.scrollTop = container.scrollHeight;
        }

        // ==================== KANAL SÄ°STEMÄ° ====================
        function switchChannel(channelId) {
            if (!DATA.channels[channelId]) return;
            
            SYSTEM.currentChannel = channelId;
            SYSTEM.activePM = null;
            
            // Aktif sekmeyi gÃ¼ncelle
            document.querySelectorAll('.channel-tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.dataset.channel === channelId) {
                    tab.classList.add('active');
                }
            });
            
            // Kanal bilgilerini gÃ¼ncelle
            const channel = DATA.channels[channelId];
            document.getElementById('currentChannel').textContent = channel.name.replace('#', '');
            document.getElementById('channelTopic').textContent = channel.topic;
            document.getElementById('panelChannelName').textContent = channel.name;
            document.getElementById('panelChannelTopic').textContent = channel.topic;
            document.getElementById('panelChannelVideo').textContent = channel.video.title;
            document.getElementById('videoChannel').textContent = channel.name.replace('#', '');
            
            // Video yÃ¶netim butonunu kontrol et
            const videoBtn = document.getElementById('videoManagerBtn');
            if (channelId === 'general') {
                videoBtn.classList.add('hidden');
                document.getElementById('changeVideoBtn').classList.add('hidden');
            } else if (channel.owner === SYSTEM.currentUser.id || 
                      SYSTEM.currentUser.role === 'owner' || 
                      SYSTEM.currentUser.role === 'admin') {
                videoBtn.classList.remove('hidden');
                document.getElementById('changeVideoBtn').classList.remove('hidden');
            } else {
                videoBtn.classList.add('hidden');
                document.getElementById('changeVideoBtn').classList.add('hidden');
            }
            
            // MesajlarÄ± yÃ¼kle
            loadChannelMessages(channelId);
            
            // Online listeyi gÃ¼ncelle
            updateOnlineList();
            
            // Video yÃ¼kle
            loadChannelVideo();
            
            // Ã–zel sohbet pencerelerini kapat
            Object.keys(SYSTEM.pmWindows).forEach(userId => {
                closePMWindow(userId);
            });
        }

        function createNewChannel() {
            const nameInput = document.getElementById('channelName');
            const typeSelect = document.getElementById('channelType');
            const topicInput = document.getElementById('channelTopicInput');
            
            const name = nameInput.value.trim();
            const type = typeSelect.value;
            const topic = topicInput.value.trim() || 'Yeni sohbet kanalÄ±';
            
            if (!name || !name.startsWith('#')) {
                alert('Kanal adÄ± # ile baÅŸlamalÄ±!');
                return;
            }
            
            const channelId = name.substring(1).toLowerCase().replace(/[^a-z0-9]/g, '_');
            
            if (DATA.channels[channelId]) {
                alert('Bu kanal adÄ± zaten kullanÄ±lÄ±yor!');
                return;
            }
            
            // Her kullanÄ±cÄ± sadece 1 kanal aÃ§abilir
            if (DATA.userChannels.has(SYSTEM.currentUser.id)) {
                alert('Zaten bir kanalÄ±nÄ±z var! Her kullanÄ±cÄ± sadece 1 kanal aÃ§abilir.');
                return;
            }
            
            // Yeni kanal oluÅŸtur
            DATA.channels[channelId] = {
                id: channelId,
                name: name,
                owner: SYSTEM.currentUser.id,
                type: type,
                topic: topic,
                users: new Set([SYSTEM.currentUser.id]),
                operators: new Set(),
                voices: new Set(),
                bans: new Map(),
                mutes: new Map(),
                slowmode: 0,
                locked: false,
                userLimit: 0,
                messages: [],
                video: {
                    id: 'jfKfPfyJRdk',
                    title: 'Lofi Hip Hop Radio ðŸ“š',
                    channel: name.replace('#', '')
                }
            };
            
            // KullanÄ±cÄ±nÄ±n kanalÄ±nÄ± kaydet
            DATA.userChannels.set(SYSTEM.currentUser.id, channelId);
            
            // Sekme ekle
            const tabsContainer = document.getElementById('channelTabs');
            const tab = document.createElement('div');
            tab.className = 'channel-tab';
            tab.dataset.channel = channelId;
            tab.innerHTML = `<i class="fas fa-hashtag"></i> ${name.substring(1)}`;
            tab.addEventListener('click', () => switchChannel(channelId));
            tabsContainer.appendChild(tab);
            
            // KanalÄ± seÃ§
            switchChannel(channelId);
            
            // Modal'Ä± kapat
            closeModal('channelModal');
            
            // Temizle
            nameInput.value = '';
            topicInput.value = '';
            
            // Sistem mesajÄ±
            addSystemMessage(`ðŸŽŠ ${SYSTEM.currentUser.name} yeni kanal oluÅŸturdu: ${name}`);
        }

        // ==================== VIDEO SÄ°STEMÄ° ====================
        function loadChannelVideo() {
            const channel = DATA.channels[SYSTEM.currentChannel];
            if (!channel || !channel.video) return;
            
            const player = document.getElementById('youtubePlayer');
            const titleElement = document.getElementById('videoTitle');
            
            if (player && titleElement) {
                player.src = `https://www.youtube.com/embed/${channel.video.id}?autoplay=1&mute=1&rel=0&controls=1&modestbranding=1`;
                titleElement.textContent = channel.video.title;
                document.getElementById('panelChannelVideo').textContent = channel.video.title;
            }
        }

        function changeChannelVideo() {
            const channel = DATA.channels[SYSTEM.currentChannel];
            if (!channel) return;
            
            // Yetki kontrolÃ¼
            if (channel.id === 'general') {
                alert('Genel kanalÄ±n videosu deÄŸiÅŸtirilemez!');
                return;
            }
            
            if (channel.owner !== SYSTEM.currentUser.id && 
                SYSTEM.currentUser.role !== 'owner' && 
                SYSTEM.currentUser.role !== 'admin') {
                alert('Sadece kanal sahibi veya yetkililer video deÄŸiÅŸtirebilir!');
                return;
            }
            
            // Modal'Ä± hazÄ±rla ve aÃ§
            document.getElementById('videoUrl').value = '';
            document.getElementById('videoTitleInput').value = channel.video.title || '';
            openModal('videoModal');
        }

        function saveChannelVideo() {
            const urlInput = document.getElementById('videoUrl');
            const titleInput = document.getElementById('videoTitleInput');
            
            const url = urlInput.value.trim();
            const title = titleInput.value.trim() || 'YouTube Video';
            
            if (!url) {
                alert('YouTube URL veya Video ID gerekli!');
                return;
            }
            
            let videoId = url;
            
            // URL'den video ID Ã§Ä±kar
            if (url.includes('youtube.com') || url.includes('youtu.be')) {
                const match = url.match(/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/);
                if (match) {
                    videoId = match[1];
                }
            } else if (url.length === 11) {
                // Direkt video ID
                videoId = url;
            } else {
                alert('GeÃ§erli bir YouTube URL veya Video ID girin!');
                return;
            }
            
            // Kanal videosunu gÃ¼ncelle
            const channel = DATA.channels[SYSTEM.currentChannel];
            if (channel) {
                channel.video = {
                    id: videoId,
                    title: title,
                    channel: channel.name.replace('#', '')
                };
                
                // Video yÃ¼kle
                loadChannelVideo();
                
                // Sistem mesajÄ±
                addSystemMessage(`ðŸŽ¥ ${SYSTEM.currentUser.name} kanal videosunu deÄŸiÅŸtirdi: ${title}`);
                
                // Modal'Ä± kapat
                closeModal('videoModal');
            }
        }

        // ==================== Ã–ZEL SOHBET SÄ°STEMÄ° ====================
        function openPrivateChat(userId) {
            if (!DATA.users[userId] || userId === SYSTEM.currentUser.id) return;
            
            SYSTEM.activePM = userId;
            
            // EÄŸer pencere zaten aÃ§Ä±ksa odakla
            if (SYSTEM.pmWindows[userId]) {
                SYSTEM.pmWindows[userId].classList.remove('minimized');
                return;
            }
            
            // Yeni pencere oluÅŸtur
            createPMWindow(userId);
            
            // Online listesinde aktif gÃ¶ster
            updateOnlineList();
            
            // Ã–zel sohbet listesini gÃ¼ncelle
            updatePMConversationList();
        }

        function createPMWindow(userId) {
            const user = DATA.users[userId];
            if (!user) return;
            
            // Pencereyi oluÅŸtur
            const pmWindow = document.createElement('div');
            pmWindow.className = 'pm-window';
            pmWindow.id = `pm-window-${userId}`;
            
            pmWindow.innerHTML = `
                <div class="pm-window-header" data-user-id="${userId}">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div class="user-avatar ${user.online ? 'online' : ''}" style="width: 30px; height: 30px; font-size: 14px;">
                            ${user.avatar}
                        </div>
                        <div>
                            <div style="font-weight: 600; font-size: 14px;">
                                ${user.name}
                                ${getRoleBadge(user.role)}
                            </div>
                            <div style="font-size: 11px; color: var(--text-secondary);">
                                ${user.online ? 'ðŸŸ¢ Ã‡evrimiÃ§i' : 'âš« Ã‡evrimdÄ±ÅŸÄ±'}
                            </div>
                        </div>
                    </div>
                    <div style="display: flex; gap: 5px;">
                        <button class="btn btn-sm" style="background: none; border: none; color: var(--text-secondary); padding: 4px 8px;">
                            <i class="fas fa-minus"></i>
                        </button>
                        <button class="btn btn-sm btn-close-pm" style="background: none; border: none; color: var(--text-secondary); padding: 4px 8px;">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
                <div class="pm-window-messages" id="pm-messages-${userId}">
                    <!-- Mesajlar buraya gelecek -->
                </div>
                <div class="pm-window-input">
                    <div class="message-input-container">
                        <textarea class="message-input" id="pm-input-${userId}" 
                                  placeholder="${user.name} ile mesajlaÅŸÄ±n..." 
                                  rows="2"></textarea>
                    </div>
                    <div class="input-actions" style="margin-top: 10px;">
                        <div class="media-buttons">
                            <button class="media-btn btn-pm-image" data-user-id="${userId}">
                                <i class="fas fa-image"></i>
                            </button>
                            <button class="media-btn btn-pm-video" data-user-id="${userId}">
                                <i class="fas fa-video"></i>
                            </button>
                        </div>
                        <button class="btn btn-primary btn-send-pm" data-user-id="${userId}">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(pmWindow);
            SYSTEM.pmWindows[userId] = pmWindow;
            
            // Event listener'larÄ± ekle
            const header = pmWindow.querySelector('.pm-window-header');
            const minimizeBtn = header.querySelector('.fa-minus').closest('button');
            const closeBtn = pmWindow.querySelector('.btn-close-pm');
            const sendBtn = pmWindow.querySelector('.btn-send-pm');
            const input = pmWindow.querySelector(`#pm-input-${userId}`);
            
            header.addEventListener('click', (e) => {
                if (e.target === header || e.target.closest('.pm-window-header') === header) {
                    pmWindow.classList.toggle('minimized');
                }
            });
            
            minimizeBtn?.addEventListener('click', (e) => {
                e.stopPropagation();
                pmWindow.classList.toggle('minimized');
            });
            
            closeBtn?.addEventListener('click', () => {
                closePMWindow(userId);
            });
            
            sendBtn?.addEventListener('click', () => {
                const text = input.value.trim();
                if (text) {
                    sendPrivateMessage(userId, text);
                    input.value = '';
                    input.focus();
                }
            });
            
            input?.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    const text = input.value.trim();
                    if (text) {
                        sendPrivateMessage(userId, text);
                        input.value = '';
                    }
                }
            });
            
            // Medya butonlarÄ±
            pmWindow.querySelector('.btn-pm-image')?.addEventListener('click', () => {
                SYSTEM.uploadType = { type: 'image', target: userId, isPM: true };
                openUploadModal('Resim GÃ¶nder');
            });
            
            pmWindow.querySelector('.btn-pm-video')?.addEventListener('click', () => {
                SYSTEM.uploadType = { type: 'video', target: userId, isPM: true };
                openUploadModal('Video GÃ¶nder');
            });
            
            // MesajlarÄ± yÃ¼kle
            loadPMMessages(userId);
        }

        function closePMWindow(userId) {
            const pmWindow = document.getElementById(`pm-window-${userId}`);
            if (pmWindow) {
                pmWindow.remove();
                delete SYSTEM.pmWindows[userId];
                
                if (SYSTEM.activePM === userId) {
                    SYSTEM.activePM = null;
                    updateOnlineList();
                }
            }
        }

        function loadPMMessages(userId) {
            const container = document.getElementById(`pm-messages-${userId}`);
            if (!container) return;
            
            container.innerHTML = '';
            
            const pmKey = [SYSTEM.currentUser.id, userId].sort().join('_');
            const messages = DATA.privateMessages.get(pmKey) || [];
            
            if (messages.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px; color: var(--text-secondary);">
                        <i class="fas fa-comment" style="font-size: 48px; margin-bottom: 15px; opacity: 0.5;"></i>
                        <h3 style="margin-bottom: 10px;">${DATA.users[userId]?.name} ile Sohbet</h3>
                        <p>HenÃ¼z mesaj yok. Ä°lk mesajÄ± siz gÃ¶nderin!</p>
                    </div>
                `;
                return;
            }
            
            messages.forEach(msg => {
                const isOutgoing = msg.from === SYSTEM.currentUser.id;
                const sender = DATA.users[msg.from];
                if (!sender) return;
                
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${isOutgoing ? 'message-outgoing' : 'message-incoming'}`;
                messageDiv.dataset.messageId = msg.id;
                
                messageDiv.innerHTML = `
                    <div class="message-sender">
                        <span style="font-weight: 500;">${sender.name}</span>
                        ${getRoleBadge(sender.role)}
                    </div>
                    <div class="message-text">${escapeHtml(msg.text)}</div>
                    <div class="message-time">${formatTime(msg.time)}</div>
                `;
                
                container.appendChild(messageDiv);
            });
            
            container.scrollTop = container.scrollHeight;
        }

        function addMessageToPMWindow(userId, message) {
            const container = document.getElementById(`pm-messages-${userId}`);
            if (!container) return;
            
            // Ä°lk mesaj boÅŸsa temizle
            if (container.children.length === 1 && 
                container.children[0].querySelector('.fas.fa-comment')) {
                container.innerHTML = '';
            }
            
            const isOutgoing = message.from === SYSTEM.currentUser.id;
            const sender = DATA.users[message.from];
            if (!sender) return;
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isOutgoing ? 'message-outgoing' : 'message-incoming'}`;
            messageDiv.dataset.messageId = message.id;
            
            messageDiv.innerHTML = `
                <div class="message-sender">
                    <span style="font-weight: 500;">${sender.name}</span>
                    ${getRoleBadge(sender.role)}
                </div>
                <div class="message-text">${escapeHtml(message.text)}</div>
                <div class="message-time">${formatTime(message.time)}</div>
            `;
            
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }

        function updatePMConversationList() {
            const container = document.getElementById('pmConversationList');
            if (!container) return;
            
            container.innerHTML = '';
            
            // TÃ¼m Ã¶zel sohbetleri topla
            const conversations = new Map();
            
            DATA.privateMessages.forEach((messages, pmKey) => {
                const [user1, user2] = pmKey.split('_');
                const otherUserId = user1 === SYSTEM.currentUser.id ? user2 : 
                                  user2 === SYSTEM.currentUser.id ? user1 : null;
                
                if (otherUserId && DATA.users[otherUserId]) {
                    const lastMessage = messages[messages.length - 1];
                    const unreadCount = messages.filter(m => 
                        m.from !== SYSTEM.currentUser.id && !m.read
                    ).length;
                    
                    conversations.set(otherUserId, {
                        user: DATA.users[otherUserId],
                        lastMessage: lastMessage,
                        unreadCount: unreadCount,
                        messageCount: messages.length
                    });
                }
            });
            
            // SÄ±rala (son mesaja gÃ¶re)
            const sortedConversations = Array.from(conversations.values())
                .sort((a, b) => {
                    if (!a.lastMessage) return 1;
                    if (!b.lastMessage) return -1;
                    return new Date(b.lastMessage.time) - new Date(a.lastMessage.time);
                });
            
            // GÃ¶ster
            sortedConversations.forEach(conv => {
                const item = document.createElement('div');
                item.className = `pm-item ${conv.unreadCount > 0 ? 'unread' : ''}`;
                
                const lastMessageText = conv.lastMessage ? 
                    (conv.lastMessage.text.length > 30 ? 
                     conv.lastMessage.text.substring(0, 30) + '...' : 
                     conv.lastMessage.text) : 
                    'Mesaj yok';
                
                const lastMessageTime = conv.lastMessage ? 
                    formatTime(conv.lastMessage.time) : '';
                
                item.innerHTML = `
                    <div class="pm-avatar">
                        ${conv.user.avatar}
                    </div>
                    <div class="pm-info">
                        <div class="pm-name">
                            ${conv.user.name}
                            ${conv.unreadCount > 0 ? 
                              `<span style="background: var(--accent-blue); color: white; font-size: 10px; padding: 1px 5px; border-radius: 10px; margin-left: 5px;">${conv.unreadCount}</span>` : 
                              ''}
                        </div>
                        <div class="pm-preview">${escapeHtml(lastMessageText)}</div>
                    </div>
                    <div class="pm-time">${lastMessageTime}</div>
                `;
                
                item.addEventListener('click', () => {
                    openPrivateChat(conv.user.id);
                });
                
                container.appendChild(item);
            });
            
            // EÄŸer Ã¶zel sohbet yoksa
            if (sortedConversations.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 30px 20px; color: var(--text-secondary);">
                        <i class="fas fa-comments" style="font-size: 32px; margin-bottom: 10px; opacity: 0.5;"></i>
                        <div style="font-size: 13px;">HenÃ¼z Ã¶zel sohbetiniz yok</div>
                    </div>
                `;
            }
        }

        // ==================== PANEL YÃ–NETÄ°MÄ° ====================
        function updatePanelInfo() {
            const channel = DATA.channels[SYSTEM.currentChannel];
            if (!channel) return;
            
            document.getElementById('panelChannelName').textContent = channel.name;
            document.getElementById('panelChannelTopic').textContent = channel.topic;
            document.getElementById('panelChannelVideo').textContent = channel.video.title;
        }

        function switchPanel(panelName) {
            // Panelleri gizle
            document.getElementById('onlinePanel').classList.add('hidden');
            document.getElementById('pmPanel').classList.add('hidden');
            
            // Tab'larÄ± gÃ¼ncelle
            document.querySelectorAll('.panel-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Hedef paneli gÃ¶ster
            document.getElementById(`${panelName}Panel`).classList.remove('hidden');
            
            // Aktif tab'Ä± iÅŸaretle
            document.querySelector(`.panel-tab[data-panel="${panelName}"]`).classList.add('active');
            
            // PM panelindeyse listeyi gÃ¼ncelle
            if (panelName === 'pm') {
                updatePMConversationList();
            }
        }

        // ==================== DOSYA YÃœKLEME SÄ°STEMÄ° ====================
        function openUploadModal(title) {
            const modal = document.getElementById('uploadModal');
            const titleElement = document.getElementById('uploadTitle');
            const dropZone = document.getElementById('uploadDropZone');
            const fileInput = document.getElementById('fileInput');
            const preview = document.getElementById('uploadPreview');
            const progress = document.getElementById('uploadProgress');
            const sendBtn = document.getElementById('sendUpload');
            
            if (!modal || !titleElement) return;
            
            // BaÅŸlÄ±ÄŸÄ± gÃ¼ncelle
            titleElement.textContent = title;
            
            // Ã–nceki durumu sÄ±fÄ±rla
            preview.style.display = 'none';
            preview.innerHTML = '';
            progress.style.display = 'none';
            sendBtn.disabled = true;
            fileInput.value = '';
            
            // Drop zone event'leri
            dropZone.onclick = () => fileInput.click();
            
            dropZone.ondragover = (e) => {
                e.preventDefault();
                dropZone.style.borderColor = 'var(--accent-blue)';
                dropZone.style.background = 'var(--bg-tertiary)';
            };
            
            dropZone.ondragleave = () => {
                dropZone.style.borderColor = 'var(--border-light)';
                dropZone.style.background = 'transparent';
            };
            
            dropZone.ondrop = (e) => {
                e.preventDefault();
                dropZone.style.borderColor = 'var(--border-light)';
                dropZone.style.background = 'transparent';
                
                if (e.dataTransfer.files.length > 0) {
                    handleFileSelect(e.dataTransfer.files[0]);
                }
            };
            
            // File input event'i
            fileInput.onchange = () => {
                if (fileInput.files.length > 0) {
                    handleFileSelect(fileInput.files[0]);
                }
            };
            
            // Modal'Ä± aÃ§
            modal.style.display = 'flex';
        }

        function handleFileSelect(file) {
            if (!file) return;
            
            // Dosya boyutu kontrolÃ¼ (10MB)
            if (file.size > 10 * 1024 * 1024) {
                alert('Dosya Ã§ok bÃ¼yÃ¼k! Maksimum 10MB.');
                return;
            }
            
            const preview = document.getElementById('uploadPreview');
            const sendBtn = document.getElementById('sendUpload');
            
            // Ã–nizleme oluÅŸtur
            preview.style.display = 'block';
            
            if (file.type.startsWith('image/')) {
                // Resim Ã¶nizleme
                const reader = new FileReader();
                reader.onload = (e) => {
                    preview.innerHTML = `
                        <div style="text-align: center;">
                            <img src="${e.target.result}" style="max-width: 100%; max-height: 200px; border-radius: 8px;">
                            <div style="margin-top: 10px; font-size: 13px;">
                                ${file.name} (${(file.size / 1024).toFixed(1)} KB)
                            </div>
                        </div>
                    `;
                    sendBtn.disabled = false;
                };
                reader.readAsDataURL(file);
            } else if (file.type.startsWith('video/')) {
                // Video Ã¶nizleme
                preview.innerHTML = `
                    <div style="text-align: center;">
                        <div style="background: var(--bg-tertiary); padding: 20px; border-radius: 8px; margin-bottom: 10px;">
                            <i class="fas fa-video" style="font-size: 48px; color: var(--text-secondary);"></i>
                        </div>
                        <div style="font-size: 13px;">
                            ${file.name} (${(file.size / 1024).toFixed(1)} KB)
                        </div>
                        <div style="font-size: 12px; color: var(--text-secondary); margin-top: 5px;">
                            ${file.type}
                        </div>
                    </div>
                `;
                sendBtn.disabled = false;
            } else {
                // DiÄŸer dosyalar
                preview.innerHTML = `
                    <div style="text-align: center;">
                        <div style="background: var(--bg-tertiary); padding: 20px; border-radius: 8px; margin-bottom: 10px;">
                            <i class="fas fa-file" style="font-size: 48px; color: var(--text-secondary);"></i>
                        </div>
                        <div style="font-size: 13px;">
                            ${file.name} (${(file.size / 1024).toFixed(1)} KB)
                        </div>
                        <div style="font-size: 12px; color: var(--text-secondary); margin-top: 5px;">
                            ${file.type || 'Bilinmeyen dosya tÃ¼rÃ¼'}
                        </div>
                    </div>
                `;
                sendBtn.disabled = false;
            }
        }

        function uploadFile() {
            const fileInput = document.getElementById('fileInput');
            const progress = document.getElementById('uploadProgress');
            const progressBar = document.getElementById('uploadProgressBar');
            const progressText = document.getElementById('uploadProgressText');
            const sendBtn = document.getElementById('sendUpload');
            
            if (!fileInput.files.length) return;
            
            const file = fileInput.files[0];
            const uploadType = SYSTEM.uploadType;
            
            if (!uploadType) return;
            
            // Progress bar'Ä± gÃ¶ster
            progress.style.display = 'block';
            sendBtn.disabled = true;
            
            // Fake upload simÃ¼lasyonu (gerÃ§ekte burada sunucuya gÃ¶nderilir)
            let progressValue = 0;
            const interval = setInterval(() => {
                progressValue += 5 + Math.random() * 10;
                if (progressValue > 100) progressValue = 100;
                
                progressBar.style.width = `${progressValue}%`;
                progressText.textContent = `%${Math.round(progressValue)}`;
                
                if (progressValue >= 100) {
                    clearInterval(interval);
                    
                    // Upload tamamlandÄ±
                    setTimeout(() => {
                        // DosyayÄ± mesaj olarak gÃ¶nder
                        if (uploadType.isPM) {
                            // Ã–zel sohbete dosya gÃ¶nder
                            sendPrivateMessage(uploadType.target, 
                                `[${uploadType.type.toUpperCase()}] ${file.name} (${(file.size / 1024).toFixed(1)} KB)`);
                        } else {
                            // Kanal sohbetine dosya gÃ¶nder
                            sendChannelMessage(
                                `[${uploadType.type.toUpperCase()}] ${file.name} (${(file.size / 1024).toFixed(1)} KB)`);
                        }
                        
                        // Modal'Ä± kapat
                        closeModal('uploadModal');
                        
                        // BaÅŸarÄ± mesajÄ±
                        showNotification('Dosya GÃ¶nderildi', `${file.name} baÅŸarÄ±yla gÃ¶nderildi.`);
                    }, 500);
                }
            }, 100);
        }

        // ==================== IRC KOMUT SÄ°STEMÄ° ====================
        function handleIRCCommand(fullCommand) {
            const parts = fullCommand.split(' ');
            const cmd = parts[0].toLowerCase();
            const args = parts.slice(1);
            
            switch(cmd) {
                case '/nick':
                    if (args.length >= 1) changeNick(args[0]);
                    break;
                    
                case '/join':
                    if (args.length >= 1) {
                        let channelName = args[0];
                        if (!channelName.startsWith('#')) channelName = '#' + channelName;
                        joinChannel(channelName);
                    }
                    break;
                    
                case '/leave':
                    leaveChannel();
                    break;
                    
                case '/msg':
                    if (args.length >= 2) {
                        const target = args[0];
                        const message = args.slice(1).join(' ');
                        sendPrivateMessage(target.toLowerCase(), message);
                    }
                    break;
                    
                case '/me':
                    if (args.length >= 1) {
                        const action = args.join(' ');
                        sendChannelMessage(`* ${SYSTEM.currentUser.name} ${action}`);
                    }
                    break;
                    
                case '/who':
                    listChannelUsers();
                    break;
                    
                case '/whois':
                    if (args.length >= 1) showUserInfo(args[0]);
                    break;
                    
                case '/clear':
                    clearChat();
                    break;
                    
                case '/topic':
                    if (args.length >= 1) changeTopic(args.join(' '));
                    break;
                    
                case '/help':
                    showIRCHelp();
                    break;
                    
                default:
                    addSystemMessage(`âŒ Bilinmeyen komut: ${cmd}. /help yazarak yardÄ±m alÄ±n.`);
            }
        }

        function changeNick(newNick) {
            if (!newNick || newNick.length < 2) {
                addSystemMessage('âŒ GeÃ§ersiz nick! (min 2 karakter)');
                return;
            }
            
            const oldNick = SYSTEM.currentUser.name;
            const userId = newNick.toLowerCase();
            
            // Nick deÄŸiÅŸtirme iÅŸlemi
            SYSTEM.currentUser.name = newNick;
            SYSTEM.currentUser.avatar = newNick.charAt(0).toUpperCase();
            
            // KullanÄ±cÄ± verisini gÃ¼ncelle
            DATA.users[SYSTEM.currentUser.id] = SYSTEM.currentUser;
            
            addSystemMessage(`âœ… Nick deÄŸiÅŸtirildi: ${oldNick} â†’ ${newNick}`);
            updateOnlineList();
        }

        function joinChannel(channelName) {
            const channelId = channelName.substring(1).toLowerCase().replace(/[^a-z0-9]/g, '_');
            
            if (!DATA.channels[channelId]) {
                addSystemMessage(`âŒ Kanal bulunamadÄ±: ${channelName}`);
                return;
            }
            
            const channel = DATA.channels[channelId];
            
            // Kilit kontrolÃ¼
            if (channel.locked && !channel.users.has(SYSTEM.currentUser.id)) {
                addSystemMessage('âŒ Kanal kilitli!');
                return;
            }
            
            // Limit kontrolÃ¼
            if (channel.userLimit > 0 && channel.users.size >= channel.userLimit) {
                addSystemMessage('âŒ Kanal doldu!');
                return;
            }
            
            // KullanÄ±cÄ±yÄ± ekle
            channel.users.add(SYSTEM.currentUser.id);
            
            // Sekme kontrolÃ¼
            let tabExists = false;
            document.querySelectorAll('.channel-tab').forEach(tab => {
                if (tab.dataset.channel === channelId) {
                    tabExists = true;
                }
            });
            
            if (!tabExists) {
                // Yeni sekme ekle
                const tabsContainer = document.getElementById('channelTabs');
                const tab = document.createElement('div');
                tab.className = 'channel-tab';
                tab.dataset.channel = channelId;
                tab.innerHTML = `<i class="fas fa-hashtag"></i> ${channel.name.substring(1)}`;
                tab.addEventListener('click', () => switchChannel(channelId));
                tabsContainer.appendChild(tab);
            }
            
            // Kanala geÃ§
            switchChannel(channelId);
            addSystemMessage(`âœ… ${channelName} kanalÄ±na katÄ±ldÄ±nÄ±z`);
        }

        function leaveChannel() {
            if (SYSTEM.currentChannel === 'general') {
                addSystemMessage('âŒ Genel kanaldan ayrÄ±lamazsÄ±nÄ±z!');
                return;
            }
            
            const channel = DATA.channels[SYSTEM.currentChannel];
            const channelName = channel.name;
            
            // KullanÄ±cÄ±yÄ± kanaldan Ã§Ä±kar
            channel.users.delete(SYSTEM.currentUser.id);
            
            // Sekmeyi kaldÄ±r
            const tab = document.querySelector(`.channel-tab[data-channel="${SYSTEM.currentChannel}"]`);
            if (tab) tab.remove();
            
            // Genel kanala geÃ§
            switchChannel('general');
            addSystemMessage(`âœ… ${channelName} kanalÄ±ndan ayrÄ±ldÄ±nÄ±z`);
        }

        function listChannelUsers() {
            const channel = DATA.channels[SYSTEM.currentChannel];
            if (!channel) return;
            
            const users = Array.from(channel.users)
                .map(id => DATA.users[id])
                .filter(u => u)
                .sort((a, b) => a.name.localeCompare(b.name));
            
            let message = `ðŸ‘¥ ${channel.name} KullanÄ±cÄ±larÄ± (${users.length}):\n`;
            users.forEach(user => {
                message += `â€¢ ${user.name} ${getRoleBadge(user.role)}\n`;
            });
            
            addSystemMessage(message);
        }

        function showUserInfo(nick) {
            const userId = nick.toLowerCase();
            const user = DATA.users[userId];
            
            if (!user) {
                addSystemMessage(`âŒ KullanÄ±cÄ± bulunamadÄ±: ${nick}`);
                return;
            }
            
            let info = `ðŸ‘¤ ${user.name} Bilgisi:\n`;
            info += `Rol: ${user.role}\n`;
            info += `Durum: ${user.online ? 'ðŸŸ¢ Ã‡evrimiÃ§i' : 'âš« Ã‡evrimdÄ±ÅŸÄ±'}\n`;
            info += `KayÄ±tlÄ±: ${user.registered ? 'Evet âœ“' : 'HayÄ±r âœ—'}\n`;
            info += `GÃ¶rÃ¼nmez: ${user.invisible ? 'Evet' : 'HayÄ±r'}\n`;
            info += `KatÄ±lma: ${user.joinDate.toLocaleDateString('tr-TR')}\n`;
            info += `Son GÃ¶rÃ¼lme: ${user.lastSeen.toLocaleTimeString('tr-TR')}`;
            
            addSystemMessage(info);
        }

        function changeTopic(newTopic) {
            const channel = DATA.channels[SYSTEM.currentChannel];
            if (!channel) return;
            
            // Yetki kontrolÃ¼ (sadece owner, admin veya kanal sahibi)
            if (channel.id !== 'general' && 
                channel.owner !== SYSTEM.currentUser.id && 
                SYSTEM.currentUser.role !== 'owner' && 
                SYSTEM.currentUser.role !== 'admin') {
                addSystemMessage('âŒ Kanal konusunu deÄŸiÅŸtirme yetkiniz yok!');
                return;
            }
            
            const oldTopic = channel.topic;
            channel.topic = newTopic;
            
            // ArayÃ¼zÃ¼ gÃ¼ncelle
            document.getElementById('channelTopic').textContent = newTopic;
            document.getElementById('panelChannelTopic').textContent = newTopic;
            
            addSystemMessage(`ðŸ“ Kanal konusu deÄŸiÅŸtirildi: "${oldTopic}" â†’ "${newTopic}"`);
        }

        function clearChat() {
            const container = document.getElementById('chatMessages');
            if (container) {
                container.innerHTML = '';
                addSystemMessage('âœ… Sohbet temizlendi');
            }
        }

        function showIRCHelp() {
            const helpText = `
ðŸ“‹ IRC KOMUTLARI:

ðŸ‘¤ GENEL KOMUTLAR:
/nick yeniNick - KullanÄ±cÄ± adÄ±nÄ± deÄŸiÅŸtir
/join #kanal - Kanala katÄ±l
/leave - Kanaldan ayrÄ±l
/msg nick mesaj - Ã–zel mesaj gÃ¶nder
/me eylem - Eylem mesajÄ± gÃ¶nder
/who - Kanal kullanÄ±cÄ±larÄ±nÄ± listele
/whois nick - KullanÄ±cÄ± bilgisi gÃ¶ster
/clear - Sohbeti temizle
/topic yeniKonu - Kanal konusunu deÄŸiÅŸtir
/help - Bu yardÄ±mÄ± gÃ¶ster

ðŸ›¡ï¸ YETKÄ°LÄ° KOMUTLARI (Kanal Sahibi/Admin):
/kick nick - KullanÄ±cÄ±yÄ± at
/ban nick - KullanÄ±cÄ±yÄ± banla
/mute nick sÃ¼re - KullanÄ±cÄ±yÄ± sustur
/op nick - OP yetkisi ver
/voice nick - Voice yetkisi ver
/lock - KanalÄ± kilitle
/unlock - KanalÄ± aÃ§
/limit sayÄ± - KullanÄ±cÄ± limiti koy
/slowmode saniye - YavaÅŸ mod aÃ§

ðŸ‘‘ SÄ°STEM KOMUTLARI (Owner/Admin):
/gban nick - Global ban
/gmute nick - Global sustur
/duyuru mesaj - Sistem duyurusu
/yetki ver nick rol - Yetki ver
/yetki al nick - Yetki al
            `;
            
            // YardÄ±mÄ± mesaj olarak gÃ¶ster
            helpText.trim().split('\n').forEach(line => {
                if (line.trim()) {
                    addSystemMessage(line);
                }
            });
        }

        // ==================== OTOMATÄ°K GÃœNCELLEMELER ====================
        function startAutoUpdates() {
            // Online durum simÃ¼lasyonu
            setInterval(() => {
                // Rastgele kullanÄ±cÄ±larÄ±n online durumunu deÄŸiÅŸtir
                Object.keys(DATA.users).forEach(userId => {
                    if (userId !== SYSTEM.currentUser.id && Math.random() > 0.95) {
                        const user = DATA.users[userId];
                        user.online = !user.online;
                        user.lastSeen = new Date();
                        
                        if (user.online) {
                            DATA.onlineUsers.add(userId);
                        } else {
                            DATA.onlineUsers.delete(userId);
                        }
                    }
                });
                
                // Online listeyi gÃ¼ncelle
                updateOnlineList();
                
                // Viewer count gÃ¼ncelle (fake)
                const viewerCount = document.getElementById('viewerCount');
                if (viewerCount) {
                    const current = parseInt(viewerCount.textContent.replace(/[^\d]/g, '')) || 1200000;
                    const change = Math.floor(Math.random() * 1000) - 500;
                    const newCount = Math.max(1000, current + change);
                    viewerCount.textContent = (newCount / 1000).toFixed(1) + 'K';
                }
            }, 10000); // 10 saniyede bir
            
            // Ã–zel mesaj kontrolÃ¼
            setInterval(() => {
                updatePMConversationList();
            }, 5000); // 5 saniyede bir
        }

        // ==================== MODAL YÃ–NETÄ°MÄ° ====================
        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'flex';
            }
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'none';
                SYSTEM.uploadType = null;
            }
        }

        function closeAllModals() {
            const modals = document.querySelectorAll('.modal-overlay');
            modals.forEach(modal => {
                modal.style.display = 'none';
            });
            SYSTEM.uploadType = null;
        }

        // ==================== TEMA SÄ°STEMÄ° ====================
        function toggleTheme() {
            if (SYSTEM.theme === 'night') {
                document.body.classList.add('day-mode');
                document.body.classList.remove('night-mode');
                SYSTEM.theme = 'day';
            } else {
                document.body.classList.add('night-mode');
                document.body.classList.remove('day-mode');
                SYSTEM.theme = 'night';
            }
        }

        // ==================== AYARLAR SÄ°STEMÄ° ====================
        function openSettings() {
            const settings = SYSTEM.currentUser;
            if (!settings) return;
            
            document.getElementById('settingsNick').value = settings.name;
            document.getElementById('settingsAvatar').textContent = settings.avatar;
            document.getElementById('settingsBio').value = settings.bio || '';
            document.getElementById('settingsInvisible').checked = settings.invisible;
            
            openModal('settingsModal');
        }

        function saveSettings() {
            const nickInput = document.getElementById('settingsNick');
            const bioInput = document.getElementById('settingsBio');
            const invisibleInput = document.getElementById('settingsInvisible');
            
            const newNick = nickInput.value.trim();
            const bio = bioInput.value.trim();
            const invisible = invisibleInput.checked;
            
            if (newNick && newNick !== SYSTEM.currentUser.name) {
                // Nick deÄŸiÅŸtirme
                const oldNick = SYSTEM.currentUser.name;
                SYSTEM.currentUser.name = newNick;
                SYSTEM.currentUser.avatar = newNick.charAt(0).toUpperCase();
                
                addSystemMessage(`âœ… Nick deÄŸiÅŸtirildi: ${oldNick} â†’ ${newNick}`);
            }
            
            SYSTEM.currentUser.bio = bio;
            SYSTEM.currentUser.invisible = invisible;
            
            closeModal('settingsModal');
            updateOnlineList();
            addSystemMessage('âœ… AyarlarÄ±nÄ±z gÃ¼ncellendi.');
        }

        function changeAvatar() {
            const newAvatar = prompt('Yeni avatar karakteri (1 karakter):', SYSTEM.currentUser.avatar);
            if (newAvatar && newAvatar.length === 1) {
                SYSTEM.currentUser.avatar = newAvatar;
                document.getElementById('settingsAvatar').textContent = newAvatar;
                updateOnlineList();
            }
        }

        // ==================== EVENT LISTENERS ====================
        document.addEventListener('DOMContentLoaded', function() {
            // GiriÅŸ butonu
            document.getElementById('loginButton').addEventListener('click', handleLogin);
            
            // Enter ile giriÅŸ
            document.getElementById('nickInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') handleLogin();
            });
            document.getElementById('passInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') handleLogin();
            });
            
            // Mesaj gÃ¶nderme
            document.getElementById('sendBtn').addEventListener('click', sendMessage);
            document.getElementById('messageInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
            
            // Panel tab'larÄ±
            document.querySelectorAll('.panel-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    switchPanel(tab.dataset.panel);
                });
            });
            
            // Buton event'leri
            const buttonEvents = {
                'createChannelBtn': () => openModal('channelModal'),
                'settingsBtn': openSettings,
                'themeBtn': toggleTheme,
                'videoManagerBtn': changeChannelVideo,
                'changeVideoBtn': changeChannelVideo,
                'fullscreenBtn': () => {
                    const player = document.getElementById('youtubePlayer');
                    if (player.requestFullscreen) {
                        player.requestFullscreen();
                    }
                },
                'channelInfoBtn': () => {
                    const channel = DATA.channels[SYSTEM.currentChannel];
                    if (!channel) return;
                    
                    document.getElementById('infoChannelName').textContent = channel.name;
                    document.getElementById('infoChannelTopic').textContent = channel.topic;
                    document.getElementById('infoChannelOwner').textContent = 
                        DATA.users[channel.owner]?.name || channel.owner;
                    document.getElementById('infoChannelType').textContent = 
                        channel.type === 'public' ? 'Public' : 
                        channel.type === 'private' ? 'Private' : 'Secret';
                    document.getElementById('infoChannelVideo').textContent = channel.video.title;
                    document.getElementById('infoChannelUsers').textContent = channel.users.size;
                    
                    openModal('channelInfoModal');
                },
                'newPmBtn': () => openModal('newPmModal'),
                
                // Modal kapatma butonlarÄ±
                'closeVideoModal': () => closeModal('videoModal'),
                'cancelVideo': () => closeModal('videoModal'),
                'saveVideo': saveChannelVideo,
                'closeChannelModal': () => closeModal('channelModal'),
                'cancelChannel': () => closeModal('channelModal'),
                'createChannel': createNewChannel,
                'closeChannelInfo': () => closeModal('channelInfoModal'),
                'closeSettings': () => closeModal('settingsModal'),
                'cancelSettings': () => closeModal('settingsModal'),
                'saveSettings': saveSettings,
                'changeAvatarBtn': changeAvatar,
                'closeNewPmModal': () => closeModal('newPmModal'),
                'cancelNewPm': () => closeModal('newPmModal'),
                'startNewPm': () => {
                    const userInput = document.getElementById('pmUserInput');
                    const messageInput = document.getElementById('pmFirstMessage');
                    
                    const targetUser = userInput.value.trim().toLowerCase();
                    const message = messageInput.value.trim();
                    
                    if (!targetUser) {
                        alert('KullanÄ±cÄ± adÄ± gerekli!');
                        return;
                    }
                    
                    if (!DATA.users[targetUser]) {
                        alert('KullanÄ±cÄ± bulunamadÄ±!');
                        return;
                    }
                    
                    if (targetUser === SYSTEM.currentUser.id) {
                        alert('Kendinize mesaj gÃ¶nderemezsiniz!');
                        return;
                    }
                    
                    closeModal('newPmModal');
                    openPrivateChat(targetUser);
                    
                    if (message) {
                        sendPrivateMessage(targetUser, message);
                    }
                    
                    userInput.value = '';
                    messageInput.value = '';
                },
                
                // Dosya yÃ¼kleme
                'closeUploadModal': () => closeModal('uploadModal'),
                'cancelUpload': () => closeModal('uploadModal'),
                'sendUpload': uploadFile,
                
                // Medya butonlarÄ±
                'imageBtn': () => {
                    SYSTEM.uploadType = { type: 'image', target: SYSTEM.currentChannel, isPM: false };
                    openUploadModal('Resim GÃ¶nder');
                },
                'videoBtn': () => {
                    SYSTEM.uploadType = { type: 'video', target: SYSTEM.currentChannel, isPM: false };
                    openUploadModal('Video GÃ¶nder');
                },
                'fileBtn': () => {
                    SYSTEM.uploadType = { type: 'file', target: SYSTEM.currentChannel, isPM: false };
                    openUploadModal('Dosya GÃ¶nder');
                }
            };
            
            // Buton event'lerini ata
            Object.keys(buttonEvents).forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('click', buttonEvents[id]);
                }
            });
            
            // KullanÄ±cÄ± arama Ã¶nerileri
            const pmUserInput = document.getElementById('pmUserInput');
            if (pmUserInput) {
                pmUserInput.addEventListener('input', function() {
                    const query = this.value.trim().toLowerCase();
                    const suggestions = document.getElementById('pmUserSuggestions');
                    
                    if (!query) {
                        suggestions.innerHTML = '';
                        return;
                    }
                    
                    const matches = Object.values(DATA.users)
                        .filter(user => 
                            user.id !== SYSTEM.currentUser.id && 
                            user.id.includes(query))
                        .slice(0, 5);
                    
                    suggestions.innerHTML = '';
                    
                    matches.forEach(user => {
                        const div = document.createElement('div');
                        div.style.padding = '8px';
                        div.style.cursor = 'pointer';
                        div.style.borderBottom = '1px solid var(--border-light)';
                        div.style.display = 'flex';
                        div.style.alignItems = 'center';
                        div.style.gap = '10px';
                        
                        div.innerHTML = `
                            <div style="width: 30px; height: 30px; border-radius: 50%; background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple)); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">${user.avatar}</div>
                            <div>
                                <div style="font-weight: 500;">${user.name}</div>
                                <div style="font-size: 11px; color: var(--text-secondary);">
                                    ${user.online ? 'ðŸŸ¢ Ã‡evrimiÃ§i' : 'âš« Ã‡evrimdÄ±ÅŸÄ±'}
                                </div>
                            </div>
                        `;
                        
                        div.addEventListener('click', () => {
                            pmUserInput.value = user.name;
                            suggestions.innerHTML = '';
                        });
                        
                        suggestions.appendChild(div);
                    });
                });
            }
            
            // ESC ile modal kapatma
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    closeAllModals();
                }
            });
            
            // Modal overlay tÄ±klama ile kapatma
            document.querySelectorAll('.modal-overlay').forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.style.display = 'none';
                        SYSTEM.uploadType = null;
                    }
                });
            });
            
            // Ä°lk yÃ¼kleme
            setTimeout(() => {
                if (SYSTEM.currentUser) {
                    addSystemMessage('ðŸ¤– EliteChat sistemine hoÅŸ geldiniz!');
                }
            }, 1000);
        });
    </script>
</body>
</html>
