<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Popbox Elite IRC</title>
    <style>
        /* === TEMEL STÄ°LLER === */
        :root {
            --bg-primary: #0a0a0a; --bg-secondary: #111111; --bg-tertiary: #1a1a1a;
            --text-primary: #ffffff; --text-secondary: #b0b0b0; --accent-blue: #3b82f6;
            --accent-green: #10b981; --accent-red: #ef4444; --border-light: #222222;
        }
        body.day-mode {
            --bg-primary: #f8fafc; --bg-secondary: #ffffff; --bg-tertiary: #f1f5f9;
            --text-primary: #0f172a; --text-secondary: #475569; --border-light: #e2e8f0;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body, html { height: 100%; width: 100%; overflow: hidden; }
        body {
            font-family: 'Inter', sans-serif; background: var(--bg-primary); color: var(--text-primary);
            display: flex; flex-direction: column;
        }
        body::before {
            content: ''; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-image: 
                radial-gradient(circle at 25px 25px, rgba(255, 255, 255, 0.05) 2%, transparent 2.5%),
                radial-gradient(circle at 75px 75px, rgba(255, 255, 255, 0.05) 2%, transparent 2.5%);
            background-size: 100px 100px; pointer-events: none; z-index: -1;
        }
        body.day-mode::before {
            background-image: 
                radial-gradient(circle at 25px 25px, rgba(0, 0, 0, 0.03) 2%, transparent 2.5%),
                radial-gradient(circle at 75px 75px, rgba(0, 0, 0, 0.03) 2%, transparent 2.5%);
        }
        
        /* === GÄ°RÄ°Å EKRANI === */
        .login-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.95); display: flex; align-items: center;
            justify-content: center; z-index: 1000;
        }
        .login-container {
            background: var(--bg-secondary); padding: 40px; border-radius: 12px;
            width: 420px; max-width: 90%; border: 1px solid var(--border-light);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }
        .login-input {
            width: 100%; padding: 14px; margin: 12px 0; background: var(--bg-tertiary);
            border: 1px solid var(--border-light); color: var(--text-primary);
            border-radius: 8px; font-size: 15px;
        }
        .login-btn {
            width: 100%; padding: 14px; background: var(--accent-blue); color: white;
            border: none; border-radius: 8px; cursor: pointer; font-size: 15px;
            font-weight: 600; margin-top: 15px; transition: background 0.2s;
        }
        .login-btn:hover { background: #2563eb; }
        
        /* === ANA UYGULAMA === */
        .app-container { display: flex; flex-direction: column; height: 100vh; width: 100vw; overflow: hidden; }
        
        /* ÃœST BAR */
        .top-bar {
            display: flex; height: 70px; min-height: 70px; background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-light); padding: 0 25px;
            align-items: center; justify-content: space-between; flex-shrink: 0;
        }
        .channel-tabs { display: flex; gap: 8px; overflow-x: auto; max-width: 600px; padding: 5px 0; flex: 1; margin: 0 20px; }
        .channel-tab {
            padding: 10px 18px; background: var(--bg-tertiary); border-radius: 8px;
            cursor: pointer; white-space: nowrap; font-size: 14px; transition: all 0.2s;
            border: 1px solid var(--border-light);
        }
        .channel-tab:hover { background: var(--bg-primary); }
        .channel-tab.active { background: var(--accent-blue); color: white; border-color: var(--accent-blue); }
        
        /* ANA Ä°Ã‡ERÄ°K */
        .main-content { display: flex; flex: 1; overflow: hidden; min-height: 0; }
        
        /* SOL PANEL */
        .online-panel {
            width: 300px; min-width: 300px; background: var(--bg-secondary);
            border-right: 1px solid var(--border-light); display: flex;
            flex-direction: column; flex-shrink: 0;
        }
        .panel-header { padding: 20px; border-bottom: 1px solid var(--border-light); flex-shrink: 0; }
        .user-list { flex: 1; overflow-y: auto; padding: 10px; }
        .user-item {
            padding: 14px; border-radius: 8px; cursor: pointer; display: flex;
            align-items: center; gap: 12px; margin-bottom: 8px; transition: background 0.2s;
            border: 1px solid transparent;
        }
        .user-item:hover { background: var(--bg-tertiary); border-color: var(--border-light); }
        .user-avatar {
            width: 48px; height: 48px; border-radius: 50%; background: linear-gradient(135deg, var(--accent-blue), #8b5cf6);
            display: flex; align-items: center; justify-content: center; color: white;
            font-weight: bold; font-size: 18px; flex-shrink: 0;
        }
        .user-info { flex: 1; min-width: 0; }
        .user-name { font-weight: 600; font-size: 15px; margin-bottom: 4px; }
        .user-status { font-size: 13px; color: var(--text-secondary); }
        
        /* ORTA PANEL */
        .chat-panel { flex: 1; display: flex; flex-direction: column; min-width: 0; }
        .chat-header {
            padding: 0 25px; height: 70px; border-bottom: 1px solid var(--border-light);
            display: flex; align-items: center; justify-content: space-between;
            background: var(--bg-secondary); flex-shrink: 0;
        }
        .chat-messages { flex: 1; overflow-y: auto; padding: 25px; background: var(--bg-primary); }
        .message { margin-bottom: 20px; max-width: 75%; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .message-outgoing { margin-left: auto; }
        .message-text {
            background: var(--bg-tertiary); padding: 14px 18px; border-radius: 12px;
            display: inline-block; font-size: 15px; line-height: 1.5; word-break: break-word;
        }
        .message-outgoing .message-text { background: var(--accent-blue); color: white; border-bottom-right-radius: 4px; }
        .message-incoming .message-text { border-bottom-left-radius: 4px; }
        .message-sender { font-size: 13px; color: var(--text-secondary); margin-bottom: 6px; font-weight: 500; }
        .message-time { font-size: 11px; color: var(--text-secondary); margin-top: 4px; text-align: right; }
        .chat-input-area { padding: 20px; border-top: 1px solid var(--border-light); background: var(--bg-secondary); flex-shrink: 0; }
        .message-input {
            width: 100%; padding: 16px; background: var(--bg-tertiary); border: 1px solid var(--border-light);
            color: var(--text-primary); border-radius: 10px; resize: none; font-size: 15px;
            line-height: 1.5; min-height: 60px; max-height: 150px;
        }
        .message-input:focus { outline: none; border-color: var(--accent-blue); }
        .input-actions { display: flex; justify-content: space-between; margin-top: 15px; }
        
        /* SAÄ PANEL */
        .video-panel {
            width: 650px; min-width: 650px; background: #000; display: flex;
            flex-direction: column; flex-shrink: 0; border-left: 1px solid #333;
        }
        .video-header { padding: 20px; background: rgba(0, 0, 0, 0.9); color: white; border-bottom: 1px solid #333; flex-shrink: 0; }
        .video-container { flex: 1; background: #000; position: relative; min-height: 0; }
        .youtube-video { width: 100%; height: 100%; border: none; display: block; }
        .video-controls { padding: 20px; background: rgba(0, 0, 0, 0.9); border-top: 1px solid #333; flex-shrink: 0; }
        
        /* BUTONLAR */
        .btn {
            padding: 10px 20px; border-radius: 8px; border: none; cursor: pointer; font-size: 14px;
            font-weight: 500; transition: all 0.2s; display: inline-flex; align-items: center; gap: 8px;
        }
        .btn-primary { background: var(--accent-blue); color: white; }
        .btn-primary:hover { background: #2563eb; transform: translateY(-1px); }
        .btn-secondary { background: var(--bg-tertiary); color: var(--text-primary); border: 1px solid var(--border-light); }
        .btn-secondary:hover { background: var(--bg-secondary); }
        .btn-success { background: var(--accent-green); color: white; }
        .btn-success:hover { background: #059669; }
        .btn-danger { background: var(--accent-red); color: white; }
        .btn-danger:hover { background: #dc2626; }
        
        /* MODALLAR */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.8); display: none; align-items: center;
            justify-content: center; z-index: 2000; backdrop-filter: blur(5px);
        }
        .modal-content {
            background: var(--bg-secondary); padding: 30px; border-radius: 12px;
            max-width: 800px; width: 90%; max-height: 90vh; overflow-y: auto;
            border: 1px solid var(--border-light); box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
        }
        
        /* UTILITIES */
        .hidden { display: none !important; }
        .text-sm { font-size: 13px; }
        .text-muted { color: var(--text-secondary); }
        .flex { display: flex; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .gap-2 { gap: 8px; }
        .gap-3 { gap: 12px; }
        .w-full { width: 100%; }
        
        /* SCROLLBAR */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-tertiary); border-radius: 4px; }
        ::-webkit-scrollbar-thumb { background: var(--border-light); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #444; }
        
        /* YENÄ° EKLENEN STÄ°LLER */
        .owner-tab { padding: 8px 16px; background: var(--bg-tertiary); border: none; color: var(--text-primary); cursor: pointer; border-radius: 6px; }
        .owner-tab.active { background: var(--accent-blue); color: white; }
        .owner-tab-content { display: block; }
        .status-dot {
            width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-right: 6px;
        }
        .status-online { background: var(--accent-green); }
        .status-offline { background: var(--text-secondary); }
        .role-badge {
            font-size: 11px; padding: 2px 8px; border-radius: 12px; margin-left: 6px;
        }
        .role-owner { background: linear-gradient(135deg, #8b5cf6, #3b82f6); color: white; }
        .role-admin { background: var(--accent-blue); color: white; }
        .role-coadmin { background: #f59e0b; color: white; }
        .role-operator { background: #10b981; color: white; }
        .role-voice { background: #8b5cf6; color: white; }
        .message-id {
            font-size: 10px; color: var(--text-secondary); margin-right: 8px; opacity: 0.6;
        }
        .ban-item, .mute-item {
            padding: 10px; border: 1px solid var(--border-light); border-radius: 8px;
            margin-bottom: 8px; background: var(--bg-tertiary);
        }
        .pm-window {
            position: fixed; bottom: 20px; right: 20px; width: 350px; height: 450px;
            background: var(--bg-secondary); border-radius: 12px; border: 1px solid var(--border-light);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3); display: flex; flex-direction: column;
            z-index: 100;
        }
        .pm-header { padding: 15px; border-bottom: 1px solid var(--border-light); background: var(--bg-tertiary); }
        .pm-messages { flex: 1; overflow-y: auto; padding: 15px; }
        .pm-input { padding: 10px; border-top: 1px solid var(--border-light); }
    </style>
    <!-- Font Awesome (sadece kullanÄ±lan ikonlar) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="night-mode">
    <!-- GÄ°RÄ°Å EKRANI -->
    <div id="loginScreen" class="login-screen">
        <div class="login-container">
            <div style="text-align: center; margin-bottom: 30px;">
                <div style="width: 80px; height: 80px; background: linear-gradient(135deg, var(--accent-blue), #8b5cf6); border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; color: white; font-size: 32px; font-weight: bold; margin-bottom: 15px;">P</div>
                <h1 style="font-size: 28px; margin-bottom: 8px;">Popbox Elite IRC</h1>
                <p class="text-muted">Profesyonel IRC Sistemi</p>
            </div>
            
            <input type="text" id="nickInput" class="login-input" placeholder="KullanÄ±cÄ± adÄ±" autofocus>
            <input type="password" id="passInput" class="login-input" placeholder="Åifre (isteÄŸe baÄŸlÄ±)">
            
            <button class="login-btn" onclick="handleLogin()"><i class="fas fa-sign-in-alt"></i> GiriÅŸ Yap</button>
            
            <div style="margin-top: 25px; padding-top: 20px; border-top: 1px solid var(--border-light);">
                <p class="text-sm text-muted" style="text-align: center;">
                    <strong>Test KullanÄ±cÄ±larÄ±:</strong><br>
                    Owner: <strong>mateky</strong> / <strong>kumsal07@</strong><br>
                    Admin: <strong>MATE</strong> / <strong>secure123</strong>
                </p>
            </div>
        </div>
    </div>

    <!-- ANA UYGULAMA -->
    <div id="app" class="hidden">
        <div class="app-container">
            <!-- ÃœST BAR -->
            <div class="top-bar">
                <div class="flex items-center gap-3">
                    <div style="width: 36px; height: 36px; background: linear-gradient(135deg, var(--accent-blue), #8b5cf6); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">P</div>
                    <span style="font-size: 18px; font-weight: 600;">Popbox Elite IRC</span>
                    <span id="userRole" class="text-sm" style="color: var(--accent-blue);"></span>
                </div>

                <!-- KANAL SEKMELERÄ° -->
                <div class="channel-tabs" id="channelTabs">
                    <div class="channel-tab active" onclick="switchChannel('general')"><i class="fas fa-hashtag"></i> Genel</div>
                </div>

                <div class="flex items-center gap-2">
                    <button onclick="openCreateChannel()" id="createChannelBtn" class="btn btn-success hidden"><i class="fas fa-plus"></i> Kanal AÃ§</button>
                    <button onclick="openOwnerPanel()" id="ownerBtn" class="btn btn-secondary hidden"><i class="fas fa-crown"></i> Owner</button>
                    <button onclick="openAdminPanel()" id="adminBtn" class="btn btn-secondary hidden"><i class="fas fa-user-shield"></i> Admin</button>
                    <button onclick="openProfile()" class="btn btn-secondary"><i class="fas fa-user"></i> Profil</button>
                    <button onclick="toggleTheme()" class="btn btn-secondary"><i class="fas fa-moon"></i> Tema</button>
                </div>
            </div>

            <!-- ANA Ä°Ã‡ERÄ°K -->
            <div class="main-content">
                <!-- SOL PANEL -->
                <div class="online-panel">
                    <div class="panel-header">
                        <h3 style="margin-bottom: 5px;">Ã‡evrimiÃ§i KullanÄ±cÄ±lar</h3>
                        <div class="flex items-center justify-between">
                            <span class="text-muted">Aktif kullanÄ±cÄ±lar</span>
                            <span id="onlineCount" style="font-weight: 600;">0</span>
                        </div>
                    </div>
                    <div class="user-list" id="userList"></div>
                </div>

                <!-- ORTA PANEL -->
                <div class="chat-panel">
                    <div class="chat-header">
                        <div>
                            <h2 id="currentChannel" style="font-size: 18px; margin-bottom: 4px;"><i class="fas fa-hashtag"></i> Genel</h2>
                            <p class="text-muted" style="font-size: 14px;"><span id="channelUsers">0</span> kullanÄ±cÄ± â€¢ <span id="channelTopic">Popbox IRC Sistemi</span></p>
                        </div>
                        <div class="flex items-center gap-2">
                            <button onclick="openIRC()" class="btn btn-secondary"><i class="fas fa-terminal"></i> IRC KomutlarÄ±</button>
                            <button onclick="openCommandHelp()" class="btn btn-secondary"><i class="fas fa-question-circle"></i> YardÄ±m</button>
                        </div>
                    </div>

                    <div class="chat-messages" id="chatMessages">
                        <div style="text-align: center; padding: 40px 20px; color: var(--text-secondary);">
                            <i class="fas fa-comments" style="font-size: 48px; margin-bottom: 15px; opacity: 0.5;"></i>
                            <h3 style="margin-bottom: 10px;">Popbox Elite IRC'ye HoÅŸ Geldiniz</h3>
                            <p>IRC komutlarÄ± iÃ§in /help yazÄ±n</p>
                        </div>
                    </div>

                    <div class="chat-input-area">
                        <textarea class="message-input" id="messageInput" placeholder="Mesaj yazÄ±n (IRC komutlarÄ± iÃ§in / kullanÄ±n)..." rows="3" onkeydown="handleKeyPress(event)"></textarea>
                        <div class="input-actions">
                            <div class="text-sm text-muted">Enter: GÃ¶nder â€¢ Shift+Enter: Yeni SatÄ±r</div>
                            <button onclick="sendMessage()" class="btn btn-primary"><i class="fas fa-paper-plane"></i> GÃ¶nder</button>
                        </div>
                    </div>
                </div>

                <!-- SAÄ PANEL -->
                <div class="video-panel">
                    <div class="video-header">
                        <div>
                            <h3 style="display: flex; align-items: center; gap: 10px; margin-bottom: 5px;"><i class="fas fa-play-circle"></i><span id="videoTitle">Popbox Music</span></h3>
                            <p style="font-size: 14px; color: rgba(255,255,255,0.7);">YouTube CanlÄ± YayÄ±nÄ±</p>
                        </div>
                        <button onclick="openVideoManager()" id="videoManagerBtn" class="btn hidden" style="background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.2);"><i class="fas fa-video"></i> YÃ¶net</button>
                    </div>
                    <div class="video-container">
                        <iframe class="youtube-video" id="youtubePlayer" src="https://www.youtube.com/embed/jfKfPfyJRdk?autoplay=1&mute=1&rel=0" frameborder="0" allowfullscreen></iframe>
                    </div>
                    <div class="video-controls">
                        <div class="flex justify-between items-center">
                            <div style="font-size: 14px; color: rgba(255,255,255,0.7);"><i class="fas fa-eye"></i> <span id="viewerCount">1.2M</span> izleyici</div>
                            <div style="font-size: 14px; color: rgba(255,255,255,0.7);"><i class="fas fa-clock"></i> 24/7</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODALLAR -->
    <div id="videoModal" class="modal-overlay"><div class="modal-content">
        <div class="flex items-center justify-between" style="margin-bottom: 20px;">
            <h3 style="font-size: 20px;">Video YÃ¶netimi</h3>
            <button onclick="closeVideoModal()" style="background: none; border: none; color: var(--text-secondary); font-size: 24px; cursor: pointer;">Ã—</button>
        </div>
        <div style="margin-bottom: 20px;"><label style="display: block; margin-bottom: 8px; font-weight: 500;">YouTube URL veya ID</label><input type="text" id="videoUrl" class="login-input" placeholder="https://youtube.com/watch?v=..."></div>
        <div style="margin-bottom: 25px;"><label style="display: block; margin-bottom: 8px; font-weight: 500;">Video BaÅŸlÄ±ÄŸÄ±</label><input type="text" id="videoTitleInput" class="login-input" placeholder="Video baÅŸlÄ±ÄŸÄ±"></div>
        <div class="flex gap-2"><button onclick="closeVideoModal()" class="btn btn-secondary" style="flex: 1;">Ä°ptal</button><button onclick="saveVideo()" class="btn btn-primary" style="flex: 1;"><i class="fas fa-save"></i> Kaydet</button></div>
    </div></div>

    <div id="channelModal" class="modal-overlay"><div class="modal-content">
        <div class="flex items-center justify-between" style="margin-bottom: 20px;">
            <h3 style="font-size: 20px;">Yeni Kanal OluÅŸtur</h3>
            <button onclick="closeChannelModal()" style="background: none; border: none; color: var(--text-secondary); font-size: 24px; cursor: pointer;">Ã—</button>
        </div>
        <div style="margin-bottom: 20px;"><label style="display: block; margin-bottom: 8px; font-weight: 500;">Kanal AdÄ±</label><input type="text" id="channelName" class="login-input" placeholder="#kanal_adi"></div>
        <div style="margin-bottom: 25px;"><label style="display: block; margin-bottom: 8px; font-weight: 500;">Kanal TÃ¼rÃ¼</label>
            <select id="channelType" class="login-input">
                <option value="public">Public - Herkes katÄ±labilir</option>
                <option value="private">Private - Sadece davetliler</option>
                <option value="secret">Secret - Gizli kanal</option>
            </select>
        </div>
        <div class="flex gap-2"><button onclick="closeChannelModal()" class="btn btn-secondary" style="flex: 1;">Ä°ptal</button><button onclick="createNewChannel()" class="btn btn-success" style="flex: 1;"><i class="fas fa-plus"></i> OluÅŸtur</button></div>
    </div></div>

    <div id="ownerModal" class="modal-overlay"><div class="modal-content" style="max-width: 900px; max-height: 90vh;">
        <div class="flex items-center justify-between" style="margin-bottom: 20px;">
            <h3 style="font-size: 20px;"><i class="fas fa-crown"></i> Owner Paneli - TanrÄ± Modu</h3>
            <button onclick="closeOwnerModal()" style="background: none; border: none; color: var(--text-secondary); font-size: 24px; cursor: pointer;">Ã—</button>
        </div>
        <div class="flex gap-2" style="margin-bottom: 25px; border-bottom: 1px solid var(--border-light);">
            <button onclick="switchOwnerTab('users')" id="tabUsers" class="owner-tab active"><i class="fas fa-users"></i> KullanÄ±cÄ±lar</button>
            <button onclick="switchOwnerTab('messages')" id="tabMessages" class="owner-tab"><i class="fas fa-envelope"></i> Ã–zel Mesajlar</button>
            <button onclick="switchOwnerTab('channels')" id="tabChannels" class="owner-tab"><i class="fas fa-hashtag"></i> Kanallar</button>
            <button onclick="switchOwnerTab('system')" id="tabSystem" class="owner-tab"><i class="fas fa-cog"></i> Sistem</button>
            <button onclick="switchOwnerTab('custom')" id="tabCustom" class="owner-tab"><i class="fas fa-code"></i> Ã–zel Komutlar</button>
        </div>
        <div id="ownerUsers" class="owner-tab-content"><div style="max-height: 400px; overflow-y: auto;"><div id="ownerUserList"></div></div></div>
        <div id="ownerMessages" class="owner-tab-content hidden"><div style="max-height: 400px; overflow-y: auto; padding: 10px; background: var(--bg-primary); border-radius: 8px;"><div id="pmList"></div></div></div>
        <div id="ownerChannels" class="owner-tab-content hidden"><div style="max-height: 400px; overflow-y: auto;"><div id="channelList"></div></div></div>
        <div id="ownerSystem" class="owner-tab-content hidden">
            <div style="margin-bottom: 20px;"><label style="display: block; margin-bottom: 8px; font-weight: 500;">Sistem MesajÄ± (Genel)</label><input type="text" id="systemMessage" class="login-input" placeholder="Genel sistem mesajÄ±"></div>
            <div style="margin-bottom: 20px;"><label style="display: block; margin-bottom: 8px; font-weight: 500;">Video VarsayÄ±lan</label><input type="text" id="defaultVideo" class="login-input" placeholder="VarsayÄ±lan YouTube ID"></div>
            <button onclick="updateSystemSettings()" class="btn btn-primary w-full"><i class="fas fa-save"></i> Sistem AyarlarÄ±nÄ± GÃ¼ncelle</button>
        </div>
        <div id="ownerCustom" class="owner-tab-content hidden">
            <div style="margin-bottom: 20px;"><label style="display: block; margin-bottom: 8px; font-weight: 500;">Komut Ekle</label>
                <div class="flex gap-2">
                    <input type="text" id="customCommandName" class="login-input" style="flex: 1;" placeholder="komutadÄ±">
                    <input type="text" id="customCommandCode" class="login-input" style="flex: 2;" placeholder="sendMessage('Merhaba')">
                    <button onclick="addCustomCommand()" class="btn btn-success"><i class="fas fa-plus"></i> Ekle</button>
                </div>
            </div>
            <div style="max-height: 300px; overflow-y: auto;"><div id="customCommandsList"></div></div>
        </div>
    </div></div>

    <div id="adminModal" class="modal-overlay"><div class="modal-content" style="max-width: 800px;">
        <div class="flex items-center justify-between" style="margin-bottom: 20px;">
            <h3 style="font-size: 20px;"><i class="fas fa-user-shield"></i> Admin Paneli</h3>
            <button onclick="closeAdminModal()" style="background: none; border: none; color: var(--text-secondary); font-size: 24px; cursor: pointer;">Ã—</button>
        </div>
        <div class="flex gap-2" style="margin-bottom: 25px; border-bottom: 1px solid var(--border-light);">
            <button onclick="switchAdminTab('bans')" id="tabBans" class="owner-tab active"><i class="fas fa-ban"></i> Banlar</button>
            <button onclick="switchAdminTab('mutes')" id="tabMutes" class="owner-tab"><i class="fas fa-volume-mute"></i> Susturmalar</button>
            <button onclick="switchAdminTab('channels')" id="tabChannelsAdmin" class="owner-tab"><i class="fas fa-hashtag"></i> Kanallar</button>
            <button onclick="switchAdminTab('logs')" id="tabLogs" class="owner-tab"><i class="fas fa-history"></i> Loglar</button>
        </div>
        <div id="adminBans" class="owner-tab-content"><div style="max-height: 400px; overflow-y: auto;"><div id="banList"></div></div></div>
        <div id="adminMutes" class="owner-tab-content hidden"><div style="max-height: 400px; overflow-y: auto;"><div id="muteList"></div></div></div>
        <div id="adminChannels" class="owner-tab-content hidden"><div style="max-height: 400px; overflow-y: auto;"><div id="adminChannelList"></div></div></div>
        <div id="adminLogs" class="owner-tab-content hidden"><div style="max-height: 400px; overflow-y: auto; padding: 10px; background: var(--bg-primary); border-radius: 8px;"><div id="logList"></div></div></div>
    </div></div>

    <div id="ircModal" class="modal-overlay"><div class="modal-content" style="max-width: 700px;">
        <div class="flex items-center justify-between" style="margin-bottom: 20px;">
            <h3 style="font-size: 20px;"><i class="fas fa-terminal"></i> IRC KomutlarÄ±</h3>
            <button onclick="closeIRCModal()" style="background: none; border: none; color: var(--text-secondary); font-size: 24px; cursor: pointer;">Ã—</button>
        </div>
        <div style="margin-bottom: 20px;"><input type="text" id="ircCommand" class="login-input" placeholder="/komut parametreler" onkeydown="handleIRCKeyPress(event)"></div>
        <div style="height: 300px; overflow-y: auto; background: var(--bg-primary); padding: 15px; border-radius: 8px; margin-bottom: 20px;"><div id="ircOutput"></div></div>
        <div class="flex gap-2"><button onclick="clearIRC()" class="btn btn-secondary" style="flex: 1;"><i class="fas fa-trash"></i> Temizle</button><button onclick="closeIRCModal()" class="btn btn-primary" style="flex: 1;"><i class="fas fa-times"></i> Kapat</button></div>
    </div></div>

    <div id="profileModal" class="modal-overlay"><div class="modal-content">
        <div class="flex items-center justify-between" style="margin-bottom: 20px;">
            <h3 style="font-size: 20px;"><i class="fas fa-user-cog"></i> Profil AyarlarÄ±</h3>
            <button onclick="closeProfileModal()" style="background: none; border: none; color: var(--text-secondary); font-size: 24px; cursor: pointer;">Ã—</button>
        </div>
        <div style="text-align: center; margin-bottom: 25px;">
            <div id="profileAvatar" style="width: 100px; height: 100px; background: linear-gradient(135deg, var(--accent-blue), #8b5cf6); border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; color: white; font-size: 36px; font-weight: bold; cursor: pointer; position: relative;" onclick="changeAvatar()">
                <div style="position: absolute; bottom: 0; right: 0; background: var(--accent-blue); width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center;"><i class="fas fa-camera"></i></div>
            </div>
            <p class="text-muted" style="margin-top: 10px;">AvatarÄ± deÄŸiÅŸtirmek iÃ§in tÄ±klayÄ±n</p>
        </div>
        <div style="margin-bottom: 20px;"><label style="display: block; margin-bottom: 8px; font-weight: 500;">KullanÄ±cÄ± AdÄ±</label><input type="text" id="profileNick" class="login-input" value=""></div>
        <div style="margin-bottom: 20px;"><label style="display: block; margin-bottom: 8px; font-weight: 500;">Biyografi</label><textarea id="profileBio" class="login-input" placeholder="Kendinizden bahsedin..." rows="3"></textarea></div>
        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 25px; padding: 15px; background: var(--bg-tertiary); border-radius: 8px;">
            <div><div style="font-weight: 500;">Uyku Modu</div><div class="text-sm text-muted">GÃ¶rÃ¼nmez olarak Ã§evrimiÃ§i kalÄ±n</div></div>
            <label style="position: relative; display: inline-block; width: 60px; height: 30px;">
                <input type="checkbox" id="sleepMode" style="opacity: 0; width: 0; height: 0;">
                <span style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background: var(--bg-primary); border-radius: 34px; transition: .4s;"></span>
                <span style="position: absolute; content: ''; height: 22px; width: 22px; left: 4px; bottom: 4px; background: white; border-radius: 50%; transition: .4s;"></span>
            </label>
        </div>
        <div class="flex gap-2"><button onclick="closeProfileModal()" class="btn btn-secondary" style="flex: 1;">Ä°ptal</button><button onclick="saveProfile()" class="btn btn-primary" style="flex: 1;"><i class="fas fa-save"></i> Kaydet</button></div>
    </div></div>

    <div id="helpModal" class="modal-overlay"><div class="modal-content" style="max-width: 800px;">
        <div class="flex items-center justify-between" style="margin-bottom: 20px;">
            <h3 style="font-size: 20px;"><i class="fas fa-question-circle"></i> IRC Komut YardÄ±mÄ±</h3>
            <button onclick="closeHelpModal()" style="background: none; border: none; color: var(--text-secondary); font-size: 24px; cursor: pointer;">Ã—</button>
        </div>
        <div style="max-height: 500px; overflow-y: auto;">
            <div style="margin-bottom: 20px;">
                <h4 style="color: var(--accent-blue); margin-bottom: 10px;">ğŸ‘¤ GENEL KOMUTLAR (Herkes)</h4>
                <div style="background: var(--bg-tertiary); padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                    <div><code>/nick yeniNick</code> - KullanÄ±cÄ± adÄ±nÄ± deÄŸiÅŸtir</div>
                    <div><code>/join #kanal</code> - Kanala katÄ±l</div>
                    <div><code>/leave</code> - Kanaldan ayrÄ±l</div>
                    <div><code>/msg nick mesaj</code> - Ã–zel mesaj gÃ¶nder</div>
                    <div><code>/me mesaj</code> - Eylem mesajÄ± gÃ¶nder</div>
                    <div><code>/who</code> - Online kullanÄ±cÄ±larÄ± listele</div>
                    <div><code>/whois nick</code> - KullanÄ±cÄ± bilgisi gÃ¶ster</div>
                    <div><code>/clear</code> - Sohbeti temizle</div>
                </div>
            </div>
            <div style="margin-bottom: 20px;">
                <h4 style="color: #10b981; margin-bottom: 10px;">ğŸ›¡ï¸ OPERATOR (MOD) â€” SADECE KENDÄ° KANALI</h4>
                <div style="background: var(--bg-tertiary); padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                    <div><code>/sil mesajID</code> - Mesaj sil</div>
                    <div><code>/kick nick sebep</code> - KullanÄ±cÄ±yÄ± at</div>
                    <div><code>/mute nick sÃ¼re</code> - KullanÄ±cÄ±yÄ± sustur</div>
                    <div><code>/unmute nick</code> - SusturmayÄ± kaldÄ±r</div>
                    <div><code>/warn nick sebep</code> - UyarÄ± ver</div>
                    <div><code>/topic yazÄ±</code> - Kanal konusu deÄŸiÅŸtir</div>
                    <div><code>/slowmode saniye</code> - YavaÅŸ mod aÃ§</div>
                    <div><code>/unslow</code> - YavaÅŸ mod kapat</div>
                    <div><code>/lock</code> - KanalÄ± kilitle</div>
                    <div><code>/unlock</code> - Kanal kilidini aÃ§</div>
                </div>
            </div>
            <div style="margin-bottom: 20px;">
                <h4 style="color: #f59e0b; margin-bottom: 10px;">â­ COADMIN â€” SADECE AÃ‡TIÄI KANAL</h4>
                <div style="background: var(--bg-tertiary); padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                    <div><code>/ban nick sÃ¼re sebep</code> - KullanÄ±cÄ±yÄ± banla</div>
                    <div><code>/unban nick</code> - BanÄ± kaldÄ±r</div>
                    <div><code>/op nick</code> - OP yetkisi ver</div>
                    <div><code>/deop nick</code> - OP yetkisini al</div>
                    <div><code>/voice nick</code> - Voice yetkisi ver</div>
                    <div><code>/devoice nick</code> - Voice yetkisini al</div>
                    <div><code>/clearall</code> - TÃ¼m mesajlarÄ± sil</div>
                    <div><code>/limit sayÄ±</code> - KullanÄ±cÄ± limiti koy</div>
                    <div><code>/unlimit</code> - Limiti kaldÄ±r</div>
                </div>
            </div>
            <div style="margin-bottom: 20px;">
                <h4 style="color: #ef4444; margin-bottom: 10px;">ğŸ‘‘ ADMIN â€” TÃœM SÄ°STEM GENELÄ°</h4>
                <div style="background: var(--bg-tertiary); padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                    <div><code>/gban nick sÃ¼re sebep</code> - Global ban</div>
                    <div><code>/gunban nick</code> - Global ban kaldÄ±r</div>
                    <div><code>/gmute nick sÃ¼re</code> - Global sustur</div>
                    <div><code>/gunmute nick</code> - Global susturma kaldÄ±r</div>
                    <div><code>/kick nick</code> - Her kanaldan at</div>
                    <div><code>/sil mesajID</code> - Her kanaldan mesaj sil</div>
                    <div><code>/kanalsil #kanal</code> - KanalÄ± sil</div>
                    <div><code>/kanalkilit #kanal</code> - KanalÄ± kilitle</div>
                    <div><code>/kanalac #kanal</code> - KanalÄ± aÃ§</div>
                    <div><code>/yetki ver nick operator|coadmin</code> - Yetki ver</div>
                    <div><code>/yetki al nick</code> - Yetki al</div>
                    <div><code>/duyuru mesaj</code> - Sistem duyurusu yap</div>
                    <div><code>/log nick</code> - KullanÄ±cÄ± loglarÄ±nÄ± gÃ¶ster</div>
                    <div><code>/ip nick</code> - KullanÄ±cÄ± IP'sini gÃ¶ster</div>
                </div>
            </div>
            <div>
                <h4 style="color: #8b5cf6; margin-bottom: 10px;">ğŸ‘‘ OWNER â€” Ã–ZEL YETKÄ°LER</h4>
                <div style="background: var(--bg-tertiary); padding: 15px; border-radius: 8px;">
                    <div><code>/komutekle komutadÄ± => js_kodu</code> - Ã–zel komut ekle</div>
                    <div><code>/komutsil komutadÄ±</code> - Ã–zel komut sil</div>
                    <div><code>/komutlar</code> - Ã–zel komutlarÄ± listele</div>
                    <div><code>/panel</code> - TÃ¼m mesajlarÄ± gÃ¶r (gizli)</div>
                    <div><code>/herkes mesaj</code> - TÃ¼m kanallara mesaj at</div>
                    <div><code>/resetkanal #kanal</code> - KanalÄ± resetle</div>
                    <div><code>/resetchat</code> - TÃ¼m sohbetleri temizle</div>
                    <div><code>/resetyetkiler</code> - TÃ¼m yetkileri sÄ±fÄ±rla</div>
                    <div><code>/yedekal</code> - Sistem yedeÄŸi al</div>
                    <div><code>/yukle</code> - Yedek yÃ¼kle</div>
                </div>
            </div>
        </div>
    </div></div>

    <!-- Ã–ZEL MESAJ PENCERELERÄ° BURAYA EKLENECEK (dinamik) -->

    <script>
        // ==================== SÄ°STEM DEÄÄ°ÅKENLERÄ° ====================
        let currentUser = null;
        let currentChannel = 'general';
        let messageCounter = 1;
        let customCommands = {};
        
        let channels = {
            general: {
                name: '#Genel',
                owner: 'system',
                type: 'public',
                topic: 'Popbox IRC Sistemi',
                users: [],
                operators: [],
                voices: [],
                bans: [],
                mutes: [],
                slowmode: 0,
                locked: false,
                userLimit: 0,
                messages: [],
                video: { id: 'jfKfPfyJRdk', title: 'Popbox Music' }
            }
        };
        
        let users = [
            { 
                id: 'mateky', 
                name: 'mateky', 
                role: 'owner', 
                registered: true, 
                online: true, 
                sleepMode: false, 
                avatar: 'ğŸ‘‘', 
                bio: 'Sistem Owner',
                ip: '192.168.1.1',
                joinDate: new Date(),
                warnings: [],
                logs: []
            },
            { 
                id: 'mate', 
                name: 'MATE', 
                role: 'admin', 
                registered: true, 
                online: true, 
                sleepMode: false, 
                avatar: 'ğŸ¤–', 
                bio: 'GÃ¼venlik Botu',
                ip: '127.0.0.1',
                joinDate: new Date(),
                warnings: [],
                logs: []
            }
        ];
        
        let registeredUsers = [
            { name: 'mateky', password: 'kumsal07@', role: 'owner' },
            { name: 'MATE', password: 'secure123', role: 'admin' }
        ];
        
        let globalBans = [];
        let globalMutes = [];
        let privateMessages = {};
        let systemLogs = [];
        let ircHistory = [];
        let userChannels = {};
        let theme = 'night';
        let pmWindows = {};

        // ==================== GÄ°RÄ°Å SÄ°STEMÄ° ====================
        function handleLogin() {
            const nick = document.getElementById('nickInput').value.trim();
            const pass = document.getElementById('passInput').value;
            
            if (!nick) {
                alert('KullanÄ±cÄ± adÄ± gerekli!');
                return;
            }
            
            const registeredUser = registeredUsers.find(u => u.name.toLowerCase() === nick.toLowerCase());
            
            if (registeredUser) {
                if (pass !== registeredUser.password) {
                    alert('YanlÄ±ÅŸ ÅŸifre!');
                    return;
                }
                
                let existingUser = users.find(u => u.id === nick.toLowerCase());
                if (existingUser) {
                    currentUser = existingUser;
                } else {
                    currentUser = {
                        id: nick.toLowerCase(),
                        name: nick,
                        role: registeredUser.role,
                        registered: true,
                        online: true,
                        sleepMode: false,
                        avatar: nick.charAt(0).toUpperCase(),
                        bio: '',
                        ip: generateIP(),
                        joinDate: new Date(),
                        warnings: [],
                        logs: []
                    };
                    users.push(currentUser);
                }
            } else {
                currentUser = {
                    id: nick.toLowerCase(),
                    name: nick,
                    role: 'user',
                    registered: false,
                    online: true,
                    sleepMode: false,
                    avatar: nick.charAt(0).toUpperCase(),
                    bio: '',
                    ip: generateIP(),
                    joinDate: new Date(),
                    warnings: [],
                    logs: []
                };
                
                if (pass) {
                    currentUser.registered = true;
                    registeredUsers.push({ name: nick, password: pass, role: 'user' });
                }
                
                users.push(currentUser);
            }
            
            if (!channels.general.users.includes(currentUser.id)) {
                channels.general.users.push(currentUser.id);
            }
            
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('app').classList.remove('hidden');
            
            updateUserButtons();
            addSystemMessage(`ğŸ¤– HoÅŸ geldin ${currentUser.name}! Popbox Elite IRC'ye katÄ±ldÄ±nÄ±z.`);
            updateOnlineList();
            addFakeUsers();
            
            document.getElementById('userRole').textContent = currentUser.role.toUpperCase();
            
            setTimeout(() => {
                if (currentUser.name !== 'MATE') {
                    addSystemMessage('ğŸ’¡ Tip: Komutlar iÃ§in /help yazabilirsiniz.');
                }
            }, 2000);
        }

        function generateIP() {
            return `192.168.${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}`;
        }

        function updateUserButtons() {
            const ownerBtn = document.getElementById('ownerBtn');
            const adminBtn = document.getElementById('adminBtn');
            const createBtn = document.getElementById('createChannelBtn');
            
            if (currentUser.role === 'owner') {
                ownerBtn.classList.remove('hidden');
                adminBtn.classList.remove('hidden');
            } else if (currentUser.role === 'admin') {
                adminBtn.classList.remove('hidden');
                ownerBtn.classList.add('hidden');
            } else {
                ownerBtn.classList.add('hidden');
                adminBtn.classList.add('hidden');
            }
            
            if (currentUser.registered) {
                createBtn.classList.remove('hidden');
            }
        }

        // ==================== SOHBET SÄ°STEMÄ° ====================
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const text = input.value.trim();
            if (!text) return;
            
            if (text.startsWith('/')) {
                handleCommand(text);
                input.value = '';
                return;
            }
            
            const channel = channels[currentChannel];
            
            if (isUserMuted(currentUser.id, currentChannel)) {
                addSystemMessage('âš ï¸ SusturulmuÅŸsunuz! Mesaj gÃ¶nderemezsiniz.');
                return;
            }
            
            if (channel.slowmode > 0) {
                // YavaÅŸ mod kontrolÃ¼ (basit demo)
                addUserMessage(text, currentUser);
            } else {
                addUserMessage(text, currentUser);
            }
            
            input.value = '';
            
            simulateAutoReply(text);
        }

        function handleKeyPress(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        }

        function addSystemMessage(text) {
            const container = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message';
            messageDiv.style.textAlign = 'center';
            messageDiv.style.maxWidth = '100%';
            
            messageDiv.innerHTML = `
                <div style="display: inline-block; background: var(--bg-tertiary); padding: 10px 20px; border-radius: 20px; color: var(--text-secondary); font-style: italic; font-size: 14px;">
                    ${escapeHtml(text)}
                </div>
            `;
            
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
            
            logSystemMessage(text);
        }

        function addUserMessage(text, user, messageId = null) {
            const container = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${user.id === currentUser.id ? 'message-outgoing' : 'message-incoming'}`;
            
            const time = new Date().toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' });
            const msgId = messageId || messageCounter++;
            
            messageDiv.innerHTML = `
                <div class="message-sender">
                    <span class="message-id">#${msgId}</span>
                    ${user.name}
                    ${getRoleBadge(user.role)}
                    ${user.registered ? '<i class="fas fa-check-circle" style="color: var(--accent-blue); font-size: 11px; margin-left: 4px;"></i>' : ''}
                </div>
                <div class="message-text">${escapeHtml(text)}</div>
                <div class="message-time">${time}</div>
            `;
            
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
            
            channels[currentChannel].messages.push({
                id: msgId,
                type: 'user',
                text: text,
                user: user,
                time: new Date()
            });
            
            logUserMessage(user.name, text, currentChannel);
        }

        function getRoleBadge(role) {
            const badges = {
                'owner': '<span class="role-badge role-owner">OWNER</span>',
                'admin': '<span class="role-badge role-admin">ADMIN</span>',
                'coadmin': '<span class="role-badge role-coadmin">COADMIN</span>',
                'operator': '<span class="role-badge role-operator">OP</span>',
                'voice': '<span class="role-badge role-voice">VOICE</span>'
            };
            return badges[role] || '';
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function simulateAutoReply(text) {
            if (Math.random() > 0.6) {
                setTimeout(() => {
                    const otherUsers = users.filter(u => u.id !== currentUser.id && u.online && !u.sleepMode);
                    if (otherUsers.length > 0) {
                        const randomUser = otherUsers[Math.floor(Math.random() * otherUsers.length)];
                        const replies = [
                            "GÃ¼zel bir nokta!",
                            "KatÄ±lÄ±yorum ğŸ‘",
                            "Harika sohbet!",
                            "Popbox Music harika deÄŸil mi? ğŸµ"
                        ];
                        const reply = replies[Math.floor(Math.random() * replies.length)];
                        addUserMessage(reply, randomUser);
                    }
                }, 1000 + Math.random() * 2000);
            }
        }

        // ==================== IRC KOMUT SÄ°STEMÄ° ====================
        function handleCommand(fullCommand) {
            const parts = fullCommand.split(' ');
            const cmd = parts[0].toLowerCase();
            const args = parts.slice(1);
            
            // Ã–zel komutlarÄ± kontrol et
            if (customCommands[cmd]) {
                try {
                    eval(customCommands[cmd]);
                } catch (e) {
                    addSystemMessage(`âŒ Ã–zel komut hatasÄ±: ${e.message}`);
                }
                return;
            }
            
            switch(cmd) {
                // GENEL KOMUTLAR
                case '/nick':
                    if (args.length >= 1) changeNick(args[0]);
                    break;
                case '/join':
                    if (args.length >= 1) joinChannel(args[0]);
                    break;
                case '/leave':
                    leaveChannel();
                    break;
                case '/msg':
                    if (args.length >= 2) sendPrivateMessage(args[0], args.slice(1).join(' '));
                    break;
                case '/me':
                    if (args.length >= 1) sendActionMessage(args.join(' '));
                    break;
                case '/who':
                    listOnlineUsers();
                    break;
                case '/whois':
                    if (args.length >= 1) showUserInfo(args[0]);
                    break;
                case '/clear':
                    clearChat();
                    break;
                    
                // OPERATOR KOMUTLARI
                case '/sil':
                    if (args.length >= 1 && checkPermission('operator')) deleteMessage(args[0]);
                    break;
                case '/kick':
                    if (args.length >= 1 && checkPermission('operator')) kickUser(args[0], args.slice(1).join(' '));
                    break;
                case '/mute':
                    if (args.length >= 2 && checkPermission('operator')) muteUser(args[0], args[1], args.slice(2).join(' '));
                    break;
                case '/unmute':
                    if (args.length >= 1 && checkPermission('operator')) unmuteUser(args[0]);
                    break;
                case '/warn':
                    if (args.length >= 2 && checkPermission('operator')) warnUser(args[0], args.slice(1).join(' '));
                    break;
                case '/topic':
                    if (args.length >= 1 && checkPermission('operator')) changeTopic(args.join(' '));
                    break;
                case '/slowmode':
                    if (args.length >= 1 && checkPermission('operator')) setSlowmode(args[0]);
                    break;
                case '/unslow':
                    if (checkPermission('operator')) unsetSlowmode();
                    break;
                case '/lock':
                    if (checkPermission('operator')) lockChannel();
                    break;
                case '/unlock':
                    if (checkPermission('operator')) unlockChannel();
                    break;
                    
                // COADMIN KOMUTLARI
                case '/ban':
                    if (args.length >= 3 && checkPermission('coadmin')) banUser(args[0], args[1], args.slice(2).join(' '));
                    break;
                case '/unban':
                    if (args.length >= 1 && checkPermission('coadmin')) unbanUser(args[0]);
                    break;
                case '/op':
                    if (args.length >= 1 && checkPermission('coadmin')) giveOp(args[0]);
                    break;
                case '/deop':
                    if (args.length >= 1 && checkPermission('coadmin')) removeOp(args[0]);
                    break;
                case '/voice':
                    if (args.length >= 1 && checkPermission('coadmin')) giveVoice(args[0]);
                    break;
                case '/devoice':
                    if (args.length >= 1 && checkPermission('coadmin')) removeVoice(args[0]);
                    break;
                case '/clearall':
                    if (checkPermission('coadmin')) clearAllMessages();
                    break;
                case '/limit':
                    if (args.length >= 1 && checkPermission('coadmin')) setUserLimit(args[0]);
                    break;
                case '/unlimit':
                    if (checkPermission('coadmin')) removeUserLimit();
                    break;
                    
                // ADMIN KOMUTLARI
                case '/gban':
                    if (args.length >= 3 && checkPermission('admin')) globalBan(args[0], args[1], args.slice(2).join(' '));
                    break;
                case '/gunban':
                    if (args.length >= 1 && checkPermission('admin')) globalUnban(args[0]);
                    break;
                case '/gmute':
                    if (args.length >= 2 && checkPermission('admin')) globalMute(args[0], args[1]);
                    break;
                case '/gunmute':
                    if (args.length >= 1 && checkPermission('admin')) globalUnmute(args[0]);
                    break;
                case '/kanalsil':
                    if (args.length >= 1 && checkPermission('admin')) deleteChannel(args[0]);
                    break;
                case '/kanalkilit':
                    if (args.length >= 1 && checkPermission('admin')) adminLockChannel(args[0]);
                    break;
                case '/kanalac':
                    if (args.length >= 1 && checkPermission('admin')) adminUnlockChannel(args[0]);
                    break;
                case '/yetki':
                    if (args.length >= 3 && checkPermission('admin')) {
                        if (args[0] === 'ver') giveRole(args[1], args[2]);
                        else if (args[0] === 'al') removeRole(args[1]);
                    }
                    break;
                case '/duyuru':
                    if (args.length >= 1 && checkPermission('admin')) sendAnnouncement(args.join(' '));
                    break;
                case '/log':
                    if (args.length >= 1 && checkPermission('admin')) showUserLogs(args[0]);
                    break;
                case '/ip':
                    if (args.length >= 1 && checkPermission('admin')) showUserIP(args[0]);
                    break;
                    
                // OWNER KOMUTLARI
                case '/komutekle':
                    if (args.length >= 2 && checkPermission('owner')) {
                        const cmdParts = fullCommand.split('=>');
                        if (cmdParts.length >= 2) {
                            const cmdName = cmdParts[0].replace('/komutekle', '').trim();
                            const cmdCode = cmdParts[1].trim();
                            addCustomCommand(cmdName, cmdCode);
                        }
                    }
                    break;
                case '/komutsil':
                    if (args.length >= 1 && checkPermission('owner')) removeCustomCommand(args[0]);
                    break;
                case '/komutlar':
                    if (checkPermission('owner')) listCustomCommands();
                    break;
                case '/panel':
                    if (checkPermission('owner')) openOwnerPanel();
                    break;
                case '/herkes':
                    if (args.length >= 1 && checkPermission('owner')) sendToAllChannels(args.join(' '));
                    break;
                case '/resetkanal':
                    if (args.length >= 1 && checkPermission('owner')) resetChannel(args[0]);
                    break;
                case '/resetchat':
                    if (checkPermission('owner')) resetAllChats();
                    break;
                case '/resetyetkiler':
                    if (checkPermission('owner')) resetAllPermissions();
                    break;
                case '/yedekal':
                    if (checkPermission('owner')) backupSystem();
                    break;
                case '/yukle':
                    if (checkPermission('owner')) restoreSystem();
                    break;
                    
                case '/help':
                    openCommandHelp();
                    break;
                    
                default:
                    addSystemMessage(`âŒ Bilinmeyen komut: ${cmd} (/help yazarak yardÄ±m alÄ±n)`);
            }
        }

        // ==================== KOMUT FONKSÄ°YONLARI ====================
        function checkPermission(requiredRole) {
            const channel = channels[currentChannel];
            const userRole = currentUser.role;
            const isChannelOwner = channel.owner === currentUser.id;
            const isOperator = channel.operators.includes(currentUser.id);
            
            const permissions = {
                'owner': userRole === 'owner',
                'admin': userRole === 'admin' || userRole === 'owner',
                'coadmin': isChannelOwner || userRole === 'admin' || userRole === 'owner',
                'operator': isOperator || isChannelOwner || userRole === 'admin' || userRole === 'owner'
            };
            
            if (!permissions[requiredRole]) {
                addSystemMessage('âŒ Bu komutu kullanma yetkiniz yok!');
                return false;
            }
            return true;
        }

        function changeNick(newNick) {
            if (!newNick || newNick.length < 2) {
                addSystemMessage('âŒ GeÃ§ersiz nick!');
                return;
            }
            
            const oldNick = currentUser.name;
            currentUser.name = newNick;
            currentUser.avatar = newNick.charAt(0).toUpperCase();
            
            addSystemMessage(`âœ… Nick deÄŸiÅŸtirildi: ${oldNick} â†’ ${newNick}`);
            updateOnlineList();
        }

        function joinChannel(channelName) {
            if (!channelName.startsWith('#')) channelName = '#' + channelName;
            const channelId = channelName.substring(1).toLowerCase().replace(/[^a-z0-9]/g, '_');
            
            if (!channels[channelId]) {
                addSystemMessage(`âŒ Kanal bulunamadÄ±: ${channelName}`);
                return;
            }
            
            const channel = channels[channelId];
            
            if (channel.locked && !channel.users.includes(currentUser.id) && 
                !checkPermission('admin')) {
                addSystemMessage('âŒ Kanal kilitli!');
                return;
            }
            
            if (channel.userLimit > 0 && channel.users.length >= channel.userLimit) {
                addSystemMessage('âŒ Kanal doldu!');
                return;
            }
            
            if (!channel.users.includes(currentUser.id)) {
                channel.users.push(currentUser.id);
            }
            
            let tabExists = false;
            document.querySelectorAll('.channel-tab').forEach(tab => {
                if (tab.textContent.includes(channel.name.replace('#', ''))) {
                    tabExists = true;
                }
            });
            
            if (!tabExists) {
                const tabs = document.getElementById('channelTabs');
                const tab = document.createElement('div');
                tab.className = 'channel-tab';
                tab.innerHTML = `<i class="fas fa-hashtag"></i> ${channel.name.substring(1)}`;
                tab.onclick = () => switchChannel(channelId);
                tabs.appendChild(tab);
            }
            
            switchChannel(channelId);
            addSystemMessage(`âœ… ${channelName} kanalÄ±na katÄ±ldÄ±nÄ±z`);
        }

        function leaveChannel() {
            if (currentChannel === 'general') {
                addSystemMessage('âŒ Genel kanaldan ayrÄ±lamazsÄ±nÄ±z!');
                return;
            }
            
            const channel = channels[currentChannel];
            const index = channel.users.indexOf(currentUser.id);
            if (index > -1) {
                channel.users.splice(index, 1);
            }
            
            const tabs = document.querySelectorAll('.channel-tab');
            tabs.forEach(tab => {
                if (tab.textContent.includes(channel.name.replace('#', ''))) {
                    tab.remove();
                }
            });
            
            switchChannel('general');
            addSystemMessage(`âœ… ${channel.name} kanalÄ±ndan ayrÄ±ldÄ±nÄ±z`);
        }

        function sendPrivateMessage(targetNick, message) {
            const targetUser = users.find(u => u.name.toLowerCase() === targetNick.toLowerCase());
            if (!targetUser) {
                addSystemMessage(`âŒ KullanÄ±cÄ± bulunamadÄ±: ${targetNick}`);
                return;
            }
            
            const pmKey = [currentUser.id, targetUser.id].sort().join('-');
            if (!privateMessages[pmKey]) {
                privateMessages[pmKey] = [];
            }
            
            privateMessages[pmKey].push({
                from: currentUser.id,
                to: targetUser.id,
                text: message,
                time: new Date()
            });
            
            openPMWindow(targetUser);
            
            addSystemMessage(`ğŸ“¨ ${targetNick} kullanÄ±cÄ±sÄ±na Ã¶zel mesaj gÃ¶nderildi`);
            logPrivateMessage(currentUser.name, targetUser.name, message);
        }

        function sendActionMessage(action) {
            addSystemMessage(`* ${currentUser.name} ${action}`);
        }

        function listOnlineUsers() {
            const onlineUsers = users.filter(u => u.online && !u.sleepMode);
            let message = `ğŸ‘¥ Ã‡evrimiÃ§i KullanÄ±cÄ±lar (${onlineUsers.length}):\n`;
            onlineUsers.forEach(user => {
                message += `â€¢ ${user.name} ${getRoleBadge(user.role)}\n`;
            });
            addSystemMessage(message);
        }

        function showUserInfo(nick) {
            const user = users.find(u => u.name.toLowerCase() === nick.toLowerCase());
            if (!user) {
                addSystemMessage(`âŒ KullanÄ±cÄ± bulunamadÄ±: ${nick}`);
                return;
            }
            
            let info = `ğŸ‘¤ ${user.name} Bilgisi:\n`;
            info += `Rol: ${user.role}\n`;
            info += `Durum: ${user.online ? 'ğŸŸ¢ Ã‡evrimiÃ§i' : 'âš« Ã‡evrimdÄ±ÅŸÄ±'}\n`;
            info += `KayÄ±tlÄ±: ${user.registered ? 'Evet âœ“' : 'HayÄ±r âœ—'}\n`;
            info += `KatÄ±lma: ${user.joinDate.toLocaleDateString()}\n`;
            info += `UyarÄ±lar: ${user.warnings.length}`;
            
            addSystemMessage(info);
        }

        function clearChat() {
            document.getElementById('chatMessages').innerHTML = '';
            addSystemMessage('âœ… Sohbet temizlendi');
        }

        // ==================== OPERATOR FONKSÄ°YONLARI ====================
        function deleteMessage(msgId) {
            const channel = channels[currentChannel];
            const msgIndex = channel.messages.findIndex(m => m.id == msgId);
            if (msgIndex > -1) {
                channel.messages.splice(msgIndex, 1);
                
                const container = document.getElementById('chatMessages');
                const messages = container.querySelectorAll('.message');
                messages.forEach(msg => {
                    const idSpan = msg.querySelector('.message-id');
                    if (idSpan && idSpan.textContent.trim() === `#${msgId}`) {
                        msg.remove();
                    }
                });
                
                addSystemMessage(`âœ… #${msgId} mesajÄ± silindi`);
            } else {
                addSystemMessage('âŒ Mesaj bulunamadÄ±');
            }
        }

        function kickUser(nick, reason = 'Sebep belirtilmedi') {
            const user = users.find(u => u.name.toLowerCase() === nick.toLowerCase());
            if (!user) {
                addSystemMessage(`âŒ KullanÄ±cÄ± bulunamadÄ±: ${nick}`);
                return;
            }
            
            if (user.role === 'owner' || (user.role === 'admin' && currentUser.role !== 'owner')) {
                addSystemMessage('âŒ Bu kullanÄ±cÄ±yÄ± atamazsÄ±nÄ±z!');
                return;
            }
            
            const channel = channels[currentChannel];
            const index = channel.users.indexOf(user.id);
            if (index > -1) {
                channel.users.splice(index, 1);
                addSystemMessage(`ğŸš« ${user.name} ${reason} sebebiyle atÄ±ldÄ±`);
                logAction('KICK', currentUser.name, user.name, reason, currentChannel);
            }
        }

        function muteUser(nick, duration, reason = 'Sebep belirtilmedi') {
            const user = users.find(u => u.name.toLowerCase() === nick.toLowerCase());
            if (!user) {
                addSystemMessage(`âŒ KullanÄ±cÄ± bulunamadÄ±: ${nick}`);
                return;
            }
            
            if (user.role === 'owner' || (user.role === 'admin' && currentUser.role !== 'owner')) {
                addSystemMessage('âŒ Bu kullanÄ±cÄ±yÄ± susturamazsÄ±nÄ±z!');
                return;
            }
            
            const channel = channels[currentChannel];
            const muteEnd = new Date(Date.now() + (parseInt(duration) * 60000));
            
            channel.mutes.push({
                userId: user.id,
                endTime: muteEnd,
                reason: reason,
                by: currentUser.name
            });
            
            addSystemMessage(`ğŸ”‡ ${user.name} ${duration} dakika susturuldu (${reason})`);
            logAction('MUTE', currentUser.name, user.name, `${duration}dak - ${reason}`, currentChannel);
        }

        function isUserMuted(userId, channelId) {
            const channel = channels[channelId];
            if (!channel || !channel.mutes) return false;
            
            const now = new Date();
            const mute = channel.mutes.find(m => m.userId === userId && new Date(m.endTime) > now);
            return !!mute;
        }

        // ==================== COADMIN FONKSÄ°YONLARI ====================
        function banUser(nick, duration, reason = 'Sebep belirtilmedi') {
            const user = users.find(u => u.name.toLowerCase() === nick.toLowerCase());
            if (!user) {
                addSystemMessage(`âŒ KullanÄ±cÄ± bulunamadÄ±: ${nick}`);
                return;
            }
            
            if (user.role === 'owner' || (user.role === 'admin' && currentUser.role !== 'owner')) {
                addSystemMessage('âŒ Bu kullanÄ±cÄ±yÄ± banlayamazsÄ±nÄ±z!');
                return;
            }
            
            const channel = channels[currentChannel];
            const banEnd = new Date(Date.now() + (parseInt(duration) * 60000));
            
            channel.bans.push({
                userId: user.id,
                endTime: banEnd,
                reason: reason,
                by: currentUser.name
            });
            
            const index = channel.users.indexOf(user.id);
            if (index > -1) {
                channel.users.splice(index, 1);
            }
            
            addSystemMessage(`ğŸš« ${user.name} ${duration} dakika banlandÄ± (${reason})`);
            logAction('BAN', currentUser.name, user.name, `${duration}dak - ${reason}`, currentChannel);
        }

        function giveOp(nick) {
            const user = users.find(u => u.name.toLowerCase() === nick.toLowerCase());
            if (!user) {
                addSystemMessage(`âŒ KullanÄ±cÄ± bulunamadÄ±: ${nick}`);
                return;
            }
            
            const channel = channels[currentChannel];
            if (!channel.operators.includes(user.id)) {
                channel.operators.push(user.id);
                user.role = 'operator';
                addSystemMessage(`â­ ${user.name} OP yetkisi aldÄ±`);
            }
        }

        function giveVoice(nick) {
            const user = users.find(u => u.name.toLowerCase() === nick.toLowerCase());
            if (!user) {
                addSystemMessage(`âŒ KullanÄ±cÄ± bulunamadÄ±: ${nick}`);
                return;
            }
            
            const channel = channels[currentChannel];
            if (!channel.voices.includes(user.id)) {
                channel.voices.push(user.id);
                user.role = 'voice';
                addSystemMessage(`ğŸ”Š ${user.name} VOICE yetkisi aldÄ±`);
            }
        }

        // ==================== ADMIN FONKSÄ°YONLARI ====================
        function globalBan(nick, duration, reason = 'Sebep belirtilmedi') {
            const user = users.find(u => u.name.toLowerCase() === nick.toLowerCase());
            if (!user || user.role === 'owner') {
                addSystemMessage('âŒ Bu kullanÄ±cÄ±yÄ± global banlayamazsÄ±nÄ±z!');
                return;
            }
            
            const banEnd = new Date(Date.now() + (parseInt(duration) * 60000));
            
            globalBans.push({
                userId: user.id,
                endTime: banEnd,
                reason: reason,
                by: currentUser.name
            });
            
            user.online = false;
            
            Object.keys(channels).forEach(channelId => {
                const channel = channels[channelId];
                const index = channel.users.indexOf(user.id);
                if (index > -1) {
                    channel.users.splice(index, 1);
                }
            });
            
            addSystemMessage(`ğŸŒ ${user.name} global banlandÄ± (${duration}dak - ${reason})`);
            logAction('GBAN', currentUser.name, user.name, `${duration}dak - ${reason}`, 'GLOBAL');
        }

        function deleteChannel(channelName) {
            if (!channelName.startsWith('#')) channelName = '#' + channelName;
            const channelId = channelName.substring(1).toLowerCase().replace(/[^a-z0-9]/g, '_');
            
            if (!channels[channelId] || channelId === 'general') {
                addSystemMessage('âŒ Kanal silinemez!');
                return;
            }
            
            delete channels[channelId];
            
            const tabs = document.getElementById('channelTabs');
            const tabButtons = tabs.querySelectorAll('.channel-tab');
            tabButtons.forEach(tab => {
                if (tab.textContent.includes(channelName.replace('#', ''))) {
                    tab.remove();
                }
            });
            
            if (currentChannel === channelId) {
                switchChannel('general');
            }
            
            addSystemMessage(`ğŸ—‘ï¸ ${channelName} kanalÄ± silindi`);
        }

        function sendAnnouncement(message) {
            Object.keys(channels).forEach(channelId => {
                const channel = channels[channelId];
                channel.messages.push({
                    type: 'system',
                    text: `ğŸ”” DUYURU: ${message}`,
                    time: new Date()
                });
            });
            
            if (currentChannel !== 'general') {
                addSystemMessage(`ğŸ”” DUYURU: ${message}`);
            }
            
            addSystemMessage('âœ… Sistem duyurusu gÃ¶nderildi');
        }

        // ==================== OWNER FONKSÄ°YONLARI ====================
        function addCustomCommand(cmdName, cmdCode) {
            customCommands['/' + cmdName] = cmdCode;
            addSystemMessage(`âœ… Ã–zel komut eklendi: /${cmdName}`);
            saveToLocalStorage();
        }

        function removeCustomCommand(cmdName) {
            if (customCommands['/' + cmdName]) {
                delete customCommands['/' + cmdName];
                addSystemMessage(`âœ… Ã–zel komut silindi: /${cmdName}`);
                saveToLocalStorage();
            }
        }

        function listCustomCommands() {
            let list = 'ğŸ“œ Ã–zel Komutlar:\n';
            Object.keys(customCommands).forEach(cmd => {
                list += `${cmd} => ${customCommands[cmd]}\n`;
            });
            addSystemMessage(list);
        }

        function sendToAllChannels(message) {
            Object.keys(channels).forEach(channelId => {
                channels[channelId].messages.push({
                    type: 'system',
                    text: `ğŸ“¢ ${message}`,
                    time: new Date(),
                    from: currentUser.name
                });
            });
            
            addSystemMessage(`ğŸ“¢ ${message}`);
        }

        function backupSystem() {
            const backup = {
                users: users,
                channels: channels,
                registeredUsers: registeredUsers,
                customCommands: customCommands,
                date: new Date()
            };
            
            localStorage.setItem('popbox_backup', JSON.stringify(backup));
            addSystemMessage('âœ… Sistem yedeÄŸi alÄ±ndÄ±!');
        }

        function restoreSystem() {
            const backup = localStorage.getItem('popbox_backup');
            if (backup) {
                const data = JSON.parse(backup);
                users = data.users || users;
                channels = data.channels || channels;
                registeredUsers = data.registeredUsers || registeredUsers;
                customCommands = data.customCommands || customCommands;
                
                updateOnlineList();
                loadChannelMessages();
                addSystemMessage('âœ… Sistem yedeÄŸi yÃ¼klendi!');
            } else {
                addSystemMessage('âŒ Yedek bulunamadÄ±!');
            }
        }

        // ==================== DÄ°ÄER FONKSÄ°YONLARI ====================
        function saveToLocalStorage() {
            const data = {
                users: users.filter(u => u.registered),
                channels: channels,
                registeredUsers: registeredUsers,
                customCommands: customCommands
            };
            localStorage.setItem('popbox_data', JSON.stringify(data));
        }

        function loadFromLocalStorage() {
            const data = localStorage.getItem('popbox_data');
            if (data) {
                const parsed = JSON.parse(data);
                users = parsed.users || users;
                channels = parsed.channels || channels;
                registeredUsers = parsed.registeredUsers || registeredUsers;
                customCommands = parsed.customCommands || customCommands;
            }
        }

        function logAction(action, performer, target, reason, location) {
            systemLogs.push({
                action: action,
                performer: performer,
                target: target,
                reason: reason,
                location: location,
                time: new Date(),
                ip: currentUser.ip
            });
        }

        function logSystemMessage(text) {
            systemLogs.push({
                action: 'SYSTEM_MESSAGE',
                text: text,
                time: new Date()
            });
        }

        function logUserMessage(user, text, channel) {
            systemLogs.push({
                action: 'USER_MESSAGE',
                user: user,
                text: text,
                channel: channel,
                time: new Date()
            });
        }

        function logPrivateMessage(from, to, text) {
            systemLogs.push({
                action: 'PRIVATE_MESSAGE',
                from: from,
                to: to,
                text: text,
                time: new Date()
            });
        }

        // ==================== KANAL YÃ–NETÄ°MÄ° ====================
        function switchChannel(channelId) {
            currentChannel = channelId;
            const channel = channels[channelId];
            
            document.querySelectorAll('.channel-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById('currentChannel').innerHTML = `<i class="fas fa-hashtag"></i> ${channel.name.replace('#', '')}`;
            document.getElementById('channelTopic').textContent = channel.topic;
            
            if (channelId === 'general') {
                document.getElementById('videoManagerBtn').classList.add('hidden');
            } else if (channel.owner === currentUser.id || currentUser.role === 'owner' || currentUser.role === 'admin') {
                document.getElementById('videoManagerBtn').classList.remove('hidden');
            } else {
                document.getElementById('videoManagerBtn').classList.add('hidden');
            }
            
            loadChannelMessages();
            updateOnlineList();
            loadChannelVideo();
        }

        function loadChannelMessages() {
            const container = document.getElementById('chatMessages');
            container.innerHTML = '';
            
            const channel = channels[currentChannel];
            if (channel.messages && channel.messages.length > 0) {
                channel.messages.forEach(msg => {
                    if (msg.type === 'system') {
                        const messageDiv = document.createElement('div');
                        messageDiv.className = 'message';
                        messageDiv.style.textAlign = 'center';
                        messageDiv.style.maxWidth = '100%';
                        messageDiv.innerHTML = `
                            <div style="display: inline-block; background: var(--bg-tertiary); padding: 10px 20px; border-radius: 20px; color: var(--text-secondary); font-style: italic; font-size: 14px;">
                                ${escapeHtml(msg.text)}
                            </div>
                        `;
                        container.appendChild(messageDiv);
                    } else {
                        const user = users.find(u => u.id === msg.user.id) || msg.user;
                        addUserMessage(msg.text, user, msg.id);
                    }
                });
            }
            
            container.scrollTop = container.scrollHeight;
        }

        // ==================== ONLINE LÄ°STESÄ° ====================
        function updateOnlineList() {
            const container = document.getElementById('userList');
            const count = document.getElementById('onlineCount');
            const channelUsers = document.getElementById('channelUsers');
            
            container.innerHTML = '';
            
            const channel = channels[currentChannel];
            const channelUserIds = channel?.users || [];
            const channelUsersList = users.filter(user => 
                channelUserIds.includes(user.id) && !user.sleepMode
            );
            
            let onlineCount = 0;
            
            channelUsersList.forEach(user => {
                const item = document.createElement('div');
                item.className = 'user-item';
                item.onclick = () => openPMWindow(user);
                
                item.innerHTML = `
                    <div class="user-avatar" style="${user.online ? 'box-shadow: 0 0 0 2px var(--accent-green);' : ''}">
                        ${user.avatar}
                    </div>
                    <div class="user-info">
                        <div class="user-name">
                            ${user.name}
                            ${getRoleBadge(user.role)}
                        </div>
                        <div class="user-status">
                            ${user.online ? 'ğŸŸ¢ Ã‡evrimiÃ§i' : 'âš« Ã‡evrimdÄ±ÅŸÄ±'}
                            ${user.registered ? 'â€¢ âœ“ KayÄ±tlÄ±' : ''}
                        </div>
                    </div>
                `;
                
                container.appendChild(item);
                if (user.online) onlineCount++;
            });
            
            count.textContent = onlineCount;
            channelUsers.textContent = channelUsersList.length;
        }

        function addFakeUsers() {
            const fakeUsers = [
                { name: 'Ahmet', avatar: 'A', role: 'user' },
                { name: 'AyÅŸe', avatar: 'A', role: 'user' },
                { name: 'Mehmet', avatar: 'M', role: 'user' },
                { name: 'Zeynep', avatar: 'Z', role: 'user' },
                { name: 'Can', avatar: 'C', role: 'user' }
            ];
            
            fakeUsers.forEach(fake => {
                if (!users.find(u => u.name === fake.name)) {
                    const user = {
                        id: fake.name.toLowerCase(),
                        name: fake.name,
                        role: fake.role,
                        registered: Math.random() > 0.5,
                        online: Math.random() > 0.5,
                        sleepMode: false,
                        avatar: fake.avatar,
                        bio: '',
                        ip: generateIP(),
                        joinDate: new Date(),
                        warnings: [],
                        logs: []
                    };
                    users.push(user);
                    
                    if (!channels.general.users.includes(user.id)) {
                        channels.general.users.push(user.id);
                    }
                }
            });
            
            updateOnlineList();
        }

        // ==================== KANAL OLUÅTURMA ====================
        function openCreateChannel() {
            if (!currentUser.registered) {
                alert('Sadece kayÄ±tlÄ± kullanÄ±cÄ±lar kanal aÃ§abilir!');
                return;
            }
            
            if (userChannels[currentUser.id]) {
                alert('Zaten bir kanalÄ±nÄ±z var!');
                return;
            }
            
            document.getElementById('channelName').value = '';
            document.getElementById('channelModal').style.display = 'flex';
        }

        function closeChannelModal() {
            document.getElementById('channelModal').style.display = 'none';
        }

        function createNewChannel() {
            const name = document.getElementById('channelName').value.trim();
            const type = document.getElementById('channelType').value;
            
            if (!name) {
                alert('Kanal adÄ± gerekli!');
                return;
            }
            
            const channelId = name.toLowerCase().replace(/[^a-z0-9]/g, '_');
            
            if (channels[channelId]) {
                alert('Bu kanal adÄ± zaten kullanÄ±lÄ±yor!');
                return;
            }
            
            channels[channelId] = {
                name: '#' + name,
                owner: currentUser.id,
                type: type,
                topic: 'Yeni sohbet kanalÄ±',
                users: [currentUser.id, 'mate'],
                operators: [],
                voices: [],
                bans: [],
                mutes: [],
                slowmode: 0,
                locked: false,
                userLimit: 0,
                messages: [
                    {
                        type: 'system',
                        text: `ğŸ‰ ${currentUser.name} tarafÄ±ndan yeni kanal oluÅŸturuldu!`,
                        time: new Date()
                    }
                ],
                video: {
                    id: 'jfKfPfyJRdk',
                    title: 'Popbox Music'
                }
            };
            
            userChannels[currentUser.id] = channelId;
            
            const tabs = document.getElementById('channelTabs');
            const tab = document.createElement('div');
            tab.className = 'channel-tab';
            tab.innerHTML = `<i class="fas fa-hashtag"></i> ${name}`;
            tab.onclick = () => switchChannel(channelId);
            tabs.appendChild(tab);
            
            switchChannel(channelId);
            closeChannelModal();
            addSystemMessage(`ğŸŠ ${currentUser.name} yeni kanal oluÅŸturdu: #${name}`);
        }

        // ==================== VIDEO SÄ°STEMÄ° ====================
        function openVideoManager() {
            if (currentChannel === 'general') {
                alert('Genel kanalÄ±n videosu deÄŸiÅŸtirilemez!');
                return;
            }
            
            const channel = channels[currentChannel];
            if (channel.owner !== currentUser.id && currentUser.role !== 'owner' && currentUser.role !== 'admin') {
                alert('Sadece kanal sahibi veya adminler video deÄŸiÅŸtirebilir!');
                return;
            }
            
            document.getElementById('videoUrl').value = '';
            document.getElementById('videoTitleInput').value = channel.video?.title || '';
            document.getElementById('videoModal').style.display = 'flex';
        }

        function closeVideoModal() {
            document.getElementById('videoModal').style.display = 'none';
        }

        function saveVideo() {
            const url = document.getElementById('videoUrl').value.trim();
            const title = document.getElementById('videoTitleInput').value.trim();
            
            let videoId = 'jfKfPfyJRdk';
            
            if (url) {
                if (url.includes('youtube.com') || url.includes('youtu.be')) {
                    const match = url.match(/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/);
                    videoId = match ? match[1] : url;
                } else {
                    videoId = url;
                }
            }
            
            channels[currentChannel].video = {
                id: videoId,
                title: title || 'YouTube Video'
            };
            
            document.getElementById('youtubePlayer').src = `https://www.youtube.com/embed/${videoId}?autoplay=1&mute=1&rel=0`;
            document.getElementById('videoTitle').textContent = title;
            
            closeVideoModal();
            addSystemMessage(`ğŸ¥ ${currentUser.name} kanal videosunu gÃ¼ncelledi: ${title}`);
        }

        function loadChannelVideo() {
            const channel = channels[currentChannel];
            if (channel.video) {
                document.getElementById('youtubePlayer').src = `https://www.youtube.com/embed/${channel.video.id}?autoplay=1&mute=1&rel=0`;
                document.getElementById('videoTitle').textContent = channel.video.title;
            }
        }

        // ==================== OWNER PANELÄ° ====================
        function openOwnerPanel() {
            if (currentUser.role !== 'owner') {
                alert('Bu panele eriÅŸim yetkiniz yok!');
                return;
            }
            
            loadOwnerUsers();
            loadPMList();
            loadChannelList();
            loadCustomCommands();
            document.getElementById('ownerModal').style.display = 'flex';
        }

        function closeOwnerModal() {
            document.getElementById('ownerModal').style.display = 'none';
        }

        function switchOwnerTab(tabId) {
            document.querySelectorAll('.owner-tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            document.querySelectorAll('.owner-tab').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById('owner' + tabId.charAt(0).toUpperCase() + tabId.slice(1)).classList.remove('hidden');
            event.target.classList.add('active');
        }

        function loadOwnerUsers() {
            const container = document.getElementById('ownerUserList');
            container.innerHTML = '';
            
            users.forEach(user => {
                const div = document.createElement('div');
                div.className = 'user-item';
                div.style.marginBottom = '10px';
                div.style.border = '1px solid var(--border-light)';
                
                div.innerHTML = `
                    <div class="user-avatar">${user.avatar}</div>
                    <div style="flex: 1;">
                        <div style="font-weight: 600;">${user.name}</div>
                        <div style="font-size: 13px; color: var(--text-secondary);">
                            <span style="color: ${user.role === 'owner' ? '#8b5cf6' : user.role === 'admin' ? '#3b82f6' : 'var(--text-secondary)'}">
                                ${user.role}
                            </span>
                            â€¢ ${user.online ? 'ğŸŸ¢' : 'âš«'}
                            â€¢ IP: ${user.ip}
                            â€¢ ${user.warnings.length} uyarÄ±
                        </div>
                    </div>
                    <div style="display: flex; gap: 5px;">
                        <button onclick="ownerKickUser('${user.id}')" class="btn btn-secondary" style="padding: 6px 12px; font-size: 12px;"><i class="fas fa-user-minus"></i></button>
                        <button onclick="ownerBanUser('${user.id}')" class="btn btn-danger" style="padding: 6px 12px; font-size: 12px;"><i class="fas fa-ban"></i></button>
                        <button onclick="ownerViewLogs('${user.id}')" class="btn" style="padding: 6px 12px; font-size: 12px; background: var(--accent-blue); color: white;"><i class="fas fa-history"></i></button>
                    </div>
                `;
                
                container.appendChild(div);
            });
        }

        function ownerKickUser(userId) {
            const user = users.find(u => u.id === userId);
            if (user && confirm(`${user.name} kullanÄ±cÄ±sÄ±nÄ± atmak istediÄŸinize emin misiniz?`)) {
                user.online = false;
                Object.keys(channels).forEach(channelId => {
                    const channel = channels[channelId];
                    const index = channel.users.indexOf(userId);
                    if (index > -1) {
                        channel.users.splice(index, 1);
                    }
                });
                updateOnlineList();
                loadOwnerUsers();
                addSystemMessage(`ğŸš« ${user.name} kullanÄ±cÄ±sÄ± tÃ¼m kanallardan atÄ±ldÄ±.`);
            }
        }

        function loadPMList() {
            const container = document.getElementById('pmList');
            container.innerHTML = '';
            
            Object.keys(privateMessages).forEach(pmKey => {
                const messages = privateMessages[pmKey];
                if (messages.length > 0) {
                    const usersInPM = pmKey.split('-');
                    const user1 = users.find(u => u.id === usersInPM[0]);
                    const user2 = users.find(u => u.id === usersInPM[1]);
                    
                    if (user1 && user2) {
                        const div = document.createElement('div');
                        div.style.marginBottom: '15px';
                        div.style.padding: '10px';
                        div.style.border: '1px solid var(--border-light)';
                        div.style.borderRadius: '8px';
                        div.style.background: 'var(--bg-tertiary)';
                        
                        div.innerHTML = `
                            <div style="font-weight: 600; margin-bottom: 5px; color: var(--accent-blue);">
                                ${user1.name} â†” ${user2.name}
                            </div>
                            <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 5px;">
                                ${messages.length} mesaj â€¢ Son: ${messages[messages.length-1].time.toLocaleTimeString()}
                            </div>
                            <div style="font-size: 12px; background: var(--bg-primary); padding: 8px; border-radius: 6px; max-height: 100px; overflow-y: auto;">
                                ${messages.slice(-3).map(m => `${m.from}: ${m.text}`).join('<br>')}
                            </div>
                            <button onclick="ownerViewPM('${usersInPM[0]}', '${usersInPM[1]}')" class="btn btn-secondary" style="width: 100%; margin-top: 8px; padding: 5px; font-size: 11px;">
                                <i class="fas fa-eye"></i> TÃ¼m MesajlarÄ± GÃ¶r
                            </button>
                        `;
                        
                        container.appendChild(div);
                    }
                }
            });
        }

        function ownerViewPM(userId1, userId2) {
            const pmKey = [userId1, userId2].sort().join('-');
            const messages = privateMessages[pmKey] || [];
            const user1 = users.find(u => u.id === userId1);
            const user2 = users.find(u => u.id === userId2);
            
            let messageLog = `ğŸ“¨ ${user1?.name} â†” ${user2?.name} Ã–zel MesajlarÄ±:\n\n`;
            messages.forEach(msg => {
                const time = new Date(msg.time).toLocaleTimeString();
                messageLog += `[${time}] ${msg.from}: ${msg.text}\n`;
            });
            
            alert(messageLog);
        }

        function loadCustomCommands() {
            const container = document.getElementById('customCommandsList');
            container.innerHTML = '';
            
            Object.keys(customCommands).forEach(cmd => {
                const div = document.createElement('div');
                div.style.marginBottom: '10px';
                div.style.padding: '10px';
                div.style.border: '1px solid var(--border-light)';
                div.style.borderRadius: '8px';
                div.style.background: 'var(--bg-tertiary)';
                
                div.innerHTML = `
                    <div style="font-weight: 600; color: var(--accent-blue);">${cmd}</div>
                    <div style="font-size: 12px; color: var(--text-secondary); font-family: monospace; margin-top: 5px;">${customCommands[cmd]}</div>
                    <button onclick="removeCustomCommandFromList('${cmd.replace('/', '')}')" class="btn btn-danger" style="width: 100%; margin-top: 8px; padding: 5px; font-size: 11px;">
                        <i class="fas fa-trash"></i> Sil
                    </button>
                `;
                
                container.appendChild(div);
            });
        }

        function removeCustomCommandFromList(cmdName) {
            if (confirm(`${cmdName} komutunu silmek istediÄŸinize emin misiniz?`)) {
                removeCustomCommand(cmdName);
                loadCustomCommands();
            }
        }

        // ==================== ADMIN PANELÄ° ====================
        function openAdminPanel() {
            if (currentUser.role !== 'admin' && currentUser.role !== 'owner') {
                alert('Bu panele eriÅŸim yetkiniz yok!');
                return;
            }
            
            loadBanList();
            loadMuteList();
            loadAdminChannels();
            loadLogList();
            document.getElementById('adminModal').style.display = 'flex';
        }

        function closeAdminModal() {
            document.getElementById('adminModal').style.display = 'none';
        }

        function switchAdminTab(tabId) {
            document.querySelectorAll('.owner-tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            document.querySelectorAll('.owner-tab').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById('admin' + tabId.charAt(0).toUpperCase() + tabId.slice(1)).classList.remove('hidden');
            event.target.classList.add('active');
        }

        function loadBanList() {
            const container = document.getElementById('banList');
            container.innerHTML = '';
            
            globalBans.forEach(ban => {
                const user = users.find(u => u.id === ban.userId);
                if (user) {
                    const div = document.createElement('div');
                    div.className = 'ban-item';
                    
                    div.innerHTML = `
                        <div style="font-weight: 600;">${user.name}</div>
                        <div style="font-size: 12px; color: var(--text-secondary);">
                            Sebep: ${ban.reason}<br>
                            SÃ¼re: ${ban.endTime.toLocaleString()}<br>
                            Banlayan: ${ban.by}
                        </div>
                        <button onclick="adminUnban('${user.id}')" class="btn btn-success" style="width: 100%; margin-top: 8px; padding: 5px; font-size: 11px;">
                            <i class="fas fa-unlock"></i> BanÄ± KaldÄ±r
                        </button>
                    `;
                    
                    container.appendChild(div);
                }
            });
        }

        function adminUnban(userId) {
            const index = globalBans.findIndex(b => b.userId === userId);
            if (index > -1) {
                globalBans.splice(index, 1);
                loadBanList();
                addSystemMessage(`âœ… KullanÄ±cÄ±nÄ±n global banÄ± kaldÄ±rÄ±ldÄ±`);
            }
        }

        function loadLogList() {
            const container = document.getElementById('logList');
            container.innerHTML = '';
            
            const recentLogs = systemLogs.slice(-50).reverse();
            
            recentLogs.forEach(log => {
                const div = document.createElement('div');
                div.style.padding: '8px';
                div.style.borderBottom = '1px solid var(--border-light)';
                div.style.fontSize = '12px';
                
                let logText = '';
                if (log.action === 'USER_MESSAGE') {
                    logText = `ğŸ’¬ ${log.user}: ${log.text}`;
                } else if (log.action === 'PRIVATE_MESSAGE') {
                    logText = `ğŸ“¨ ${log.from} â†’ ${log.to}: ${log.text}`;
                } else if (log.action === 'KICK' || log.action === 'BAN' || log.action === 'MUTE') {
                    logText = `âš ï¸ ${log.performer} ${log.action} ${log.target}: ${log.reason}`;
                } else if (log.action === 'SYSTEM_MESSAGE') {
                    logText = `ğŸ”” ${log.text}`;
                }
                
                div.innerHTML = `
                    <div style="color: var(--text-secondary); font-size: 10px;">${log.time.toLocaleTimeString()}</div>
                    <div>${logText}</div>
                `;
                
                container.appendChild(div);
            });
        }

        // ==================== IRC MODAL ====================
        function openIRC() {
            document.getElementById('ircModal').style.display = 'flex';
        }

        function closeIRCModal() {
            document.getElementById('ircModal').style.display = 'none';
        }

        function handleIRCKeyPress(e) {
            if (e.key === 'Enter') {
                const command = document.getElementById('ircCommand').value.trim();
                if (command) {
                    executeIRCCommand(command);
                    document.getElementById('ircCommand').value = '';
                }
            }
        }

        function executeIRCCommand(fullCommand) {
            const output = document.getElementById('ircOutput');
            const parts = fullCommand.split(' ');
            const cmd = parts[0].toLowerCase();
            
            let result = '';
            
            if (cmd.startsWith('/')) {
                handleCommand(fullCommand);
                result = `<span style="color: var(--accent-green);">âœ… Komut Ã§alÄ±ÅŸtÄ±rÄ±ldÄ±: ${fullCommand}</span>`;
            } else {
                result = `<span style="color: var(--accent-red);">âŒ Komut / ile baÅŸlamalÄ±!</span>`;
            }
            
            const div = document.createElement('div');
            div.style.padding = '10px 0';
            div.style.borderBottom = '1px solid var(--border-light)';
            div.innerHTML = `<div style="color: var(--accent-blue); margin-bottom: 5px;"><strong>> ${fullCommand}</strong></div>${result}`;
            output.appendChild(div);
            output.scrollTop = output.scrollHeight;
            
            ircHistory.push({ command: fullCommand, result: result });
        }

        function clearIRC() {
            document.getElementById('ircOutput').innerHTML = `
                <div style="color: var(--text-secondary); margin-bottom: 10px;">
                    <strong>IRC Komut Konsolu</strong><br>
                    KomutlarÄ± buraya yazabilirsiniz
                </div>
            `;
        }

        // ==================== YARDIM MODAL ====================
        function openCommandHelp() {
            document.getElementById('helpModal').style.display = 'flex';
        }

        function closeHelpModal() {
            document.getElementById('helpModal').style.display = 'none';
        }

        // ==================== Ã–ZEL MESAJ PENCERESÄ° ====================
        function openPMWindow(user) {
            if (user.id === currentUser.id) return;
            
            const pmKey = [currentUser.id, user.id].sort().join('-');
            
            if (pmWindows[pmKey]) {
                pmWindows[pmKey].style.display = 'flex';
                return;
            }
            
            const pmWindow = document.createElement('div');
            pmWindow.className = 'pm-window';
            pmWindow.id = `pm-${pmKey}`;
            
            pmWindow.innerHTML = `
                <div class="pm-header">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div style="font-weight: 600;">ğŸ’¬ ${user.name}</div>
                        <button onclick="closePMWindow('${pmKey}')" style="background: none; border: none; color: var(--text-secondary); cursor: pointer;">Ã—</button>
                    </div>
                </div>
                <div class="pm-messages" id="pm-messages-${pmKey}"></div>
                <div class="pm-input">
                    <input type="text" id="pm-input-${pmKey}" style="width: 100%; padding: 8px; background: var(--bg-tertiary); border: 1px solid var(--border-light); color: var(--text-primary); border-radius: 6px;" 
                           placeholder="Mesaj yazÄ±n..." 
                           onkeydown="handlePMKeyPress(event, '${user.name}')">
                </div>
            `;
            
            document.body.appendChild(pmWindow);
            pmWindows[pmKey] = pmWindow;
            
            loadPMMessages(pmKey);
        }

        function closePMWindow(pmKey) {
            const pmWindow = document.getElementById(`pm-${pmKey}`);
            if (pmWindow) {
                pmWindow.style.display = 'none';
            }
        }

        function handlePMKeyPress(e, targetNick) {
            if (e.key === 'Enter') {
                const input = e.target;
                const message = input.value.trim();
                if (message) {
                    sendPrivateMessage(targetNick, message);
                    input.value = '';
                    
                    const pmKey = [currentUser.id, targetNick.toLowerCase()].sort().join('-');
                    loadPMMessages(pmKey);
                }
            }
        }

        function loadPMMessages(pmKey) {
            const container = document.getElementById(`pm-messages-${pmKey}`);
            if (!container) return;
            
            container.innerHTML = '';
            const messages = privateMessages[pmKey] || [];
            
            messages.forEach(msg => {
                const div = document.createElement('div');
                div.style.marginBottom = '10px';
                div.style.padding = '8px';
                div.style.background = msg.from === currentUser.id ? 'var(--accent-blue)' : 'var(--bg-tertiary)';
                div.style.color = msg.from === currentUser.id ? 'white' : 'var(--text-primary)';
                div.style.borderRadius = '8px';
                div.style.maxWidth = '80%';
                div.style.marginLeft = msg.from === currentUser.id ? 'auto' : '0';
                
                const time = new Date(msg.time).toLocaleTimeString();
                div.innerHTML = `
                    <div style="font-size: 11px; opacity: 0.8; margin-bottom: 2px;">${msg.from === currentUser.id ? 'Siz' : msg.from}</div>
                    <div>${escapeHtml(msg.text)}</div>
                    <div style="font-size: 10px; opacity: 0.6; text-align: right;">${time}</div>
                `;
                
                container.appendChild(div);
            });
            
            container.scrollTop = container.scrollHeight;
        }

        // ==================== PROFÄ°L SÄ°STEMÄ° ====================
        function openProfile() {
            document.getElementById('profileNick').value = currentUser.name;
            document.getElementById('profileAvatar').textContent = currentUser.avatar;
            document.getElementById('profileBio').value = currentUser.bio || '';
            document.getElementById('sleepMode').checked = currentUser.sleepMode;
            document.getElementById('profileModal').style.display = 'flex';
        }

        function closeProfileModal() {
            document.getElementById('profileModal').style.display = 'none';
        }

        function changeAvatar() {
            const newAvatar = prompt('Yeni avatar karakteri (1 karakter):', currentUser.avatar);
            if (newAvatar && newAvatar.length === 1) {
                currentUser.avatar = newAvatar;
                document.getElementById('profileAvatar').textContent = currentUser.avatar;
                updateOnlineList();
            }
        }

        function saveProfile() {
            const newNick = document.getElementById('profileNick').value.trim();
            const bio = document.getElementById('profileBio').value.trim();
            const sleepMode = document.getElementById('sleepMode').checked;
            
            if (newNick && newNick !== currentUser.name) {
                const oldNick = currentUser.name;
                currentUser.name = newNick;
                currentUser.avatar = newNick.charAt(0).toUpperCase();
                addSystemMessage(`âœ… Nick deÄŸiÅŸtirildi: ${oldNick} â†’ ${newNick}`);
            }
            
            currentUser.bio = bio;
            currentUser.sleepMode = sleepMode;
            
            closeProfileModal();
            updateOnlineList();
            addSystemMessage('âœ… Profil ayarlarÄ±nÄ±z gÃ¼ncellendi.');
        }

        // ==================== DÄ°ÄER FONKSÄ°YONLAR ====================
        function toggleTheme() {
            if (theme === 'night') {
                document.body.classList.add('day-mode');
                document.body.classList.remove('night-mode');
                theme = 'day';
            } else {
                document.body.classList.add('night-mode');
                document.body.classList.remove('day-mode');
                theme = 'night';
            }
        }

        // ==================== BAÅLANGIÃ‡ ====================
        document.addEventListener('DOMContentLoaded', function() {
            loadFromLocalStorage();
            
            document.getElementById('nickInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') handleLogin();
            });
            
            document.getElementById('passInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') handleLogin();
            });
            
            setTimeout(() => {
                if (document.getElementById('loginScreen').classList.contains('hidden')) {
                    addSystemMessage('ğŸ¤– MATE: Popbox Elite IRC sistemine hoÅŸ geldiniz!');
                }
            }, 1000);
        });
    </script>
</body>
</html>
