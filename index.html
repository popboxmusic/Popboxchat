<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CETCETY â€¢ SON</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- FIREBASE -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    
    <style>
        /* TÃœM STÄ°LLER AYNI - DEÄžÄ°ÅžTÄ°RME */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background: #0f0f0f; color: #fff; overflow: hidden; height: 100vh; }
        .app { display: flex; height: 100vh; width: 100vw; }

        /* GÄ°RÄ°Åž */
        .login-overlay {
            position: fixed; inset: 0; background: #0a0a0a; z-index: 1000;
            background-image: radial-gradient(rgba(255,0,0,0.2) 1px, transparent 1px);
            background-size: 40px 40px;
            display: flex; align-items: center; justify-content: center;
        }
        .login-overlay::before {
            content: ''; position: absolute; inset: 0;
            backdrop-filter: blur(8px);
        }
        .login-overlay.hidden { display: none; }
        .login-panel {
            width: 380px; background: rgba(20,20,20,0.9); border: 1px solid #ff0000;
            border-radius: 24px; padding: 32px; position: relative; z-index: 10;
        }
        .login-panel h2 { text-align: center; color: #ff0000; margin-bottom: 24px; }
        .login-panel input {
            width: 100%; padding: 14px; background: #1a1a1a; border: 1px solid #333;
            border-radius: 12px; color: #fff; margin-bottom: 16px;
        }
        .login-panel button {
            width: 100%; padding: 14px; background: #ff0000; border: none;
            border-radius: 12px; color: #fff; font-weight: bold; cursor: pointer;
        }
        .login-info { text-align: center; margin-top: 16px; color: #aaa; }

        /* ANA UYGULAMA - SADE HALÄ° (Ã–NCE Ã‡ALIÅžSIN) */
        .app { display: flex; height: 100vh; width: 100vw; }
        .main-content { flex: 1; display: flex; overflow: hidden; }
        .chat-container { flex: 1; display: flex; flex-direction: column; background: #0f0f0f; }
        .chat-header { padding: 16px; border-bottom: 1px solid #333; }
        .messages { flex: 1; overflow-y: auto; padding: 16px; }
        .message { margin-bottom: 8px; }
        .message-input-container { padding: 16px; border-top: 1px solid #333; }
        .input-wrapper { display: flex; background: #1a1a1a; border-radius: 24px; }
        .message-input { flex: 1; padding: 12px; background: transparent; border: none; color: #fff; }
        .send-btn { width: 44px; height: 44px; background: #ff0000; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; }
    </style>
</head>
<body>
    <!-- GÄ°RÄ°Åž -->
    <div id="loginOverlay" class="login-overlay">
        <div class="login-panel">
            <h2>ðŸŽ§ CETCETY</h2>
            <input type="text" id="loginNick" placeholder="KullanÄ±cÄ± adÄ±">
            <input type="password" id="loginPassword" placeholder="Åžifre">
            <button onclick="handleLogin()">GÄ°RÄ°Åž YAP</button>
            <div class="login-info">Owner: mateky / Åžifre: Sahi17407@SCM</div>
        </div>
    </div>

    <!-- ANA SAYFA -->
    <div id="app" class="app" style="display: none;">
        <div class="main-content">
            <div class="chat-container">
                <div class="chat-header">
                    <span id="currentChannelName">genel</span> - 
                    <span id="channelUserCount">0</span> Ã§evrimiÃ§i
                </div>
                <div class="messages" id="messages"></div>
                <div class="message-input-container">
                    <div class="input-wrapper">
                        <input type="text" id="messageInput" class="message-input" placeholder="Mesaj yaz..." onkeypress="if(event.key==='Enter') sendMessage()">
                        <div class="send-btn" onclick="sendMessage()"><i class="fas fa-paper-plane"></i></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ========== FIREBASE ==========
        const firebaseConfig = {
            apiKey: "AIzaSyCrn_tXJZCAlKhem45aXxj4f0h26EPOQ70",
            authDomain: "popboxmusicchat.firebaseapp.com",
            databaseURL: "https://popboxmusicchat-default-rtdb.firebaseio.com",
            projectId: "popboxmusicchat"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        console.log('ðŸ”¥ Firebase baÅŸladÄ±');

        // ========== GLOBAL ==========
        let user = null;
        let currentChannel = 'genel';
        const OWNER_PASS = 'Sahi17407@SCM';

        // ========== GÄ°RÄ°Åž ==========
        function handleLogin() {
            const nick = document.getElementById('loginNick').value.trim();
            const pass = document.getElementById('loginPassword').value.trim();
            if (!nick) return alert('Nick gerekli');

            if (nick === 'mateky' && pass !== OWNER_PASS) 
                return alert('âŒ Owner ÅŸifre hatalÄ±');

            user = {
                id: Date.now(),
                name: nick,
                role: nick === 'mateky' ? 'owner' : 'user',
                avatar: nick[0].toUpperCase()
            };

            // Firebase'e ekle
            const userRef = db.ref(`online/${currentChannel}/${user.id}`);
            userRef.set({ name: user.name, role: user.role });
            userRef.onDisconnect().remove();

            // UI gÃ¶ster
            document.getElementById('loginOverlay').classList.add('hidden');
            document.getElementById('app').style.display = 'flex';
            document.getElementById('messages').innerHTML = '';

            // MesajlarÄ± dinle
            db.ref(`chats/${currentChannel}`).off();
            db.ref(`chats/${currentChannel}`).on('child_added', (snap) => {
                const msg = snap.val();
                if (msg.sender !== user.name) {
                    const div = document.createElement('div');
                    div.className = 'message';
                    div.innerHTML = `<b>${msg.sender}:</b> ${msg.text}`;
                    document.getElementById('messages').appendChild(div);
                }
            });

            // Online sayÄ±sÄ±nÄ± dinle
            db.ref(`online/${currentChannel}`).on('value', (snap) => {
                const users = snap.val();
                const count = users ? Object.keys(users).length : 0;
                document.getElementById('channelUserCount').textContent = count;
            });

            // HoÅŸgeldin mesajÄ±
            const div = document.createElement('div');
            div.className = 'message';
            div.innerHTML = `<b>Sistem:</b> ðŸ‘‹ HoÅŸ geldin ${user.name}`;
            document.getElementById('messages').appendChild(div);
        }

        // ========== MESAJ GÃ–NDER ==========
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const text = input.value.trim();
            if (!text || !user) return;

            db.ref(`chats/${currentChannel}`).push({
                sender: user.name,
                text: text,
                time: Date.now()
            });

            // Kendi mesajÄ±nÄ± gÃ¶ster
            const div = document.createElement('div');
            div.className = 'message';
            div.style.textAlign = 'right';
            div.innerHTML = `<b>${user.name}:</b> ${text}`;
            document.getElementById('messages').appendChild(div);

            input.value = '';
        }
    </script>
</body>
</html>
