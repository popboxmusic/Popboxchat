<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Canlı Yayın & Sohbet</title>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-database-compat.js"></script>

  <!-- CryptoJS for password hash -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: system-ui, sans-serif;
      background: #0d0d0d;
      color: #e0e0e0;
      height: 100vh;
      overflow: hidden;
    }
    #login-container {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background: #111;
    }
    #login-container input {
      width: 300px;
      margin-bottom: 10px;
      padding: 10px;
      border-radius: 8px;
      border: none;
      background: #222;
      color: white;
    }
    #login-container button {
      width: 300px;
      padding: 10px;
      border-radius: 8px;
      background: #ff3366;
      color: white;
      border: none;
      cursor: pointer;
    }
    #login-container p {
      margin-top: 10px;
      cursor: pointer;
      color: #aaa;
    }
    #chat-container {
      display: none;
      flex-direction: column;
      height: 100vh;
    }
    #header {
      background: #1a1a1a;
      padding: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    #header span {
      font-weight: bold;
    }
    #header button {
      background: #ff3366;
      border: none;
      padding: 5px 10px;
      color: white;
      border-radius: 4px;
      cursor: pointer;
    }
    #main {
      flex: 1;
      display: flex;
    }
    #video-area {
      flex: 2;
      background: black;
    }
    #video-area iframe {
      width: 100%;
      height: 100%;
    }
    #sohbet-area {
      flex: 1;
      display: flex;
      flex-direction: column;
      background: #111;
    }
    #mesajlar {
      flex: 1;
      overflow-y: auto;
      padding: 10px;
    }
    .mesaj {
      margin-bottom: 10px;
      padding: 10px;
      border-radius: 8px;
      max-width: 70%;
    }
    .mesaj.kendi {
      background: #ff3366;
      color: white;
      margin-left: auto;
    }
    .mesaj.baska {
      background: #333;
    }
    .mesaj img {
      max-width: 100%;
      border-radius: 8px;
    }
    #gonder-area {
      display: flex;
      padding: 10px;
      background: #1a1a1a;
      border-top: 1px solid #333;
    }
    #gonder-area input {
      flex: 1;
      padding: 10px;
      border-radius: 8px;
      background: #222;
      color: white;
      border: none;
    }
    #gonder-area button {
      background: #ff3366;
      border: none;
      padding: 10px;
      color: white;
      border-radius: 8px;
      margin-left: 10px;
      cursor: pointer;
    }
    #online-listesi {
      width: 200px;
      background: #0a0a0a;
      padding: 10px;
      overflow-y: auto;
      border-left: 1px solid #333;
    }
    #online-listesi h3 {
      margin-bottom: 10px;
    }
    .online-nick {
      margin-bottom: 5px;
      cursor: pointer;
    }
    .online-nick.blink {
      color: #ff3366;
      animation: blink 1s infinite;
    }
    @keyframes blink {
      50% { opacity: 0.5; }
    }
    #ozel-panel {
      position: fixed;
      bottom: 10px;
      right: 10px;
      width: 300px;
      height: 400px;
      background: #111;
      border: 1px solid #333;
      border-radius: 8px;
      display: none;
      flex-direction: column;
    }
    #ozel-header {
      background: #1a1a1a;
      padding: 10px;
      display: flex;
      justify-content: space-between;
    }
    #ozel-mesajlar {
      flex: 1;
      overflow-y: auto;
      padding: 10px;
    }
    #ozel-gonder-area {
      display: flex;
      padding: 10px;
      background: #1a1a1a;
      border-top: 1px solid #333;
    }
    #ozel-gonder-area input {
      flex: 1;
      padding: 10px;
      border-radius: 8px;
      background: #222;
      color: white;
      border: none;
    }
    #ozel-gonder-area button {
      background: #ff3366;
      border: none;
      padding: 10px;
      color: white;
      border-radius: 8px;
      margin-left: 10px;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <!-- Giriş Ekranı -->
  <div id="login-container">
    <input id="nick" placeholder="Nick" />
    <input id="sifre" type="password" placeholder="Şifre" />
    <button id="gir">Giriş Yap</button>
    <p id="kayit">Kayıt Ol</p>
  </div>

  <!-- Sohbet Ekranı -->
  <div id="chat-container" style="display: none;">
    <div id="header">
      <span id="kullanici">Hoş geldin</span>
      <button id="cikis">Çıkış</button>
    </div>
    <div id="main">
      <div id="video-area">
        <iframe src="https://www.youtube.com/embed/RN4h0sBtzlc?autoplay=1" frameborder="0" allowfullscreen></iframe>
      </div>
      <div id="sohbet-area">
        <div id="mesajlar"></div>
        <div id="gonder-area">
          <input id="mesaj" placeholder="Mesaj" />
          <button id="gonder">Gönder</button>
        </div>
      </div>
      <div id="online-listesi">
        <h3>Online</h3>
      </div>
    </div>
  </div>

  <!-- Özel Mesaj Penceresi -->
  <div id="ozel-panel">
    <div id="ozel-header">
      <span id="ozel-kim"></span>
      <button id="ozel-kapat">Kapat</button>
    </div>
    <div id="ozel-mesajlar"></div>
    <div id="ozel-gonder-area">
      <input id="ozel-mesaj" placeholder="Mesaj" />
      <button id="ozel-gonder">Gönder</button>
      <button id="ozel-resim">Resim</button>
    </div>
  </div>

  <script>
    const firebaseConfig = {
      // Senin Firebase config
      apiKey: "AIzaSyCrn_tXJZCAlKhem45aXxj4f0h26EPOQ70",
      authDomain: "popboxmusicchat.firebaseapp.com",
      databaseURL: "https://popboxmusicchat-default-rtdb.firebaseio.com",
      projectId: "popboxmusicchat",
      storageBucket: "popboxmusicchat.appspot.com",
      messagingSenderId: "206625719024",
      appId: "1:206625719024:web:d28f478a2c96d10412f835",
      measurementId: "G-SB1K22FLEX"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let currentUser = null;
    let currentUid = null;
    let currentRole = 'kullanici';
    let ozelKisi = null;

    // Kayıt / Giriş Toggle
    document.getElementById('kayit').addEventListener('click', () => {
      document.getElementById('gir').textContent = 'Kayıt Ol';
    });

    // Giriş / Kayıt
    document.getElementById('gir').addEventListener('click', () => {
      const nick = document.getElementById('nick').value;
      const sifre = document.getElementById('sifre').value;
      const butonText = document.getElementById('gir').textContent;

      if (butonText === 'Kayıt Ol') {
        db.ref('users/' + nick).set({
          sifre: CryptoJS.MD5(sifre).toString(),
          role: 'kullanici',
          online: true
        }).then(() => {
          localStorage.setItem('nick', nick);
          currentUser = nick;
          currentUid = nick; // Nick'i UID gibi kullan
          currentRole = 'kullanici';
          document.getElementById('login-container').style.display = 'none';
          document.getElementById('chat-container').style.display = 'flex';
          document.getElementById('kullanici').textContent = `Hoş geldin, ${nick}`;
        }).catch(err => alert("Kayıt hatası: " + err));
      } else {
        db.ref('users/' + nick).once('value').then(snapshot => {
          const data = snapshot.val();
          if (data && data.sifre === CryptoJS.MD5(sifre).toString()) {
            localStorage.setItem('nick', nick);
            currentUser = nick;
            currentUid = nick;
            currentRole = data.role;
            document.getElementById('login-container').style.display = 'none';
            document.getElementById('chat-container').style.display = 'flex';
            document.getElementById('kullanici').textContent = `Hoş geldin, ${nick}`;
          } else {
            alert("Yanlış nick veya şifre");
          }
        });
      }
    });

    // Çıkış
    document.getElementById('cikis').addEventListener('click', () => {
      localStorage.removeItem('nick');
      location.reload();
    });

    // Otomatik giriş
    if (localStorage.getElementById('nick')) {
      currentUser = localStorage.getElementById('nick');
      document.getElementById('login-container').style.display = 'none';
      document.getElementById('chat-container').style.display = 'flex';
      document.getElementById('kullanici').textContent = `Hoş geldin, ${currentUser}`;
    }

    // Online listesi
    db.ref('users').on('value', snapshot => {
      const online = document.getElementById('online-listesi');
      online.innerHTML = '<h3>Online</h3>';
      snapshot.forEach(childSnapshot => {
        const childData = childSnapshot.val();
        if (childData.online) {
          const div = document.createElement('div');
          div.className = 'online-nick';
          div.textContent = childData.nick;
          div.addEventListener('click', () => {
            ozelKisi = childData.nick;
            document.getElementById('ozel-panel').style.display = 'flex';
            document.getElementById('ozel-kim').textContent = ozelKisi;
          });
          online.appendChild(div);
        }
      });
    });

    // Genel mesaj gönderme
    document.getElementById('gonder').addEventListener('click', () => {
      const mesaj = document.getElementById('mesaj').value;
      db.ref('mesajlar').push({
        nick: currentUser,
        mesaj: mesaj
      });
      document.getElementById('mesaj').value = '';
    });

    // Genel mesajlar
    db.ref('mesajlar').on('child_added', snapshot => {
      const data = snapshot.val();
      const div = document.createElement('div');
      div.className = 'mesaj ' + (data.nick === currentUser ? 'kendi' : 'baska');
      div.textContent = data.nick + ': ' + data.mesaj;
      div.addEventListener('click', () => {
        if (data.nick === currentUser) {
          db.ref('mesajlar/' + snapshot.key).remove();
        }
      });
      document.getElementById('mesajlar').appendChild(div);
    });

    // Özel mesaj gönderme
    document.getElementById('ozel-gonder').addEventListener('click', () => {
      const mesaj = document.getElementById('ozel-mesaj').value;
      db.ref('ozel/' + ozelKisi).push({
        nick: currentUser,
        mesaj: mesaj
      });
      document.getElementById('ozel-mesaj').value = '';
    });

    // Özel mesajlar
    db.ref('ozel/' + currentUser).on('child_added', snapshot => {
      const data = snapshot.val();
      const div = document.createElement('div');
      div.className = 'mesaj ' + (data.nick === currentUser ? 'kendi' : 'baska');
      div.textContent = data.nick + ': ' + data.mesaj;
      div.addEventListener('click', () => {
        if (data.nick === currentUser) {
          db.ref('ozel/' + ozelKisi + '/' + snapshot.key).remove();
        }
      });
      document.getElementById('ozel-mesajlar').appendChild(div);
      document.getElementById('online-listesi').querySelector(`[data-nick="${data.nick}"]`).classList.add('blink');
      setTimeout(() => document.getElementById('online-listesi').querySelector(`[data-nick="${data.nick}"]`).classList.remove('blink'), 3000);
    });

    // Özel pencere kapat
    document.getElementById('ozel-kapat').addEventListener('click', () => {
      document.getElementById('ozel-panel').style.display = 'none';
    });

    // Resim gönderme (Base64)
    document.getElementById('ozel-resim').addEventListener('click', () => {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = 'image/*';
      input.onchange = e => {
        const reader = new FileReader();
        reader.readAsDataURL(e.target.files[0]);
        reader.onload = () => {
          db.ref('ozel/' + ozelKisi).push({
            nick: currentUser,
            mesaj: reader.result
          });
        };
      };
      input.click();
    });

    // Yetki komutları (genel sohbette /komut şeklinde)
    // Örnek: /coadmin [nick], /operator [nick], /kick [nick], /temiz, /spamengelle [nick], /sil (son mesaj)

    // Komutları sendPublicMessage içinde kontrol et (önceki kodlarda olduğu gibi)
  </script>
</body>
</html>
