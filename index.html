<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Popbox Music Chat - GeliÅŸmiÅŸ Sohbet Platformu</title>
    <!-- FIREBASE SDK v8 -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    
    <style>
        /* ... CSS kodlarÄ± aynÄ± kalacak ... */
        /* CSS kodlarÄ± tamamen aynÄ±, burada tekrar yazmÄ±yorum */
    </style>
</head>
<body class="youtube-live-mode">
    <!-- ... HTML yapÄ±sÄ± aynÄ± ... -->
    
    <script>
        // ========== GÃœVENLÄ°K KONFÄ°GÃœRASYONU ==========
        const SECURE_CONFIG = {
            DEFAULT_ADMINS: ['popbox', 'popboxmusic', 'admin', 'moderator'],
            OWNER_CONFIG: {
                username: 'MateKy',
                role: 'owner',
                password: 'Sahi17407@SCM',
                isHidden: true
            },
            BOT_CONFIG: {
                name: 'MateB Security Bot',
                securityLevel: 'high',
                welcomeMessages: [
                    "ğŸ‰ {user} aramÄ±za hoÅŸ geldin! GÃ¼venli sohbetin keyfini Ã§Ä±kar!",
                    "ğŸ›¡ï¸ Merhaba {user}! MateB botu sizi koruyor.",
                    "ğŸ‘‹ HoÅŸ geldin {user}! Kurallara uymayÄ± unutmayÄ±n!"
                ],
                autoMessages: [
                    "ğŸ’¡ Ä°pucu: /yardÄ±m yazarak tÃ¼m komutlarÄ± gÃ¶rebilirsin!",
                    "ğŸ‘¥ Online kullanÄ±cÄ±larÄ± gÃ¶rmek iÃ§in /online yazÄ±n!",
                    "â¤ï¸ Abone olarak Ã¶zel Ã¶zelliklere eriÅŸin! /abone",
                    "ğŸ“± Instagram gibi story paylaÅŸÄ±n! /story",
                    "ğŸ”’ Ã–zel sohbet iÃ§in kullanÄ±cÄ±ya saÄŸ tÄ±klayÄ±n!"
                ],
                messageInterval: 300000,
                welcomeDelay: 1000,
                maxMessagesPerHour: 3
            },
            YOUTUBE_SUBSCRIPTION_PLANS: {
                standart: {
                    name: 'Standart',
                    price: 0,
                    badge: '',
                    color: 'user',
                    storyDuration: 24,
                    features: [
                        'Standart sohbet Ã¶zellikleri',
                        '1 gÃ¼nlÃ¼k story sÃ¼resi',
                        'Temel emoji desteÄŸi',
                        'Normal mesaj limiti'
                    ]
                },
                member: {
                    name: 'Ãœye',
                    price: 29.99,
                    badge: 'âœ”ï¸',
                    color: 'member',
                    storyDuration: 168,
                    features: [
                        'Ãœye rozeti ve rengi',
                        '7 gÃ¼nlÃ¼k story sÃ¼resi',
                        'ArttÄ±rÄ±lmÄ±ÅŸ mesaj limiti',
                        'Ã–zel emoji paketi',
                        'GeliÅŸmiÅŸ profil'
                    ]
                },
                abone: {
                    name: 'Abone',
                    price: 49.99,
                    badge: 'â¤ï¸',
                    color: 'subscriber',
                    storyDuration: 336,
                    features: [
                        'Ã–zel abone rozeti',
                        'Ã–zel mesaj rengi',
                        '14 gÃ¼nlÃ¼k story sÃ¼resi',
                        'SÄ±nÄ±rsÄ±z emoji',
                        'Ã–zel abone listesi',
                        'Erken eriÅŸim Ã¶zellikleri'
                    ]
                },
                premium: {
                    name: 'Premium',
                    price: 99.99,
                    badge: 'ğŸ‘‘',
                    color: 'premium',
                    storyDuration: 720,
                    features: [
                        'Premium rozet ve animasyon',
                        '30 gÃ¼nlÃ¼k story sÃ¼resi',
                        'SÄ±nÄ±rsÄ±z mesaj ve story',
                        'Ã–zel yÃ¶netici desteÄŸi',
                        'TÃ¼m Ã¶zelliklere eriÅŸim',
                        'Ã–zel komut eriÅŸimi',
                        'VIP davetiyeleri'
                    ]
                }
            },
            STORY_CONFIG: {
                duration: 24 * 60 * 60 * 1000, // 24 saat
                maxPerUser: 10,
                maxImageSize: 5 * 1024 * 1024, // 5MB
                allowedTypes: ['image/jpeg', 'image/png', 'image/gif']
            },
            CHANNEL_CONFIG: {
                maxChannels: 20,
                defaultChannels: ['#genel', '#mÃ¼zik', '#oyun', '#eÄŸlence']
            }
        };

        // ========== FIREBASE KONFÄ°GÃœRASYONU ==========
        const firebaseConfig = {
            apiKey: "AIzaSyCrn_tXJZCAlKhem45aXxj4f0h26EPOQ70",
            authDomain: "popboxmusicchat.firebaseapp.com",
            databaseURL: "https://popboxmusicchat-default-rtdb.firebaseio.com",
            projectId: "popboxmusicchat",
            storageBucket: "popboxmusicchat.firebasestorage.app",
            messagingSenderId: "206625719024",
            appId: "1:206625719024:web:d28f478a2c96d10412f835",
            measurementId: "G-SB1K22FLEX"
        };
          
        // ========== GLOBAL DEÄÄ°ÅKENLER ==========
        let database;
        let usersRef, messagesRef, privateChatsRef, coAdminsRef, bansRef;
        let registeredUsersRef, operatorsRef, userLocksRef, adminPasswordsRef;
        let customCommandsRef, adminListRef, storiesRef, storyLikesRef;
        let storyReportsRef, subscriptionsRef, userStatsRef, followersRef;
        let channelsRef, channelMessagesRef, channelUsersRef;
          
        let isFirebaseConnected = false;
        let firebaseInitialized = false;
        let currentUser = null;
        let isAdmin = false, isCoAdmin = false, isOperator = false, isOwner = false;
        let isSubscriber = false, isPremium = false, isMember = false;
        let player = null;
        let privateChatWith = null;
        let currentPrivateChatId = null;
        let coAdminList = [], operatorList = [], adminList = [];
        let bannedUsers = {}, registeredUsers = {}, customCommands = {};
        let originalTitle = document.title;
        let ownerPrivateMessages = {}, allPrivateMessages = [];
        let activePrivateChatListeners = {};
        let ownerPasswordHash = null;
        let stories = [], storyLikes = {}, storyReports = {};
        let currentStoryIndex = 0, currentStories = [];
        let storyProgressInterval = null, storyVisibility = 'public';
        let currentStoryId = null, storySectionOpen = false;
        let currentReportStoryId = null, selectedReportReason = '';
        let userStats = {}, userSubscriptions = {}, followers = {}, following = {};
        let selectedSubscriptionPlan = 'standart';
        let profilePanelOpen = false;
        let notificationCount = 0, notifications = [];
        let reportCount = 0, reports = [];
        let notificationPanelOpen = false, reportPanelOpen = false;
        let fallbackMode = false;
        let connectionTimeout = null;
        let connectionRetries = 0;
        const MAX_RETRIES = 3;
        let channels = {}, currentChannel = '#genel';
        let storyCurrentColor = '#ff6b6b';
        let storyCurrentType = 'text';
        let isAppInitialized = false;
        let userListInterval = null;
        let messageListener = null;

        // ========== ACÄ°L GÄ°RÄ°Å SÄ°STEMÄ° ==========
        function showEmergencyLogin() {
            const emergencyBtn = document.getElementById('emergencyLogin');
            const simpleLoginBtn = document.getElementById('simple-login-btn');
              
            if (emergencyBtn) {
                emergencyBtn.style.display = 'block';
                emergencyBtn.style.position = 'fixed';
                emergencyBtn.style.top = '10px';
                emergencyBtn.style.left = '50%';
                emergencyBtn.style.transform = 'translateX(-50%)';
                emergencyBtn.style.background = 'rgba(255, 85, 85, 0.9)';
                emergencyBtn.style.color = 'white';
                emergencyBtn.style.padding = '10px 20px';
                emergencyBtn.style.borderRadius = '10px';
                emergencyBtn.style.zIndex = '9999';
                emergencyBtn.style.cursor = 'pointer';
                emergencyBtn.style.fontWeight = 'bold';
            }
              
            if (simpleLoginBtn) simpleLoginBtn.style.display = 'block';
        }
          
        function emergencyLogin() {
            fallbackMode = true;
            document.getElementById('emergencyLogin').style.display = 'none';
              
            const loginError = document.getElementById('login-error');
            if (loginError) {
                loginError.innerHTML = 'âš ï¸ <strong>ACÄ°L GÄ°RÄ°Å MODU:</strong><br>Firebase baÄŸlantÄ±sÄ± olmadan giriÅŸ yapÄ±lÄ±yor.<br>Ã–zellikler sÄ±nÄ±rlÄ± olacaktÄ±r.';
                loginError.style.display = 'block';
            }
              
            const simpleBtn = document.getElementById('simple-login-btn');
            if (simpleBtn) simpleBtn.style.display = 'block';
        }
          
        function simpleLogin() {
            const nick = document.getElementById('login-nick').value.trim();
              
            if (!nick) {
                showLoginError('âŒ LÃ¼tfen bir kullanÄ±cÄ± adÄ± girin!');
                return;
            }
              
            if (nick.length < 2 || nick.length > 20) {
                showLoginError('âŒ KullanÄ±cÄ± adÄ± 2-20 karakter arasÄ±nda olmalÄ±!');
                return;
            }
              
            currentUser = {
                name: nick,
                role: 'user',
                isRegistered: false,
                isFallback: true,
                subscription: 'standart',
                badges: []
            };
              
            document.getElementById('login-screen').style.display = 'none';
              
            addSystemMessage(`ğŸ‰ HoÅŸ geldin, ${nick}! (Acil GiriÅŸ Modu)`);
            addSystemMessage('âš ï¸ Firebase baÄŸlantÄ±sÄ± yok. BazÄ± Ã¶zellikler sÄ±nÄ±rlÄ±.');
              
            initBasicApp();
              
            setTimeout(initYouTubePlayer, 500);
        }
          
        // ========== FIREBASE BAÄLANTI KONTROLÃœ ==========
        function checkFirebaseConnection() {
            const checkElement = document.getElementById('connectionCheck');
            if (checkElement) {
                checkElement.style.display = 'block';
                checkElement.innerHTML = 'ğŸ”„ Firebase baÄŸlantÄ±sÄ± kontrol ediliyor...';
            }
              
            connectionTimeout = setTimeout(() => {
                if (!isFirebaseConnected && !firebaseInitialized) {
                    console.warn('âš ï¸ Firebase baÄŸlantÄ± zaman aÅŸÄ±mÄ±');
                      
                    if (checkElement) {
                        checkElement.innerHTML = 'âŒ Firebase baÄŸlantÄ±sÄ± saÄŸlanamadÄ±';
                        checkElement.style.background = 'rgba(255, 85, 85, 0.7)';
                    }
                      
                    showEmergencyLogin();
                      
                    connectionRetries++;
                    if (connectionRetries < MAX_RETRIES) {
                        setTimeout(initializeFirebase, 3000);
                    }
                }
            }, 10000);
        }

        // ========== FÄ°REBASE BAÄLANTISINI DÃœZELT ==========
        function initializeFirebase() {
            try {
                console.log("ğŸ”¥ Firebase baÅŸlatÄ±lÄ±yor...");
                
                // Firebase SDK kontrolÃ¼
                if (typeof firebase === 'undefined') {
                    console.error("âŒ Firebase SDK yÃ¼klenemedi");
                    showEmergencyLogin();
                    return;
                }
                
                try {
                    // Firebase'i baÅŸlat (eÄŸer zaten baÅŸlatÄ±lmadÄ±ysa)
                    if (!firebase.apps.length) {
                        firebase.initializeApp(firebaseConfig);
                    } else {
                        firebase.app(); // Zaten baÅŸlatÄ±lmÄ±ÅŸ
                    }
                    firebaseInitialized = true;
                    console.log("âœ… Firebase baÅŸlatÄ±ldÄ±");
                } catch (firebaseError) {
                    console.log("â„¹ï¸ Firebase zaten baÅŸlatÄ±lmÄ±ÅŸ:", firebaseError.message);
                    firebaseInitialized = true;
                }
                
                database = firebase.database();
                
                // BaÄŸlantÄ± durumunu dinle
                const connectedRef = database.ref(".info/connected");
                connectedRef.on("value", function(snap) {
                    if (snap.val() === true) {
                        console.log("âœ… Firebase'e BAÄLANDI!");
                        isFirebaseConnected = true;
                        
                        if (connectionTimeout) {
                            clearTimeout(connectionTimeout);
                        }
                        
                        // BaÄŸlantÄ± baÅŸarÄ±lÄ± badge'ini gÃ¶ster
                        const checkElement = document.getElementById('connectionCheck');
                        if (checkElement) {
                            checkElement.innerHTML = 'âœ… Firebase baÄŸlantÄ±sÄ± baÅŸarÄ±lÄ±!';
                            checkElement.style.background = 'rgba(76, 175, 80, 0.7)';
                            setTimeout(() => {
                                checkElement.style.display = 'none';
                            }, 3000);
                        }
                        
                        // Firebase referanslarÄ±nÄ± oluÅŸtur
                        initFirebaseReferences();
                        
                        document.getElementById('emergencyLogin').style.display = 'none';
                        document.getElementById('simple-login-btn').style.display = 'none';
                        
                    } else {
                        console.log("âŒ Firebase baÄŸlantÄ±sÄ± KESÄ°LDÄ°");
                        isFirebaseConnected = false;
                        showEmergencyLogin();
                    }
                });
                
                // BaÄŸlantÄ± hatasÄ±nÄ± yakala
                database.ref('.info/connected').onDisconnect().update({
                    connected: false
                });
                
            } catch (error) {
                console.error("âŒ Firebase baÅŸlatma hatasÄ±:", error);
                
                setTimeout(() => {
                    showEmergencyLogin();
                }, 2000);
            }
        }

        function initFirebaseReferences() {
            usersRef = database.ref('onlineUsers');
            messagesRef = database.ref('messages');
            privateChatsRef = database.ref('privateChats');
            coAdminsRef = database.ref('coAdmins');
            bansRef = database.ref('bans');
            registeredUsersRef = database.ref('registeredUsers');
            operatorsRef = database.ref('operators');
            userLocksRef = database.ref('userLocks');
            adminPasswordsRef = database.ref('adminPasswords');
            customCommandsRef = database.ref('customCommands');
            adminListRef = database.ref('adminList');
            storiesRef = database.ref('stories');
            storyLikesRef = database.ref('storyLikes');
            storyReportsRef = database.ref('storyReports');
            subscriptionsRef = database.ref('subscriptions');
            userStatsRef = database.ref('userStats');
            followersRef = database.ref('followers');
            channelsRef = database.ref('channels');
            channelMessagesRef = database.ref('channelMessages');
            channelUsersRef = database.ref('channelUsers');
            
            console.log("âœ… Firebase referanslarÄ± oluÅŸturuldu");
            
            // Sistemleri baÅŸlat
            initOwnerPassword();
            loadCustomCommands();
            updateBannedUsers();
            startBanMonitoring();
            startUserLocksCleanup();
            
            loadStories();
            loadStoryLikes();
            loadStoryReports();
            loadChannels();
        }

        // ========== GÄ°RÄ°Å FONKSÄ°YONUNU DÃœZELT ==========
        async function login() {
            console.log("login() fonksiyonu Ã§aÄŸrÄ±ldÄ±");
            
            if (fallbackMode) {
                simpleLogin();
                return;
            }
              
            const nickInput = document.getElementById('login-nick');
            const passwordInput = document.getElementById('login-password');
            const rawNick = nickInput.value.trim();
            const password = passwordInput.value;
            const loginBtn = document.getElementById('login-btn');
              
            if (!rawNick) {
                showLoginError('âŒ LÃ¼tfen bir kullanÄ±cÄ± adÄ± girin!');
                return;
            }
              
            if (rawNick.length < 2 || rawNick.length > 20) {
                showLoginError('âŒ KullanÄ±cÄ± adÄ± 2-20 karakter arasÄ±nda olmalÄ±!');
                return;
            }
              
            if (!isFirebaseConnected || !usersRef) {
                showLoginError('âŒ Firebase baÄŸlantÄ±sÄ± yok! LÃ¼tfen bekleyin veya "Acil GiriÅŸ" butonunu kullanÄ±n.');
                showEmergencyLogin();
                return;
            }
              
            loginBtn.disabled = true;
            loginBtn.innerHTML = '<span class="loading"></span> Kontrol ediliyor...';
            showLoginError('');
            showLoginSuccess('');
              
            try {
                const normalizedNick = rawNick.toLowerCase().trim();
                  
                // Owner kontrolÃ¼
                const isOwnerUser = normalizedNick === SECURE_CONFIG.OWNER_CONFIG.username.toLowerCase();
                  
                if (isOwnerUser) {
                    console.log("Owner giriÅŸi deneniyor");
                    if (!password) {
                        showLoginError('ğŸ” Owner ÅŸifresi gerekli!');
                        loginBtn.disabled = false;
                        loginBtn.textContent = 'Sohbete KatÄ±l';
                        return;
                    }
                      
                    if (password !== SECURE_CONFIG.OWNER_CONFIG.password) {
                        showLoginError('âŒ HatalÄ± ÅŸifre!');
                        loginBtn.disabled = false;
                        loginBtn.textContent = 'Sohbete KatÄ±l';
                        return;
                    }
                      
                    await completeLogin(SECURE_CONFIG.OWNER_CONFIG.username, 'owner', true, null);
                    return;
                }
                  
                // Normal kullanÄ±cÄ± iÃ§in kayÄ±tlÄ± olup olmadÄ±ÄŸÄ±nÄ± kontrol et
                let isRegisteredUser = false;
                try {
                    const registeredSnapshot = await registeredUsersRef.child(rawNick).once('value');
                    isRegisteredUser = registeredSnapshot.exists();
                } catch (e) {
                    console.log("KayÄ±tlÄ± kullanÄ±cÄ± kontrolÃ¼ atlandÄ±");
                }
                
                // KullanÄ±cÄ± adÄ±nÄ±n kullanÄ±labilir olduÄŸundan emin ol
                const finalNick = await getAvailableNick(rawNick);
                
                // Online kullanÄ±cÄ± kontrolÃ¼
                const onlineSnapshot = await usersRef.child(finalNick).once('value');
                if (onlineSnapshot.exists()) {
                    showLoginError('âŒ Bu kullanÄ±cÄ± adÄ± ÅŸu anda online!');
                    loginBtn.disabled = false;
                    loginBtn.textContent = 'Sohbete KatÄ±l';
                    return;
                }
                
                // Ban kontrolÃ¼
                if (bannedUsers[finalNick]) {
                    const ban = bannedUsers[finalNick];
                    if (ban.expiresAt > Date.now()) {
                        showLoginError(`â›” Bu kullanÄ±cÄ± banlÄ±! Sebep: ${ban.reason || 'BelirtilmemiÅŸ'}`);
                        loginBtn.disabled = false;
                        loginBtn.textContent = 'Sohbete KatÄ±l';
                        return;
                    }
                }
                
                await completeLogin(finalNick, 'user', isRegisteredUser, null);
                  
            } catch (error) {
                console.error('GiriÅŸ hatasÄ±:', error);
                showLoginError(`âŒ GiriÅŸ hatasÄ±: ${error.message || 'Bilinmeyen hata'}`);
                loginBtn.disabled = false;
                loginBtn.textContent = 'Sohbete KatÄ±l';
            }
        }

        // ========== KULLANICI ADI KONTROLÃœ ==========
        async function checkUsernameRealTime() {
            const nickInput = document.getElementById('login-nick');
            const passwordInput = document.getElementById('login-password');
            const passwordInfo = document.getElementById('password-info');
            const similarWarning = document.getElementById('similar-users-warning');
            const nickSuggestion = document.getElementById('nick-suggestion');
            
            const rawNick = nickInput.value.trim();
            
            if (!rawNick || rawNick.length < 2) {
                passwordInput.style.display = 'none';
                passwordInfo.style.display = 'none';
                similarWarning.style.display = 'none';
                nickSuggestion.style.display = 'none';
                return;
            }
            
            // Owner kontrolÃ¼
            if (rawNick.toLowerCase() === SECURE_CONFIG.OWNER_CONFIG.username.toLowerCase()) {
                passwordInput.style.display = 'block';
                passwordInfo.style.display = 'block';
                passwordInfo.innerHTML = 'ğŸ” Owner hesabÄ± - lÃ¼tfen ÅŸifrenizi girin';
                similarWarning.style.display = 'none';
                nickSuggestion.style.display = 'none';
                return;
            }
            
            // Firebase baÄŸlantÄ±sÄ± yoksa atla
            if (!isFirebaseConnected) {
                passwordInput.style.display = 'none';
                passwordInfo.style.display = 'none';
                return;
            }
            
            try {
                // KayÄ±tlÄ± kullanÄ±cÄ± kontrolÃ¼
                const registeredSnapshot = await registeredUsersRef.child(rawNick).once('value');
                if (registeredSnapshot.exists()) {
                    passwordInput.style.display = 'block';
                    passwordInfo.style.display = 'block';
                    passwordInfo.innerHTML = 'ğŸ” Bu kullanÄ±cÄ± kayÄ±tlÄ±dÄ±r, lÃ¼tfen ÅŸifrenizi girin';
                } else {
                    passwordInput.style.display = 'none';
                    passwordInfo.style.display = 'none';
                }
                
                // Benzer kullanÄ±cÄ± kontrolÃ¼
                const allUsersSnapshot = await usersRef.once('value');
                const similarUsers = [];
                
                if (allUsersSnapshot.exists()) {
                    allUsersSnapshot.forEach(childSnapshot => {
                        const existingUser = childSnapshot.key;
                        if (existingUser && existingUser.toLowerCase().includes(rawNick.toLowerCase()) || 
                            rawNick.toLowerCase().includes(existingUser.toLowerCase())) {
                            similarUsers.push(existingUser);
                        }
                    });
                }
                
                if (similarUsers.length > 0 && rawNick.length > 2) {
                    similarWarning.style.display = 'block';
                    similarWarning.innerHTML = `âš ï¸ Benzer kullanÄ±cÄ±lar: ${similarUsers.join(', ')}`;
                    
                    // Ã–neri gÃ¶ster
                    let suggestion = rawNick;
                    let counter = 1;
                    while (similarUsers.includes(suggestion) && counter < 100) {
                        suggestion = rawNick + counter;
                        counter++;
                    }
                    
                    if (counter > 1) {
                        nickSuggestion.style.display = 'block';
                        document.getElementById('suggested-nick').textContent = suggestion;
                        document.getElementById('suggested-nick').onclick = function() {
                            nickInput.value = suggestion;
                            checkUsernameRealTime();
                        };
                    } else {
                        nickSuggestion.style.display = 'none';
                    }
                } else {
                    similarWarning.style.display = 'none';
                    nickSuggestion.style.display = 'none';
                }
                
            } catch (error) {
                console.log("KullanÄ±cÄ± adÄ± kontrolÃ¼ hatasÄ±:", error);
            }
        }

        async function getAvailableNick(desiredNick) {
            if (!usersRef) return desiredNick;
            
            let finalNick = desiredNick;
            let counter = 1;
            
            // Ä°lk kontrol
            const snapshot = await usersRef.child(finalNick).once('value');
            if (!snapshot.exists()) {
                return finalNick;
            }
            
            // KullanÄ±cÄ± adÄ± doluysa numara ekle
            while (counter < 100) {
                finalNick = desiredNick + counter;
                const newSnapshot = await usersRef.child(finalNick).once('value');
                if (!newSnapshot.exists()) {
                    return finalNick;
                }
                counter++;
            }
            
            // 100 denemeden sonra hala bulunamadÄ±ysa timestamp ekle
            return desiredNick + Date.now().toString().slice(-4);
        }

        async function completeLogin(username, role, isRegistered, userData) {
            console.log("completeLogin Ã§aÄŸrÄ±ldÄ±:", username);
            
            try {
                // Abonelik kontrolÃ¼
                await checkSubscription(username);
                
                const userInfo = {
                    name: username,
                    lastSeen: Date.now(),
                    joinedAt: Date.now(),
                    isOnline: true,
                    timestamp: Date.now(),
                    role: role,
                    isRegistered: isRegistered,
                    subscription: userData?.subscription || 'standart',
                    currentChannel: currentChannel,
                    badges: []
                };
                
                // KullanÄ±cÄ±yÄ± online listeye ekle
                await usersRef.child(username).set(userInfo);
                
                currentUser = {
                    name: username,
                    role: role,
                    isRegistered: isRegistered,
                    subscription: userInfo.subscription,
                    data: userInfo
                };
                
                // Disconnect handler
                usersRef.child(username).onDisconnect().remove();
                
                // Login ekranÄ±nÄ± kapat
                document.getElementById('login-screen').style.display = 'none';
                
                // UygulamayÄ± baÅŸlat
                initApp();
                
                // HoÅŸ geldin mesajÄ±
                addSystemMessage(`ğŸ‰ HoÅŸ geldin, ${currentUser.name}!`);
                
                // Yetkileri ayarla
                if (role === 'owner') {
                    isOwner = true;
                    document.getElementById('ownerPanelBtn').style.display = 'block';
                    addSystemMessage('ğŸ¤´ Owner olarak giriÅŸ yaptÄ±nÄ±z!');
                } else if (role === 'admin') {
                    isAdmin = true;
                    document.getElementById('adminPanelBtn').style.display = 'block';
                    addSystemMessage('â­ï¸ Admin olarak giriÅŸ yaptÄ±nÄ±z!');
                } else if (role === 'coadmin') {
                    isCoAdmin = true;
                    document.getElementById('coadminBadge').style.display = 'inline-block';
                    addSystemMessage('âš¡ï¸ Co-Admin olarak giriÅŸ yaptÄ±nÄ±z!');
                } else if (role === 'operator') {
                    isOperator = true;
                    document.getElementById('operatorBadge').style.display = 'inline-block';
                    addSystemMessage('ğŸ› ï¸ OperatÃ¶r olarak giriÅŸ yaptÄ±nÄ±z!');
                }
                
                // Abonelik mesajÄ±
                if (currentUser.subscription === 'premium') {
                    isPremium = true;
                    addSystemMessage('ğŸ‘‘ Premium abone olarak giriÅŸ yaptÄ±nÄ±z!');
                } else if (currentUser.subscription === 'abone') {
                    isSubscriber = true;
                    addSystemMessage('â¤ï¸ Abone olarak giriÅŸ yaptÄ±nÄ±z!');
                } else if (currentUser.subscription === 'member') {
                    isMember = true;
                    addSystemMessage('âœ”ï¸ Ãœye olarak giriÅŸ yaptÄ±nÄ±z!');
                }
                
                // Badge'leri gÃ¼ncelle
                updateUserBadges();
                
                // Bot hoÅŸ geldin mesajÄ±
                setTimeout(() => {
                    if (!isOwner && bot) {
                        bot.sendWelcome(username);
                    }
                }, 1000);
                
                // Bot'u baÅŸlat
                if (bot) {
                    bot.startAutoMessages();
                    bot.startSecurityScans();
                }
                
                console.log("âœ… GiriÅŸ baÅŸarÄ±lÄ±:", username);
                
            } catch (error) {
                console.error('GiriÅŸ tamamlama hatasÄ±:', error);
                showLoginError(`âŒ GiriÅŸ hatasÄ±: ${error.message}`);
                location.reload();
            }
        }

        // ========== UYGULAMA BAÅLATMA ==========
        function initBasicApp() {
            console.log("initBasicApp Ã§aÄŸrÄ±ldÄ±");
            if (isAppInitialized) return;
            
            isAppInitialized = true;
            
            // Mesaj input'unu aktif et
            document.getElementById('message-input').disabled = false;
            document.getElementById('message-input').placeholder = "MesajÄ±nÄ±zÄ± yazÄ±n...";
            
            // Online kullanÄ±cÄ± listesini baÅŸlat
            startUserListUpdate();
            
            // YouTube player'Ä± baÅŸlat
            initYouTubePlayer();
            
            // Tema yÃ¼kle
            loadTheme();
            
            console.log("âœ… Temel uygulama baÅŸlatÄ±ldÄ±");
        }

        function initApp() {
            console.log("initApp Ã§aÄŸrÄ±ldÄ±");
            if (isAppInitialized) return;
            
            isAppInitialized = true;
            
            // Mesaj listener'Ä±nÄ± baÅŸlat
            if (messagesRef) {
                messageListener = messagesRef.on('child_added', (snapshot) => {
                    const message = snapshot.val();
                    if (message && (!message.channel || message.channel === currentChannel)) {
                        addMessageToChat(message);
                    }
                });
            }
            
            // Online kullanÄ±cÄ± listener'Ä±nÄ± baÅŸlat
            if (usersRef) {
                usersRef.on('value', (snapshot) => {
                    updateUserList(snapshot.val());
                });
            }
            
            // Mesaj input'unu aktif et
            document.getElementById('message-input').disabled = false;
            
            // Online kullanÄ±cÄ± listesini baÅŸlat
            startUserListUpdate();
            
            // YouTube player'Ä± baÅŸlat
            initYouTubePlayer();
            
            // Tema yÃ¼kle
            loadTheme();
            
            // Profil panelini gÃ¼ncelle
            updateProfilePanel();
            
            console.log("âœ… Uygulama baÅŸlatÄ±ldÄ±");
        }

        // ========== MESAJ SÄ°STEMÄ° ==========
        function addMessageToChat(message) {
            if (!message || !message.sender || !message.text) return;
            
            const container = document.getElementById('messages');
            if (!container) return;
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'yt-message';
            
            let messageClass = 'user';
            if (message.type === 'owner') messageClass = 'owner';
            else if (message.type === 'admin') messageClass = 'admin';
            else if (message.type === 'coadmin') messageClass = 'coadmin';
            else if (message.type === 'operator') messageClass = 'operator';
            else if (message.type === 'system') messageClass = 'system';
            else if (message.type === 'premium') messageClass = 'premium';
            else if (message.type === 'subscriber') messageClass = 'subscriber';
            else if (message.type === 'member') messageClass = 'member';
            
            messageDiv.classList.add(messageClass);
            
            let senderHTML = `<span class="message-sender" style="color: ${getUserColor(message.sender)}; font-weight: bold;">${message.sender}</span>`;
            
            // Badge ekle
            if (message.sender === SECURE_CONFIG.OWNER_CONFIG.username) {
                senderHTML += ' <span class="badge owner">OWNER ğŸ¤´</span>';
            } else if (adminList.includes(message.sender)) {
                senderHTML += ' <span class="badge admin">ADMIN â­ï¸</span>';
            } else if (coAdminList.includes(message.sender)) {
                senderHTML += ' <span class="badge coadmin">CO-ADMIN âš¡ï¸</span>';
            } else if (operatorList.includes(message.sender)) {
                senderHTML += ' <span class="badge operator">OPERATOR ğŸ› ï¸</span>';
            }
            
            messageDiv.innerHTML = `
                <div class="message-header">
                    ${senderHTML}
                    <span class="message-time">${message.time || formatTime(message.timestamp)}</span>
                </div>
                <div class="message-content">${escapeHtml(message.text)}</div>
                ${message.imageUrl ? `<img src="${message.imageUrl}" class="message-image" onclick="openImageModal('${message.imageUrl}')">` : ''}
            `;
            
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }

        function addSystemMessage(text) {
            const container = document.getElementById('messages');
            if (!container) return;
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'yt-message system';
            messageDiv.innerHTML = `
                <div class="message-content">${escapeHtml(text)}</div>
            `;
            
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }

        function sendMessage() {
            if (!currentUser) {
                addSystemMessage('â›” Ã–nce giriÅŸ yapmalÄ±sÄ±nÄ±z!');
                return;
            }
              
            const input = document.getElementById('message-input');
            const text = input.value.trim();
              
            if (!text) return;
              
            if (text.startsWith('/')) {
                handleCommand(text);
                input.value = '';
                autoResize(input);
                return;
            }
              
            let messageType = 'user';
            if (isOwner) messageType = 'owner';
            else if (isAdmin) messageType = 'admin';
            else if (isCoAdmin) messageType = 'coadmin';
            else if (isOperator) messageType = 'operator';
            else if (isPremium) messageType = 'premium';
            else if (isSubscriber) messageType = 'subscriber';
            else if (isMember) messageType = 'member';
              
            const messageData = {
                sender: currentUser.name,
                text: text,
                type: messageType,
                timestamp: Date.now(),
                time: new Date().toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' }),
                channel: currentChannel
            };
              
            try {
                if (messagesRef) {
                    messagesRef.push(messageData);
                    console.log("âœ… Mesaj gÃ¶nderildi");
                } else {
                    // Firebase yoksa direkt ekrana ekle
                    addMessageToChat(messageData);
                }
                  
                input.value = '';
                autoResize(input);
                  
                // KullanÄ±cÄ± istatistiklerini gÃ¼ncelle
                updateUserStats(currentUser.name, 'messages');
                  
            } catch (error) {
                console.error('Mesaj gÃ¶nderme hatasÄ±:', error);
                addSystemMessage('âŒ Mesaj gÃ¶nderilemedi!');
            }
        }

        // ========== Ã–ZEL MESAJ SÄ°STEMÄ° (OWNER VE ADMÄ°NLER Ä°Ã‡Ä°N) ==========
        function openPrivateChat(username) {
            if (!currentUser) {
                addSystemMessage('â›” Ã–nce giriÅŸ yapmalÄ±sÄ±nÄ±z!');
                return;
            }
            
            privateChatWith = username;
            document.getElementById('privateWith').textContent = `ğŸ”’ Ã–zel Sohbet: ${username}`;
            document.getElementById('privateModal').style.display = 'block';
            document.getElementById('overlay').style.display = 'block';
            
            // Ã–nceki listener'Ä± temizle
            if (currentPrivateChatId && activePrivateChatListeners[currentPrivateChatId]) {
                activePrivateChatListeners[currentPrivateChatId]();
            }
            
            // Chat ID oluÅŸtur (alfabetik sÄ±raya gÃ¶re)
            const chatId = [currentUser.name, username].sort().join('_');
            currentPrivateChatId = chatId;
            
            // MesajlarÄ± yÃ¼kle
            loadPrivateMessages(chatId);
        }

        function closePrivateChat() {
            document.getElementById('privateModal').style.display = 'none';
            document.getElementById('overlay').style.display = 'none';
            
            // Listener'Ä± temizle
            if (currentPrivateChatId && activePrivateChatListeners[currentPrivateChatId]) {
                activePrivateChatListeners[currentPrivateChatId]();
                delete activePrivateChatListeners[currentPrivateChatId];
            }
            
            privateChatWith = null;
            currentPrivateChatId = null;
            document.getElementById('privateMessages').innerHTML = '';
        }

        async function loadPrivateMessages(chatId) {
            if (!privateChatsRef) return;
            
            try {
                const container = document.getElementById('privateMessages');
                container.innerHTML = '';
                
                // MesajlarÄ± dinle
                const listener = privateChatsRef.child(chatId).on('child_added', (snapshot) => {
                    const message = snapshot.val();
                    if (!message) return;
                    
                    const messageDiv = document.createElement('div');
                    messageDiv.className = `private-message ${message.sender === currentUser.name ? 'sent' : 'received'}`;
                    
                    messageDiv.innerHTML = `
                        <div style="font-weight: bold; margin-bottom: 5px;">${message.sender}</div>
                        <div>${escapeHtml(message.text)}</div>
                        ${message.imageUrl ? `<img src="${message.imageUrl}" class="message-image" onclick="openImageModal('${message.imageUrl}')" style="max-width: 200px; margin-top: 5px;">` : ''}
                        <div style="font-size: 11px; opacity: 0.7; margin-top: 5px;">${formatTime(message.timestamp)}</div>
                    `;
                    
                    container.appendChild(messageDiv);
                    container.scrollTop = container.scrollHeight;
                });
                
                // Listener'Ä± kaydet
                activePrivateChatListeners[chatId] = () => {
                    privateChatsRef.child(chatId).off('child_added', listener);
                };
                
            } catch (error) {
                console.error('Ã–zel mesajlar yÃ¼klenirken hata:', error);
            }
        }

        async function sendPrivateMessage() {
            if (!currentUser || !privateChatWith || !currentPrivateChatId) return;
            
            const input = document.getElementById('private-input');
            const text = input.value.trim();
            
            if (!text) return;
            
            try {
                const messageData = {
                    sender: currentUser.name,
                    receiver: privateChatWith,
                    text: text,
                    timestamp: Date.now(),
                    time: new Date().toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' })
                };
                
                // Ã–zel mesajÄ± kaydet
                await privateChatsRef.child(currentPrivateChatId).push(messageData);
                
                // Bildirim gÃ¶nder (eÄŸer alÄ±cÄ± online ise)
                if (usersRef) {
                    const receiverSnapshot = await usersRef.child(privateChatWith).once('value');
                    if (receiverSnapshot.exists()) {
                        // Burada bildirim sistemi eklenebilir
                        console.log(`ğŸ“¨ Ã–zel mesaj gÃ¶nderildi: ${currentUser.name} -> ${privateChatWith}`);
                    }
                }
                
                input.value = '';
                autoResize(input);
                
            } catch (error) {
                console.error('Ã–zel mesaj gÃ¶nderme hatasÄ±:', error);
            }
        }

        // ========== OWNER TÃœM Ã–ZEL MESAJLARI GÃ–RÃœNTÃœLEME ==========
        async function loadAllPrivateMessages() {
            if (!isOwner && !isAdmin) {
                addSystemMessage('â›” Bu Ã¶zelliÄŸi kullanma yetkiniz yok!');
                return;
            }
            
            try {
                const snapshot = await privateChatsRef.once('value');
                const allMessages = snapshot.val() || {};
                
                const container = document.getElementById('allPrivateMessages');
                container.innerHTML = '';
                
                let messageCount = 0;
                
                Object.entries(allMessages).forEach(([chatId, messages]) => {
                    if (messages && typeof messages === 'object') {
                        Object.entries(messages).forEach(([messageId, message]) => {
                            if (message && message.sender && message.text) {
                                messageCount++;
                                
                                const messageDiv = document.createElement('div');
                                messageDiv.style.padding = '10px';
                                messageDiv.style.margin = '5px 0';
                                messageDiv.style.background = 'rgba(0,0,0,0.1)';
                                messageDiv.style.borderRadius = '5px';
                                messageDiv.style.borderLeft = '3px solid var(--private)';
                                
                                let messageContent = escapeHtml(message.text);
                                if (message.imageUrl) {
                                    messageContent += `<br><img src="${message.imageUrl}" style="max-width: 150px; border-radius: 5px; margin-top: 5px;" onclick="openImageModal('${message.imageUrl}')">`;
                                }
                                
                                messageDiv.innerHTML = `
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                        <div>
                                            <strong style="color: ${getUserColor(message.sender)}">${message.sender}</strong> 
                                            â†’ 
                                            <strong style="color: ${message.receiver ? getUserColor(message.receiver) : '#666'}">${message.receiver || 'Bilinmiyor'}</strong>
                                        </div>
                                        <small>${formatTime(message.timestamp)}</small>
                                    </div>
                                    <div>${messageContent}</div>
                                `;
                                
                                // Owner iÃ§in mesaj silme butonu
                                if (isOwner) {
                                    const deleteBtn = document.createElement('button');
                                    deleteBtn.textContent = 'ğŸ—‘ï¸';
                                    deleteBtn.style.float = 'right';
                                    deleteBtn.style.background = 'none';
                                    deleteBtn.style.border = 'none';
                                    deleteBtn.style.cursor = 'pointer';
                                    deleteBtn.style.color = 'var(--ban-color)';
                                    deleteBtn.onclick = () => deletePrivateMessage(chatId, messageId);
                                    messageDiv.appendChild(deleteBtn);
                                }
                                
                                container.appendChild(messageDiv);
                            }
                        });
                    }
                });
                
                if (messageCount === 0) {
                    container.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-secondary);">HenÃ¼z Ã¶zel mesaj bulunmuyor.</div>';
                }
                
                console.log(`âœ… ${messageCount} Ã¶zel mesaj yÃ¼klendi`);
                
            } catch (error) {
                console.error('Ã–zel mesajlar yÃ¼klenirken hata:', error);
                addSystemMessage('âŒ Ã–zel mesajlar yÃ¼klenemedi!');
            }
        }

        async function deletePrivateMessage(chatId, messageId) {
            if (!isOwner) return;
            
            if (confirm('Bu Ã¶zel mesajÄ± silmek istediÄŸinize emin misiniz?')) {
                try {
                    await privateChatsRef.child(chatId).child(messageId).remove();
                    addSystemMessage('âœ… Ã–zel mesaj silindi!');
                    loadAllPrivateMessages(); // Listeyi yenile
                } catch (error) {
                    console.error('Mesaj silme hatasÄ±:', error);
                    addSystemMessage('âŒ Mesaj silinemedi!');
                }
            }
        }

        // ========== RESÄ°M YÃœKLEME SÄ°STEMÄ° ==========
        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
              
            if (!file.type.startsWith('image/')) {
                addSystemMessage('âŒ Sadece resim dosyalarÄ± yÃ¼kleyebilirsiniz!');
                return;
            }
              
            if (file.size > 10 * 1024 * 1024) { // 10MB
                addSystemMessage('âŒ Resim boyutu 10MB\'dan kÃ¼Ã§Ã¼k olmalÄ±!');
                return;
            }
              
            const reader = new FileReader();
            reader.onload = function(e) {
                const imageUrl = e.target.result;
                sendMessageWithImage(imageUrl);
            };
            reader.readAsDataURL(file);
            
            // Input'u temizle
            event.target.value = '';
        }

        function sendMessageWithImage(imageUrl) {
            if (!currentUser) return;
              
            let messageType = 'user';
            if (isOwner) messageType = 'owner';
            else if (isAdmin) messageType = 'admin';
            else if (isCoAdmin) messageType = 'coadmin';
            else if (isOperator) messageType = 'operator';
            else if (isPremium) messageType = 'premium';
            else if (isSubscriber) messageType = 'subscriber';
            else if (isMember) messageType = 'member';
              
            const messageData = {
                sender: currentUser.name,
                text: '[Resim]',
                imageUrl: imageUrl,
                type: messageType,
                timestamp: Date.now(),
                time: new Date().toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' }),
                channel: currentChannel
            };
              
            try {
                if (messagesRef) {
                    messagesRef.push(messageData);
                } else {
                    // Firebase yoksa direkt ekle
                    addMessageToChat(messageData);
                }
                addSystemMessage('âœ… Resim gÃ¶nderildi!');
                  
            } catch (error) {
                console.error('Resim gÃ¶nderme hatasÄ±:', error);
                addSystemMessage('âŒ Resim gÃ¶nderilemedi!');
            }
        }

        function handlePrivateImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
              
            if (!file.type.startsWith('image/')) {
                alert('âŒ Sadece resim dosyalarÄ± yÃ¼kleyebilirsiniz!');
                return;
            }
              
            if (file.size > 10 * 1024 * 1024) {
                alert('âŒ Resim boyutu 10MB\'dan kÃ¼Ã§Ã¼k olmalÄ±!');
                return;
            }
              
            const reader = new FileReader();
            reader.onload = function(e) {
                const imageUrl = e.target.result;
                sendPrivateMessageWithImage(imageUrl);
            };
            reader.readAsDataURL(file);
            
            // Input'u temizle
            event.target.value = '';
        }

        async function sendPrivateMessageWithImage(imageUrl) {
            if (!currentUser || !privateChatWith || !currentPrivateChatId) return;
            
            try {
                const messageData = {
                    sender: currentUser.name,
                    receiver: privateChatWith,
                    text: '[Resim]',
                    imageUrl: imageUrl,
                    timestamp: Date.now(),
                    time: new Date().toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' })
                };
                
                await privateChatsRef.child(currentPrivateChatId).push(messageData);
                addSystemMessage('âœ… Ã–zel resim gÃ¶nderildi!');
                
            } catch (error) {
                console.error('Ã–zel resim gÃ¶nderme hatasÄ±:', error);
                addSystemMessage('âŒ Ã–zel resim gÃ¶nderilemedi!');
            }
        }

        // ========== YARDIMCI FONKSÄ°YONLAR ==========
        function updateUserBadges() {
            // Ã–nce tÃ¼m badge'leri gizle
            document.querySelectorAll('.badge').forEach(badge => {
                badge.style.display = 'none';
            });
            
            if (currentUser) {
                if (currentUser.role === 'owner') {
                    isOwner = true;
                    document.getElementById('ownerBadge').style.display = 'inline-block';
                } else if (currentUser.role === 'admin') {
                    isAdmin = true;
                    document.getElementById('adminBadge').style.display = 'inline-block';
                } else if (currentUser.role === 'coadmin') {
                    isCoAdmin = true;
                    document.getElementById('coadminBadge').style.display = 'inline-block';
                } else if (currentUser.role === 'operator') {
                    isOperator = true;
                    document.getElementById('operatorBadge').style.display = 'inline-block';
                }
                
                if (currentUser.subscription === 'premium') {
                    isPremium = true;
                    document.getElementById('premiumBadge').style.display = 'inline-block';
                } else if (currentUser.subscription === 'abone') {
                    isSubscriber = true;
                    document.getElementById('subscriberBadge').style.display = 'inline-block';
                } else if (currentUser.subscription === 'member') {
                    isMember = true;
                    document.getElementById('memberBadge').style.display = 'inline-block';
                }
            }
        }

        function updateProfilePanel() {
            if (!currentUser) return;
            
            document.getElementById('profileUsername').textContent = currentUser.name;
            document.getElementById('profileRole').textContent = 
                currentUser.role === 'owner' ? 'Owner ğŸ¤´' :
                currentUser.role === 'admin' ? 'Admin â­ï¸' :
                currentUser.role === 'coadmin' ? 'Co-Admin âš¡ï¸' :
                currentUser.role === 'operator' ? 'Operator ğŸ› ï¸' : 'KullanÄ±cÄ±';
            
            document.getElementById('profileAvatar').textContent = currentUser.name.charAt(0).toUpperCase();
            
            // Ä°statistikleri gÃ¼ncelle
            updateUserStatsDisplay();
            
            // Abonelik durumu
            const subscriptionStatus = document.getElementById('subscriptionStatus');
            if (subscriptionStatus) {
                subscriptionStatus.textContent = 
                    currentUser.subscription === 'premium' ? 'ğŸ‘‘ Premium' :
                    currentUser.subscription === 'abone' ? 'â¤ï¸ Abone' :
                    currentUser.subscription === 'member' ? 'âœ”ï¸ Ãœye' : 'Ãœcretsiz';
            }
            
            // Admin butonlarÄ±nÄ± gÃ¶ster/gizle
            document.getElementById('adminPanelBtn').style.display = 
                (isOwner || isAdmin) ? 'block' : 'none';
            document.getElementById('ownerPanelBtn').style.display = 
                isOwner ? 'block' : 'none';
        }

        async function updateUserStatsDisplay() {
            if (!currentUser || !userStatsRef) return;
            
            try {
                const snapshot = await userStatsRef.child(currentUser.name).once('value');
                const stats = snapshot.val() || { messages: 0, stories: 0, likes: 0, subscribers: 0 };
                
                document.getElementById('statMessages').textContent = stats.messages || 0;
                document.getElementById('statStories').textContent = stats.stories || 0;
                document.getElementById('statLikes').textContent = stats.likes || 0;
                document.getElementById('statSubscribers').textContent = stats.subscribers || 0;
                
            } catch (error) {
                console.log("Ä°statistikler yÃ¼klenirken hata:", error);
            }
        }

        async function updateUserStats(username, type) {
            if (!userStatsRef) return;
            
            try {
                const statsRef = userStatsRef.child(username);
                const snapshot = await statsRef.once('value');
                const currentStats = snapshot.val() || { messages: 0, stories: 0, likes: 0, subscribers: 0 };
                
                if (type === 'messages') currentStats.messages = (currentStats.messages || 0) + 1;
                else if (type === 'stories') currentStats.stories = (currentStats.stories || 0) + 1;
                else if (type === 'likes') currentStats.likes = (currentStats.likes || 0) + 1;
                
                await statsRef.set(currentStats);
                
                // Profil panelini gÃ¼ncelle
                if (username === currentUser.name) {
                    updateUserStatsDisplay();
                }
                
            } catch (error) {
                console.error('Ä°statistik gÃ¼ncelleme hatasÄ±:', error);
            }
        }

        async function checkSubscription(username) {
            if (!subscriptionsRef) {
                currentUser.subscription = 'standart';
                return;
            }
            
            try {
                const snapshot = await subscriptionsRef.child(username).once('value');
                if (snapshot.exists()) {
                    const subData = snapshot.val();
                    if (subData.expiresAt > Date.now()) {
                        currentUser.subscription = subData.plan;
                    } else {
                        currentUser.subscription = 'standart';
                    }
                } else {
                    currentUser.subscription = 'standart';
                }
            } catch (error) {
                console.error('Abonelik kontrol hatasÄ±:', error);
                currentUser.subscription = 'standart';
            }
        }

        // ========== YÃ–NETÄ°CÄ° FONKSÄ°YONLARI ==========
        async function addAdmin() {
            if (!isOwner && !isAdmin) {
                addSystemMessage('â›” Bu iÅŸlemi yapma yetkiniz yok!');
                return;
            }
            
            const username = document.getElementById('adminUsername').value.trim();
            const role = document.getElementById('adminRole').value;
            
            if (!username) {
                alert('âŒ KullanÄ±cÄ± adÄ± gerekli!');
                return;
            }
            
            try {
                if (role === 'admin') {
                    await adminListRef.child(username).set({
                        username: username,
                        role: 'admin',
                        addedBy: currentUser.name,
                        addedAt: Date.now()
                    });
                    adminList.push(username);
                } else if (role === 'coadmin') {
                    await coAdminsRef.child(username).set({
                        username: username,
                        role: 'coadmin',
                        addedBy: currentUser.name,
                        addedAt: Date.now()
                    });
                    coAdminList.push(username);
                } else if (role === 'operator') {
                    await operatorsRef.child(username).set({
                        username: username,
                        role: 'operator',
                        addedBy: currentUser.name,
                        addedAt: Date.now()
                    });
                    operatorList.push(username);
                }
                
                addSystemMessage(`âœ… ${username} kullanÄ±cÄ±sÄ± ${role} olarak atandÄ±!`);
                
                // AlanlarÄ± temizle
                document.getElementById('adminUsername').value = '';
                
            } catch (error) {
                console.error('Admin ekleme hatasÄ±:', error);
                addSystemMessage('âŒ Admin eklenemedi!');
            }
        }

        async function removeAdmin() {
            if (!isOwner && !isAdmin) {
                addSystemMessage('â›” Bu iÅŸlemi yapma yetkiniz yok!');
                return;
            }
            
            const username = document.getElementById('adminUsername').value.trim();
            
            if (!username) {
                alert('âŒ KullanÄ±cÄ± adÄ± gerekli!');
                return;
            }
            
            if (!confirm(`${username} kullanÄ±cÄ±sÄ±nÄ±n yetkilerini kaldÄ±rmak istediÄŸinize emin misiniz?`)) {
                return;
            }
            
            try {
                // TÃ¼m yetkilerden kaldÄ±r
                await adminListRef.child(username).remove();
                await coAdminsRef.child(username).remove();
                await operatorsRef.child(username).remove();
                
                // Listelerden Ã§Ä±kar
                adminList = adminList.filter(u => u !== username);
                coAdminList = coAdminList.filter(u => u !== username);
                operatorList = operatorList.filter(u => u !== username);
                
                addSystemMessage(`âœ… ${username} kullanÄ±cÄ±sÄ±nÄ±n yetkileri kaldÄ±rÄ±ldÄ±!`);
                document.getElementById('adminUsername').value = '';
                
            } catch (error) {
                console.error('Admin kaldÄ±rma hatasÄ±:', error);
                addSystemMessage('âŒ Yetkiler kaldÄ±rÄ±lamadÄ±!');
            }
        }

        async function banUser() {
            if (!isOwner && !isAdmin) {
                addSystemMessage('â›” Bu iÅŸlemi yapma yetkiniz yok!');
                return;
            }
            
            const username = document.getElementById('banUsername').value.trim();
            const duration = document.getElementById('banDuration').value;
            const reason = document.getElementById('banReason').value.trim();
            
            if (!username) {
                alert('âŒ KullanÄ±cÄ± adÄ± gerekli!');
                return;
            }
            
            try {
                const banData = {
                    username: username,
                    bannedBy: currentUser.name,
                    reason: reason || 'BelirtilmemiÅŸ',
                    duration: parseInt(duration),
                    bannedAt: Date.now(),
                    expiresAt: Date.now() + parseInt(duration)
                };
                
                await bansRef.child(username).set(banData);
                bannedUsers[username] = banData;
                
                // KullanÄ±cÄ±yÄ± online listeden kaldÄ±r
                await usersRef.child(username).remove();
                
                addSystemMessage(`ğŸš« ${username} kullanÄ±cÄ±sÄ± banlandÄ±! Sebep: ${banData.reason}`);
                
                // AlanlarÄ± temizle
                document.getElementById('banUsername').value = '';
                document.getElementById('banReason').value = '';
                
            } catch (error) {
                console.error('Ban hatasÄ±:', error);
                addSystemMessage('âŒ KullanÄ±cÄ± banlanamadÄ±!');
            }
        }

        async function unbanUser() {
            if (!isOwner && !isAdmin) {
                addSystemMessage('â›” Bu iÅŸlemi yapma yetkiniz yok!');
                return;
            }
            
            const username = document.getElementById('banUsername').value.trim();
            
            if (!username) {
                alert('âŒ KullanÄ±cÄ± adÄ± gerekli!');
                return;
            }
            
            try {
                await bansRef.child(username).remove();
                delete bannedUsers[username];
                
                addSystemMessage(`âœ… ${username} kullanÄ±cÄ±sÄ±nÄ±n banÄ± kaldÄ±rÄ±ldÄ±!`);
                document.getElementById('banUsername').value = '';
                
            } catch (error) {
                console.error('Ban kaldÄ±rma hatasÄ±:', error);
                addSystemMessage('âŒ Ban kaldÄ±rÄ±lamadÄ±!');
            }
        }

        // ========== KULLANICI LÄ°STESÄ° ==========
        function startUserListUpdate() {
            if (userListInterval) {
                clearInterval(userListInterval);
            }
            
            // Online kullanÄ±cÄ±larÄ± gÃ¼ncelle
            updateOnlineUsers();
            
            // Her 10 saniyede bir gÃ¼ncelle
            userListInterval = setInterval(updateOnlineUsers, 10000);
        }

        async function updateOnlineUsers() {
            if (!usersRef) {
                // Firebase yoksa fallback
                updateUserListFallback();
                return;
            }
            
            try {
                const snapshot = await usersRef.once('value');
                const users = snapshot.val() || {};
                updateUserList(users);
                
            } catch (error) {
                console.error('KullanÄ±cÄ± listesi gÃ¼ncelleme hatasÄ±:', error);
            }
        }

        function updateUserList(users) {
            const userList = document.getElementById('userList');
            const onlineCount = document.getElementById('onlineCount');
            const chatOnlineCount = document.getElementById('chatOnlineCount');
            
            if (!userList) return;
            
            userList.innerHTML = '';
            let count = 0;
            
            if (users && typeof users === 'object') {
                Object.entries(users).forEach(([username, userData]) => {
                    if (!userData || username === 'undefined') return;
                    
                    count++;
                    
                    const userDiv = document.createElement('div');
                    userDiv.className = 'user-item';
                    userDiv.style.padding = '10px';
                    userDiv.style.margin = '5px 0';
                    userDiv.style.background = 'rgba(0,0,0,0.05)';
                    userDiv.style.borderRadius = '8px';
                    userDiv.style.display = 'flex';
                    userDiv.style.alignItems = 'center';
                    userDiv.style.gap = '10px';
                    userDiv.style.cursor = 'pointer';
                    userDiv.style.transition = 'background 0.3s';
                    
                    userDiv.onmouseenter = () => {
                        userDiv.style.background = 'rgba(0,0,0,0.1)';
                    };
                    userDiv.onmouseleave = () => {
                        userDiv.style.background = 'rgba(0,0,0,0.05)';
                    };
                    
                    userDiv.onclick = () => {
                        if (currentUser && username !== currentUser.name) {
                            openUserContextMenu(username, userDiv);
                        }
                    };
                    
                    // KullanÄ±cÄ± avatarÄ±
                    const avatar = document.createElement('div');
                    avatar.style.width = '40px';
                    avatar.style.height = '40px';
                    avatar.style.borderRadius = '50%';
                    avatar.style.background = getUserColor(username);
                    avatar.style.display = 'flex';
                    avatar.style.alignItems = 'center';
                    avatar.style.justifyContent = 'center';
                    avatar.style.color = 'white';
                    avatar.style.fontWeight = 'bold';
                    avatar.style.fontSize = '18px';
                    avatar.textContent = username.charAt(0).toUpperCase();
                    
                    // KullanÄ±cÄ± bilgileri
                    const infoDiv = document.createElement('div');
                    infoDiv.style.flex = '1';
                    
                    const nameDiv = document.createElement('div');
                    nameDiv.style.fontWeight = 'bold';
                    nameDiv.style.color = getUserColor(username);
                    nameDiv.textContent = username;
                    
                    const roleDiv = document.createElement('div');
                    roleDiv.style.fontSize = '12px';
                    roleDiv.style.color = 'var(--text-secondary)';
                    
                    if (username === SECURE_CONFIG.OWNER_CONFIG.username) {
                        roleDiv.textContent = 'Owner ğŸ¤´';
                        nameDiv.innerHTML += ' <span style="font-size: 10px; background: var(--owner); color: white; padding: 2px 6px; border-radius: 10px;">OWNER</span>';
                    } else if (adminList.includes(username)) {
                        roleDiv.textContent = 'Admin â­ï¸';
                        nameDiv.innerHTML += ' <span style="font-size: 10px; background: var(--secondary); color: white; padding: 2px 6px; border-radius: 10px;">ADMIN</span>';
                    } else if (coAdminList.includes(username)) {
                        roleDiv.textContent = 'Co-Admin âš¡ï¸';
                        nameDiv.innerHTML += ' <span style="font-size: 10px; background: var(--coadmin); color: white; padding: 2px 6px; border-radius: 10px;">CO-ADMIN</span>';
                    } else if (operatorList.includes(username)) {
                        roleDiv.textContent = 'Operator ğŸ› ï¸';
                        nameDiv.innerHTML += ' <span style="font-size: 10px; background: var(--operator); color: white; padding: 2px 6px; border-radius: 10px;">OPERATOR</span>';
                    } else {
                        roleDiv.textContent = 'KullanÄ±cÄ±';
                    }
                    
                    // Online durumu
                    const onlineDot = document.createElement('div');
                    onlineDot.style.width = '10px';
                    onlineDot.style.height = '10px';
                    onlineDot.style.borderRadius = '50%';
                    onlineDot.style.background = 'var(--online)';
                    onlineDot.style.marginLeft = 'auto';
                    
                    infoDiv.appendChild(nameDiv);
                    infoDiv.appendChild(roleDiv);
                    
                    userDiv.appendChild(avatar);
                    userDiv.appendChild(infoDiv);
                    userDiv.appendChild(onlineDot);
                    
                    userList.appendChild(userDiv);
                });
            }
            
            // SayÄ±larÄ± gÃ¼ncelle
            if (onlineCount) onlineCount.textContent = count;
            if (chatOnlineCount) chatOnlineCount.textContent = count;
            
            // EÄŸer hiÃ§ kullanÄ±cÄ± yoksa mesaj gÃ¶ster
            if (count === 0) {
                userList.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-secondary);">HenÃ¼z online kullanÄ±cÄ± yok.</div>';
            }
        }

        function updateUserListFallback() {
            const userList = document.getElementById('userList');
            const onlineCount = document.getElementById('onlineCount');
            const chatOnlineCount = document.getElementById('chatOnlineCount');
            
            if (!userList) return;
            
            userList.innerHTML = '';
            
            // Sadece mevcut kullanÄ±cÄ±yÄ± gÃ¶ster
            if (currentUser) {
                const userDiv = document.createElement('div');
                userDiv.className = 'user-item';
                userDiv.style.padding = '10px';
                userDiv.style.margin = '5px 0';
                userDiv.style.background = 'rgba(0,0,0,0.05)';
                userDiv.style.borderRadius = '8px';
                userDiv.style.display = 'flex';
                userDiv.style.alignItems = 'center';
                userDiv.style.gap = '10px';
                
                const avatar = document.createElement('div');
                avatar.style.width = '40px';
                avatar.style.height = '40px';
                avatar.style.borderRadius = '50%';
                avatar.style.background = getUserColor(currentUser.name);
                avatar.style.display = 'flex';
                avatar.style.alignItems = 'center';
                avatar.style.justifyContent = 'center';
                avatar.style.color = 'white';
                avatar.style.fontWeight = 'bold';
                avatar.style.fontSize = '18px';
                avatar.textContent = currentUser.name.charAt(0).toUpperCase();
                
                const infoDiv = document.createElement('div');
                infoDiv.style.flex = '1';
                
                const nameDiv = document.createElement('div');
                nameDiv.style.fontWeight = 'bold';
                nameDiv.style.color = getUserColor(currentUser.name);
                nameDiv.textContent = currentUser.name;
                
                const roleDiv = document.createElement('div');
                roleDiv.style.fontSize = '12px';
                roleDiv.style.color = 'var(--text-secondary)';
                roleDiv.textContent = currentUser.role === 'owner' ? 'Owner ğŸ¤´' : 'KullanÄ±cÄ±';
                
                const onlineDot = document.createElement('div');
                onlineDot.style.width = '10px';
                onlineDot.style.height = '10px';
                onlineDot.style.borderRadius = '50%';
                onlineDot.style.background = 'var(--online)';
                onlineDot.style.marginLeft = 'auto';
                
                infoDiv.appendChild(nameDiv);
                infoDiv.appendChild(roleDiv);
                
                userDiv.appendChild(avatar);
                userDiv.appendChild(infoDiv);
                userDiv.appendChild(onlineDot);
                
                userList.appendChild(userDiv);
            }
            
            const count = currentUser ? 1 : 0;
            if (onlineCount) onlineCount.textContent = count;
            if (chatOnlineCount) chatOnlineCount.textContent = count;
        }

        function openUserContextMenu(username, element) {
            // Context menu oluÅŸtur
            const menu = document.createElement('div');
            menu.style.position = 'absolute';
            menu.style.background = 'var(--bg-secondary)';
            menu.style.border = '1px solid var(--border-color)';
            menu.style.borderRadius = '8px';
            menu.style.boxShadow = '0 4px 12px rgba(0,0,0,0.3)';
            menu.style.zIndex = '10000';
            menu.style.minWidth = '200px';
            menu.style.overflow = 'hidden';
            
            const rect = element.getBoundingClientRect();
            menu.style.top = (rect.bottom + 5) + 'px';
            menu.style.left = rect.left + 'px';
            
            // MenÃ¼ Ã¶ÄŸeleri
            const menuItems = [
                { text: 'ğŸ“¨ Ã–zel Mesaj GÃ¶nder', action: () => openPrivateChat(username) },
                { text: 'ğŸ‘¤ Profilini GÃ¶r', action: () => viewUserProfile(username) }
            ];
            
            // Admin yetkileri
            if (isOwner || isAdmin || isCoAdmin) {
                menuItems.push(
                    { separator: true },
                    { text: 'âš ï¸ UyarÄ± Ver', action: () => warnUserCommand(username) },
                    { text: 'ğŸšª Kick At', action: () => kickUserCommand(username) }
                );
            }
            
            // Owner yetkileri
            if (isOwner || isAdmin) {
                menuItems.push(
                    { text: 'ğŸš« Banla', action: () => banUserCommand(username) },
                    { text: 'ğŸ‘‘ Admin Yap', action: () => promoteToAdmin(username) }
                );
            }
            
            menuItems.forEach(item => {
                if (item.separator) {
                    const separator = document.createElement('div');
                    separator.style.height = '1px';
                    separator.style.background = 'var(--border-color)';
                    separator.style.margin = '5px 0';
                    menu.appendChild(separator);
                } else {
                    const menuItem = document.createElement('div');
                    menuItem.style.padding = '10px 15px';
                    menuItem.style.cursor = 'pointer';
                    menuItem.style.transition = 'background 0.2s';
                    menuItem.textContent = item.text;
                    
                    menuItem.onmouseenter = () => {
                        menuItem.style.background = 'rgba(0,0,0,0.1)';
                    };
                    menuItem.onmouseleave = () => {
                        menuItem.style.background = 'transparent';
                    };
                    
                    menuItem.onclick = () => {
                        item.action();
                        document.body.removeChild(menu);
                    };
                    
                    menu.appendChild(menuItem);
                }
            });
            
            // MenÃ¼yÃ¼ ekle
            document.body.appendChild(menu);
            
            // DÄ±ÅŸarÄ± tÄ±klanÄ±nca kapat
            const closeMenu = (e) => {
                if (!menu.contains(e.target) && e.target !== element) {
                    document.body.removeChild(menu);
                    document.removeEventListener('click', closeMenu);
                }
            };
            
            setTimeout(() => {
                document.addEventListener('click', closeMenu);
            }, 100);
        }

        // ========== SÄ°STEM BAÅLATMA FONKSÄ°YONLARI ==========
        async function initOwnerPassword() {
            try {
                const hash = await sha256(SECURE_CONFIG.OWNER_CONFIG.password);
                ownerPasswordHash = hash;
                console.log("âœ… Owner ÅŸifresi hazÄ±r");
            } catch (error) {
                console.error("Owner ÅŸifresi hash hatasÄ±:", error);
            }
        }

        async function loadCustomCommands() {
            if (!customCommandsRef) return;
            
            try {
                const snapshot = await customCommandsRef.once('value');
                customCommands = snapshot.val() || {};
                console.log("âœ… Ã–zel komutlar yÃ¼klendi");
            } catch (error) {
                console.error("Ã–zel komutlar yÃ¼klenirken hata:", error);
            }
        }

        async function updateBannedUsers() {
            if (!bansRef) return;
            
            try {
                const snapshot = await bansRef.once('value');
                bannedUsers = snapshot.val() || {};
                console.log("âœ… BanlÄ± kullanÄ±cÄ±lar yÃ¼klendi");
            } catch (error) {
                console.error("BanlÄ± kullanÄ±cÄ±lar yÃ¼klenirken hata:", error);
            }
        }

        function startBanMonitoring() {
            if (!bansRef) return;
            
            // Ban deÄŸiÅŸikliklerini dinle
            bansRef.on('child_added', (snapshot) => {
                const banData = snapshot.val();
                bannedUsers[snapshot.key] = banData;
            });
            
            bansRef.on('child_removed', (snapshot) => {
                delete bannedUsers[snapshot.key];
            });
            
            console.log("âœ… Ban izleme baÅŸlatÄ±ldÄ±");
        }

        function startUserLocksCleanup() {
            if (!userLocksRef) return;
            
            // 5 dakikada bir eski kilitleri temizle
            setInterval(async () => {
                try {
                    const snapshot = await userLocksRef.once('value');
                    const locks = snapshot.val() || {};
                    const now = Date.now();
                    
                    Object.entries(locks).forEach(async ([key, lock]) => {
                        if (lock.expiresAt && lock.expiresAt < now) {
                            await userLocksRef.child(key).remove();
                        }
                    });
                } catch (error) {
                    console.error("Kilit temizleme hatasÄ±:", error);
                }
            }, 300000);
            
            console.log("âœ… KullanÄ±cÄ± kilit temizleyici baÅŸlatÄ±ldÄ±");
        }

        async function loadStories() {
            if (!storiesRef) return;
            
            try {
                const snapshot = await storiesRef.once('value');
                const allStories = snapshot.val() || {};
                stories = [];
                
                const now = Date.now();
                Object.entries(allStories).forEach(([id, story]) => {
                    if (story.expiresAt > now) {
                        stories.push({ ...story, id });
                    } else {
                        // SÃ¼resi dolan story'leri sil
                        storiesRef.child(id).remove();
                    }
                });
                
                console.log(`âœ… ${stories.length} aktif story yÃ¼klendi`);
                updateStoryContainer();
                
            } catch (error) {
                console.error("Story yÃ¼kleme hatasÄ±:", error);
            }
        }

        function updateStoryContainer() {
            const storyWrapper = document.getElementById('storyWrapper');
            if (!storyWrapper) return;
            
            // My Story butonunu koru
            const myStoryButton = storyWrapper.querySelector('.story-item:first-child');
            storyWrapper.innerHTML = '';
            
            if (myStoryButton) {
                storyWrapper.appendChild(myStoryButton);
            } else {
                // My Story butonu yoksa oluÅŸtur
                const myStoryDiv = document.createElement('div');
                myStoryDiv.className = 'story-item';
                myStoryDiv.onclick = openMyStory;
                myStoryDiv.innerHTML = `
                    <div class="story-avatar my-story">
                        +
                    </div>
                    <div class="story-user">Story Ekle</div>
                `;
                storyWrapper.appendChild(myStoryDiv);
            }
            
            // Aktif story'leri ekle
            stories.forEach(story => {
                const storyItem = document.createElement('div');
                storyItem.className = 'story-item';
                storyItem.onclick = () => openStoryModal(story.sender);
                
                const isSeen = false; // Burada gÃ¶rÃ¼ldÃ¼ bilgisi kontrol edilebilir
                const likes = storyLikes[story.id] || [];
                
                storyItem.innerHTML = `
                    <div class="story-avatar ${isSeen ? 'seen' : ''}" style="background: ${story.color || '#ff6b6b'}">
                        ${story.sender.charAt(0).toUpperCase()}
                    </div>
                    <div class="story-user">${story.sender}</div>
                    ${likes.length > 0 ? `<div class="story-badge">${likes.length}</div>` : ''}
                `;
                
                storyWrapper.appendChild(storyItem);
            });
            
            // Story sayÄ±sÄ±nÄ± gÃ¼ncelle
            const storyToggleBadge = document.getElementById('storyToggleBadge');
            if (storyToggleBadge) {
                storyToggleBadge.textContent = stories.length;
                storyToggleBadge.style.display = stories.length > 0 ? 'flex' : 'none';
            }
        }

        async function loadStoryLikes() {
            if (!storyLikesRef) return;
            
            try {
                const snapshot = await storyLikesRef.once('value');
                storyLikes = snapshot.val() || {};
                console.log("âœ… Story beÄŸenileri yÃ¼klendi");
            } catch (error) {
                console.error("Story beÄŸenileri yÃ¼klenirken hata:", error);
            }
        }

        async function loadStoryReports() {
            if (!storyReportsRef) return;
            
            try {
                const snapshot = await storyReportsRef.once('value');
                storyReports = snapshot.val() || {};
                console.log("âœ… Story ÅŸikayetleri yÃ¼klendi");
            } catch (error) {
                console.error("Story ÅŸikayetleri yÃ¼klenirken hata:", error);
            }
        }

        async function loadChannels() {
            if (!channelsRef) return;
            
            try {
                const snapshot = await channelsRef.once('value');
                const channelsData = snapshot.val() || {};
                
                // VarsayÄ±lan kanallarÄ± ekle
                SECURE_CONFIG.CHANNEL_CONFIG.defaultChannels.forEach(channelName => {
                    if (!channelsData[channelName]) {
                        channelsData[channelName] = {
                            name: channelName,
                            creator: 'System',
                            createdAt: Date.now(),
                            type: 'public',
                            description: `${channelName} kanalÄ±`
                        };
                    }
                });
                
                channels = channelsData;
                updateChannelsList();
                
                console.log(`âœ… ${Object.keys(channels).length} kanal yÃ¼klendi`);
                
            } catch (error) {
                console.error('Kanallar yÃ¼klenirken hata:', error);
            }
        }

        function updateChannelsList() {
            const channelList = document.getElementById('channelList');
            const channelsCount = document.getElementById('channelsCount');
            
            if (!channelList) return;
            
            channelList.innerHTML = '';
            let count = 0;
            
            Object.entries(channels).forEach(([channelName, channelData]) => {
                count++;
                
                const channelItem = document.createElement('div');
                channelItem.className = `channel-item ${currentChannel === channelName ? 'active' : ''}`;
                channelItem.innerHTML = `
                    <div style="font-weight: 500;">${channelName}</div>
                    <div style="font-size: 12px; color: var(--text-secondary);">${channelData.description || ''}</div>
                    <div style="font-size: 10px; color: var(--text-secondary); margin-top: 3px;">
                        ${channelData.type === 'public' ? 'ğŸŒ' : channelData.type === 'private' ? 'ğŸ”’' : 'ğŸ”'} ${channelData.creator || 'Sistem'}
                    </div>
                `;
                
                channelItem.onclick = () => switchChannel(channelName);
                channelList.appendChild(channelItem);
            });
            
            if (channelsCount) {
                channelsCount.textContent = count;
            }
        }

        function switchChannel(channelName) {
            if (!currentUser) return;
            
            currentChannel = channelName;
            document.getElementById('currentChannel').textContent = channelName;
            
            // Kanal mesajlarÄ±nÄ± temizle
            const messagesContainer = document.getElementById('messages');
            if (messagesContainer) {
                messagesContainer.innerHTML = `<div class="yt-message system">ğŸ‰ ${channelName} kanalÄ±na hoÅŸ geldiniz!</div>`;
            }
            
            // KullanÄ±cÄ±nÄ±n bulunduÄŸu kanalÄ± gÃ¼ncelle
            if (usersRef) {
                usersRef.child(currentUser.name).update({
                    currentChannel: channelName
                });
            }
            
            // Mesaj listener'Ä±nÄ± yeniden baÅŸlat
            if (messageListener && messagesRef) {
                messagesRef.off('child_added', messageListener);
                
                messageListener = messagesRef.on('child_added', (snapshot) => {
                    const message = snapshot.val();
                    if (message && (!message.channel || message.channel === currentChannel)) {
                        addMessageToChat(message);
                    }
                });
            }
            
            updateChannelsList();
            addSystemMessage(`âœ… ${channelName} kanalÄ±na geÃ§ildi!`);
        }

        // ========== TÃœM TANIMSIZ FONKSÄ°YONLARI TANIMLA ==========
        function toggleProfilePanel() {
            const panel = document.getElementById('profilePanel');
            profilePanelOpen = !profilePanelOpen;
            
            if (profilePanelOpen) {
                panel.classList.add('active');
                updateProfilePanel();
            } else {
                panel.classList.remove('active');
            }
        }

        function openStoryCreateModal() {
            if (!currentUser) {
                addSystemMessage('â›” Ã–nce giriÅŸ yapmalÄ±sÄ±nÄ±z!');
                return;
            }
            
            document.getElementById('storyCreateModal').style.display = 'block';
            document.getElementById('overlay').style.display = 'block';
            
            // VarsayÄ±lan ayarlar
            selectStoryType('text');
            changeStoryColor('#ff6b6b');
        }

        function closeStoryCreateModal() {
            document.getElementById('storyCreateModal').style.display = 'none';
            document.getElementById('overlay').style.display = 'none';
            
            // AlanlarÄ± temizle
            document.getElementById('story-text').value = '';
            document.getElementById('preview-image').style.display = 'none';
        }

        function viewMyStories() {
            if (!currentUser) {
                addSystemMessage('â›” Ã–nce giriÅŸ yapmalÄ±sÄ±nÄ±z!');
                return;
            }
            
            const myStories = stories.filter(story => story.sender === currentUser.name);
            if (myStories.length === 0) {
                addSystemMessage('ğŸ“± HenÃ¼z hiÃ§ story paylaÅŸmadÄ±nÄ±z.');
                return;
            }
            
            currentStories = myStories;
            currentStoryIndex = 0;
            showStory(currentStoryIndex);
            
            document.getElementById('storyModal').style.display = 'block';
            document.getElementById('overlay').style.display = 'block';
            startStoryProgress();
        }

        function openMyStory() {
            openStoryCreateModal();
        }

        function handleStoryImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (!file.type.startsWith('image/')) {
                alert('âŒ Sadece resim dosyalarÄ± yÃ¼kleyebilirsiniz!');
                return;
            }
            
            if (file.size > SECURE_CONFIG.STORY_CONFIG.maxImageSize) {
                alert(`âŒ Resim boyutu ${SECURE_CONFIG.STORY_CONFIG.maxImageSize / (1024 * 1024)}MB'dan kÃ¼Ã§Ã¼k olmalÄ±!`);
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = document.getElementById('preview-image');
                img.src = e.target.result;
                img.style.display = 'block';
            };
            reader.readAsDataURL(file);
        }

        function openChannelCreateModal() {
            document.getElementById('channelCreateModal').style.display = 'block';
            document.getElementById('overlay').style.display = 'block';
        }

        function closeChannelCreateModal() {
            document.getElementById('channelCreateModal').style.display = 'none';
            document.getElementById('overlay').style.display = 'none';
            
            // AlanlarÄ± temizle
            document.getElementById('channelName').value = '';
            document.getElementById('channelDescription').value = '';
            document.getElementById('channelPassword').value = '';
            document.getElementById('channelPassword').style.display = 'none';
        }

        async function createNewChannel() {
            if (!currentUser) {
                addSystemMessage('â›” Ã–nce giriÅŸ yapmalÄ±sÄ±nÄ±z!');
                return;
            }
            
            const name = document.getElementById('channelName').value.trim();
            const description = document.getElementById('channelDescription').value.trim();
            const type = document.getElementById('channelType').value;
            const password = document.getElementById('channelPassword').value;
            
            if (!name || !name.startsWith('#')) {
                alert('âŒ Kanal adÄ± # ile baÅŸlamalÄ±!');
                return;
            }
            
            if (channels[name]) {
                alert('âŒ Bu kanal adÄ± zaten kullanÄ±lÄ±yor!');
                return;
            }
            
            try {
                const channelData = {
                    name: name,
                    description: description || `${name} kanalÄ±`,
                    creator: currentUser.name,
                    createdAt: Date.now(),
                    type: type,
                    password: type === 'protected' ? password : null
                };
                
                await channelsRef.child(name).set(channelData);
                channels[name] = channelData;
                
                closeChannelCreateModal();
                updateChannelsList();
                
                addSystemMessage(`âœ… ${name} kanalÄ± oluÅŸturuldu!`);
                
                // Yeni kanala geÃ§
                switchChannel(name);
                
            } catch (error) {
                console.error('Kanal oluÅŸturma hatasÄ±:', error);
                addSystemMessage('âŒ Kanal oluÅŸturulamadÄ±!');
            }
        }

        function openAdminPanel() {
            if (!isOwner && !isAdmin) {
                addSystemMessage('â›” Bu paneli kullanma yetkiniz yok!');
                return;
            }
            
            document.getElementById('ownerPanel').style.display = 'block';
            document.getElementById('overlay').style.display = 'block';
        }

        function closeOwnerPanel() {
            document.getElementById('ownerPanel').style.display = 'none';
            document.getElementById('overlay').style.display = 'none';
        }

        function openMatebBotPanel() {
            document.getElementById('matebBotPanel').style.display = 'block';
            document.getElementById('overlay').style.display = 'block';
        }

        function closeMatebBotPanel() {
            document.getElementById('matebBotPanel').style.display = 'none';
            document.getElementById('overlay').style.display = 'none';
        }

        function toggleNotificationPanel(event) {
            event.stopPropagation();
            const panel = document.getElementById('notificationPanel');
            notificationPanelOpen = !notificationPanelOpen;
            
            if (notificationPanelOpen) {
                panel.style.display = 'block';
                panel.style.position = 'absolute';
                panel.style.top = '60px';
                panel.style.right = '10px';
                panel.style.zIndex = '1000';
            } else {
                panel.style.display = 'none';
            }
        }

        function closeNotificationPanel() {
            document.getElementById('notificationPanel').style.display = 'none';
            notificationPanelOpen = false;
        }

        function clearAllNotifications() {
            notifications = [];
            notificationCount = 0;
            document.getElementById('notificationBadge').textContent = '0';
            document.getElementById('notificationList').innerHTML = '<div style="padding: 20px; text-align: center; color: var(--text-secondary);">Bildirim yok</div>';
        }

        function toggleReportPanel(event) {
            event.stopPropagation();
            const panel = document.getElementById('reportPanel');
            reportPanelOpen = !reportPanelOpen;
            
            if (reportPanelOpen) {
                panel.style.display = 'block';
                panel.style.position = 'absolute';
                panel.style.top = '60px';
                panel.style.right = '10px';
                panel.style.zIndex = '1000';
            } else {
                panel.style.display = 'none';
            }
        }

        function closeReportPanel() {
            document.getElementById('reportPanel').style.display = 'none';
            reportPanelOpen = false;
        }

        function openReportsModal() {
            // Burada detaylÄ± ÅŸikayet listesi modalÄ± aÃ§Ä±labilir
            addSystemMessage('ğŸ“‹ Åikayetler listesi geliÅŸtirme aÅŸamasÄ±nda...');
        }

        function viewUserProfile(username) {
            addSystemMessage(`ğŸ‘¤ ${username} kullanÄ±cÄ±sÄ±nÄ±n profili gÃ¶rÃ¼ntÃ¼leniyor...`);
            // Profil modalÄ± aÃ§Ä±labilir
        }

        function warnUserCommand(username) {
            if (!isOwner && !isAdmin && !isCoAdmin) return;
            
            const reason = prompt(`${username} kullanÄ±cÄ±sÄ±na uyarÄ± verme sebebi:`, 'Kural ihlali');
            if (reason) {
                addSystemMessage(`âš ï¸ ${username} kullanÄ±cÄ±sÄ±na uyarÄ± verildi: ${reason}`);
                // UyarÄ±yÄ± kaydet
            }
        }

        function kickUserCommand(username) {
            if (!isOwner && !isAdmin && !isCoAdmin) return;
            
            const reason = prompt(`${username} kullanÄ±cÄ±sÄ±nÄ± atma sebebi:`, 'Kural ihlali');
            if (reason) {
                addSystemMessage(`ğŸšª ${username} kullanÄ±cÄ±sÄ± atÄ±ldÄ±: ${reason}`);
                // Kick iÅŸlemi
                if (usersRef) {
                    usersRef.child(username).remove();
                }
            }
        }

        function banUserCommand(username) {
            if (!isOwner && !isAdmin) return;
            
            const reason = prompt(`${username} kullanÄ±cÄ±sÄ±nÄ± banlama sebebi:`, 'Ciddi kural ihlali');
            if (reason) {
                const duration = prompt('Ban sÃ¼resi (dakika):', '60');
                if (duration) {
                    // Ban iÅŸlemi
                    const banData = {
                        username: username,
                        bannedBy: currentUser.name,
                        reason: reason,
                        duration: parseInt(duration) * 60000,
                        bannedAt: Date.now(),
                        expiresAt: Date.now() + (parseInt(duration) * 60000)
                    };
                    
                    if (bansRef) {
                        bansRef.child(username).set(banData);
                    }
                    
                    if (usersRef) {
                        usersRef.child(username).remove();
                    }
                    
                    addSystemMessage(`ğŸš« ${username} kullanÄ±cÄ±sÄ± ${duration} dakika banlandÄ±: ${reason}`);
                }
            }
        }

        function promoteToAdmin(username) {
            if (!isOwner) return;
            
            const role = prompt('Yeni rol (admin/coadmin/operator):', 'operator');
            if (role && ['admin', 'coadmin', 'operator'].includes(role)) {
                addSystemMessage(`ğŸ‘‘ ${username} kullanÄ±cÄ±sÄ± ${role} olarak atandÄ±!`);
                // Yetki atama iÅŸlemi
            }
        }

        function closeStoryModal() {
            document.getElementById('storyModal').style.display = 'none';
            document.getElementById('overlay').style.display = 'none';
            
            if (storyProgressInterval) {
                clearInterval(storyProgressInterval);
                storyProgressInterval = null;
            }
            
            currentStories = [];
            currentStoryIndex = 0;
        }

        function reportCurrentStory() {
            if (!currentUser || !currentStoryId) return;
            
            const reasons = ['Uygunsuz iÃ§erik', 'Spam', 'Nefret sÃ¶ylemi', 'DiÄŸer'];
            const reason = prompt('Åikayet sebebi:\n' + reasons.join('\n'), reasons[0]);
            
            if (reason) {
                addSystemMessage(`âš ï¸ Story ÅŸikayet edildi: ${reason}`);
                // Åikayeti kaydet
            }
        }

        // ========== IRC KOMUTLARI ==========
        function showHelp() {
            const helpMessage = `
                ğŸ“‹ POPBOX CHAT KOMUTLARI:
                
                ğŸ‘¤ GENEL KOMUTLAR:
                /yardÄ±m - TÃ¼m komutlarÄ± gÃ¶ster
                /online - Online kullanÄ±cÄ±larÄ± listele
                /me <mesaj> - Aksiyon mesajÄ± gÃ¶nder
                /msg <nick> <mesaj> - Ã–zel mesaj gÃ¶nder
                /nick <yeni_nick> - Nick deÄŸiÅŸtir
                /ignore <nick> - KullanÄ±cÄ±yÄ± engelle
                
                ğŸ® CHAT KOMUTLARI:
                /join <#kanal> - Kanala katÄ±l
                /list - TÃ¼m kanallarÄ± listele
                /topic <konu> - Kanal konusunu deÄŸiÅŸtir
                /away <mesaj> - Uzakta olduÄŸunu belirt
                /back - Geri dÃ¶ndÃ¼ÄŸÃ¼nÃ¼ belirt
                
                ğŸ‘‘ YÃ–NETÄ°CÄ° KOMUTLARI:
                /kick <nick> <sebep> - KullanÄ±cÄ±yÄ± at
                /ban <nick> <sebep> - KullanÄ±cÄ±yÄ± banla
                /unban <nick> - BanÄ± kaldÄ±r
                /clear - Sohbeti temizle
                /mode <kanal> <mod> - Kanal modunu deÄŸiÅŸtir
                
                ğŸ“± Ã–ZEL KOMUTLAR:
                /abone - Abonelik paketlerini gÃ¶ster
                /story - Yeni story oluÅŸtur
                /mystories - Story'lerimi gÃ¶rÃ¼ntÃ¼le
                /report <nick> <sebep> - KullanÄ±cÄ±yÄ± ÅŸikayet et
                
                ğŸ›¡ï¸ GÃœVENLÄ°K:
                /rules - Sohbet kurallarÄ±nÄ± gÃ¶ster
                /whois <nick> - KullanÄ±cÄ± bilgilerini gÃ¶ster
            `;
              
            addSystemMessage(helpMessage);
        }

        function showOnlineUsers() {
            const userList = document.getElementById('userList');
            if (userList.children.length === 0) {
                addSystemMessage('ğŸ‘¥ HenÃ¼z online kullanÄ±cÄ± yok.');
            } else {
                const users = Array.from(userList.querySelectorAll('.user-item')).map(item => {
                    return item.querySelector('div[style*="font-weight: bold"]').textContent;
                }).join(', ');
                
                addSystemMessage(`ğŸ‘¥ Online kullanÄ±cÄ±lar (${userList.children.length}): ${users}`);
            }
        }

        function sendAction(action) {
            if (!currentUser || !action) return;
            
            const messageData = {
                sender: currentUser.name,
                text: `* ${action} *`,
                type: 'action',
                timestamp: Date.now(),
                time: new Date().toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' }),
                channel: currentChannel
            };
            
            if (messagesRef) {
                messagesRef.push(messageData);
            } else {
                addMessageToChat(messageData);
            }
        }

        function clearChat() {
            if (!isOwner && !isAdmin && !isCoAdmin) {
                addSystemMessage('â›” Bu komutu kullanma yetkiniz yok!');
                return;
            }
            
            const container = document.getElementById('messages');
            if (container) {
                container.innerHTML = '<div class="yt-message system">ğŸ’¥ Sohbet temizlendi!</div>';
            }
            
            addSystemMessage('ğŸ’¥ Sohbet temizlendi!');
        }

        function listChannels() {
            const channelList = Object.keys(channels).join(', ');
            addSystemMessage(`#ï¸âƒ£ Kanallar (${Object.keys(channels).length}): ${channelList}`);
        }

        function showRules() {
            const rules = `
                ğŸ“œ SOCHAT KURALLARI:
                1. KÃ¼fÃ¼r ve hakaret yasaktÄ±r
                2. Spam yapmak yasaktÄ±r
                3. IrkÃ§Ä±lÄ±k ve ayrÄ±mcÄ±lÄ±k yasaktÄ±r
                4. Yetkililere saygÄ±lÄ± olun
                5. Ã–zel bilgi paylaÅŸÄ±mÄ± yasaktÄ±r
                6. Uygunsuz iÃ§erik paylaÅŸÄ±mÄ± yasaktÄ±r
                
                âš ï¸ Kural ihlalleri ban ile sonuÃ§lanabilir!
            `;
            
            addSystemMessage(rules);
        }

        // ========== UTILITY FONKSÄ°YONLAR ==========
        function showLoginError(message) {
            const errorElement = document.getElementById('login-error');
            if (errorElement) {
                errorElement.innerHTML = message;
                errorElement.style.display = message ? 'block' : 'none';
                errorElement.style.color = 'var(--ban-color)';
                errorElement.style.background = 'rgba(255, 51, 51, 0.1)';
                errorElement.style.padding = '10px';
                errorElement.style.borderRadius = '8px';
                errorElement.style.borderLeft = '3px solid var(--ban-color)';
                errorElement.style.margin = '10px 0';
            }
        }

        function showLoginSuccess(message) {
            const successElement = document.getElementById('login-success');
            if (successElement) {
                successElement.innerHTML = message;
                successElement.style.display = message ? 'block' : 'none';
                successElement.style.color = 'var(--online)';
                successElement.style.background = 'rgba(76, 175, 80, 0.1)';
                successElement.style.padding = '10px';
                successElement.style.borderRadius = '8px';
                successElement.style.borderLeft = '3px solid var(--online)';
                successElement.style.margin = '10px 0';
            }
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function getUserColor(username) {
            if (username === SECURE_CONFIG.OWNER_CONFIG.username) return '#ff4081';
            if (adminList.includes(username)) return '#ff0000';
            if (coAdminList.includes(username)) return '#ff9800';
            if (operatorList.includes(username)) return '#3b82f6';
            if (currentUser && username === currentUser.name) {
                if (currentUser.subscription === 'premium') return '#ffd700';
                if (currentUser.subscription === 'abone') return '#ff4081';
                if (currentUser.subscription === 'member') return '#4caf50';
            }
            return '#4caf50';
        }

        function formatTime(timestamp) {
            const date = new Date(timestamp);
            return date.toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' });
        }

        function capitalizeFirstLetter(string) {
            return string.charAt(0).toUpperCase() + string.slice(1);
        }

        async function sha256(message) {
            const msgBuffer = new TextEncoder().encode(message);
            const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        }

        // ========== MATEB GÃœVENLÄ°K BOTU ==========
        class MateBSecurityBot {
            constructor() {
                this.name = SECURE_CONFIG.BOT_CONFIG.name;
                this.securityLevel = SECURE_CONFIG.BOT_CONFIG.securityLevel;
                this.logs = [];
                this.suspiciousActivities = [];
                this.autoMessageInterval = null;
                this.securityScanInterval = null;
            }
              
            log(message, type = 'info') {
                const timestamp = new Date().toLocaleTimeString();
                const logEntry = {
                    timestamp: timestamp,
                    message: message,
                    type: type
                };
                  
                this.logs.push(logEntry);
                  
                // Log'u arayÃ¼ze ekle
                const logsContainer = document.getElementById('matebBotLogs');
                if (logsContainer) {
                    const logElement = document.createElement('div');
                    logElement.className = `bot-log-entry ${type}`;
                    logElement.innerHTML = `[${timestamp}] ${message}`;
                    logsContainer.appendChild(logElement);
                    logsContainer.scrollTop = logsContainer.scrollHeight;
                }
                  
                console.log(`[MateB Bot] ${message}`);
            }
              
            sendWelcome(user) {
                const messages = SECURE_CONFIG.BOT_CONFIG.welcomeMessages;
                const randomMessage = messages[Math.floor(Math.random() * messages.length)];
                const formattedMessage = randomMessage.replace('{user}', user);
                  
                this.sendMessage(formattedMessage);
                this.log(`${user} kullanÄ±cÄ±sÄ±na hoÅŸ geldin mesajÄ± gÃ¶nderildi`, 'success');
            }
              
            sendAutoMessage() {
                const messages = SECURE_CONFIG.BOT_CONFIG.autoMessages;
                const randomMessage = messages[Math.floor(Math.random() * messages.length)];
                this.sendMessage(randomMessage);
            }
              
            sendMessage(text) {
                if (!messagesRef) return;
                  
                const messageData = {
                    sender: this.name,
                    text: text,
                    type: 'system',
                    timestamp: Date.now(),
                    time: new Date().toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' }),
                    isBot: true
                };
                  
                messagesRef.push(messageData);
            }
              
            scanForSpam() {
                this.log('Spam taramasÄ± baÅŸlatÄ±ldÄ±', 'warning');
                // Spam tarama algoritmasÄ±
            }
              
            startAutoMessages() {
                if (this.autoMessageInterval) {
                    clearInterval(this.autoMessageInterval);
                }
                  
                this.autoMessageInterval = setInterval(() => {
                    this.sendAutoMessage();
                }, SECURE_CONFIG.BOT_CONFIG.messageInterval);
                  
                this.log('Otomatik mesaj sistemi baÅŸlatÄ±ldÄ±', 'success');
            }
              
            startSecurityScans() {
                if (this.securityScanInterval) {
                    clearInterval(this.securityScanInterval);
                }
                  
                this.securityScanInterval = setInterval(() => {
                    this.scanForSpam();
                }, 60000);
                
                this.log('GÃ¼venlik taramalarÄ± baÅŸlatÄ±ldÄ±', 'success');
            }
              
            sendSystemAnnouncement() {
                const announcement = "ğŸ“¢ Sistem Duyurusu: LÃ¼tfen sohbet kurallarÄ±na uyunuz. Spam, kÃ¼fÃ¼r ve uygunsuz iÃ§erik yasaktÄ±r.";
                this.sendMessage(announcement);
                this.log('Sistem duyurusu gÃ¶nderildi', 'info');
            }
              
            clearLogs() {
                this.logs = [];
                const logsContainer = document.getElementById('matebBotLogs');
                if (logsContainer) {
                    logsContainer.innerHTML = '';
                }
                this.log('Loglar temizlendi', 'info');
            }
              
            stopAll() {
                if (this.autoMessageInterval) {
                    clearInterval(this.autoMessageInterval);
                    this.autoMessageInterval = null;
                }
                  
                if (this.securityScanInterval) {
                    clearInterval(this.securityScanInterval);
                    this.securityScanInterval = null;
                }
                  
                this.log('TÃ¼m sistemler durduruldu', 'warning');
            }
        }

        // Bot instance oluÅŸtur
        let bot = new MateBSecurityBot();

        // ========== SAYFA YÃœKLENDÄ°ÄÄ°NDE ==========
        window.addEventListener('load', function() {
            console.log("ğŸ“± Popbox Chat yÃ¼klendi!");
              
            originalTitle = document.title;
            loadTheme();
              
            checkFirebaseConnection();
            initializeFirebase();
              
            document.getElementById('login-nick').focus();
              
            // Enter tuÅŸu ile giriÅŸ
            document.getElementById('login-nick').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') login();
            });
              
            document.getElementById('login-password').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') login();
            });
              
            // Enter tuÅŸu ile mesaj gÃ¶nderme
            document.getElementById('message-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
              
            // Enter tuÅŸu ile Ã¶zel mesaj gÃ¶nderme
            document.getElementById('private-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendPrivateMessage();
                }
            });
              
            // Overlay click
            document.getElementById('overlay').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeAllModals();
                }
            });
              
            // YouTube Player
            function onYouTubeIframeAPIReady() {
                console.log("ğŸ¬ YouTube API hazÄ±r!");
                initYouTubePlayer();
            }
            window.onYouTubeIframeAPIReady = onYouTubeIframeAPIReady;
              
            // Firebase badge durumu
            const badgeHidden = localStorage.getItem('firebaseBadgeHidden') === 'true';
            if (badgeHidden) {
                document.getElementById('firebaseBadge').classList.add('hidden');
            }
            
            // KullanÄ±cÄ± adÄ± deÄŸiÅŸikliklerini dinle
            document.getElementById('login-nick').addEventListener('input', checkUsernameRealTime);
        });

        function closeAllModals() {
            document.getElementById('overlay').style.display = 'none';
            document.querySelectorAll('.subscription-modal, .owner-panel, .private-modal, .channel-create-modal, .story-modal, .mateb-bot-panel, .image-modal, .story-create-modal').forEach(modal => {
                modal.style.display = 'none';
            });
            
            // Profil panelini kapat
            document.getElementById('profilePanel').classList.remove('active');
            profilePanelOpen = false;
            
            // Bildirim panellerini kapat
            closeNotificationPanel();
            closeReportPanel();
        }

        // YouTube Player
        function initYouTubePlayer() {
            if (typeof YT === 'undefined' || typeof YT.Player === 'undefined') {
                // YouTube API henÃ¼z yÃ¼klenmediyse bekleyelim
                setTimeout(initYouTubePlayer, 1000);
                return;
            }
              
            try {
                player = new YT.Player('youtube-player', {
                    height: '100%',
                    width: '100%',
                    videoId: 'dQw4w9WgXcQ', // Ã–rnek video
                    playerVars: {
                        autoplay: 0,
                        controls: 1,
                        modestbranding: 1,
                        rel: 0,
                        showinfo: 0
                    },
                    events: {
                        'onReady': onPlayerReady,
                        'onStateChange': onPlayerStateChange
                    }
                });
            } catch (error) {
                console.error("YouTube Player hatasÄ±:", error);
            }
        }

        function onPlayerReady(event) {
            console.log("âœ… YouTube Player hazÄ±r!");
        }

        function onPlayerStateChange(event) {
            // Player state deÄŸiÅŸiklikleri
        }

        // ========== TEMA SÄ°STEMÄ° ==========
        function toggleTheme() {
            const body = document.body;
            const themeBtn = document.querySelector('.theme-toggle');
              
            if (body.classList.contains('youtube-live-mode')) {
                body.classList.remove('youtube-live-mode');
                body.classList.add('night-mode');
                themeBtn.textContent = 'ğŸŒ™';
                themeBtn.title = 'Gece modu';
                localStorage.setItem('theme', 'night');
            } else if (body.classList.contains('night-mode')) {
                body.classList.remove('night-mode');
                body.classList.add('light-mode');
                themeBtn.textContent = 'â˜€ï¸';
                themeBtn.title = 'GÃ¼ndÃ¼z modu';
                localStorage.setItem('theme', 'light');
            } else {
                body.classList.remove('light-mode');
                body.classList.add('youtube-live-mode');
                themeBtn.textContent = 'ğŸ¬';
                themeBtn.title = 'YouTube Live temasÄ±';
                localStorage.setItem('theme', 'youtube');
            }
        }
          
        function loadTheme() {
            const savedTheme = localStorage.getItem('theme') || 'youtube';
            const body = document.body;
            const themeBtn = document.querySelector('.theme-toggle');
              
            body.classList.remove('youtube-live-mode', 'night-mode', 'light-mode');
              
            if (savedTheme === 'night') {
                body.classList.add('night-mode');
                if (themeBtn) {
                    themeBtn.textContent = 'ğŸŒ™';
                    themeBtn.title = 'Gece modu';
                }
            } else if (savedTheme === 'light') {
                body.classList.add('light-mode');
                if (themeBtn) {
                    themeBtn.textContent = 'â˜€ï¸';
                    themeBtn.title = 'GÃ¼ndÃ¼z modu';
                }
            } else {
                body.classList.add('youtube-live-mode');
                if (themeBtn) {
                    themeBtn.textContent = 'ğŸ¬';
                    themeBtn.title = 'YouTube Live temasÄ±';
                }
            }
        }

        // ========== FIREBASE BADGE ==========
        function toggleFirebaseBadge() {
            const badge = document.getElementById('firebaseBadge');
            badge.classList.toggle('hidden');
            localStorage.setItem('firebaseBadgeHidden', badge.classList.contains('hidden'));
        }

        // ========== OTURUM KAPATMA ==========
        function logout() {
            if (currentUser && usersRef) {
                usersRef.child(currentUser.name).remove();
            }
              
            if (bot) {
                bot.stopAll();
            }
              
            if (userListInterval) {
                clearInterval(userListInterval);
            }
              
            if (messageListener && messagesRef) {
                messagesRef.off('child_added', messageListener);
            }
              
            // TÃ¼m Firebase listener'larÄ±nÄ± temizle
            if (database) {
                database.goOffline();
            }
              
            location.reload();
        }

        console.log("âœ… TÃ¼m fonksiyonlar tanÄ±mlandÄ±!");
    </script>
      
    <!-- YouTube IFrame API -->
    <script src="https://www.youtube.com/iframe_api"></script>
</body>
</html>            --member-color: #4caf50;  
            --channel-color: #2196f3;  
            
            /* Layout - DEEPSEEK STILI UYGULANACAK */  
            --bg-primary: var(--youtube-dark);  
            --bg-secondary: var(--youtube-chat-bg);  
            --text-primary: var(--youtube-text);  
            --text-secondary: var(--youtube-text-secondary);  
            --input-bg: var(--youtube-chat-input);  
            --header-bg: var(--youtube-dark);  
            --border-color: rgba(255,255,255,0.1);  
            
            /* Blur efekti */  
            --blur-bg: rgba(0, 0, 0, 0.7);  
            --blur-intensity: blur(15px);  
            
            /* Mesaj Renkleri */  
            --message-user-bg: rgba(255,255,255,0.05);  
            --message-admin-bg: rgba(255,0,0,0.15);  
            --message-coadmin-bg: rgba(255,152,0,0.15);  
            --message-operator-bg: rgba(59,130,246,0.15);  
            --message-owner-bg: rgba(255,64,129,0.15);  
            --message-system-bg: rgba(255,255,255,0.05);  
            --message-private-bg: rgba(156,39,176,0.15);  
            --message-ban-bg: rgba(255,51,51,0.15);  
            --message-story-bg: rgba(255,107,107,0.15);  
            --message-report-bg: rgba(255,68,68,0.15);  
            --message-subscriber-bg: rgba(255,64,129,0.15);  
            --message-member-bg: rgba(76,175,80,0.15);  
            --message-channel-bg: rgba(33,150,243,0.15);  
        }  
        
        /* GECE TEMA (Koyu) */  
        body.night-mode {  
            --bg-primary: #1a1a2e;  
            --bg-secondary: #2d2d44;  
            --text-primary: #ffffff;  
            --text-secondary: #cccccc;  
            --input-bg: rgba(0,0,0,0.3);  
            --header-bg: rgba(0,0,0,0.4);  
            --border-color: rgba(79, 195, 247, 0.2);  
            --blur-bg: rgba(26, 26, 46, 0.8);  
            
            --primary: #4fc3f7;  
            --secondary: #ff5555;  
            --private: #9c27b0;  
            --coadmin: #ff9800;  
            --operator: #3b82f6;  
            --owner: #ff4081;  
            --online: #4caf50;  
            --firebase: #ffa000;  
            --ban-color: #ff3333;  
            --story-color: #ff6b6b;  
            --report-color: #ff4444;  
            --subscriber-color: #ff4081;  
            --premium-color: #ffd700;  
            --member-color: #4caf50;  
            --channel-color: #2196f3;  
            
            --message-user-bg: rgba(255,255,255,0.07);  
            --message-admin-bg: rgba(255,85,85,0.1);  
            --message-coadmin-bg: rgba(255,152,0,0.1);  
            --message-operator-bg: rgba(59,130,246,0.1);  
            --message-owner-bg: rgba(255,64,129,0.1);  
            --message-system-bg: rgba(76,175,80,0.1);  
            --message-private-bg: rgba(156,39,176,0.1);  
            --message-ban-bg: rgba(255,51,51,0.1);  
            --message-story-bg: rgba(255,107,107,0.1);  
            --message-report-bg: rgba(255,68,68,0.1);  
            --message-subscriber-bg: rgba(255,64,129,0.1);  
            --message-member-bg: rgba(76,175,80,0.1);  
            --message-channel-bg: rgba(33,150,243,0.1);  
        }  
        
        /* GÃœNDÃœZ TEMA (AÃ§Ä±k) */  
        body.light-mode {  
            --bg-primary: #f5f5f5;  
            --bg-secondary: #ffffff;  
            --text-primary: #333333;  
            --text-secondary: #666666;  
            --input-bg: rgba(0,0,0,0.05);  
            --header-bg: rgba(79, 195, 247, 0.1);  
            --border-color: rgba(0,0,0,0.1);  
            --blur-bg: rgba(245, 245, 245, 0.8);  
            
            --primary: #2196f3;  
            --secondary: #f44336;  
            --private: #9c27b0;  
            --coadmin: #ff9800;  
            --operator: #3b82f6;  
            --owner: #ff4081;  
            --online: #4caf50;  
            --firebase: #ffa000;  
            --ban-color: #ff3333;  
            --story-color: #ff6b6b;  
            --report-color: #ff4444;  
            --subscriber-color: #ff4081;  
            --premium-color: #ffd700;  
            --member-color: #4caf50;  
            --channel-color: #2196f3;  
            
            --message-user-bg: rgba(0,0,0,0.05);  
            --message-admin-bg: rgba(244,67,54,0.15);  
            --message-coadmin-bg: rgba(255,152,0,0.15);  
            --message-operator-bg: rgba(59,130,246,0.15);  
            --message-owner-bg: rgba(255,64,129,0.15);  
            --message-system-bg: rgba(76,175,80,0.15);  
            --message-private-bg: rgba(156,39,176,0.15);  
            --message-ban-bg: rgba(255,51,51,0.15);  
            --message-story-bg: rgba(255,107,107,0.15);  
            --message-report-bg: rgba(255,68,68,0.15);  
            --message-subscriber-bg: rgba(255,64,129,0.15);  
            --message-member-bg: rgba(76,175,80,0.15);  
            --message-channel-bg: rgba(33,150,243,0.15);  
        }  
        
        * {   
            margin: 0;   
            padding: 0;   
            box-sizing: border-box;  
            -webkit-tap-highlight-color: transparent;  
        }  
        
        html, body {  
            height: 100%;  
            width: 100%;  
            overflow: hidden;  
            position: fixed;  
        }  
        
        body {  
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;  
            background: var(--bg-primary);  
            color: var(--text-primary);  
            display: flex;  
            flex-direction: column;  
            overflow: hidden;  
            transition: all 0.3s ease;  
        }  
        
        /* BLUR EFFECT */  
        .blur-background {  
            background: var(--blur-bg) !important;  
            backdrop-filter: var(--blur-intensity) !important;  
            -webkit-backdrop-filter: var(--blur-intensity) !important;  
        }  
        
        /* HEADER - BLUR EFFECT */  
        .youtube-header {  
            height: 56px;  
            background: var(--header-bg);  
            display: flex;  
            align-items: center;  
            justify-content: space-between;  
            padding: 0 16px;  
            border-bottom: 1px solid var(--border-color);  
            position: fixed;  
            top: 0;  
            left: 0;  
            right: 0;  
            z-index: 1000;  
            flex-shrink: 0;  
            transition: all 0.3s ease;  
            backdrop-filter: blur(20px);  
            -webkit-backdrop-filter: blur(20px);  
        }  
        
        .header-left, .header-right {  
            display: flex;  
            align-items: center;  
            gap: 12px;  
        }  
        
        .logo {  
            display: flex;  
            align-items: center;  
            gap: 8px;  
            font-weight: 500;  
            color: var(--text-primary);  
            font-size: 18px;  
        }  
        
        .logo-icon {  
            color: var(--primary);  
            font-size: 24px;  
        }  
        
        .user-badges {  
            display: flex;  
            gap: 4px;  
        }  
        
        .badge {  
            font-size: 11px;  
            padding: 2px 6px;  
            border-radius: 10px;  
            display: none;  
            color: white;  
            font-weight: 500;  
        }  
        
        .badge.admin { background: var(--secondary); }  
        .badge.coadmin { background: var(--coadmin); }  
        .badge.operator { background: var(--operator); }  
        .badge.owner { background: var(--owner); }  
        .badge.story { background: var(--story-color); }  
        .badge.subscriber { background: var(--subscriber-color); }  
        .badge.premium { background: var(--premium-color); color: #000; }  
        .badge.member { background: var(--member-color); }  
        .badge.channel { background: var(--channel-color); }  
        
        /* STORY/HÄ°KAYE BÃ–LÃœMÃœ - INSTAGRAM STYLE */  
        .story-section {  
            position: relative;  
        }  
        
        .story-toggle-btn {  
            background: none;  
            border: none;  
            color: var(--story-color);  
            font-size: 20px;  
            cursor: pointer;  
            padding: 6px;  
            display: flex;  
            align-items: center;  
            justify-content: center;  
            position: relative;  
            border-radius: 8px;  
            transition: background 0.2s;  
        }  
        
        .story-toggle-btn:hover {  
            background: rgba(255,255,255,0.1);  
        }  
        
        .story-toggle-btn.active {  
            color: var(--owner);  
        }  
        
        .story-toggle-badge {  
            position: absolute;  
            top: 0;  
            right: 0;  
            background: var(--story-color);  
            color: white;  
            font-size: 10px;  
            font-weight: bold;  
            min-width: 16px;  
            height: 16px;  
            border-radius: 8px;  
            display: flex;  
            align-items: center;  
            justify-content: center;  
            padding: 0 4px;  
            display: none;  
        }  
        
        .story-container {  
            background: rgba(0, 0, 0, 0.95);  
            backdrop-filter: blur(20px);  
            -webkit-backdrop-filter: blur(20px);  
            border-bottom: 1px solid var(--border-color);  
            overflow-x: auto;  
            white-space: nowrap;  
            display: none;  
            position: fixed;  
            top: 56px;  
            left: 0;  
            right: 0;  
            z-index: 999;  
            transition: all 0.3s ease;  
            max-height: 0;  
            opacity: 0;  
            padding: 0;  
        }  
        
        .story-container.active {  
            display: block;  
            max-height: 120px;  
            opacity: 1;  
            padding: 10px 16px;  
        }  
        
        .story-wrapper {  
            display: inline-flex;  
            gap: 16px;  
            padding: 8px;  
        }  
        
        .story-item {  
            display: flex;  
            flex-direction: column;  
            align-items: center;  
            gap: 8px;  
            cursor: pointer;  
            min-width: 80px;  
            transition: all 0.3s ease;  
        }  
        
        .story-avatar {  
            width: 60px;  
            height: 60px;  
            border-radius: 50%;  
            position: relative;  
            border: 3px solid transparent;  
            background: linear-gradient(45deg, var(--story-color), var(--owner)) border-box;  
            -webkit-mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);  
            mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);  
            -webkit-mask-composite: xor;  
            mask-composite: exclude;  
            display: flex;  
            align-items: center;  
            justify-content: center;  
            font-size: 24px;  
        }  
        
        .story-avatar.seen {  
            background: linear-gradient(45deg, var(--text-secondary), var(--text-secondary)) border-box;  
        }  
        
        .story-avatar.my-story {  
            border: 3px solid var(--story-color);  
            background: none;  
            -webkit-mask: none;  
            mask: none;  
        }  
        
        .story-user {  
            font-size: 12px;  
            font-weight: 500;  
            color: var(--text-primary);  
            text-align: center;  
            max-width: 80px;  
            overflow: hidden;  
            text-overflow: ellipsis;  
        }  
        
        .story-badge {  
            position: absolute;  
            bottom: -5px;  
            right: -5px;  
            background: var(--story-color);  
            color: white;  
            width: 20px;  
            height: 20px;  
            border-radius: 50%;  
            display: flex;  
            align-items: center;  
            justify-content: center;  
            font-size: 11px;  
            font-weight: bold;  
            border: 2px solid var(--bg-secondary);  
        }  
        
        /* PROFÄ°L AÃ‡ILIR ALANI */  
        .profile-section {  
            position: relative;  
        }  
        
        .profile-btn {  
            background: none;  
            border: none;  
            color: var(--text-primary);  
            font-size: 20px;  
            cursor: pointer;  
            padding: 6px;  
            display: flex;  
            align-items: center;  
            justify-content: center;  
            border-radius: 8px;  
            transition: background 0.2s;  
            position: relative;  
        }  
        
        .profile-btn:hover {  
            background: rgba(255,255,255,0.1);  
        }  
        
        .profile-panel {  
            position: absolute;  
            top: 100%;  
            right: 0;  
            width: 320px;  
            background: var(--bg-secondary);  
            border: 1px solid var(--border-color);  
            border-radius: 12px;  
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);  
            z-index: 1001;  
            display: none;  
            flex-direction: column;  
            overflow: hidden;  
            backdrop-filter: blur(20px);  
            -webkit-backdrop-filter: blur(20px);  
        }  
        
        .profile-panel.active {  
            display: flex;  
        }  
        
        .profile-header {  
            padding: 20px;  
            background: linear-gradient(135deg, var(--primary), var(--secondary));  
            color: white;  
            display: flex;  
            align-items: center;  
            gap: 15px;  
        }  
        
        .profile-avatar {  
            width: 60px;  
            height: 60px;  
            border-radius: 50%;  
            background: rgba(255,255,255,0.2);  
            display: flex;  
            align-items: center;  
            justify-content: center;  
            font-size: 28px;  
            border: 3px solid rgba(255,255,255,0.3);  
        }  
        
        .profile-info {  
            flex: 1;  
        }  
        
        .profile-username {  
            font-weight: 600;  
            font-size: 18px;  
            margin-bottom: 4px;  
        }  
        
        .profile-role {  
            font-size: 13px;  
            opacity: 0.9;  
        }  
        
        .profile-body {  
            padding: 20px;  
            max-height: 400px;  
            overflow-y: auto;  
        }  
        
        .profile-stats {  
            display: grid;  
            grid-template-columns: 1fr 1fr;  
            gap: 15px;  
            margin-bottom: 20px;  
        }  
        
        .stat-item {  
            text-align: center;  
            padding: 15px;  
            background: rgba(0,0,0,0.05);  
            border-radius: 10px;  
            transition: transform 0.2s;  
        }  
        
        .stat-item:hover {  
            transform: translateY(-2px);  
        }  
        
        body.night-mode .stat-item {  
            background: rgba(255,255,255,0.05);  
        }  
        
        .stat-value {  
            font-size: 22px;  
            font-weight: 600;  
            color: var(--primary);  
        }  
        
        .stat-label {  
            font-size: 13px;  
            color: var(--text-secondary);  
        }  
        
        .profile-actions {  
            display: flex;  
            flex-direction: column;  
            gap: 10px;  
        }  
        
        .profile-action-btn {  
            padding: 14px 18px;  
            background: rgba(0,0,0,0.05);  
            border: none;  
            border-radius: 10px;  
            color: var(--text-primary);  
            text-align: left;  
            cursor: pointer;  
            transition: all 0.2s;  
            display: flex;  
            align-items: center;  
            gap: 12px;  
            font-size: 14px;  
        }  
        
        .profile-action-btn:hover {  
            background: rgba(0,0,0,0.1);  
            transform: translateX(5px);  
        }  
        
        body.night-mode .profile-action-btn {  
            background: rgba(255,255,255,0.05);  
        }  
        
        body.night-mode .profile-action-btn:hover {  
            background: rgba(255,255,255,0.1);  
        }  
        
        .profile-action-btn.subscribe {  
            background: var(--subscriber-color);  
            color: white;  
        }  
        
        .profile-action-btn.premium {  
            background: linear-gradient(135deg, var(--premium-color), #ff9800);  
            color: #000;  
        }  
        
        .profile-action-btn.owner-panel {  
            background: linear-gradient(135deg, var(--owner), #e91e63);  
            color: white;  
        }  
        
        .profile-action-btn.admin-panel {  
            background: linear-gradient(135deg, var(--secondary), #ff9800);  
            color: white;  
        }  
        
        .subscriber-badge {  
            background: var(--subscriber-color);  
            color: white;  
            padding: 4px 10px;  
            border-radius: 12px;  
            font-size: 11px;  
            font-weight: 600;  
        }  
        
        .premium-badge {  
            background: linear-gradient(135deg, var(--premium-color), #ff9800);  
            color: #000;  
            padding: 4px 10px;  
            border-radius: 12px;  
            font-size: 11px;  
            font-weight: 600;  
        }  
        
        .member-badge {  
            background: var(--member-color);  
            color: white;  
            padding: 4px 10px;  
            border-radius: 12px;  
            font-size: 11px;  
            font-weight: 600;  
        }  
        
        /* YOUTUBE STYLE ABONELÄ°K SÄ°STEMÄ° */  
        .subscription-modal {  
            position: fixed;  
            top: 50%;  
            left: 50%;  
            transform: translate(-50%, -50%);  
            background: var(--bg-secondary);  
            border: 1px solid var(--border-color);  
            border-radius: 20px;  
            z-index: 3000;  
            display: none;  
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);  
            backdrop-filter: blur(25px);  
            -webkit-backdrop-filter: blur(25px);  
            width: 90%;  
            max-width: 450px;  
            overflow: hidden;  
        }  
        
        .subscription-header {  
            padding: 25px;  
            background: linear-gradient(135deg, #ff0000, #cc0000);  
            color: white;  
            text-align: center;  
            position: relative;  
            overflow: hidden;  
        }  
        
        .subscription-header:before {  
            content: '';  
            position: absolute;  
            top: 0;  
            left: 0;  
            right: 0;  
            bottom: 0;  
            background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.1) 50%, transparent 70%);  
            animation: shine 3s infinite;  
        }  
        
        @keyframes shine {  
            0% { transform: translateX(-100%); }  
            100% { transform: translateX(100%); }  
        }  
        
        .subscription-body {  
            padding: 25px;  
        }  
        
        .subscription-plan {  
            padding: 20px;  
            border: 2px solid var(--border-color);  
            border-radius: 15px;  
            margin-bottom: 20px;  
            cursor: pointer;  
            transition: all 0.3s;  
            position: relative;  
            overflow: hidden;  
        }  
        
        .subscription-plan:hover {  
            border-color: var(--primary);  
            transform: translateY(-5px);  
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);  
        }  
        
        .subscription-plan.selected {  
            border-color: var(--subscriber-color);  
            background: linear-gradient(135deg, rgba(255,64,129,0.1), rgba(255,64,129,0.05));  
            box-shadow: 0 10px 30px rgba(255,64,129,0.2);  
        }  
        
        .subscription-plan.premium.selected {  
            border-color: var(--premium-color);  
            background: linear-gradient(135deg, rgba(255,215,0,0.1), rgba(255,215,0,0.05));  
            box-shadow: 0 10px 30px rgba(255,215,0,0.3);  
        }  
        
        .subscription-plan.member.selected {  
            border-color: var(--member-color);  
            background: linear-gradient(135deg, rgba(76,175,80,0.1), rgba(76,175,80,0.05));  
            box-shadow: 0 10px 30px rgba(76,175,80,0.2);  
        }  
        
        .plan-badge {  
            position: absolute;  
            top: 10px;  
            right: 10px;  
            padding: 4px 10px;  
            border-radius: 20px;  
            font-size: 11px;  
            font-weight: 600;  
        }  
        
        .plan-badge.member {  
            background: var(--member-color);  
            color: white;  
        }  
        
        .plan-badge.subscriber {  
            background: var(--subscriber-color);  
            color: white;  
        }  
        
        .plan-badge.premium {  
            background: var(--premium-color);  
            color: #000;  
        }  
        
        .plan-title {  
            font-size: 20px;  
            font-weight: 600;  
            margin-bottom: 10px;  
            display: flex;  
            align-items: center;  
            gap: 10px;  
        }  
        
        .plan-price {  
            font-size: 28px;  
            font-weight: 700;  
            margin-bottom: 10px;  
        }  
        
        .plan-price.free {  
            color: var(--text-primary);  
        }  
        
        .plan-price.member {  
            color: var(--member-color);  
        }  
        
        .plan-price.subscriber {  
            color: var(--subscriber-color);  
        }  
        
        .plan-price.premium {  
            color: var(--premium-color);  
            background: linear-gradient(135deg, var(--premium-color), #ff9800);  
            -webkit-background-clip: text;  
            -webkit-text-fill-color: transparent;  
            background-clip: text;  
        }  
        
        .plan-period {  
            font-size: 14px;  
            color: var(--text-secondary);  
            margin-left: 5px;  
        }  
        
        .plan-features {  
            font-size: 14px;  
            color: var(--text-secondary);  
        }  
        
        .plan-features li {  
            margin-bottom: 6px;  
            list-style: none;  
            padding-left: 24px;  
            position: relative;  
        }  
        
        .plan-features li:before {  
            content: "âœ“";  
            position: absolute;  
            left: 0;  
            color: var(--subscriber-color);  
            font-weight: bold;  
        }  
        
        .subscription-plan.member .plan-features li:before {  
            color: var(--member-color);  
        }  
        
        .subscription-plan.premium .plan-features li:before {  
            color: var(--premium-color);  
        }  
        
        /* OWNER YÃ–NETÄ°M PANELÄ° */  
        .owner-panel {  
            position: fixed;  
            top: 50%;  
            left: 50%;  
            transform: translate(-50%, -50%);  
            width: 90%;  
            max-width: 1000px;  
            height: 80vh;  
            background: var(--bg-secondary);  
            border: 1px solid var(--border-color);  
            border-radius: 20px;  
            z-index: 3001;  
            display: none;  
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);  
            backdrop-filter: blur(25px);  
            -webkit-backdrop-filter: blur(25px);  
            overflow: hidden;  
        }  
        
        .owner-tabs {  
            display: flex;  
            background: var(--header-bg);  
            border-bottom: 1px solid var(--border-color);  
            padding: 0;  
        }  
        
        .owner-tab {  
            padding: 15px 20px;  
            background: none;  
            border: none;  
            color: var(--text-secondary);  
            cursor: pointer;  
            font-size: 14px;  
            font-weight: 500;  
            border-bottom: 3px solid transparent;  
            transition: all 0.3s;  
        }  
        
        .owner-tab:hover {  
            background: rgba(255,255,255,0.05);  
        }  
        
        .owner-tab.active {  
            color: var(--owner);  
            border-bottom-color: var(--owner);  
            background: rgba(255,64,129,0.1);  
        }  
        
        .owner-tab-content {  
            display: none;  
            padding: 20px;  
            height: calc(80vh - 53px);  
            overflow-y: auto;  
        }  
        
        .owner-tab-content.active {  
            display: block;  
        }  
        
        .admin-controls {  
            display: grid;  
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));  
            gap: 15px;  
            margin-bottom: 20px;  
        }  
        
        .control-group {  
            background: rgba(0,0,0,0.05);  
            padding: 15px;  
            border-radius: 10px;  
        }  
        
        .control-group h4 {  
            margin-bottom: 10px;  
            color: var(--primary);  
        }  
        
        .control-input {  
            width: 100%;  
            padding: 10px;  
            margin: 5px 0;  
            background: var(--input-bg);  
            border: 1px solid var(--border-color);  
            border-radius: 8px;  
            color: var(--text-primary);  
        }  
        
        .control-btn {  
            padding: 8px 15px;  
            margin: 5px;  
            background: var(--primary);  
            color: white;  
            border: none;  
            border-radius: 8px;  
            cursor: pointer;  
            transition: all 0.2s;  
        }  
        
        .control-btn:hover {  
            opacity: 0.9;  
            transform: translateY(-2px);  
        }  
        
        .control-btn.ban {  
            background: var(--ban-color);  
        }  
        
        .control-btn.kick {  
            background: var(--coadmin);  
        }  
        
        .control-btn.warn {  
            background: var(--warning-color, #ff9800);  
        }  
        
        /* PRIVATE MESSAGE STYLES */  
        .private-modal {  
            position: fixed;  
            top: 50%;  
            left: 50%;  
            transform: translate(-50%, -50%);  
            width: 90%;  
            max-width: 500px;  
            height: 70vh;  
            background: var(--bg-secondary);  
            border: 1px solid var(--border-color);  
            border-radius: 15px;  
            z-index: 3000;  
            display: none;  
            flex-direction: column;  
            box-shadow: 0 15px 50px rgba(0,0,0,0.3);  
            backdrop-filter: blur(20px);  
            -webkit-backdrop-filter: blur(20px);  
        }  
        
        .private-header {  
            padding: 15px 20px;  
            background: linear-gradient(135deg, var(--private), #7b1fa2);  
            color: white;  
            display: flex;  
            justify-content: space-between;  
            align-items: center;  
            border-radius: 15px 15px 0 0;  
        }  
        
        .private-messages {  
            flex: 1;  
            overflow-y: auto;  
            padding: 20px;  
            display: flex;  
            flex-direction: column;  
            gap: 10px;  
        }  
        
        .private-message {  
            max-width: 80%;  
            padding: 10px 15px;  
            border-radius: 15px;  
            word-wrap: break-word;  
        }  
        
        .private-message.sent {  
            align-self: flex-end;  
            background: var(--private);  
            color: white;  
            border-bottom-right-radius: 5px;  
        }  
        
        .private-message.received {  
            align-self: flex-start;  
            background: rgba(0,0,0,0.1);  
            color: var(--text-primary);  
            border-bottom-left-radius: 5px;  
        }  
        
        .private-input-area {  
            padding: 15px;  
            border-top: 1px solid var(--border-color);  
            display: flex;  
            gap: 10px;  
            align-items: flex-end;  
        }  
        
        .private-input-area textarea {  
            flex: 1;  
            padding: 12px 15px;  
            background: var(--input-bg);  
            border: 1px solid var(--border-color);  
            border-radius: 12px;  
            color: var(--text-primary);  
            resize: none;  
            min-height: 44px;  
            max-height: 100px;  
        }  
        
        .image-upload-btn {  
            width: 44px;  
            height: 44px;  
            border-radius: 12px;  
            background: var(--primary);  
            border: none;  
            color: white;  
            display: flex;  
            align-items: center;  
            justify-content: center;  
            cursor: pointer;  
            font-size: 20px;  
        }  
        
        /* MESSAGE STYLES */  
        .message-image {  
            max-width: 100%;  
            max-height: 300px;  
            border-radius: 10px;  
            margin-top: 8px;  
            cursor: pointer;  
            transition: transform 0.3s;  
        }  
        
        .message-image:hover {  
            transform: scale(1.02);  
        }  
        
        .image-modal {  
            position: fixed;  
            top: 0;  
            left: 0;  
            width: 100%;  
            height: 100%;  
            background: rgba(0,0,0,0.9);  
            display: none;  
            justify-content: center;  
            align-items: center;  
            z-index: 4000;  
        }  
        
        .image-modal img {  
            max-width: 90%;  
            max-height: 90%;  
            border-radius: 10px;  
        }  
        
        .close-image-modal {  
            position: absolute;  
            top: 20px;  
            right: 20px;  
            background: rgba(255,255,255,0.1);  
            color: white;  
            border: none;  
            width: 40px;  
            height: 40px;  
            border-radius: 50%;  
            font-size: 24px;  
            cursor: pointer;  
        }  
        
        /* GÄ°RÄ°Å EKRANI - BLUR EFFECT */  
        #login-screen {  
            position: fixed;  
            top: 0;  
            left: 0;  
            width: 100%;  
            height: 100%;  
            background: var(--bg-primary);  
            display: flex;  
            align-items: center;  
            justify-content: center;  
            z-index: 2000;  
            transition: all 0.3s ease;  
        }  
        
        .login-container {  
            background: var(--blur-bg);  
            border-radius: 20px;  
            padding: 40px;  
            width: 90%;  
            max-width: 450px;  
            border: 1px solid var(--border-color);  
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);  
            transition: all 0.3s ease;  
            backdrop-filter: var(--blur-intensity);  
            -webkit-backdrop-filter: var(--blur-intensity);  
        }  
        
        .login-title {  
            text-align: center;  
            margin-bottom: 30px;  
            color: var(--primary);  
            font-size: 28px;  
            display: flex;  
            align-items: center;  
            justify-content: center;  
            gap: 10px;  
            font-weight: 600;  
        }  
        
        .login-input {  
            width: 100%;  
            padding: 16px 20px;  
            margin-bottom: 15px;  
            background: var(--input-bg);  
            border: 1px solid var(--border-color);  
            border-radius: 12px;  
            color: var(--text-primary);  
            font-size: 16px;  
            outline: none;  
            transition: all 0.3s ease;  
            backdrop-filter: blur(10px);  
        }  
        
        .login-input:focus {  
            border-color: var(--primary);  
            box-shadow: 0 0 0 3px rgba(255,0,0,0.1);  
        }  
        
        /* CHAT INPUT AREA */  
        .chat-input-area {  
            padding: 16px;  
            border-top: 1px solid var(--border-color);  
            background: var(--bg-secondary);  
            flex-shrink: 0;  
            transition: all 0.3s ease;  
            backdrop-filter: blur(10px);  
        }  
        
        .input-wrapper {  
            display: flex;  
            gap: 12px;  
            align-items: flex-end;  
        }  
        
        #message-input {  
            flex: 1;  
            padding: 12px 16px;  
            background: var(--input-bg);  
            border: 1px solid var(--border-color);  
            border-radius: 12px;  
            color: var(--text-primary);  
            font-size: 14px;  
            outline: none;  
            min-height: 44px;  
            max-height: 120px;  
            resize: none;  
            transition: all 0.3s ease;  
            backdrop-filter: blur(5px);  
        }  
        
        /* FIREBASE BADGE - TÃœM SAYFA ALTINDA */  
        .firebase-badge {  
            position: fixed;  
            bottom: 15px;  
            right: 15px;  
            background: var(--firebase);  
            color: white;  
            padding: 10px 20px;  
            border-radius: 15px;  
            font-size: 12px;  
            z-index: 1000;  
            display: flex;  
            align-items: center;  
            gap: 8px;  
            backdrop-filter: blur(10px);  
            cursor: pointer;  
            transition: all 0.3s;  
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);  
        }  
        
        .firebase-badge:hover {  
            transform: translateY(-3px);  
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);  
        }  
        
        .firebase-badge.hidden {  
            opacity: 0.5;  
            transform: scale(0.9);  
        }  
        
        /* STORY MODAL - INSTAGRAM STYLE */  
        .story-modal {  
            position: fixed;  
            top: 0;  
            left: 0;  
            width: 100%;  
            height: 100%;  
            background: #000;  
            z-index: 4001;  
            display: none;  
        }  
        
        .story-progress {  
            position: absolute;  
            top: 10px;  
            left: 10px;  
            right: 10px;  
            height: 3px;  
            background: rgba(255,255,255,0.3);  
            border-radius: 3px;  
            overflow: hidden;  
        }  
        
        .story-progress-bar {  
            height: 100%;  
            background: white;  
            width: 0%;  
            transition: width 0.1s linear;  
        }  
        
        .story-content {  
            position: absolute;  
            top: 0;  
            left: 0;  
            width: 100%;  
            height: 100%;  
            display: flex;  
            justify-content: center;  
            align-items: center;  
        }  
        
        .story-image {  
            max-width: 100%;  
            max-height: 100%;  
            object-fit: contain;  
        }  
        
        .story-text {  
            color: white;  
            font-size: 24px;  
            text-align: center;  
            padding: 20px;  
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);  
        }  
        
        .story-info {  
            position: absolute;  
            bottom: 20px;  
            left: 20px;  
            right: 20px;  
            color: white;  
            display: flex;  
            justify-content: space-between;  
            align-items: center;  
        }  
        
        .story-actions {  
            display: flex;  
            gap: 15px;  
        }  
        
        .story-action-btn {  
            background: none;  
            border: none;  
            color: white;  
            font-size: 24px;  
            cursor: pointer;  
        }  
        
        .story-report-btn {  
            position: absolute;  
            top: 20px;  
            right: 20px;  
            background: rgba(255,255,255,0.1);  
            color: white;  
            border: none;  
            padding: 8px 15px;  
            border-radius: 20px;  
            cursor: pointer;  
            backdrop-filter: blur(10px);  
        }  
        
        /* CHANNEL SYSTEM */  
        .channels-sidebar {  
            width: 250px;  
            background: var(--bg-secondary);  
            border-right: 1px solid var(--border-color);  
            padding: 20px;  
            overflow-y: auto;  
            display: none;  
            flex-direction: column;  
            gap: 10px;  
        }  
        
        .channel-item {  
            padding: 12px 15px;  
            background: rgba(0,0,0,0.05);  
            border-radius: 10px;  
            cursor: pointer;  
            transition: all 0.2s;  
            border-left: 4px solid var(--channel-color);  
        }  
        
        .channel-item:hover {  
            background: rgba(0,0,0,0.1);  
            transform: translateX(5px);  
        }  
        
        .channel-item.active {  
            background: var(--message-channel-bg);  
            border-left-color: var(--channel-color);  
        }  
        
        /* KANAL OLUÅTURMA MODALI */  
        .channel-create-modal {  
            position: fixed;  
            top: 50%;  
            left: 50%;  
            transform: translate(-50%, -50%);  
            width: 90%;  
            max-width: 400px;  
            background: var(--bg-secondary);  
            border: 1px solid var(--border-color);  
            border-radius: 15px;  
            z-index: 3000;  
            display: none;  
            box-shadow: 0 15px 50px rgba(0,0,0,0.3);  
            backdrop-filter: blur(20px);  
        }  
        
        /* MATEB BOT PANEL */  
        .mateb-bot-panel {  
            position: fixed;  
            top: 50%;  
            left: 50%;  
            transform: translate(-50%, -50%);  
            width: 90%;  
            max-width: 600px;  
            height: 70vh;  
            background: var(--bg-secondary);  
            border: 1px solid var(--border-color);  
            border-radius: 20px;  
            z-index: 3000;  
            display: none;  
            flex-direction: column;  
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);  
            backdrop-filter: blur(25px);  
        }  
        
        .bot-logs {  
            flex: 1;  
            overflow-y: auto;  
            padding: 20px;  
            font-family: monospace;  
            font-size: 12px;  
        }  
        
        .bot-log-entry {  
            margin-bottom: 5px;  
            padding: 8px;  
            border-radius: 5px;  
            background: rgba(0,0,0,0.05);  
        }  
        
        .bot-log-entry.warning {  
            background: rgba(255,152,0,0.1);  
            border-left: 3px solid var(--coadmin);  
        }  
        
        .bot-log-entry.danger {  
            background: rgba(255,51,51,0.1);  
            border-left: 3px solid var(--ban-color);  
        }  
        
        .bot-log-entry.success {  
            background: rgba(76,175,80,0.1);  
            border-left: 3px solid var(--online);  
        }  
        
        /* RESPONSIVE STYLES */  
        @media (max-width: 768px) {  
            .login-container {  
                padding: 30px 20px;  
            }  
            
            .subscription-modal {  
                width: 95%;  
            }  
            
            .owner-panel {  
                width: 95%;  
                height: 90vh;  
            }  
            
            .private-modal {  
                width: 95%;  
                height: 80vh;  
            }  
            
            .profile-panel {  
                width: 300px;  
                right: 10px;  
            }  
        }  
        
        @media (max-width: 480px) {  
            .profile-panel {  
                width: calc(100vw - 40px);  
                right: 20px;  
            }  
            
            .subscription-plan {  
                padding: 15px;  
            }  
            
            .plan-title {  
                font-size: 18px;  
            }  
            
            .plan-price {  
                font-size: 24px;  
            }  
        }  
        
        /* ANIMATIONS */  
        @keyframes slideIn {  
            from {  
                opacity: 0;  
                transform: translateY(-20px);  
            }  
            to {  
                opacity: 1;  
                transform: translateY(0);  
            }  
        }  
        
        @keyframes fadeIn {  
            from { opacity: 0; }  
            to { opacity: 1; }  
        }  
        
        @keyframes pulse {  
            0%, 100% { opacity: 1; }  
            50% { opacity: 0.5; }  
        }  
        
        .animate-slideIn {  
            animation: slideIn 0.3s ease;  
        }  
        
        .animate-fadeIn {  
            animation: fadeIn 0.3s ease;  
        }  
        
        .animate-pulse {  
            animation: pulse 2s infinite;  
        }  
        
        /* CUSTOM SCROLLBAR */  
        ::-webkit-scrollbar {  
            width: 8px;  
            height: 8px;  
        }  
        
        ::-webkit-scrollbar-track {  
            background: rgba(0,0,0,0.1);  
            border-radius: 10px;  
        }  
        
        ::-webkit-scrollbar-thumb {  
            background: rgba(0,0,0,0.3);  
            border-radius: 10px;  
        }  
        
        ::-webkit-scrollbar-thumb:hover {  
            background: rgba(0,0,0,0.5);  
        }  
        
        /* UTILITY CLASSES */  
        .hidden {  
            display: none !important;  
        }  
        
        .loading {  
            display: inline-block;  
            width: 20px;  
            height: 20px;  
            border: 2px solid rgba(255,255,255,0.3);  
            border-radius: 50%;  
            border-top-color: white;  
            animation: spin 1s ease-in-out infinite;  
        }  
        
        @keyframes spin {  
            to { transform: rotate(360deg); }  
        }  
        
        .tooltip {  
            position: relative;  
        }  
        
        .tooltip-text {  
            position: absolute;  
            bottom: 125%;  
            left: 50%;  
            transform: translateX(-50%);  
            background: rgba(0,0,0,0.8);  
            color: white;  
            padding: 5px 10px;  
            border-radius: 5px;  
            font-size: 12px;  
            white-space: nowrap;  
            display: none;  
            z-index: 1000;  
        }  
        
        .tooltip:hover .tooltip-text {  
            display: block;  
        }  
    </style>  
</head>  
<body class="youtube-live-mode">  
    <!-- BAÄLANTI KONTROL -->  
    <div class="connection-check" id="connectionCheck">  
        ğŸ”„ BaÄŸlantÄ± kontrol ediliyor...  
    </div>  
    
    <!-- ACÄ°L GÄ°RÄ°Å BUTONU -->  
    <div class="emergency-login" id="emergencyLogin" onclick="emergencyLogin()">  
        ğŸ”¥ Acil GiriÅŸ (Firebase Sorunu)  
    </div>  
    
    <!-- FIREBASE BADGE - TÃœM SAYFA ALTINDA -->  
    <div class="firebase-badge" id="firebaseBadge" onclick="toggleFirebaseBadge()">  
        <span>ğŸ”¥</span> Firebase Active  
        <span style="margin-left: auto; font-size: 10px; opacity: 0.7;">â–²</span>  
    </div>  
    
    <!-- HEADER -->  
    <div class="youtube-header blur-background">  
        <div class="header-left">  
            <button class="mobile-menu-btn" onclick="toggleUserList()">ğŸ‘¥</button>  
            <div class="logo">  
                <span class="logo-icon">â–¶ï¸</span>  
                <span>Popbox Live</span>  
                <div class="user-badges">  
                    <span class="badge owner" id="ownerBadge">OWNER ğŸ¤´</span>  
                    <span class="badge admin" id="adminBadge">ADMIN â­ï¸</span>  
                    <span class="badge coadmin" id="coadminBadge">CO-ADMIN âš¡ï¸</span>  
                    <span class="badge operator" id="operatorBadge">OPERATOR ğŸ› ï¸</span>  
                    <span class="badge story" id="storyBadge" style="display: none;">STORY ğŸ“±</span>  
                    <span class="badge subscriber" id="subscriberBadge" style="display: none;">ABONE â¤ï¸</span>  
                    <span class="badge premium" id="premiumBadge" style="display: none;">PREMIUM ğŸ‘‘</span>  
                    <span class="badge member" id="memberBadge" style="display: none;">MEMBER âœ”ï¸</span>  
                </div>  
            </div>  
        </div>  
        <div class="header-right">  
            <!-- PROFÄ°L BUTONU -->  
            <div class="profile-section">  
                <button class="profile-btn tooltip" onclick="toggleProfilePanel()" title="Profilim">  
                    ğŸ‘¤  
                    <span class="tooltip-text">Profil</span>  
                </button>  
                <div class="profile-panel blur-background" id="profilePanel">  
                    <div class="profile-header">  
                        <div class="profile-avatar" id="profileAvatar">  
                            ğŸ‘¤  
                        </div>  
                        <div class="profile-info">  
                            <div class="profile-username" id="profileUsername">Misafir</div>  
                            <div class="profile-role" id="profileRole">KullanÄ±cÄ±</div>  
                        </div>  
                    </div>  
                    <div class="profile-body">  
                        <div class="profile-stats">  
                            <div class="stat-item">  
                                <div class="stat-value" id="statMessages">0</div>  
                                <div class="stat-label">Mesaj</div>  
                            </div>  
                            <div class="stat-item">  
                                <div class="stat-value" id="statStories">0</div>  
                                <div class="stat-label">Story</div>  
                            </div>  
                            <div class="stat-item">  
                                <div class="stat-value" id="statLikes">0</div>  
                                <div class="stat-label">BeÄŸeni</div>  
                            </div>  
                            <div class="stat-item">  
                                <div class="stat-value" id="statSubscribers">0</div>  
                                <div class="stat-label">Abone</div>  
                            </div>  
                        </div>  
                        <div class="profile-actions">  
                            <button class="profile-action-btn" onclick="openSubscriptionModal()">  
                                <span>â¤ï¸</span>  
                                <span>Abone Ol</span>  
                                <span style="margin-left: auto;" id="subscriptionStatus">Ãœcretsiz</span>  
                            </button>  
                            <button class="profile-action-btn" onclick="openStoryCreateModal()">  
                                <span>ğŸ“±</span>  
                                <span>Story Ekle</span>  
                            </button>  
                            <button class="profile-action-btn" onclick="viewMyStories()">  
                                <span>ğŸ“–</span>  
                                <span>Story'lerim</span>  
                            </button>  
                            <button class="profile-action-btn" onclick="openPrivateChat('PopboxChatBot')">  
                                <span>ğŸ¤–</span>  
                                <span>Bot ile Sohbet</span>  
                            </button>  
                            <button class="profile-action-btn" onclick="toggleTheme()">  
                                <span>ğŸ¨</span>  
                                <span>Tema DeÄŸiÅŸtir</span>  
                            </button>  
                            
                            <!-- YÃ–NETÄ°CÄ° BUTONLARI -->  
                            <button class="profile-action-btn admin-panel" onclick="openAdminPanel()" id="adminPanelBtn" style="display: none;">  
                                <span>âš™ï¸</span>  
                                <span>YÃ¶netim Paneli</span>  
                            </button>  
                            
                            <button class="profile-action-btn owner-panel" onclick="openOwnerPanel()" id="ownerPanelBtn" style="display: none;">  
                                <span>ğŸ¤´</span>  
                                <span>Owner Paneli</span>  
                            </button>  
                            
                            <button class="profile-action-btn" onclick="openMatebBotPanel()" id="matebBotBtn">  
                                <span>ğŸ›¡ï¸</span>  
                                <span>MateB GÃ¼venlik</span>  
                            </button>  
                            
                            <button class="profile-action-btn" onclick="logout()">  
                                <span>ğŸšª</span>  
                                <span>Ã‡Ä±kÄ±ÅŸ Yap</span>  
                            </button>  
                        </div>  
                    </div>  
                </div>  
            </div>  
            
            <!-- STORY BUTONU -->  
            <div class="story-section">  
                <button class="story-toggle-btn tooltip" onclick="toggleStorySection()" title="Story/Hikaye">  
                    ğŸ“±  
                    <span class="story-toggle-badge" id="storyToggleBadge">0</span>  
                    <span class="tooltip-text">Story'ler</span>  
                </button>  
            </div>  
            
            <!-- ÅÄ°KAYET BÄ°LDÄ°RÄ°MÄ° -->  
            <div class="report-notification" id="reportNotification">  
                <button class="notification-icon tooltip" onclick="toggleReportPanel()" title="Åikayetler">  
                    âš ï¸  
                    <span class="report-badge" id="reportBadge">0</span>  
                    <span class="tooltip-text">Åikayetler</span>  
                </button>  
                <div class="notification-panel blur-background" id="reportPanel">  
                    <div class="notification-header">  
                        <span>Åikayetler</span>  
                        <button onclick="closeReportPanel()" style="background:none; border:none; color:var(--text-primary); cursor:pointer;">Ã—</button>  
                    </div>  
                    <div class="notification-list" id="reportList">  
                        <!-- Åikayetler buraya eklenecek -->  
                    </div>  
                    <div class="notification-footer">  
                        <button class="clear-notifications-btn" onclick="openReportsModal()">TÃ¼mÃ¼nÃ¼ GÃ¶r</button>  
                    </div>  
                </div>  
            </div>  
            
            <!-- BÄ°LDÄ°RÄ°M PANELÄ° -->  
            <div class="notification-section">  
                <button class="notification-icon tooltip" onclick="toggleNotificationPanel(event)" title="Bildirimler">  
                    ğŸ””  
                    <span class="notification-badge" id="notificationBadge">0</span>  
                    <span class="tooltip-text">Bildirimler</span>  
                </button>  
                <div class="notification-panel blur-background" id="notificationPanel">  
                    <div class="notification-header">  
                        <span>Bildirimler</span>  
                        <button onclick="closeNotificationPanel()" style="background:none; border:none; color:var(--text-primary); cursor:pointer;">Ã—</button>  
                    </div>  
                    <div class="notification-list" id="notificationList">  
                        <!-- Bildirimler buraya eklenecek -->  
                    </div>  
                    <div class="notification-footer">  
                        <button class="clear-notifications-btn" onclick="clearAllNotifications()">TÃ¼mÃ¼nÃ¼ Temizle</button>  
                    </div>  
                </div>  
            </div>  
            
            <!-- CHANNELS BUTON -->  
            <button class="online-list-btn tooltip" onclick="toggleChannelsSidebar()" title="Kanallar">  
                <span>#ï¸âƒ£</span>  
                <span id="channelsCount">0</span>  
                <span class="tooltip-text">Kanallar</span>  
            </button>  
            
            <button class="online-list-btn tooltip" onclick="toggleUserList()" title="Online KullanÄ±cÄ±lar">  
                <span>ğŸ‘¥</span>  
                <span id="onlineCount">0</span>  
                <span class="tooltip-text">Online KullanÄ±cÄ±lar</span>  
            </button>  
            
            <button class="theme-toggle tooltip" onclick="toggleTheme()" title="Tema deÄŸiÅŸtir">  
                ğŸ¨  
                <span class="tooltip-text">Tema</span>  
            </button>  
        </div>  
    </div>  
    
    <!-- STORY/HÄ°KAYE BÃ–LÃœMÃœ - INSTAGRAM STYLE -->  
    <div class="story-container blur-background" id="storyContainer">  
        <div class="story-wrapper" id="storyWrapper">  
            <!-- My Story Button -->  
            <div class="story-item" onclick="openMyStory()">  
                <div class="story-avatar my-story">  
                    +  
                </div>  
                <div class="story-user">Story Ekle</div>  
            </div>  
            <!-- Story'ler buraya eklenecek -->  
        </div>  
    </div>  
    
    <!-- ANA CONTAINER -->  
    <div class="main-container">  
        <!-- KANALLAR SIDEBAR -->  
        <div class="channels-sidebar blur-background" id="channelsSidebar">  
            <div class="users-title">  
                <span>Kanallar</span>  
                <button class="close-sidebar" onclick="toggleChannelsSidebar()">Ã—</button>  
            </div>  
            <button class="profile-action-btn" onclick="openChannelCreateModal()" style="margin-bottom: 15px;">  
                <span>â•</span>  
                <span>Kanal OluÅŸtur</span>  
            </button>  
            <div id="channelList">  
                <!-- Kanallar buraya eklenecek -->  
            </div>  
        </div>  
        
        <!-- VIDEO BÃ–LÃœMÃœ -->  
        <div class="video-container">  
            <div class="video-wrapper">  
                <div id="youtube-player"></div>  
                <div class="video-placeholder blur-background">  
                    <div style="font-size: 48px; margin-bottom: 16px;">ğŸµ</div>  
                    <div style="font-size: 20px; font-weight: 500;">Popbox Music Live</div>  
                    <div style="font-size: 14px; opacity: 0.8; margin-top: 8px;">CanlÄ± yayÄ±n yÃ¼kleniyor...</div>  
                </div>  
            </div>  
        </div>  
        
        <!-- CHAT BÃ–LÃœMÃœ -->  
        <div class="chat-container">  
            <div class="chat-header blur-background">  
                <div class="chat-title" id="currentChannel"># Genel</div>  
                <div class="chat-actions">  
                    <button class="story-create-btn tooltip" onclick="openStoryCreateModal()" title="Yeni Story OluÅŸtur">  
                        +  
                        <span class="tooltip-text">Story Ekle</span>  
                    </button>  
                    <div class="online-count">  
                        <span id="chatOnlineCount">0</span> kiÅŸi  
                    </div>  
                </div>  
            </div>  
            
            <div class="messages-area" id="messages">  
                <div class="yt-message system">  
                    ğŸ‰ Popbox Music Live'e hoÅŸ geldiniz! CanlÄ± sohbete katÄ±lÄ±n.  
                </div>  
            </div>  
            
            <div class="chat-input-area blur-background">  
                <div class="input-wrapper">  
                    <input type="file" id="imageUpload" accept="image/*" style="display: none;" onchange="handleImageUpload(event)">  
                    <button class="image-upload-btn tooltip" onclick="document.getElementById('imageUpload').click()" title="Resim gÃ¶nder">  
                        ğŸ“·  
                        <span class="tooltip-text">Resim Ekle</span>  
                    </button>  
                    <textarea   
                        id="message-input"   
                        placeholder="MesajÄ±nÄ±zÄ± yazÄ±n veya / komutlarÄ± kullanÄ±n..."  
                        rows="1"  
                        oninput="autoResize(this)"  
                    ></textarea>  
                    <button class="send-button tooltip" onclick="sendMessage()" title="GÃ¶nder (Enter)">  
                        â†—  
                        <span class="tooltip-text">GÃ¶nder</span>  
                    </button>  
                </div>  
            </div>  
        </div>  
        
        <!-- ONLINE KULLANICILAR SIDEBAR -->  
        <div class="users-sidebar blur-background" id="usersSidebar">  
            <div class="users-title">  
                <span>CanlÄ± KatÄ±lÄ±mcÄ±lar</span>  
                <button class="close-sidebar" onclick="toggleUserList()">Ã—</button>  
            </div>  
            <div id="userList">  
                <!-- KullanÄ±cÄ±lar buraya eklenecek -->  
            </div>  
        </div>  
    </div>  
    
    <!-- GÄ°RÄ°Å EKRANI - BLUR EFFECT -->  
    <div id="login-screen" class="blur-background">  
        <div class="login-container animate-slideIn">  
            <div class="login-title">  
                <span class="logo-icon">â–¶ï¸</span>  
                Popbox Live  
            </div>  
            
            <div class="login-subtitle" style="color: var(--text-secondary); text-align: center; margin-bottom: 20px; font-size: 14px;">  
                ğŸ”¥ Firebase Realtime Chat<br>  
                ğŸ‘‘ TÃ¼m yÃ¶netici yetkileri<br>  
                ğŸ“± Instagram Style Story<br>  
                â¤ï¸ YouTube Abonelik Sistemi<br>  
                ğŸ›¡ï¸ MateB GÃ¼venlik Botu<br>  
                #ï¸âƒ£ Kanal Sistemi  
            </div>  
            
            <div style="background: rgba(255, 0, 0, 0.1); padding: 10px; border-radius: 8px; margin-bottom: 15px; border-left: 3px solid #ff0000;">  
                <strong>âš ï¸ GiriÅŸ Sorunu Ã‡Ã¶zÃ¼mÃ¼:</strong><br>  
                <small>Firebase baÄŸlantÄ±sÄ± yoksa "Acil GiriÅŸ" butonunu kullanÄ±n</small>  
            </div>  
            
            <input   
                type="text"   
                id="login-nick"   
                class="login-input"   
                placeholder="KullanÄ±cÄ± adÄ±nÄ±z"  
                autocomplete="off"  
                onkeyup="checkUsernameRealTime()"  
            >  
            
            <input   
                type="password"   
                id="login-password"   
                class="login-input"   
                placeholder="Åifre (sadece kayÄ±tlÄ± kullanÄ±cÄ±lar)"  
                autocomplete="off"  
                style="display: none;"  
            >  
            
            <div id="password-info" style="color: var(--text-secondary); font-size: 14px; margin-bottom: 12px; display: none;">  
                ğŸ” Bu kullanÄ±cÄ± kayÄ±tlÄ±dÄ±r, lÃ¼tfen ÅŸifrenizi girin  
            </div>  
            
            <div id="similar-users-warning" style="color: var(--coadmin); font-size: 14px; margin-bottom: 12px; display: none; background: rgba(255,152,0,0.1); padding: 10px; border-radius: 8px; border-left: 3px solid var(--coadmin);">  
                âš ï¸ Bu nick benzeri zaten kullanÄ±lÄ±yor!  
            </div>  
            
            <div id="nick-suggestion" style="color: var(--online); font-size: 14px; margin-bottom: 12px; display: none; background: rgba(76,175,80,0.1); padding: 10px; border-radius: 8px; border-left: 3px solid var(--online);">  
                ğŸ’¡ Ã–nerilen nick: <span id="suggested-nick" style="font-weight: bold; cursor: pointer; text-decoration: underline;"></span>  
            </div>  
            
            <button class="login-button" onclick="login()" id="login-btn">  
                Sohbete KatÄ±l  
            </button>  
            
            <button class="login-button" onclick="simpleLogin()" id="simple-login-btn" style="background: #666; margin-top: 10px; display: none;">  
                ğŸ”¥ Basit GiriÅŸ (Firebase Yok)  
            </button>  
            
            <div id="login-error" class="error-message"></div>  
            <div id="login-success" class="success-message"></div>  
            
            <div style="margin-top: 20px; text-align: center; font-size: 12px; color: var(--text-secondary);">  
                ğŸ¨ Tema deÄŸiÅŸtirebilirsiniz<br>  
                ğŸ‘¤ Profilden abone olabilirsiniz<br>  
                ğŸ“± Story ekleyip beÄŸeni toplayabilirsiniz  
            </div>  
        </div>  
    </div>  
    
    <!-- RESÄ°M GÃ–STERÄ°M MODALI -->  
    <div class="image-modal" id="imageModal" onclick="closeImageModal()">  
        <img id="modalImage" src="" alt="Resim">  
        <button class="close-image-modal" onclick="closeImageModal()">Ã—</button>  
    </div>  
    
    <!-- STORY GÃ–STERÄ°M MODALI - INSTAGRAM STYLE -->  
    <div class="story-modal" id="storyModal">  
        <div class="story-progress" id="storyProgress">  
            <div class="story-progress-bar" id="storyProgressBar"></div>  
        </div>  
        <div class="story-content" id="storyContent"></div>  
        <div class="story-info" id="storyInfo">  
            <div class="story-user-info" id="storyUserInfo"></div>  
            <div class="story-actions">  
                <button class="story-action-btn" onclick="likeStory()">â¤ï¸ <span id="storyLikeCount">0</span></button>  
                <button class="story-action-btn" onclick="reportCurrentStory()">âš ï¸</button>  
            </div>  
        </div>  
        <button class="story-report-btn" onclick="closeStoryModal()">âœ•</button>  
    </div>  
    
    <!-- OWNER YÃ–NETÄ°M PANELÄ° -->  
    <div class="owner-panel blur-background" id="ownerPanel">  
        <div class="owner-tabs">  
            <button class="owner-tab active" onclick="switchOwnerTab('privateMessages')">ğŸ“¨ Ã–zel Mesajlar</button>  
            <button class="owner-tab" onclick="switchOwnerTab('adminControl')">ğŸ‘‘ Admin Kontrol</button>  
            <button class="owner-tab" onclick="switchOwnerTab('userManagement')">ğŸ‘¥ KullanÄ±cÄ± YÃ¶netimi</button>  
            <button class="owner-tab" onclick="switchOwnerTab('channelManagement')">#ï¸âƒ£ Kanal YÃ¶netimi</button>  
            <button class="owner-tab" onclick="switchOwnerTab('botControl')">ğŸ¤– Bot Kontrol</button>  
        </div>  
        
        <div class="owner-tab-content active" id="privateMessagesTab">  
            <div style="margin-bottom: 15px;">  
                <h3>ğŸ“¨ TÃ¼m Ã–zel MesajlarÄ± GÃ¶rÃ¼ntÃ¼le</h3>  
                <div id="allPrivateMessages" style="height: 300px; overflow-y: auto; border: 1px solid var(--border-color); border-radius: 10px; padding: 10px; background: rgba(0,0,0,0.05);">  
                    <!-- TÃ¼m Ã¶zel mesajlar buraya eklenecek -->  
                </div>  
            </div>  
        </div>  
        
        <div class="owner-tab-content" id="adminControlTab">  
            <div class="admin-controls">  
                <div class="control-group">  
                    <h4>ğŸ‘‘ Admin Ekle/Sil</h4>  
                    <input type="text" id="adminUsername" class="control-input" placeholder="KullanÄ±cÄ± adÄ±">  
                    <select id="adminRole" class="control-input">  
                        <option value="operator">OperatÃ¶r</option>  
                        <option value="coadmin">Co-Admin</option>  
                        <option value="admin">Admin</option>  
                    </select>  
                    <button class="control-btn" onclick="addAdmin()">Ekle</button>  
                    <button class="control-btn ban" onclick="removeAdmin()">KaldÄ±r</button>  
                </div>  
                
                <div class="control-group">  
                    <h4>ğŸš« KullanÄ±cÄ± Ban</h4>  
                    <input type="text" id="banUsername" class="control-input" placeholder="KullanÄ±cÄ± adÄ±">  
                    <select id="banDuration" class="control-input">  
                        <option value="300000">5 Dakika</option>  
                        <option value="1800000">30 Dakika</option>  
                        <option value="3600000">1 Saat</option>  
                        <option value="86400000">1 GÃ¼n</option>  
                        <option value="604800000">1 Hafta</option>  
                        <option value="2592000000">1 Ay</option>  
                        <option value="9999999999">SÃ¼resiz</option>  
                    </select>  
                    <input type="text" id="banReason" class="control-input" placeholder="Ban sebebi">  
                    <button class="control-btn ban" onclick="banUser()">Banla</button>  
                    <button class="control-btn" onclick="unbanUser()">Ban KaldÄ±r</button>  
                </div>  
                
                <div class="control-group">  
                    <h4>âš ï¸ UyarÄ±/Kick</h4>  
                    <input type="text" id="warnUsername" class="control-input" placeholder="KullanÄ±cÄ± adÄ±">  
                    <input type="text" id="warnReason" class="control-input" placeholder="UyarÄ± sebebi">  
                    <button class="control-btn warn" onclick="warnUser()">UyarÄ± Ver</button>  
                    <button class="control-btn kick" onclick="kickUser()">Kick At</button>  
                </div>  
                
                <div class="control-group">  
                    <h4>ğŸ›¡ï¸ GÃ¼venlik</h4>  
                    <button class="control-btn" onclick="viewUserIPs()">IP Listesi</button>  
                    <button class="control-btn" onclick="viewUserActivities()">Aktivite LoglarÄ±</button>  
                    <button class="control-btn" onclick="clearAllChat()">Chat'i Temizle</button>  
                </div>  
            </div>  
        </div>  
        
        <div class="owner-tab-content" id="userManagementTab">  
            <h3>ğŸ‘¥ TÃ¼m KullanÄ±cÄ±lar</h3>  
            <div id="allUsersList" style="height: 400px; overflow-y: auto; border: 1px solid var(--border-color); border-radius: 10px; padding: 10px; background: rgba(0,0,0,0.05);">  
                <!-- TÃ¼m kullanÄ±cÄ±lar buraya eklenecek -->  
            </div>  
        </div>  
        
        <div class="owner-tab-content" id="channelManagementTab">  
            <h3>#ï¸âƒ£ Kanal YÃ¶netimi</h3>  
            <div style="margin-bottom: 15px;">  
                <input type="text" id="newChannelName" class="control-input" placeholder="Yeni kanal adÄ±" style="width: 200px;">  
                <button class="control-btn" onclick="createChannel()">Kanal OluÅŸtur</button>  
            </div>  
            <div id="allChannelsList" style="height: 300px; overflow-y: auto; border: 1px solid var(--border-color); border-radius: 10px; padding: 10px; background: rgba(0,0,0,0.05);">  
                <!-- TÃ¼m kanallar buraya eklenecek -->  
            </div>  
        </div>  
        
        <div class="owner-tab-content" id="botControlTab">  
            <h3>ğŸ¤– MateB Bot Kontrol</h3>  
            <div style="margin-bottom: 15px;">  
                <button class="control-btn" onclick="bot.sendWelcome('TÃ¼mKullanÄ±cÄ±lar')">HoÅŸ Geldin MesajÄ±</button>  
                <button class="control-btn" onclick="bot.sendSystemAnnouncement()">Sistem Duyurusu</button>  
                <button class="control-btn" onclick="bot.scanForSpam()">Spam TaramasÄ±</button>  
            </div>  
            <div id="botLogs" style="height: 300px; overflow-y: auto; border: 1px solid var(--border-color); border-radius: 10px; padding: 10px; background: rgba(0,0,0,0.05); font-family: monospace; font-size: 12px;">  
                <!-- Bot loglarÄ± buraya eklenecek -->  
            </div>  
        </div>  
        
        <div style="padding: 15px; border-top: 1px solid var(--border-color); text-align: right;">  
            <button class="control-btn" onclick="closeOwnerPanel()">Kapat</button>  
        </div>  
    </div>  
    
    <!-- MATEB BOT PANEL -->  
    <div class="mateb-bot-panel blur-background" id="matebBotPanel">  
        <div class="owner-header" style="padding: 20px; background: linear-gradient(135deg, #4caf50, #2e7d32); color: white; border-radius: 20px 20px 0 0;">  
            <h2 style="margin: 0;">ğŸ›¡ï¸ MateB GÃ¼venlik Botu</h2>  
            <p style="margin: 5px 0 0 0; opacity: 0.9;">24/7 GÃ¼venlik ve Moderas
</div>  
            <div class="bot-logs" id="matebBotLogs">  
                <!-- Bot loglarÄ± buraya eklenecek -->  
            </div>  
            <div style="padding: 15px; border-top: 1px solid var(--border-color); text-align: right;">  
                <button class="control-btn" onclick="closeMatebBotPanel()">Kapat</button>  
                <button class="control-btn" onclick="bot.clearLogs()">LoglarÄ± Temizle</button>  
            </div>  
        </div>  
        
        <!-- YOUTUBE STYLE ABONELÄ°K MODALI -->  
        <div class="subscription-modal blur-background" id="subscriptionModal">  
            <div class="subscription-header">  
                <h2 style="margin: 0; font-size: 24px;">â¤ï¸ YouTube Abonelik Sistemi</h2>  
                <p style="margin: 8px 0 0 0; opacity: 0.9;">Ã–zel Ã¶zelliklerin kilidini aÃ§Ä±n!</p>  
            </div>  
            <div class="subscription-body">  
                <div class="subscription-plan" onclick="selectSubscriptionPlan('standart')" id="planStandart">  
                    <div class="plan-title">ğŸ‘¤ Standart</div>  
                    <div class="plan-price free">ÃœCRETSÄ°Z</div>  
                    <ul class="plan-features">  
                        <li>Standart sohbet Ã¶zellikleri</li>  
                        <li>1 gÃ¼nlÃ¼k story sÃ¼resi</li>  
                        <li>Temel emoji desteÄŸi</li>  
                        <li>Normal mesaj limiti</li>  
                    </ul>  
                </div>  
                
                <div class="subscription-plan member" onclick="selectSubscriptionPlan('member')" id="planMember">  
                    <div class="plan-badge member">ÃœYE</div>  
                    <div class="plan-title">âœ”ï¸ Ãœye</div>  
                    <div class="plan-price member">29.99â‚º<span class="plan-period">/ay</span></div>  
                    <ul class="plan-features">  
                        <li>Ãœye rozeti ve rengi</li>  
                        <li>7 gÃ¼nlÃ¼k story sÃ¼resi</li>  
                        <li>ArttÄ±rÄ±lmÄ±ÅŸ mesaj limiti</li>  
                        <li>Ã–zel emoji paketi</li>  
                        <li>GeliÅŸmiÅŸ profil</li>  
                    </ul>  
                </div>  
                
                <div class="subscription-plan" onclick="selectSubscriptionPlan('abone')" id="planAbone">  
                    <div class="plan-badge subscriber">ABONE</div>  
                    <div class="plan-title">â¤ï¸ Abone</div>  
                    <div class="plan-price subscriber">49.99â‚º<span class="plan-period">/ay</span></div>  
                    <ul class="plan-features">  
                        <li>Ã–zel abone rozeti</li>  
                        <li>Ã–zel mesaj rengi</li>  
                        <li>14 gÃ¼nlÃ¼k story sÃ¼resi</li>  
                        <li>SÄ±nÄ±rsÄ±z emoji</li>  
                        <li>Ã–zel abone listesi</li>  
                        <li>Erken eriÅŸim Ã¶zellikleri</li>  
                    </ul>  
                </div>  
                
                <div class="subscription-plan premium" onclick="selectSubscriptionPlan('premium')" id="planPremium">  
                    <div class="plan-badge premium">PREMIUM</div>  
                    <div class="plan-title">ğŸ‘‘ Premium</div>  
                    <div class="plan-price premium">99.99â‚º<span class="plan-period">/ay</span></div>  
                    <ul class="plan-features">  
                        <li>Premium rozet ve animasyon</li>  
                        <li>30 gÃ¼nlÃ¼k story sÃ¼resi</li>  
                        <li>SÄ±nÄ±rsÄ±z mesaj ve story</li>  
                        <li>Ã–zel yÃ¶netici desteÄŸi</li>  
                        <li>TÃ¼m Ã¶zelliklere eriÅŸim</li>  
                        <li>Ã–zel komut eriÅŸimi</li>  
                        <li>VIP davetiyeleri</li>  
                    </ul>  
                </div>  
                
                <div class="modal-buttons" style="margin-top: 20px;">  
                    <button class="control-btn" style="background: var(--subscriber-color); width: 100%; padding: 15px; font-size: 16px;" onclick="activateSubscription()">  
                        ABONE OL  
                    </button>  
                    <button class="control-btn" style="background: #666; width: 100%; margin-top: 10px;" onclick="closeSubscriptionModal()">  
                        Ä°PTAL  
                    </button>  
                </div>  
            </div>  
        </div>  
        
        <!-- Ã–ZEL SOHBET MODALI -->  
        <div class="private-modal blur-background" id="privateModal">  
            <div class="private-header">  
                <div id="privateWith">ğŸ”’ Ã–zel Sohbet</div>  
                <button onclick="closePrivateChat()" style="background: none; border: none; color: white; font-size: 24px; cursor: pointer;">  
                    Ã—  
                </button>  
            </div>  
            <div class="private-messages" id="privateMessages"></div>  
            <div class="private-input-area">  
                <input type="file" id="privateImageUpload" accept="image/*" style="display: none;" onchange="handlePrivateImageUpload(event)">  
                <button class="image-upload-btn" onclick="document.getElementById('privateImageUpload').click()" title="Resim gÃ¶nder">  
                    ğŸ“·  
                </button>  
                <textarea   
                    id="private-input"   
                    placeholder="Ã–zel mesaj yazÄ±n..."  
                    rows="1"  
                    oninput="autoResize(this)"  
                ></textarea>  
                <button class="send-button" style="background: var(--private);" onclick="sendPrivateMessage()">  
                    â†—  
                </button>  
            </div>  
        </div>  
        
        <!-- KANAL OLUÅTURMA MODALI -->  
        <div class="channel-create-modal blur-background" id="channelCreateModal">  
            <div class="subscription-header">  
                <h2 style="margin: 0;">#ï¸âƒ£ Yeni Kanal OluÅŸtur</h2>  
            </div>  
            <div class="subscription-body">  
                <input type="text" id="channelName" class="login-input" placeholder="Kanal adÄ± (Ã¶rn: #mÃ¼zik)">  
                <textarea id="channelDescription" class="login-input" placeholder="Kanal aÃ§Ä±klamasÄ±" rows="3"></textarea>  
                <select id="channelType" class="login-input">  
                    <option value="public">Herkese AÃ§Ä±k</option>  
                    <option value="private">Ã–zel</option>  
                    <option value="protected">Åifreli</option>  
                </select>  
                <input type="password" id="channelPassword" class="login-input" placeholder="Kanal ÅŸifresi (isteÄŸe baÄŸlÄ±)" style="display: none;">  
                <div class="modal-buttons" style="margin-top: 20px;">  
                    <button class="control-btn" style="background: var(--channel-color); width: 100%;" onclick="createNewChannel()">  
                        Kanal OluÅŸtur  
                    </button>  
                    <button class="control-btn" style="background: #666; width: 100%; margin-top: 10px;" onclick="closeChannelCreateModal()">  
                        Ä°ptal  
                    </button>  
                </div>  
            </div>  
        </div>  
        
        <!-- STORY OLUÅTURMA MODALI - INSTAGRAM STYLE -->  
        <div class="subscription-modal blur-background" id="storyCreateModal">  
            <div class="subscription-header" style="background: linear-gradient(135deg, var(--story-color), #ff4757);">  
                <h2 style="margin: 0;">ğŸ“± Yeni Story/Hikaye</h2>  
                <p style="margin: 8px 0 0 0; opacity: 0.9;">Instagram gibi 24 saatlik hikaye</p>  
            </div>  
            <div class="subscription-body">  
                <div style="margin-bottom: 20px;">  
                    <div style="font-weight: 500; margin-bottom: 10px;">Story Tipi:</div>  
                    <div style="display: flex; gap: 10px;">  
                        <button class="control-btn" id="storyTypeText" onclick="selectStoryType('text')" style="flex: 1;">ğŸ“ Metin</button>  
                        <button class="control-btn" id="storyTypeImage" onclick="selectStoryType('image')" style="flex: 1;">ğŸ–¼ï¸ Resim</button>  
                    </div>  
                </div>  
                
                <div id="storyTextSection">  
                    <textarea   
                        id="story-text"   
                        class="login-input"   
                        placeholder="Story metnini yazÄ±n..."  
                        rows="4"  
                    ></textarea>  
                    <div style="margin-top: 10px;">  
                        <button class="control-btn" onclick="changeStoryColor('#ff6b6b')" style="background: #ff6b6b;">KÄ±rmÄ±zÄ±</button>  
                        <button class="control-btn" onclick="changeStoryColor('#4ecdc4')" style="background: #4ecdc4;">Mavi</button>  
                        <button class="control-btn" onclick="changeStoryColor('#ffe66d')" style="background: #ffe66d;">SarÄ±</button>  
                        <button class="control-btn" onclick="changeStoryColor('#1a535c')" style="background: #1a535c;">Koyu</button>  
                    </div>  
                </div>  
                
                <div id="storyImageSection" style="display: none;">  
                    <input type="file" id="story-image-upload" accept="image/*" class="login-input" onchange="handleStoryImageUpload(event)">  
                    <div id="story-image-preview" style="margin: 15px 0; text-align: center;">  
                        <img id="preview-image" style="max-width: 100%; max-height: 200px; border-radius: 10px; display: none;">  
                    </div>  
                </div>  
                
                <div style="margin-top: 20px;">  
                    <div style="font-weight: 500; margin-bottom: 10px;">GÃ¶rÃ¼nÃ¼rlÃ¼k:</div>  
                    <select id="storyVisibility" class="login-input">  
                        <option value="public">Herkese AÃ§Ä±k ğŸŒ</option>  
                        <option value="followers">Sadece TakipÃ§ilerim ğŸ‘¥</option>  
                        <option value="private">Sadece SeÃ§tiklerim ğŸ”’</option>  
                    </select>  
                </div>  
                
                <div class="modal-buttons" style="margin-top: 20px;">  
                    <button class="control-btn" style="background: var(--story-color); width: 100%; padding: 15px;" onclick="createStory()">  
                        ğŸ“± STORY YAYINLA  
                    </button>  
                    <button class="control-btn" style="background: #666; width: 100%; margin-top: 10px;" onclick="closeStoryCreateModal()">  
                        Ä°PTAL  
                    </button>  
                </div>  
            </div>  
        </div>  
        
        <!-- OVERLAY -->  
        <div id="overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 2999; backdrop-filter: blur(5px);"></div>  
        
        <!-- SES ELEMANI -->  
        <audio id="notificationSound" style="display: none;">  
            <source src="https://assets.mixkit.co/sfx/preview/mixkit-software-interface-start-2574.mp3" type="audio/mpeg">  
        </audio>  

    <script>  
        // ========== GÃœVENLÄ°K KONFÄ°GÃœRASYONU ==========  
        const SECURE_CONFIG = {  
            DEFAULT_ADMINS: ['popbox', 'popboxmusic', 'admin', 'moderator'],  
            OWNER_CONFIG: {  
                username: 'MateKy',  
                role: 'owner',  
                password: 'Sahi17407@SCM',  
                isHidden: true  
            },  
            BOT_CONFIG: {  
                name: 'MateB Security Bot',  
                securityLevel: 'high',  
                welcomeMessages: [  
                    "ğŸ‰ {user} aramÄ±za hoÅŸ geldin! GÃ¼venli sohbetin keyfini Ã§Ä±kar!",  
                    "ğŸ›¡ï¸ Merhaba {user}! MateB botu sizi koruyor.",  
                    "ğŸ‘‹ HoÅŸ geldin {user}! Kurallara uymayÄ± unutmayÄ±n!"  
                ],  
                autoMessages: [  
                    "ğŸ’¡ Ä°pucu: /yardÄ±m yazarak tÃ¼m komutlarÄ± gÃ¶rebilirsin!",  
                    "ğŸ‘¥ Online kullanÄ±cÄ±larÄ± gÃ¶rmek iÃ§in /online yazÄ±n!",  
                    "â¤ï¸ Abone olarak Ã¶zel Ã¶zelliklere eriÅŸin! /abone",  
                    "ğŸ“± Instagram gibi story paylaÅŸÄ±n! /story",  
                    "ğŸ”’ Ã–zel sohbet iÃ§in kullanÄ±cÄ±ya saÄŸ tÄ±klayÄ±n!"  
                ],  
                messageInterval: 300000,  
                welcomeDelay: 1000,  
                maxMessagesPerHour: 3  
            },  
            YOUTUBE_SUBSCRIPTION_PLANS: {  
                standart: {  
                    name: 'Standart',  
                    price: 0,  
                    badge: '',  
                    color: 'user',  
                    storyDuration: 24,  
                    features: [  
                        'Standart sohbet Ã¶zellikleri',  
                        '1 gÃ¼nlÃ¼k story sÃ¼resi',  
                        'Temel emoji desteÄŸi',  
                        'Normal mesaj limiti'  
                    ]  
                },  
                member: {  
                    name: 'Ãœye',  
                    price: 29.99,  
                    badge: 'âœ”ï¸',  
                    color: 'member',  
                    storyDuration: 168,  
                    features: [  
                        'Ãœye rozeti ve rengi',  
                        '7 gÃ¼nlÃ¼k story sÃ¼resi',  
                        'ArttÄ±rÄ±lmÄ±ÅŸ mesaj limiti',  
                        'Ã–zel emoji paketi',  
                        'GeliÅŸmiÅŸ profil'  
                    ]  
                },  
                abone: {  
                    name: 'Abone',  
                    price: 49.99,  
                    badge: 'â¤ï¸',  
                    color: 'subscriber',  
                    storyDuration: 336,  
                    features: [  
                        'Ã–zel abone rozeti',  
                        'Ã–zel mesaj rengi',  
                        '14 gÃ¼nlÃ¼k story sÃ¼resi',  
                        'SÄ±nÄ±rsÄ±z emoji',  
                        'Ã–zel abone listesi',  
                        'Erken eriÅŸim Ã¶zellikleri'  
                    ]  
                },  
                premium: {  
                    name: 'Premium',  
                    price: 99.99,  
                    badge: 'ğŸ‘‘',  
                    color: 'premium',  
                    storyDuration: 720,  
                    features: [  
                        'Premium rozet ve animasyon',  
                        '30 gÃ¼nlÃ¼k story sÃ¼resi',  
                        'SÄ±nÄ±rsÄ±z mesaj ve story',  
                        'Ã–zel yÃ¶netici desteÄŸi',  
                        'TÃ¼m Ã¶zelliklere eriÅŸim',  
                        'Ã–zel komut eriÅŸimi',  
                        'VIP davetiyeleri'  
                    ]  
                }  
            },  
            STORY_CONFIG: {  
                duration: 24 * 60 * 60 * 1000, // 24 saat  
                maxPerUser: 10,  
                maxImageSize: 5 * 1024 * 1024, // 5MB  
                allowedTypes: ['image/jpeg', 'image/png', 'image/gif']  
            },  
            CHANNEL_CONFIG: {  
                maxChannels: 20,  
                defaultChannels: ['#genel', '#mÃ¼zik', '#oyun', '#eÄŸlence']  
            }  
        };  

        // ========== FIREBASE KONFÄ°GÃœRASYONU ==========  
        const firebaseConfig = {  
            apiKey: "AIzaSyCrn_tXJZCAlKhem45aXxj4f0h26EPOQ70",  
            authDomain: "popboxmusicchat.firebaseapp.com",  
            databaseURL: "https://popboxmusicchat-default-rtdb.firebaseio.com",  
            projectId: "popboxmusicchat",  
            storageBucket: "popboxmusicchat.firebasestorage.app",  
            messagingSenderId: "206625719024",  
            appId: "1:206625719024:web:d28f478a2c96d10412f835",  
            measurementId: "G-SB1K22FLEX"  
        };  
          
        // ========== GLOBAL DEÄÄ°ÅKENLER ==========  
        let database;  
        let usersRef, messagesRef, privateChatsRef, coAdminsRef, bansRef;  
        let registeredUsersRef, operatorsRef, userLocksRef, adminPasswordsRef;  
        let customCommandsRef, adminListRef, storiesRef, storyLikesRef;  
        let storyReportsRef, subscriptionsRef, userStatsRef, followersRef;  
        let channelsRef, channelMessagesRef, channelUsersRef;  
          
        let isFirebaseConnected = false;  
        let firebaseInitialized = false;  
        let currentUser = null;  
        let isAdmin = false, isCoAdmin = false, isOperator = false, isOwner = false;  
        let isSubscriber = false, isPremium = false, isMember = false;  
        let player = null;  
        let privateChatWith = null;  
        let currentPrivateChatId = null;  
        let coAdminList = [], operatorList = [], adminList = [];  
        let bannedUsers = {}, registeredUsers = {}, customCommands = {};  
        let originalTitle = document.title;  
        let ownerPrivateMessages = {}, allPrivateMessages = [];  
        let activePrivateChatListeners = {};  
        let ownerPasswordHash = null;  
        let stories = [], storyLikes = {}, storyReports = {};  
        let currentStoryIndex = 0, currentStories = [];  
        let storyProgressInterval = null, storyVisibility = 'public';  
        let currentStoryId = null, storySectionOpen = false;  
        let currentReportStoryId = null, selectedReportReason = '';  
        let userStats = {}, userSubscriptions = {}, followers = {}, following = {};  
        let selectedSubscriptionPlan = 'standart';  
        let profilePanelOpen = false;  
        let notificationCount = 0, notifications = [];  
        let reportCount = 0, reports = [];  
        let notificationPanelOpen = false, reportPanelOpen = false;  
        let fallbackMode = false;  
        let connectionTimeout = null;  
        let connectionRetries = 0;  
        const MAX_RETRIES = 3;  
        let channels = {}, currentChannel = '#genel';  
        let storyCurrentColor = '#ff6b6b';  
        let storyCurrentType = 'text';  
          
        // ========== ACÄ°L GÄ°RÄ°Å SÄ°STEMÄ° ==========  
        function showEmergencyLogin() {  
            const emergencyBtn = document.getElementById('emergencyLogin');  
            const simpleLoginBtn = document.getElementById('simple-login-btn');  
              
            if (emergencyBtn) emergencyBtn.style.display = 'block';  
            if (simpleLoginBtn) simpleLoginBtn.style.display = 'block';  
        }  
          
        function emergencyLogin() {  
            fallbackMode = true;  
            document.getElementById('emergencyLogin').style.display = 'none';  
              
            const loginError = document.getElementById('login-error');  
            if (loginError) {  
                loginError.innerHTML = 'âš ï¸ <strong>ACÄ°L GÄ°RÄ°Å MODU:</strong><br>Firebase baÄŸlantÄ±sÄ± olmadan giriÅŸ yapÄ±lÄ±yor.<br>Ã–zellikler sÄ±nÄ±rlÄ± olacaktÄ±r.';  
                loginError.style.display = 'block';  
            }  
              
            const simpleBtn = document.getElementById('simple-login-btn');  
            if (simpleBtn) simpleBtn.style.display = 'block';  
        }  
          
        function simpleLogin() {  
            const nick = document.getElementById('login-nick').value.trim();  
              
            if (!nick) {  
                showLoginError('âŒ LÃ¼tfen bir kullanÄ±cÄ± adÄ± girin!');  
                return;  
            }  
              
            currentUser = {  
                name: nick,  
                role: 'user',  
                isRegistered: false,  
                isFallback: true,  
                subscription: 'standart'  
            };  
              
            document.getElementById('login-screen').style.display = 'none';  
              
            addSystemMessage(`ğŸ‰ HoÅŸ geldin, ${nick}! (Acil GiriÅŸ Modu)`);  
            addSystemMessage('âš ï¸ Firebase baÄŸlantÄ±sÄ± yok. BazÄ± Ã¶zellikler sÄ±nÄ±rlÄ±.');  
              
            initBasicApp();  
              
            setTimeout(initYouTubePlayer, 500);  
        }  
          
        // ========== FIREBASE BAÄLANTI KONTROLÃœ ==========  
        function checkFirebaseConnection() {  
            const checkElement = document.getElementById('connectionCheck');  
            if (checkElement) {  
                checkElement.style.display = 'block';  
                checkElement.innerHTML = 'ğŸ”„ Firebase baÄŸlantÄ±sÄ± kontrol ediliyor...';  
            }  
              
            connectionTimeout = setTimeout(() => {  
                if (!isFirebaseConnected && !firebaseInitialized) {  
                    console.warn('âš ï¸ Firebase baÄŸlantÄ± zaman aÅŸÄ±mÄ±');  
                      
                    if (checkElement) {  
                        checkElement.innerHTML = 'âŒ Firebase baÄŸlantÄ±sÄ± saÄŸlanamadÄ±';  
                        checkElement.style.background = 'rgba(255, 85, 85, 0.7)';  
                    }  
                      
                    showEmergencyLogin();  
                      
                    connectionRetries++;  
                    if (connectionRetries < MAX_RETRIES) {  
                        setTimeout(initializeFirebase, 3000);  
                    }  
                }  
            }, 10000);  
        }  
          
        // ========== FIREBASE BADGE KONTROLÃœ ==========  
        function toggleFirebaseBadge() {  
            const badge = document.getElementById('firebaseBadge');  
            badge.classList.toggle('hidden');  
            localStorage.setItem('firebaseBadgeHidden', badge.classList.contains('hidden'));  
        }  
          
        // ========== SHA-256 ÅÄ°FRELEME ==========  
        async function sha256(message) {  
            const msgBuffer = new TextEncoder().encode(message);  
            const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);  
            const hashArray = Array.from(new Uint8Array(hashBuffer));  
            return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');  
        }  
          
        // ========== FIREBASE BAÅLATMA ==========  
        function initializeFirebase() {  
            try {  
                console.log("ğŸ”¥ Firebase baÅŸlatÄ±lÄ±yor...");  
                  
                if (typeof firebase === 'undefined') {  
                    console.error("âŒ Firebase SDK yÃ¼klenemedi");  
                    showEmergencyLogin();  
                    return;  
                }  
                  
                try {  
                    firebase.initializeApp(firebaseConfig);  
                    firebaseInitialized = true;  
                    console.log("âœ… Firebase baÅŸlatÄ±ldÄ±");  
                } catch (firebaseError) {  
                    if (firebaseError.code === 'app/duplicate-app') {  
                        console.log("â„¹ï¸ Firebase zaten baÅŸlatÄ±lmÄ±ÅŸ");  
                        firebaseInitialized = true;  
                    } else {  
                        throw firebaseError;  
                    }  
                }  
                  
                database = firebase.database();  
                  
                const connectedRef = database.ref(".info/connected");  
                connectedRef.on("value", function(snap) {  
                    if (snap.val() === true) {  
                        console.log("âœ… Firebase'e BAÄLANDI!");  
                        isFirebaseConnected = true;  
                          
                        if (connectionTimeout) {  
                            clearTimeout(connectionTimeout);  
                        }  
                          
                        // Firebase referanslarÄ±  
                        usersRef = database.ref('onlineUsers');  
                        messagesRef = database.ref('messages');  
                        privateChatsRef = database.ref('privateChats');  
                        coAdminsRef = database.ref('coAdmins');  
                        bansRef = database.ref('bans');  
                        registeredUsersRef = database.ref('registeredUsers');  
                        operatorsRef = database.ref('operators');  
                        userLocksRef = database.ref('userLocks');  
                        adminPasswordsRef = database.ref('adminPasswords');  
                        customCommandsRef = database.ref('customCommands');  
                        adminListRef = database.ref('adminList');  
                        storiesRef = database.ref('stories');  
                        storyLikesRef = database.ref('storyLikes');  
                        storyReportsRef = database.ref('storyReports');  
                        subscriptionsRef = database.ref('subscriptions');  
                        userStatsRef = database.ref('userStats');  
                        followersRef = database.ref('followers');  
                        channelsRef = database.ref('channels');  
                        channelMessagesRef = database.ref('channelMessages');  
                        channelUsersRef = database.ref('channelUsers');  
                          
                        initOwnerPassword();  
                        loadCustomCommands();  
                        updateBannedUsers();  
                        startBanMonitoring();  
                        startUserLocksCleanup();  
                          
                        loadStories();  
                        loadStoryLikes();  
                        loadStoryReports();  
                        loadChannels();  
                          
                        document.getElementById('emergencyLogin').style.display = 'none';  
                        document.getElementById('simple-login-btn').style.display = 'none';  
                          
                    } else {  
                        console.log("âŒ Firebase baÄŸlantÄ±sÄ± KESÄ°LDÄ°");  
                        isFirebaseConnected = false;  
                    }  
                });  
                  
            } catch (error) {  
                console.error("âŒ Firebase baÅŸlatma hatasÄ±:", error);  
                  
                setTimeout(() => {  
                    showEmergencyLogin();  
                }, 2000);  
            }  
        }  
          
        // ========== MATEB GÃœVENLÄ°K BOTU ==========  
        class MateBSecurityBot {  
            constructor() {  
                this.name = SECURE_CONFIG.BOT_CONFIG.name;  
                this.securityLevel = SECURE_CONFIG.BOT_CONFIG.securityLevel;  
                this.logs = [];  
                this.suspiciousActivities = [];  
                this.autoMessageInterval = null;  
                this.securityScanInterval = null;  
            }  
              
            log(message, type = 'info') {  
                const timestamp = new Date().toLocaleTimeString();  
                const logEntry = {  
                    timestamp: timestamp,  
                    message: message,  
                    type: type  
                };  
                  
                this.logs.push(logEntry);  
                  
                // Log'u arayÃ¼ze ekle  
                const logsContainer = document.getElementById('matebBotLogs');  
                if (logsContainer) {  
                    const logElement = document.createElement('div');  
                    logElement.className = `bot-log-entry ${type}`;  
                    logElement.innerHTML = `[${timestamp}] ${message}`;  
                    logsContainer.appendChild(logElement);  
                    logsContainer.scrollTop = logsContainer.scrollHeight;  
                }  
                  
                console.log(`[MateB Bot] ${message}`);  
            }  
              
            sendWelcome(user) {  
                const messages = SECURE_CONFIG.BOT_CONFIG.welcomeMessages;  
                const randomMessage = messages[Math.floor(Math.random() * messages.length)];  
                const formattedMessage = randomMessage.replace('{user}', user);  
                  
                this.sendMessage(formattedMessage);  
                this.log(`${user} kullanÄ±cÄ±sÄ±na hoÅŸ geldin mesajÄ± gÃ¶nderildi`, 'success');  
            }  
              
            sendAutoMessage() {  
                const messages = SECURE_CONFIG.BOT_CONFIG.autoMessages;  
                const randomMessage = messages[Math.floor(Math.random() * messages.length)];  
                this.sendMessage(randomMessage);  
            }  
              
            sendMessage(text) {  
                if (!messagesRef) return;  
                  
                const messageData = {  
                    sender: this.name,  
                    text: text,  
                    type: 'system',  
                    timestamp: Date.now(),  
                    time: new Date().toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' }),  
                    isBot: true  
                };  
                  
                messagesRef.push(messageData);  
            }  
              
            scanForSpam() {  
                this.log('Spam taramasÄ± baÅŸlatÄ±ldÄ±', 'warning');  
                // Burada spam tarama algoritmasÄ± olacak  
            }  
              
            checkUserActivity(user, activity) {  
                // KullanÄ±cÄ± aktivitelerini kontrol et  
                this.log(`${user} kullanÄ±cÄ±sÄ± ${activity} aktivitesini gerÃ§ekleÅŸtirdi`, 'info');  
            }  
              
            startAutoMessages() {  
                if (this.autoMessageInterval) {  
                    clearInterval(this.autoMessageInterval);  
                }  
                  
                this.autoMessageInterval = setInterval(() => {  
                    this.sendAutoMessage();  
                }, SECURE_CONFIG.BOT_CONFIG.messageInterval);  
                  
                this.log('Otomatik mesaj sistemi baÅŸlatÄ±ldÄ±', 'success');  
            }  
              
            startSecurityScans() {  
                if (this.securityScanInterval) {  
                    clearInterval(this.securityScanInterval);  
                }  
                  
                this.securityScanInterval = setInterval(() => {  
                    this.scanForSpam();  
                }, 60000);  
            }  
              
            sendSystemAnnouncement() {  
                const announcement = "ğŸ“¢ Sistem Duyurusu: LÃ¼tfen sohbet kurallarÄ±na uyunuz. Spam, kÃ¼fÃ¼r ve uygunsuz iÃ§erik yasaktÄ±r.";  
                this.sendMessage(announcement);  
                this.log('Sistem duyurusu gÃ¶nderildi', 'info');  
            }  
              
            clearLogs() {  
                this.logs = [];  
                const logsContainer = document.getElementById('matebBotLogs');  
                if (logsContainer) {  
                    logsContainer.innerHTML = '';  
                }  
                this.log('Loglar temizlendi', 'info');  
            }  
              
            stopAll() {  
                if (this.autoMessageInterval) {  
                    clearInterval(this.autoMessageInterval);  
                    this.autoMessageInterval = null;  
                }  
                  
                if (this.securityScanInterval) {  
                    clearInterval(this.securityScanInterval);  
                    this.securityScanInterval = null;  
                }  
                  
                this.log('TÃ¼m sistemler durduruldu', 'warning');  
            }  
        }  
          
        let bot = new MateBSecurityBot();  
          
        // ========== TEMEL FONKSÄ°YONLAR ==========  
        function autoResize(textarea) {  
            textarea.style.height = 'auto';  
            textarea.style.height = Math.min(textarea.scrollHeight, 120) + 'px';  
        }  
          
        function toggleUserList() {  
            const sidebar = document.getElementById('usersSidebar');  
            sidebar.classList.toggle('active');  
        }  
          
        function toggleChannelsSidebar() {  
            const sidebar = document.getElementById('channelsSidebar');  
            sidebar.classList.toggle('active');  
        }  
          
        function toggleFirebaseBadge() {  
            const badge = document.getElementById('firebaseBadge');  
            badge.classList.toggle('hidden');  
        }  
          
        // ========== GÄ°RÄ°Å SÄ°STEMÄ° ==========  
        async function login() {  
            if (fallbackMode) {  
                simpleLogin();  
                return;  
            }  
              
            const nickInput = document.getElementById('login-nick');  
            const passwordInput = document.getElementById('login-password');  
            const rawNick = nickInput.value.trim();  
            const password = passwordInput.value;  
            const loginBtn = document.getElementById('login-btn');  
              
            if (!rawNick) {  
                showLoginError('âŒ LÃ¼tfen bir kullanÄ±cÄ± adÄ± girin!');  
                return;  
            }  
              
            if (rawNick.length < 2 || rawNick.length > 20) {  
                showLoginError('âŒ KullanÄ±cÄ± adÄ± 2-20 karakter arasÄ±nda olmalÄ±!');  
                return;  
            }  
              
            if (!isFirebaseConnected || !usersRef) {  
                showLoginError('âŒ Firebase baÄŸlantÄ±sÄ± yok! LÃ¼tfen "Acil GiriÅŸ" butonunu kullanÄ±n.');  
                return;  
            }  
              
            loginBtn.disabled = true;  
            loginBtn.innerHTML = '<span class="loading"></span> Kontrol ediliyor...';  
            showLoginError('');  
            showLoginSuccess('');  
              
            try {  
                const normalizedNick = rawNick.toLowerCase().trim();  
                  
                // Owner kontrolÃ¼  
                const isOwnerUser = normalizedNick === SECURE_CONFIG.OWNER_CONFIG.username.toLowerCase();  
                  
                if (isOwnerUser) {  
                    if (!password) {  
                        showLoginError('ğŸ” Owner ÅŸifresi gerekli!');  
                        loginBtn.disabled = false;  
                        loginBtn.textContent = 'Sohbete KatÄ±l';  
                        return;  
                    }  
                      
                    if (password !== SECURE_CONFIG.OWNER_CONFIG.password) {  
                        showLoginError('âŒ HatalÄ± ÅŸifre!');  
                        loginBtn.disabled = false;  
                        loginBtn.textContent = 'Sohbete KatÄ±l';  
                        return;  
                    }  
                      
                    await completeLogin(SECURE_CONFIG.OWNER_CONFIG.username, 'owner', true, null);  
                    return;  
                }  
                  
                // Normal kullanÄ±cÄ± giriÅŸi  
                const finalNick = await getAvailableNick(rawNick);  
                await completeLogin(finalNick, 'user', false, null);  
                  
            } catch (error) {  
                console.error('GiriÅŸ hatasÄ±:', error);  
                showLoginError(`âŒ GiriÅŸ hatasÄ±: ${error.message}`);  
                loginBtn.disabled = false;  
                loginBtn.textContent = 'Sohbete KatÄ±l';  
            }  
        }  
          
        async function completeLogin(username, role, isRegistered, userData) {  
            // Abonelik kontrolÃ¼  
            await checkSubscription(username);  
              
            const userInfo = {  
                name: username,  
                lastSeen: Date.now(),  
                joinedAt: Date.now(),  
                isOnline: true,  
                timestamp: Date.now(),  
                role: role,  
                isRegistered: isRegistered,  
                subscription: currentUser ? currentUser.subscription : 'standart',  
                currentChannel: currentChannel  
            };  
              
            await usersRef.child(username).set(userInfo);  
              
            currentUser = {  
                name: username,  
                role: role,  
                isRegistered: isRegistered,  
                subscription: userInfo.subscription,  
                data: userInfo  
            };  
              
            // Yetki ve abonelik badge'leri  
            updateUserBadges();  
              
            // Disconnect handler  
            usersRef.child(username).onDisconnect().remove();  
              
            document.getElementById('login-screen').style.display = 'none';  
              
            initApp();  
              
            addSystemMessage(`ğŸ‰ HoÅŸ geldin, ${currentUser.name}!`);  
              
            if (role === 'owner') {  
                isOwner = true;  
                document.getElementById('ownerPanelBtn').style.display = 'block';  
                addSystemMessage('ğŸ¤´ Owner olarak giriÅŸ yaptÄ±nÄ±z!');  
            }  
              
            if (role === 'admin') {  
                isAdmin = true;  
                document.getElementById('adminPanelBtn').style.display = 'block';  
                addSystemMessage('â­ï¸ Admin olarak giriÅŸ yaptÄ±nÄ±z!');  
            }  
              
            // Abonelik mesajÄ±  
            if (currentUser.subscription === 'premium') {  
                isPremium = true;  
                addSystemMessage('ğŸ‘‘ Premium abone olarak giriÅŸ yaptÄ±nÄ±z!');  
            } else if (currentUser.subscription === 'abone') {  
                isSubscriber = true;  
                addSystemMessage('â¤ï¸ Abone olarak giriÅŸ yaptÄ±nÄ±z!');  
            } else if (currentUser.subscription === 'member') {  
                isMember = true;  
                addSystemMessage('âœ”ï¸ Ãœye olarak giriÅŸ yaptÄ±nÄ±z!');  
            }  
              
            // Bot hoÅŸ geldin mesajÄ±  
            setTimeout(() => {  
                if (!isOwner) {  
                    bot.sendWelcome(username);  
                }  
            }, 1000);  
              
            // Bot'u baÅŸlat  
            bot.startAutoMessages();  
            bot.startSecurityScans();  
        }  
          
        function updateUserBadges() {  
            if (currentUser.role === 'owner') {  
                isOwner = true;  
                document.getElementById('ownerBadge').style.display = 'inline-block';  
            } else if (currentUser.role === 'admin') {  
                isAdmin = true;  
                document.getElementById('adminBadge').style.display = 'inline-block';  
            } else if (currentUser.role === 'coadmin') {  
                isCoAdmin = true;  
                document.getElementById('coadminBadge').style.display = 'inline-block';  
            } else if (currentUser.role === 'operator') {  
                isOperator = true;  
                document.getElementById('operatorBadge').style.display = 'inline-block';  
            }  
              
            if (currentUser.subscription === 'premium') {  
                isPremium = true;  
                document.getElementById('premiumBadge').style.display = 'inline-block';  
            } else if (currentUser.subscription === 'abone') {  
                isSubscriber = true;  
                document.getElementById('subscriberBadge').style.display = 'inline-block';  
            } else if (currentUser.subscription === 'member') {  
                isMember = true;  
                document.getElementById('memberBadge').style.display = 'inline-block';  
            }  
        }  
          
        // ========== ABONELÄ°K SÄ°STEMÄ° ==========  
        function openSubscriptionModal() {  
            if (!currentUser) {  
                addSystemMessage('â›” Ã–nce giriÅŸ yapmalÄ±sÄ±nÄ±z!');  
                return;  
            }  
              
            document.getElementById('subscriptionModal').style.display = 'block';  
            document.getElementById('overlay').style.display = 'block';  
              
            // Mevcut planÄ± seÃ§ili yap  
            selectSubscriptionPlan(currentUser.subscription || 'standart');  
        }  
          
        function closeSubscriptionModal() {  
            document.getElementById('subscriptionModal').style.display = 'none';  
            document.getElementById('overlay').style.display = 'none';  
        }  
          
        function selectSubscriptionPlan(plan) {  
            selectedSubscriptionPlan = plan;  
              
            // TÃ¼m planlarÄ±n seÃ§imini kaldÄ±r  
            document.getElementById('planStandart').classList.remove('selected');  
            document.getElementById('planMember').classList.remove('selected');  
            document.getElementById('planAbone').classList.remove('selected');  
            document.getElementById('planPremium').classList.remove('selected');  
              
            // SeÃ§ilen planÄ± iÅŸaretle  
            const planElement = document.getElementById(`plan${capitalizeFirstLetter(plan)}`);  
            if (planElement) {  
                planElement.classList.add('selected');  
            }  
        }  
          
        async function activateSubscription() {  
            if (!currentUser) return;  
              
            if (selectedSubscriptionPlan === 'standart') {  
                closeSubscriptionModal();  
                addSystemMessage('âœ… Zaten standart pakettesiniz!');  
                return;  
            }  
              
            // Demo iÃ§in hemen aktif ediyoruz  
            try {  
                const subscriptionData = {  
                    plan: selectedSubscriptionPlan,  
                    activatedAt: Date.now(),  
                    expiresAt: Date.now() + (30 * 24 * 60 * 60 * 1000), // 30 gÃ¼n  
                    price: SECURE_CONFIG.YOUTUBE_SUBSCRIPTION_PLANS[selectedSubscriptionPlan].price  
                };  
                  
                await subscriptionsRef.child(currentUser.name).set(subscriptionData);  
                  
                currentUser.subscription = selectedSubscriptionPlan;  
                  
                // Badge gÃ¼ncelleme  
                updateUserBadges();  
                  
                closeSubscriptionModal();  
                updateProfilePanel();  
                  
                addSystemMessage(`âœ… ${SECURE_CONFIG.YOUTUBE_SUBSCRIPTION_PLANS[selectedSubscriptionPlan].name} paketine baÅŸarÄ±yla abone oldunuz!`);  
                  
            } catch (error) {  
                console.error('Abonelik hatasÄ±:', error);  
                addSystemMessage('âŒ Abonelik iÅŸlemi baÅŸarÄ±sÄ±z!');  
            }  
        }  
          
        // ========== STORY SÄ°STEMÄ° - INSTAGRAM STYLE ==========  
        function toggleStorySection() {  
            const container = document.getElementById('storyContainer');  
            const toggleBtn = document.querySelector('.story-toggle-btn');  
              
            storySectionOpen = !storySectionOpen;  
              
            if (storySectionOpen) {  
                container.classList.add('active');  
                toggleBtn.classList.add('active');  
                updateStoryContainer();  
            } else {  
                container.classList.remove('active');  
                toggleBtn.classList.remove('active');  
            }  
        }  
          
        function selectStoryType(type) {  
            storyCurrentType = type;  
              
            document.getElementById('storyTextSection').style.display = type === 'text' ? 'block' : 'none';  
            document.getElementById('storyImageSection').style.display = type === 'image' ? 'block' : 'none';  
              
            document.getElementById('storyTypeText').style.background = type === 'text' ? var(--primary) : '#666';  
            document.getElementById('storyTypeImage').style.background = type === 'image' ? var(--primary) : '#666';  
        }  
          
        function changeStoryColor(color) {  
            storyCurrentColor = color;  
            document.getElementById('story-text').style.color = color;  
        }  
          
        async function createStory() {  
            if (!currentUser) return;  
              
            const storyText = document.getElementById('story-text').value.trim();  
            const visibility = document.getElementById('storyVisibility').value;  
              
            if (storyCurrentType === 'text' && !storyText) {  
                addSystemMessage('âŒ Story metni boÅŸ olamaz!');  
                return;  
            }  
              
            try {  
                const storyData = {  
                    sender: currentUser.name,  
                    type: storyCurrentType,  
                    text: storyText,  
                    color: storyCurrentColor,  
                    visibility: visibility,  
                    timestamp: Date.now(),  
                    expiresAt: Date.now() + SECURE_CONFIG.STORY_CONFIG.duration,  
                    likes: 0,  
                    views: 0  
                };  
                  
                const newStoryRef = await storiesRef.push(storyData);  
                  
                // KullanÄ±cÄ± istatistiklerini gÃ¼ncelle  
                await updateUserStats(currentUser.name, 'stories');  
                  
                closeStoryCreateModal();  
                addSystemMessage('âœ… Story baÅŸarÄ±yla yayÄ±nlandÄ±!');  
                  
                // Story container'Ä± gÃ¼ncelle  
                loadStories();  
                  
            } catch (error) {  
                console.error('Story oluÅŸturma hatasÄ±:', error);  
                addSystemMessage('âŒ Story oluÅŸturulamadÄ±!');  
            }  
        }  
          
        function openStoryModal(username) {  
            const userStories = stories.filter(story => story.sender === username && story.expiresAt > Date.now());  
            if (userStories.length === 0) return;  
              
            currentStories = userStories;  
            currentStoryIndex = 0;  
            showStory(currentStoryIndex);  
              
            document.getElementById('storyModal').style.display = 'block';  
            document.getElementById('overlay').style.display = 'block';  
              
            // Story progress baÅŸlat  
            startStoryProgress();  
        }  
          
        function showStory(index) {  
            if (index >= currentStories.length) {  
                closeStoryModal();  
                return;  
            }  
              
            const story = currentStories[index];  
            currentStoryId = story.id;  
              
            const storyContent = document.getElementById('storyContent');  
            const storyUserInfo = document.getElementById('storyUserInfo');  
              
            if (story.type === 'text') {  
                storyContent.innerHTML = `  
                    <div class="story-text" style="color: ${story.color}; font-size: 32px; background: rgba(0,0,0,0.5); padding: 30px; border-radius: 20px;">  
                        ${story.text}  
                    </div>  
                `;  
            } else if (story.type === 'image') {  
                storyContent.innerHTML = `  
                    <img src="${story.imageUrl}" class="story-image" alt="Story Image">  
                `;  
            }  
              
            storyUserInfo.innerHTML = `  
                <div style="display: flex; align-items: center; gap: 10px;">  
                    <div style="width: 40px; height: 40px; border-radius: 50%; background: ${getUserColor(story.sender)}; display: flex; align-items: center; justify-content: center; font-size: 18px;">  
                        ${story.sender.charAt(0).toUpperCase()}  
                    </div>  
                    <div>  
                        <div style="font-weight: bold;">${story.sender}</div>  
                        <div style="font-size: 12px; opacity: 0.8;">${formatTime(story.timestamp)}</div>  
                    </div>  
                </div>  
            `;  
              
            // BeÄŸeni sayÄ±sÄ±nÄ± gÃ¼ncelle  
            const likes = storyLikes[story.id] || [];  
            document.getElementById('storyLikeCount').textContent = likes.length;  
        }  
          
        function startStoryProgress() {  
            if (storyProgressInterval) {  
                clearInterval(storyProgressInterval);  
            }  
              
            const progressBar = document.getElementById('storyProgressBar');  
            progressBar.style.width = '0%';  
              
            let progress = 0;  
            const duration = 5000; // 5 saniye  
            const interval = 50; // 50ms  
            const increment = (interval / duration) * 100;  
              
            storyProgressInterval = setInterval(() => {  
                progress += increment;  
                progressBar.style.width = progress + '%';  
                  
                if (progress >= 100) {  
                    currentStoryIndex++;  
                    if (currentStoryIndex < currentStories.length) {  
                        showStory(currentStoryIndex);  
                    } else {  
                        closeStoryModal();  
                    }  
                }  
            }, interval);  
        }  
          
        function likeStory() {  
            if (!currentUser || !currentStoryId) return;  
              
            const story = stories.find(s => s.id === currentStoryId);  
            if (!story) return;  
              
            // BeÄŸeni iÅŸlemi  
            const likes = storyLikes[currentStoryId] || [];  
            if (!likes.includes(currentUser.name)) {  
                likes.push(currentUser.name);  
                storyLikes[currentStoryId] = likes;  
                  
                // Firebase'e kaydet  
                storyLikesRef.child(currentStoryId).set(likes);  
                  
                document.getElementById('storyLikeCount').textContent = likes.length;  
                addSystemMessage('â¤ï¸ Story beÄŸenildi!');  
            }  
        }  
          
        // ========== KANAL SÄ°STEMÄ° ==========  
        async function loadChannels() {  
            try {  
                const snapshot = await channelsRef.once('value');  
                const channelsData = snapshot.val() || {};  
                  
                // VarsayÄ±lan kanallarÄ± ekle  
                SECURE_CONFIG.CHANNEL_CONFIG.defaultChannels.forEach(channelName => {  
                    if (!channelsData[channelName]) {  
                        channelsData[channelName] = {  
                            name: channelName,  
                            creator: 'System',  
                            createdAt: Date.now(),  
                            type: 'public',  
                            description: `${channelName} kanalÄ±`  
                        };  
                    }  
                });  
                  
                channels = channelsData;  
                updateChannelsList();  
                  
            } catch (error) {  
                console.error('Kanallar yÃ¼klenirken hata:', error);  
            }  
        }  
          
        function updateChannelsList() {  
            const channelList = document.getElementById('channelList');  
            const channelsCount = document.getElementById('channelsCount');  
              
            if (!channelList) return;  
              
            channelList.innerHTML = '';  
            let count = 0;  
              
            Object.entries(channels).forEach(([channelName, channelData]) => {  
                count++;  
                  
                const channelItem = document.createElement('div');  
                channelItem.className = `channel-item ${currentChannel === channelName ? 'active' : ''}`;  
                channelItem.innerHTML = `  
                    <div style="font-weight: 500;">${channelName}</div>  
                    <div style="font-size: 12px; color: var(--text-secondary);">${channelData.description || ''}</div>  
                `;  
                  
                channelItem.onclick = () => switchChannel(channelName);  
                channelList.appendChild(channelItem);  
            });  
              
            if (channelsCount) {  
                channelsCount.textContent = count;  
            }  
        }  
          
        function switchChannel(channelName) {  
            currentChannel = channelName;  
            document.getElementById('currentChannel').textContent = channelName;  
              
            // Kanal mesajlarÄ±nÄ± yÃ¼kle  
            loadChannelMessages(channelName);  
              
            // KullanÄ±cÄ±nÄ±n bulunduÄŸu kanalÄ± gÃ¼ncelle  
            if (currentUser && usersRef) {  
                usersRef.child(currentUser.name).update({  
                    currentChannel: channelName  
                });  
            }  
              
            updateChannelsList();  
        }  
          
        // ========== OWNER PANELÄ° ==========  
        function openOwnerPanel() {  
            if (!isOwner) return;  
              
            document.getElementById('ownerPanel').style.display = 'block';  
            document.getElementById('overlay').style.display = 'block';  
              
            // TÃ¼m Ã¶zel mesajlarÄ± yÃ¼kle  
            loadAllPrivateMessages();  
        }  
          
        function closeOwnerPanel() {  
            document.getElementById('ownerPanel').style.display = 'none';  
            document.getElementById('overlay').style.display = 'none';  
        }  
          
        function switchOwnerTab(tabName) {  
            // TÃ¼m tab'larÄ± gizle  
            document.querySelectorAll('.owner-tab-content').forEach(tab => {  
                tab.classList.remove('active');  
            });  
              
            document.querySelectorAll('.owner-tab').forEach(tab => {  
                tab.classList.remove('active');  
            });  
              
            // SeÃ§ili tab'Ä± gÃ¶ster  
            document.getElementById(tabName + 'Tab').classList.add('active');  
            document.querySelector(`.owner-tab[onclick*="${tabName}"]`).classList.add('active');  
        }  
          
        async function loadAllPrivateMessages() {  
            try {  
                const snapshot = await privateChatsRef.once('value');  
                const allMessages = snapshot.val() || {};  
                  
                const container = document.getElementById('allPrivateMessages');  
                container.innerHTML = '';  
                  
                Object.entries(allMessages).forEach(([chatId, messages]) => {  
                    if (messages && typeof messages === 'object') {  
                        Object.entries(messages).forEach(([messageId, message]) => {  
                            if (message && message.sender && message.text) {  
                                const messageDiv = document.createElement('div');  
                                messageDiv.style.padding = '10px';  
                                messageDiv.style.margin = '5px 0';  
                                messageDiv.style.background = 'rgba(0,0,0,0.1)';  
                                messageDiv.style.borderRadius = '5px';  
                                messageDiv.innerHTML = `  
                                    <strong>${message.sender}</strong> -> <strong>${message.receiver || 'Bilinmiyor'}</strong><br>  
                                    ${message.text}<br>  
                                    <small>${formatTime(message.timestamp)}</small>  
                                `;  
                                container.appendChild(messageDiv);  
                            }  
                        });  
                    }  
                });  
                  
            } catch (error) {  
                console.error('Ã–zel mesajlar yÃ¼klenirken hata:', error);  
            }  
        }  
          
        // ========== MATEB BOT PANELÄ° ==========  
        function openMatebBotPanel() {  
            document.getElementById('matebBotPanel').style.display = 'block';  
            document.getElementById('overlay').style.display = 'block';  
        }  
          
        function closeMatebBotPanel() {  
            document.getElementById('matebBotPanel').style.display = 'none';  
            document.getElementById('overlay').style.display = 'none';  
        }  
          
        // ========== RESÄ°M GÃ–NDERME SÄ°STEMÄ° ==========  
        function handleImageUpload(event) {  
            const file = event.target.files[0];  
            if (!file) return;  
              
            if (!file.type.startsWith('image/')) {  
                addSystemMessage('âŒ Sadece resim dosyalarÄ± yÃ¼kleyebilirsiniz!');  
                return;  
            }  
              
            if (file.size > 10 * 1024 * 1024) { // 10MB  
                addSystemMessage('âŒ Resim boyutu 10MB\'dan kÃ¼Ã§Ã¼k olmalÄ±!');  
                return;  
            }  
              
            const reader = new FileReader();  
            reader.onload = function(e) {  
                const imageUrl = e.target.result;  
                sendMessageWithImage(imageUrl);  
            };  
            reader.readAsDataURL(file);  
        }  
          
        function sendMessageWithImage(imageUrl) {  
            if (!currentUser) return;  
              
            const messageData = {  
                sender: currentUser.name,  
                text: '',  
                imageUrl: imageUrl,  
                type: currentUser.role,  
                timestamp: Date.now(),  
                time: new Date().toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' })  
            };  
              
            if (messagesRef) {  
                messagesRef.push(messageData);  
            }  
        }  
          
        function openImageModal(imageUrl) {  
            document.getElementById('modalImage').src = imageUrl;  
            document.getElementById('imageModal').style.display = 'flex';  
        }  
          
        function closeImageModal() {  
            document.getElementById('imageModal').style.display = 'none';  
            document.getElementById('modalImage').src = '';  
        }  
          
        // ========== MESAJ GÃ–NDERME ==========  
        function sendMessage() {  
            if (!currentUser) return;  
              
            const input = document.getElementById('message-input');  
            const text = input.value.trim();  
              
            if (!text) return;  
              
            if (text.startsWith('/')) {  
                handleCommand(text);  
                input.value = '';  
                autoResize(input);  
                return;  
            }  
              
            let messageType = 'user';  
            if (isOwner) messageType = 'owner';  
            else if (isAdmin) messageType = 'admin';  
            else if (isCoAdmin) messageType = 'coadmin';  
            else if (isOperator) messageType = 'operator';  
            else if (isPremium) messageType = 'premium';  
            else if (isSubscriber) messageType = 'subscriber';  
            else if (isMember) messageType = 'member';  
              
            const messageData = {  
                sender: currentUser.name,  
                text: text,  
                type: messageType,  
                timestamp: Date.now(),  
                time: new Date().toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' }),  
                channel: currentChannel  
            };  
              
            try {  
                if (messagesRef) {  
                    messagesRef.push(messageData);  
                }  
                  
                input.value = '';  
                autoResize(input);  
                  
                // KullanÄ±cÄ± istatistiklerini gÃ¼ncelle  
                updateUserStats(currentUser.name, 'messages');  
                  
            } catch (error) {  
                console.error('Mesaj gÃ¶nderme hatasÄ±:', error);  
                addSystemMessage('âŒ Mesaj gÃ¶nderilemedi!');  
            }  
        }  
          
        // ========== IRC KOMUTLARI ==========  
        function handleCommand(command) {  
            const parts = command.split(' ');  
            const cmd = parts[0].toLowerCase();  
            const args = parts.slice(1);  
              
            switch(cmd) {  
                case '/yardÄ±m':  
                    showHelp();  
                    break;  
                case '/online':  
                    showOnlineUsers();  
                    break;  
                case '/me':  
                    sendAction(args.join(' '));  
                    break;  
                case '/kick':  
                    if (isAdmin || isOwner || isCoAdmin) {  
                        kickUserCommand(args[0], args.slice(1).join(' '));  
                    } else {  
                        addSystemMessage('â›” Bu komutu kullanma yetkiniz yok!');  
                    }  
                    break;  
                case '/ban':  
                    if (isAdmin || isOwner) {  
                        banUserCommand(args[0], args.slice(1).join(' '));  
                    } else {  
                        addSystemMessage('â›” Bu komutu kullanma yetkiniz yok!');  
                    }  
                    break;  
                case '/unban':  
                    if (isAdmin || isOwner) {  
                        unbanUserCommand(args[0]);  
                    } else {  
                        addSystemMessage('â›” Bu komutu kullanma yetkiniz yok!');  
                    }  
                    break;  
                case '/clear':  
                    if (isAdmin || isOwner || isCoAdmin) {  
                        clearChat();  
                    } else {  
                        addSystemMessage('â›” Bu komutu kullanma yetkiniz yok!');  
                    }  
                    break;  
                case '/topic':  
                    if (isAdmin || isOwner || isCoAdmin) {  
                        changeTopic(args.join(' '));  
                    } else {  
                        addSystemMessage('â›” Bu komutu kullanma yetkiniz yok!');  
                    }  
                    break;  
                case '/mode':  
                    if (isAdmin || isOwner) {  
                        changeMode(args[0], args[1]);  
                    } else {  
                        addSystemMessage('â›” Bu komutu kullanma yetkiniz yok!');  
                    }  
                    break;  
                case '/msg':  
                    if (args.length >= 2) {  
                        openPrivateChat(args[0]);  
                        setTimeout(() => {  
                            document.getElementById('private-input').value = args.slice(1).join(' ');  
                            sendPrivateMessage();  
                        }, 100);  
                    }  
                    break;  
                case '/join':  
                    switchChannel(args[0] || '#genel');  
                    break;  
                case '/list':  
                    listChannels();  
                    break;  
                case '/whois':  
                    whoisUser(args[0]);  
                    break;  
                case '/nick':  
                    changeNick(args[0]);  
                    break;  
                case '/away':  
                    setAway(args.join(' '));  
                    break;  
                case '/back':  
                    setBack();  
                    break;  
                case '/ignore':  
                    ignoreUser(args[0]);  
                    break;  
                case '/unignore':  
                    unignoreUser(args[0]);  
                    break;  
                case '/rules':  
                    showRules();  
                    break;  
                case '/report':  
                    reportUser(args[0], args.slice(1).join(' '));  
                    break;  
                case '/abone':  
                    openSubscriptionModal();  
                    break;  
                case '/story':  
                    openStoryCreateModal();  
                    break;  
                case '/mystories':  
                    viewMyStories();  
                    break;  
                default:  
                    addSystemMessage(`âŒ Bilinmeyen komut: ${cmd}. /yardÄ±m yazÄ±n.`);  
            }  
        }  
          
        function showHelp() {  
            const helpMessage = `  
                ğŸ“‹ POPBOX CHAT KOMUTLARI:  
                
                ğŸ‘¤ GENEL KOMUTLAR:  
                /yardÄ±m - TÃ¼m komutlarÄ± gÃ¶ster  
                /online - Online kullanÄ±cÄ±larÄ± listele  
                /me <mesaj> - Aksiyon mesajÄ± gÃ¶nder  
                /msg <nick> <mesaj> - Ã–zel mesaj gÃ¶nder  
                /nick <yeni_nick> - Nick deÄŸiÅŸtir  
                /ignore <nick> - KullanÄ±cÄ±yÄ± engelle  
                
                ğŸ® CHAT KOMUTLARI:  
                /join <#kanal> - Kanala katÄ±l  
                /list - TÃ¼m kanallarÄ± listele  
                /topic <konu> - Kanal konusunu deÄŸiÅŸtir  
                /away <mesaj> - Uzakta olduÄŸunu belirt  
                /back - Geri dÃ¶ndÃ¼ÄŸÃ¼nÃ¼ belirt  
                
                ğŸ‘‘ YÃ–NETÄ°CÄ° KOMUTLARI:  
                /kick <nick> <sebep> - KullanÄ±cÄ±yÄ± at  
                /ban <nick> <sebep> - KullanÄ±cÄ±yÄ± banla  
                /unban <nick> - BanÄ± kaldÄ±r  
                /clear - Sohbeti temizle  
                /mode <kanal> <mod> - Kanal modunu deÄŸiÅŸtir  
                
                ğŸ“± Ã–ZEL KOMUTLAR:  
                /abone - Abonelik paketlerini gÃ¶ster  
                /story - Yeni story oluÅŸtur  
                /mystories - Story'lerimi gÃ¶rÃ¼ntÃ¼le  
                /report <nick> <sebep> - KullanÄ±cÄ±yÄ± ÅŸikayet et  
                
                ğŸ›¡ï¸ GÃœVENLÄ°K:  
                /rules - Sohbet kurallarÄ±nÄ± gÃ¶ster  
                /whois <nick> - KullanÄ±cÄ± bilgilerini gÃ¶ster  
            `;  
              
            addSystemMessage(helpMessage);  
        }  
          
        // ========== Ã‡IKIÅ ==========  
        function logout() {  
            if (currentUser && usersRef) {  
                usersRef.child(currentUser.name).remove();  
            }  
              
            bot.stopAll();  
              
            location.reload();  
        }  
          
        // ========== TEMA SÄ°STEMÄ° ==========  
        function toggleTheme() {  
            const body = document.body;  
            const themeBtn = document.querySelector('.theme-toggle');  
              
            if (body.classList.contains('youtube-live-mode')) {  
                body.classList.remove('youtube-live-mode');  
                body.classList.add('night-mode');  
                themeBtn.textContent = 'ğŸŒ™';  
                themeBtn.title = 'Gece modu';  
                localStorage.setItem('theme', 'night');  
            } else if (body.classList.contains('night-mode')) {  
                body.classList.remove('night-mode');  
                body.classList.add('light-mode');  
                themeBtn.textContent = 'â˜€ï¸';  
                themeBtn.title = 'GÃ¼ndÃ¼z modu';  
                localStorage.setItem('theme', 'light');  
            } else {  
                body.classList.remove('light-mode');  
                body.classList.add('youtube-live-mode');  
                themeBtn.textContent = 'ğŸ¬';  
                themeBtn.title = 'YouTube Live temasÄ±';  
                localStorage.setItem('theme', 'youtube');  
            }  
        }  
          
        function loadTheme() {  
            const savedTheme = localStorage.getItem('theme') || 'youtube';  
            const body = document.body;  
            const themeBtn = document.querySelector('.theme-toggle');  
              
            body.classList.remove('youtube-live-mode', 'night-mode', 'light-mode');  
              
            if (savedTheme === 'night') {  
                body.classList.add('night-mode');  
                themeBtn.textContent = 'ğŸŒ™';  
                themeBtn.title = 'Gece modu';  
            } else if (savedTheme === 'light') {  
                body.classList.add('light-mode');  
                themeBtn.textContent = 'â˜€ï¸';  
                themeBtn.title = 'GÃ¼ndÃ¼z modu';  
            } else {  
                body.classList.add('youtube-live-mode');  
                themeBtn.textContent = 'ğŸ¬';  
                themeBtn.title = 'YouTube Live temasÄ±';  
            }  
        }  
          
        // ========== UTILITY FONKSÄ°YONLAR ==========  
        function capitalizeFirstLetter(string) {  
            return string.charAt(0).toUpperCase() + string.slice(1);  
        }  
          
        function formatTime(timestamp) {  
            const date = new Date(timestamp);  
            return date.toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' });  
        }  
          
        function getUserColor(username) {  
            if (username === SECURE_CONFIG.OWNER_CONFIG.username) return '#ff4081';  
            if (adminList.includes(username)) return '#ff0000';  
            if (coAdminList.includes(username)) return '#ff9800';  
            if (operatorList.includes(username)) return '#3b82f6';  
            return '#4caf50';  
        }  
          
        function addSystemMessage(text) {  
            const container = document.getElementById('messages');  
            const messageDiv = document.createElement('div');  
            messageDiv.className = 'yt-message system';  
            messageDiv.innerHTML = `  
                <div class="message-content">${text}</div>  
            `;  
              
            container.appendChild(messageDiv);  
            container.scrollTop = container.scrollHeight;  
        }  
          
        // ========== SAYFA YÃœKLENDÄ°ÄÄ°NDE ==========  
        window.addEventListener('load', function() {  
            console.log("ğŸ“± Popbox Chat yÃ¼klendi!");  
              
            originalTitle = document.title;  
            loadTheme();  
              
            checkFirebaseConnection();  
            initializeFirebase();  
              
            document.getElementById('login-nick').focus();  
              
            // Enter tuÅŸu ile giriÅŸ  
            document.getElementById('login-nick').addEventListener('keypress', function(e) {  
                if (e.key === 'Enter') login();  
            });  
              
            document.getElementById('login-password').addEventListener('keypress', function(e) {  
                if (e.key === 'Enter') login();  
            });  
              
            // Enter tuÅŸu ile mesaj gÃ¶nderme  
            document.getElementById('message-input').addEventListener('keypress', function(e) {  
                if (e.key === 'Enter' && !e.shiftKey) {  
                    e.preventDefault();  
                    sendMessage();  
                }  
            });  
              
            // Enter tuÅŸu ile Ã¶zel mesaj gÃ¶nderme  
            document.getElementById('private-input').addEventListener('keypress', function(e) {  
                if (e.key === 'Enter' && !e.shiftKey) {  
                    e.preventDefault();  
                    sendPrivateMessage();  
                }  
            });  
              
            // Overlay click  
            document.getElementById('overlay').addEventListener('click', function(e) {  
                if (e.target === this) {  
                    closeAllModals();  
                }  
            });  
              
            // YouTube Player  
            function onYouTubeIframeAPIReady() {  
                console.log("ğŸ¬ YouTube API hazÄ±r!");  
                initYouTubePlayer();  
            }  
            window.onYouTubeIframeAPIReady = onYouTubeIframeAPIReady;  
              
            // Firebase badge durumu  
            const badgeHidden = localStorage.getItem('firebaseBadgeHidden') === 'true';  
            if (badgeHidden) {  
                document.getElementById('firebaseBadge').classList.add('hidden');  
            }  
        });  
          
        function closeAllModals() {  
            document.getElementById('overlay').style.display = 'none';  
            document.querySelectorAll('.subscription-modal, .owner-panel, .private-modal, .channel-create-modal, .story-modal, .mateb-bot-panel, .image-modal').forEach(modal => {  
                modal.style.display = 'none';  
            });  
        }  
          
        // YouTube Player  
        function initYouTubePlayer() {  
            if (typeof YT === 'undefined' || typeof YT.Player === 'undefined') {  
                setTimeout(initYouTubePlayer, 100);  
                return;  
            }  
              
            player = new YT.Player('youtube-player', {  
                height: '100%',  
                width: '100%',  
                videoId: 'dQw4w9WgXcQ', // Ã–rnek video  
                playerVars: {  
                    autoplay: 1,  
                    controls: 1,  
                    modestbranding: 1,  
                    rel: 0,  
                    showinfo: 0  
                },  
                events: {  
                    'onReady': onPlayerReady,  
                    'onStateChange': onPlayerStateChange  
                }  
            });  
        }  
          
        function onPlayerReady(event) {  
            console.log("âœ… YouTube Player hazÄ±r!");  
        }  
          
        function onPlayerStateChange(event) {  
            // Player state deÄŸiÅŸiklikleri  
        }  
    </script>  
      
    <!-- YouTube IFrame API -->  
    <script src="https://www.youtube.com/iframe_api"></script>  
</body>  
</html>
