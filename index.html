<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EliteChat - Profesyonel IRC Platformu</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* === TEMEL STÄ°LLER === */
        :root {
            --bg-primary: #0a0a0a; --bg-secondary: #111111; --bg-tertiary: #1a1a1a;
            --text-primary: #ffffff; --text-secondary: #b0b0b0; --accent-blue: #3b82f6;
            --accent-green: #10b981; --accent-red: #ef4444; --border-light: #222222;
            --accent-purple: #8b5cf6; --accent-yellow: #f59e0b;
        }
        body.day-mode {
            --bg-primary: #f8fafc; --bg-secondary: #ffffff; --bg-tertiary: #f1f5f9;
            --text-primary: #0f172a; --text-secondary: #475569; --border-light: #e2e8f0;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body, html { height: 100%; width: 100%; overflow: hidden; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: var(--bg-primary); color: var(--text-primary);
            display: flex; flex-direction: column;
        }
        body::before {
            content: ''; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-image: 
                radial-gradient(circle at 25px 25px, rgba(255, 255, 255, 0.05) 2%, transparent 2.5%),
                radial-gradient(circle at 75px 75px, rgba(255, 255, 255, 0.05) 2%, transparent 2.5%);
            background-size: 100px 100px; pointer-events: none; z-index: -1;
        }
        body.day-mode::before {
            background-image: 
                radial-gradient(circle at 25px 25px, rgba(0, 0, 0, 0.03) 2%, transparent 2.5%),
                radial-gradient(circle at 75px 75px, rgba(0, 0, 0, 0.03) 2%, transparent 2.5%);
        }
        
        /* === GÄ°RÄ°Åž EKRANI === */
        .login-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.95); display: flex; align-items: center;
            justify-content: center; z-index: 1000;
        }
        .login-container {
            background: var(--bg-secondary); padding: 40px; border-radius: 12px;
            width: 420px; max-width: 90%; border: 1px solid var(--border-light);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }
        .login-input {
            width: 100%; padding: 14px; margin: 12px 0; background: var(--bg-tertiary);
            border: 1px solid var(--border-light); color: var(--text-primary);
            border-radius: 8px; font-size: 15px;
        }
        .login-btn {
            width: 100%; padding: 14px; background: var(--accent-blue); color: white;
            border: none; border-radius: 8px; cursor: pointer; font-size: 15px;
            font-weight: 600; margin-top: 15px; transition: background 0.2s;
        }
        .login-btn:hover { background: #2563eb; }
        
        /* === ANA UYGULAMA === */
        .app-container { display: flex; flex-direction: column; height: 100vh; width: 100vw; overflow: hidden; }
        
        /* ÃœST BAR */
        .top-bar {
            display: flex; height: 70px; min-height: 70px; background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-light); padding: 0 25px;
            align-items: center; justify-content: space-between; flex-shrink: 0;
        }
        .channel-tabs { display: flex; gap: 8px; overflow-x: auto; max-width: 600px; padding: 5px 0; flex: 1; margin: 0 20px; }
        .channel-tab {
            padding: 10px 18px; background: var(--bg-tertiary); border-radius: 8px;
            cursor: pointer; white-space: nowrap; font-size: 14px; transition: all 0.2s;
            border: 1px solid var(--border-light);
        }
        .channel-tab:hover { background: var(--bg-primary); }
        .channel-tab.active { background: var(--accent-blue); color: white; border-color: var(--accent-blue); }
        
        /* ANA Ä°Ã‡ERÄ°K */
        .main-content { display: flex; flex: 1; overflow: hidden; min-height: 0; }
        
        /* SOL PANEL - Online Listesi & Ã–zel Sohbetler */
        .left-panel {
            width: 320px; min-width: 320px; background: var(--bg-secondary);
            border-right: 1px solid var(--border-light); display: flex;
            flex-direction: column; flex-shrink: 0;
        }
        .panel-tabs {
            display: flex; border-bottom: 1px solid var(--border-light);
        }
        .panel-tab {
            flex: 1; padding: 15px; text-align: center; cursor: pointer;
            background: var(--bg-tertiary); border: none; color: var(--text-primary);
            font-weight: 500; transition: all 0.2s;
        }
        .panel-tab.active {
            background: var(--bg-secondary); border-bottom: 2px solid var(--accent-blue);
        }
        .panel-content {
            flex: 1; overflow-y: auto; display: flex; flex-direction: column;
        }
        .panel-section {
            padding: 20px; border-bottom: 1px solid var(--border-light);
        }
        .panel-section h3 {
            font-size: 14px; color: var(--text-secondary); margin-bottom: 15px;
            text-transform: uppercase; letter-spacing: 0.5px;
        }
        
        /* KullanÄ±cÄ± Listesi */
        .user-list { flex: 1; padding: 10px; }
        .user-item {
            padding: 12px; border-radius: 8px; cursor: pointer; display: flex;
            align-items: center; gap: 12px; margin-bottom: 8px; transition: all 0.2s;
            border: 1px solid transparent;
        }
        .user-item:hover {
            background: var(--bg-tertiary); border-color: var(--border-light);
        }
        .user-item.active {
            background: var(--accent-blue); color: white; border-color: var(--accent-blue);
        }
        .user-item.active .user-status { color: rgba(255,255,255,0.8); }
        .user-avatar {
            width: 40px; height: 40px; border-radius: 50%; 
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            display: flex; align-items: center; justify-content: center; color: white;
            font-weight: bold; font-size: 16px; flex-shrink: 0; position: relative;
        }
        .user-avatar.online::after {
            content: ''; position: absolute; bottom: 0; right: 0;
            width: 10px; height: 10px; background: var(--accent-green);
            border-radius: 50%; border: 2px solid var(--bg-secondary);
        }
        .user-info { flex: 1; min-width: 0; }
        .user-name { 
            font-weight: 600; font-size: 14px; margin-bottom: 2px;
            display: flex; align-items: center; gap: 6px;
        }
        .user-status { font-size: 12px; color: var(--text-secondary); }
        
        /* Ã–zel Sohbet Listesi */
        .pm-list { padding: 10px; }
        .pm-item {
            padding: 12px; border-radius: 8px; cursor: pointer; display: flex;
            align-items: center; gap: 12px; margin-bottom: 8px; transition: all 0.2s;
            border: 1px solid var(--border-light); background: var(--bg-tertiary);
        }
        .pm-item:hover { background: var(--bg-primary); }
        .pm-item.unread { border-color: var(--accent-blue); background: rgba(59, 130, 246, 0.1); }
        .pm-avatar {
            width: 36px; height: 36px; border-radius: 50%; 
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-blue));
            display: flex; align-items: center; justify-content: center; color: white;
            font-weight: bold; font-size: 14px; flex-shrink: 0;
        }
        .pm-info { flex: 1; min-width: 0; }
        .pm-name { font-weight: 600; font-size: 13px; margin-bottom: 2px; }
        .pm-preview { 
            font-size: 12px; color: var(--text-secondary);
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }
        .pm-time {
            font-size: 10px; color: var(--text-secondary); margin-left: 8px;
        }
        
        /* ORTA PANEL - Sohbet */
        .chat-panel { flex: 1; display: flex; flex-direction: column; min-width: 0; }
        .chat-header {
            padding: 0 25px; height: 70px; border-bottom: 1px solid var(--border-light);
            display: flex; align-items: center; justify-content: space-between;
            background: var(--bg-secondary); flex-shrink: 0;
        }
        .chat-header-info { flex: 1; }
        .chat-header-actions { display: flex; gap: 10px; }
        .chat-messages { 
            flex: 1; overflow-y: auto; padding: 20px; background: var(--bg-primary);
            display: flex; flex-direction: column;
        }
        .message { 
            margin-bottom: 15px; max-width: 75%; animation: fadeIn 0.3s ease;
            display: flex; flex-direction: column;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .message-outgoing { 
            margin-left: auto; align-items: flex-end;
        }
        .message-incoming { align-items: flex-start; }
        .message-sender { 
            font-size: 12px; color: var(--text-secondary); margin-bottom: 4px;
            display: flex; align-items: center; gap: 8px;
        }
        .message-text {
            background: var(--bg-tertiary); padding: 12px 16px; border-radius: 12px;
            font-size: 14px; line-height: 1.5; word-break: break-word;
            max-width: 100%;
        }
        .message-outgoing .message-text { 
            background: var(--accent-blue); color: white; 
            border-bottom-right-radius: 4px;
        }
        .message-incoming .message-text { border-bottom-left-radius: 4px; }
        .message-time {
            font-size: 10px; color: var(--text-secondary); margin-top: 4px;
            opacity: 0.7;
        }
        .message-media {
            margin-top: 8px; border-radius: 8px; overflow: hidden;
            max-width: 300px; cursor: pointer;
        }
        .message-media img, .message-media video {
            width: 100%; height: auto; display: block;
        }
        .chat-input-area {
            padding: 20px; border-top: 1px solid var(--border-light); 
            background: var(--bg-secondary); flex-shrink: 0;
        }
        .message-input-container {
            display: flex; gap: 10px; align-items: flex-end;
        }
        .message-input {
            flex: 1; padding: 14px; background: var(--bg-tertiary); 
            border: 1px solid var(--border-light); color: var(--text-primary);
            border-radius: 10px; resize: none; font-size: 14px; line-height: 1.5;
            min-height: 60px; max-height: 150px; font-family: inherit;
        }
        .message-input:focus { outline: none; border-color: var(--accent-blue); }
        .input-actions {
            display: flex; justify-content: space-between; margin-top: 12px;
        }
        
        /* SAÄž PANEL - Video */
        .right-panel {
            width: 400px; min-width: 400px; background: #000; 
            display: flex; flex-direction: column; flex-shrink: 0;
            border-left: 1px solid #333;
        }
        .video-header { 
            padding: 15px; background: rgba(0, 0, 0, 0.9); color: white; 
            border-bottom: 1px solid #333; flex-shrink: 0;
            display: flex; justify-content: space-between; align-items: center;
        }
        .video-container { 
            flex: 1; background: #000; position: relative; min-height: 0;
            display: flex; align-items: center; justify-content: center;
        }
        .youtube-video { 
            width: 100%; height: 100%; border: none; display: block;
        }
        .video-controls { 
            padding: 15px; background: rgba(0, 0, 0, 0.9); 
            border-top: 1px solid #333; flex-shrink: 0;
        }
        .video-info {
            display: flex; justify-content: space-between; align-items: center;
            font-size: 13px; color: rgba(255,255,255,0.7);
        }
        
        /* BUTONLAR */
        .btn {
            padding: 8px 16px; border-radius: 6px; border: none; 
            cursor: pointer; font-size: 13px; font-weight: 500; 
            transition: all 0.2s; display: inline-flex; align-items: center; gap: 6px;
        }
        .btn-sm { padding: 6px 12px; font-size: 12px; }
        .btn-primary { background: var(--accent-blue); color: white; }
        .btn-primary:hover { background: #2563eb; }
        .btn-secondary { 
            background: var(--bg-tertiary); color: var(--text-primary); 
            border: 1px solid var(--border-light);
        }
        .btn-secondary:hover { background: var(--bg-primary); }
        .btn-success { background: var(--accent-green); color: white; }
        .btn-success:hover { background: #059669; }
        .btn-danger { background: var(--accent-red); color: white; }
        .btn-danger:hover { background: #dc2626; }
        .btn-warning { background: var(--accent-yellow); color: white; }
        .btn-warning:hover { background: #d97706; }
        
        /* MODALLAR */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.8); display: none; align-items: center;
            justify-content: center; z-index: 2000; backdrop-filter: blur(5px);
        }
        .modal-content {
            background: var(--bg-secondary); padding: 24px; border-radius: 12px;
            max-width: 500px; width: 90%; max-height: 90vh; overflow-y: auto;
            border: 1px solid var(--border-light); box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
        }
        
        /* KAMERA MODALI */
        .camera-modal {
            max-width: 800px;
        }
        .camera-preview-container {
            width: 100%; height: 400px; background: #000; border-radius: 8px;
            overflow: hidden; margin-bottom: 15px; position: relative;
        }
        .camera-preview {
            width: 100%; height: 100%; object-fit: cover;
        }
        .camera-controls {
            display: flex; justify-content: center; gap: 15px; margin-top: 15px;
        }
        .camera-btn {
            padding: 10px 20px; border-radius: 50px; border: none;
            background: var(--accent-blue); color: white; cursor: pointer;
            font-weight: 500; display: flex; align-items: center; gap: 8px;
        }
        .camera-btn.danger { background: var(--accent-red); }
        .camera-btn.warning { background: var(--accent-yellow); }
        
        /* UTILITIES */
        .hidden { display: none !important; }
        .text-sm { font-size: 13px; }
        .text-muted { color: var(--text-secondary); }
        .flex { display: flex; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .gap-2 { gap: 8px; }
        .gap-3 { gap: 12px; }
        .w-full { width: 100%; }
        
        /* SCROLLBAR */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg-tertiary); border-radius: 3px; }
        ::-webkit-scrollbar-thumb { background: var(--border-light); border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #444; }
        
        /* ROL BADGELERÄ° */
        .role-badge {
            font-size: 10px; padding: 1px 6px; border-radius: 10px; 
            margin-left: 4px; font-weight: 600;
        }
        .role-owner { background: linear-gradient(135deg, var(--accent-purple), #3b82f6); color: white; }
        .role-admin { background: var(--accent-blue); color: white; }
        .role-coadmin { background: var(--accent-yellow); color: white; }
        .role-operator { background: var(--accent-green); color: white; }
        .role-voice { background: var(--accent-purple); color: white; opacity: 0.9; }
        
        /* RESPONSIVE */
        @media (max-width: 1200px) {
            .right-panel { width: 350px; min-width: 350px; }
            .left-panel { width: 280px; min-width: 280px; }
        }
        @media (max-width: 992px) {
            .right-panel { display: none; }
            .left-panel { width: 250px; min-width: 250px; }
        }
        @media (max-width: 768px) {
            .left-panel { display: none; }
            .channel-tabs { max-width: 300px; }
            .top-bar { padding: 0 15px; }
        }
        @media (max-width: 480px) {
            .channel-tabs { max-width: 200px; }
            .chat-header { padding: 0 15px; }
            .chat-messages { padding: 15px; }
            .chat-input-area { padding: 15px; }
        }
        
        /* Ã–ZEL SOHBET PENCERESÄ° */
        .pm-window {
            position: fixed; bottom: 0; right: 400px; width: calc(100% - 400px - 320px);
            height: 80vh; background: var(--bg-secondary); border-radius: 12px 12px 0 0;
            border: 1px solid var(--border-light); border-bottom: none;
            box-shadow: 0 -10px 30px rgba(0,0,0,0.3); display: flex; flex-direction: column;
            z-index: 100; transition: transform 0.3s ease;
        }
        @media (max-width: 992px) {
            .pm-window { right: 0; width: 100%; }
        }
        .pm-window.minimized { transform: translateY(calc(100% - 50px)); }
        .pm-window-header {
            padding: 15px; border-bottom: 1px solid var(--border-light); 
            background: var(--bg-tertiary); display: flex; justify-content: space-between;
            align-items: center; cursor: pointer;
        }
        .pm-window-messages {
            flex: 1; overflow-y: auto; padding: 20px; background: var(--bg-primary);
        }
        .pm-window-input {
            padding: 15px; border-top: 1px solid var(--border-light); 
            background: var(--bg-secondary);
        }
        
        /* PM MESAJ MEDYA */
        .pm-media-container {
            margin-top: 8px; border-radius: 8px; overflow: hidden;
            max-width: 250px; cursor: pointer; position: relative;
        }
        .pm-media-container img, .pm-media-container video {
            width: 100%; height: auto; display: block;
        }
        .pm-media-info {
            position: absolute; bottom: 0; left: 0; right: 0;
            background: rgba(0, 0, 0, 0.7); color: white;
            padding: 5px 10px; font-size: 11px;
        }
        
        /* LOADING */
        .loading { 
            display: inline-block; width: 20px; height: 20px;
            border: 2px solid var(--border-light); border-top-color: var(--accent-blue);
            border-radius: 50%; animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="night-mode">
    <!-- GÄ°RÄ°Åž EKRANI -->
    <div id="loginScreen" class="login-screen">
        <div class="login-container">
            <div style="text-align: center; margin-bottom: 30px;">
                <div style="width: 80px; height: 80px; background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple)); border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; color: white; font-size: 32px; font-weight: bold; margin-bottom: 15px;">EC</div>
                <h1 style="font-size: 28px; margin-bottom: 8px;">EliteChat</h1>
                <p class="text-muted">Profesyonel IRC Platformu</p>
            </div>
            
            <input type="text" id="nickInput" class="login-input" placeholder="KullanÄ±cÄ± adÄ±" autofocus>
            <input type="password" id="passInput" class="login-input" placeholder="Åžifre (isteÄŸe baÄŸlÄ±)">
            
            <button class="login-btn" id="loginButton">
                <i class="fas fa-sign-in-alt"></i> GiriÅŸ Yap
            </button>
            
            <div style="margin-top: 25px; padding-top: 20px; border-top: 1px solid var(--border-light);">
                <p class="text-sm text-muted" style="text-align: center;">
                    <strong>Ä°lk GiriÅŸ:</strong><br>
                    Nickinizi ve ÅŸifrenizi belirleyin<br>
                    Åžifre opsiyonel - ÅŸifresiz giriÅŸ misafir olur
                </p>
            </div>
        </div>
    </div>

    <!-- ANA UYGULAMA -->
    <div id="app" class="hidden">
        <div class="app-container">
            <!-- ÃœST BAR -->
            <div class="top-bar">
                <div class="flex items-center gap-3">
                    <div style="width: 36px; height: 36px; background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple)); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">EC</div>
                    <span style="font-size: 18px; font-weight: 600;">EliteChat</span>
                </div>

                <!-- KANAL SEKMELERÄ° -->
                <div class="channel-tabs" id="channelTabs">
                    <div class="channel-tab active" data-channel="general">
                        <i class="fas fa-hashtag"></i> Genel
                    </div>
                </div>

                <div class="flex items-center gap-2">
                    <button id="createChannelBtn" class="btn btn-success btn-sm">
                        <i class="fas fa-plus"></i> Kanal AÃ§
                    </button>
                    <button id="settingsBtn" class="btn btn-secondary btn-sm">
                        <i class="fas fa-cog"></i>
                    </button>
                    <button id="themeBtn" class="btn btn-secondary btn-sm">
                        <i class="fas fa-moon"></i>
                    </button>
                </div>
            </div>

            <!-- ANA Ä°Ã‡ERÄ°K -->
            <div class="main-content">
                <!-- SOL PANEL -->
                <div class="left-panel">
                    <div class="panel-tabs">
                        <button class="panel-tab active" data-panel="online">
                            <i class="fas fa-users"></i> Online
                        </button>
                        <button class="panel-tab" data-panel="pm">
                            <i class="fas fa-comments"></i> Ã–zel
                        </button>
                    </div>
                    
                    <!-- ONLINE LÄ°STESÄ° -->
                    <div class="panel-content" id="onlinePanel">
                        <div class="panel-section">
                            <h3>Ã‡evrimiÃ§i KullanÄ±cÄ±lar <span id="onlineCount">(0)</span></h3>
                            <div class="user-list" id="userList">
                                <!-- KullanÄ±cÄ±lar buraya gelecek -->
                            </div>
                        </div>
                        
                        <div class="panel-section">
                            <h3>Kanal Bilgisi</h3>
                            <div style="font-size: 13px;">
                                <div style="margin-bottom: 8px;">
                                    <strong>Kanal:</strong> <span id="panelChannelName">#Genel</span>
                                </div>
                                <div style="margin-bottom: 8px;">
                                    <strong>Konu:</strong> <span id="panelChannelTopic">EliteChat HoÅŸ Geldiniz</span>
                                </div>
                                <div>
                                    <strong>Video:</strong> <span id="panelChannelVideo">Lofi Hip Hop Radio ðŸ“š</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Ã–ZEL MESAJ LÄ°STESÄ° -->
                    <div class="panel-content hidden" id="pmPanel">
                        <div class="panel-section">
                            <h3>Ã–zel Sohbetler</h3>
                            <div class="pm-list" id="pmConversationList">
                                <!-- Ã–zel sohbetler buraya gelecek -->
                            </div>
                        </div>
                        
                        <div class="panel-section">
                            <button id="newPmBtn" class="btn btn-primary w-full">
                                <i class="fas fa-plus"></i> Yeni Ã–zel Sohbet
                            </button>
                        </div>
                    </div>
                </div>

                <!-- ORTA PANEL - SOHBET -->
                <div class="chat-panel">
                    <div class="chat-header">
                        <div class="chat-header-info">
                            <h2 style="font-size: 18px; margin-bottom: 4px;">
                                <i class="fas fa-hashtag"></i> <span id="currentChannel">Genel</span>
                            </h2>
                            <p class="text-muted" style="font-size: 14px;">
                                <span id="channelUsers">0</span> kullanÄ±cÄ± â€¢ 
                                <span id="channelTopic">EliteChat HoÅŸ Geldiniz</span>
                            </p>
                        </div>
                        <div class="chat-header-actions">
                            <button id="videoManagerBtn" class="btn btn-secondary btn-sm">
                                <i class="fas fa-video"></i> Video
                            </button>
                            <button id="channelInfoBtn" class="btn btn-secondary btn-sm">
                                <i class="fas fa-info-circle"></i>
                            </button>
                        </div>
                    </div>

                    <div class="chat-messages" id="chatMessages">
                        <div style="text-align: center; padding: 40px 20px; color: var(--text-secondary);">
                            <i class="fas fa-comments" style="font-size: 48px; margin-bottom: 15px; opacity: 0.5;"></i>
                            <h3 style="margin-bottom: 10px;">EliteChat'e HoÅŸ Geldiniz</h3>
                            <p>Mesaj yazmaya baÅŸlayÄ±n veya birine Ã¶zel mesaj gÃ¶nderin</p>
                        </div>
                    </div>

                    <div class="chat-input-area">
                        <div class="message-input-container">
                            <textarea class="message-input" id="messageInput" 
                                      placeholder="Mesaj yazÄ±n... (IRC komutlarÄ± iÃ§in / kullanÄ±n)" 
                                      rows="3"></textarea>
                        </div>
                        <div class="input-actions">
                            <div style="flex: 1;"></div>
                            <button id="sendBtn" class="btn btn-primary">
                                <i class="fas fa-paper-plane"></i> GÃ¶nder
                            </button>
                        </div>
                    </div>
                </div>

                <!-- SAÄž PANEL - VÄ°DEO -->
                <div class="right-panel">
                    <div class="video-header">
                        <div>
                            <h3 style="font-size: 16px; margin-bottom: 2px;">
                                <i class="fas fa-play-circle"></i> <span id="videoTitle">Lofi Hip Hop Radio ðŸ“š</span>
                            </h3>
                            <p style="font-size: 12px; color: rgba(255,255,255,0.7);">
                                <i class="fas fa-hashtag"></i> <span id="videoChannel">Genel</span>
                            </p>
                        </div>
                        <div class="flex gap-2">
                            <button id="changeVideoBtn" class="btn btn-sm" style="background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.2);">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button id="fullscreenBtn" class="btn btn-sm" style="background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.2);">
                                <i class="fas fa-expand"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="video-container">
                        <iframe class="youtube-video" id="youtubePlayer" 
                                src="https://www.youtube-nocookie.com/embed/jfKfPfyJRdk?autoplay=1&mute=1&rel=0&controls=1&modestbranding=1" 
                                frameborder="0" 
                                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                                allowfullscreen>
                        </iframe>
                    </div>
                    
                    <div class="video-controls">
                        <div class="video-info">
                            <div>
                                <i class="fas fa-eye"></i> <span id="viewerCount">1.2K</span> izleyici
                            </div>
                            <div>
                                <i class="fas fa-clock"></i> 24/7
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODALLAR -->
    <!-- Video DeÄŸiÅŸtirme Modal -->
    <div id="videoModal" class="modal-overlay">
        <div class="modal-content">
            <div class="flex items-center justify-between" style="margin-bottom: 20px;">
                <h3 style="font-size: 18px;">Video YÃ¶netimi</h3>
                <button id="closeVideoModal" style="background: none; border: none; color: var(--text-secondary); font-size: 24px; cursor: pointer;">Ã—</button>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px;">
                    YouTube URL veya Video ID
                </label>
                <input type="text" id="videoUrl" class="login-input" 
                       placeholder="Ã–rnek: https://youtube.com/watch?v=VIDEO_ID veya sadece VIDEO_ID">
            </div>
            
            <div style="margin-bottom: 25px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px;">
                    Video BaÅŸlÄ±ÄŸÄ±
                </label>
                <input type="text" id="videoTitleInput" class="login-input" 
                       placeholder="Video baÅŸlÄ±ÄŸÄ± (isteÄŸe baÄŸlÄ±)">
            </div>
            
            <div class="flex gap-2">
                <button id="cancelVideo" class="btn btn-secondary" style="flex: 1;">Ä°ptal</button>
                <button id="saveVideo" class="btn btn-primary" style="flex: 1;">
                    <i class="fas fa-save"></i> Kaydet
                </button>
            </div>
        </div>
    </div>

    <!-- Kanal OluÅŸturma Modal -->
    <div id="channelModal" class="modal-overlay">
        <div class="modal-content">
            <div class="flex items-center justify-between" style="margin-bottom: 20px;">
                <h3 style="font-size: 18px;">Yeni Kanal OluÅŸtur</h3>
                <button id="closeChannelModal" style="background: none; border: none; color: var(--text-secondary); font-size: 24px; cursor: pointer;">Ã—</button>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px;">Kanal AdÄ±</label>
                <input type="text" id="channelName" class="login-input" placeholder="#kanal_adi">
            </div>
            
            <div style="margin-bottom: 25px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px;">Kanal TÃ¼rÃ¼</label>
                <select id="channelType" class="login-input">
                    <option value="public">Public - Herkes katÄ±labilir</option>
                    <option value="private">Private - Sadece davetliler</option>
                    <option value="secret">Secret - Gizli kanal</option>
                </select>
            </div>
            
            <div style="margin-bottom: 25px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px;">Kanal Konusu</label>
                <input type="text" id="channelTopicInput" class="login-input" placeholder="Kanal konusu">
            </div>
            
            <div class="flex gap-2">
                <button id="cancelChannel" class="btn btn-secondary" style="flex: 1;">Ä°ptal</button>
                <button id="createChannel" class="btn btn-success" style="flex: 1;">
                    <i class="fas fa-plus"></i> OluÅŸtur
                </button>
            </div>
        </div>
    </div>

    <!-- Yeni Ã–zel Sohbet Modal -->
    <div id="newPmModal" class="modal-overlay">
        <div class="modal-content">
            <div class="flex items-center justify-between" style="margin-bottom: 20px;">
                <h3 style="font-size: 18px;">Yeni Ã–zel Sohbet</h3>
                <button id="closeNewPmModal" style="background: none; border: none; color: var(--text-secondary); font-size: 24px; cursor: pointer;">Ã—</button>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px;">KullanÄ±cÄ± AdÄ±</label>
                <input type="text" id="pmUserInput" class="login-input" placeholder="KullanÄ±cÄ± adÄ± yazÄ±n">
                <div id="pmUserSuggestions" style="margin-top: 10px; max-height: 200px; overflow-y: auto;"></div>
            </div>
            
            <div style="margin-bottom: 25px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px;">Ä°lk Mesaj</label>
                <textarea id="pmFirstMessage" class="login-input" placeholder="Ä°lk mesajÄ±nÄ±z..." rows="3"></textarea>
            </div>
            
            <div class="flex gap-2">
                <button id="cancelNewPm" class="btn btn-secondary" style="flex: 1;">Ä°ptal</button>
                <button id="startNewPm" class="btn btn-primary" style="flex: 1;">
                    <i class="fas fa-paper-plane"></i> BaÅŸlat
                </button>
            </div>
        </div>
    </div>

    <!-- Kanal Bilgisi Modal -->
    <div id="channelInfoModal" class="modal-overlay">
        <div class="modal-content">
            <div class="flex items-center justify-between" style="margin-bottom: 20px;">
                <h3 style="font-size: 18px;">Kanal Bilgisi</h3>
                <button id="closeChannelInfo" style="background: none; border: none; color: var(--text-secondary); font-size: 24px; cursor: pointer;">Ã—</button>
            </div>
            
            <div style="margin-bottom: 20px;">
                <div style="font-size: 14px; margin-bottom: 10px;">
                    <strong>Kanal:</strong> <span id="infoChannelName">#Genel</span>
                </div>
                <div style="font-size: 14px; margin-bottom: 10px;">
                    <strong>Konu:</strong> <span id="infoChannelTopic">EliteChat HoÅŸ Geldiniz</span>
                </div>
                <div style="font-size: 14px; margin-bottom: 10px;">
                    <strong>Sahibi:</strong> <span id="infoChannelOwner">System</span>
                </div>
                <div style="font-size: 14px; margin-bottom: 10px;">
                    <strong>TÃ¼r:</strong> <span id="infoChannelType">Public</span>
                </div>
                <div style="font-size: 14px; margin-bottom: 10px;">
                    <strong>Video:</strong> <span id="infoChannelVideo">Lofi Hip Hop Radio ðŸ“š</span>
                </div>
                <div style="font-size: 14px;">
                    <strong>KullanÄ±cÄ±lar:</strong> <span id="infoChannelUsers">0</span>
                </div>
            </div>
            
            <div id="channelInfoActions" class="flex gap-2">
                <!-- Yetkili butonlarÄ± buraya dinamik eklenecek -->
            </div>
        </div>
    </div>

    <!-- Ayarlar Modal -->
    <div id="settingsModal" class="modal-overlay">
        <div class="modal-content">
            <div class="flex items-center justify-between" style="margin-bottom: 20px;">
                <h3 style="font-size: 18px;">Ayarlar</h3>
                <button id="closeSettings" style="background: none; border: none; color: var(--text-secondary); font-size: 24px; cursor: pointer;">Ã—</button>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px;">KullanÄ±cÄ± AdÄ±</label>
                <input type="text" id="settingsNick" class="login-input" value="">
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px;">Avatar</label>
                <div style="display: flex; align-items: center; gap: 15px;">
                    <div id="settingsAvatar" style="width: 60px; height: 60px; border-radius: 50%; background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple)); display: flex; align-items: center; justify-content: center; color: white; font-size: 24px; font-weight: bold; cursor: pointer;"></div>
                    <button id="changeAvatarBtn" class="btn btn-secondary">
                        <i class="fas fa-edit"></i> DeÄŸiÅŸtir
                    </button>
                </div>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px;">Biyografi</label>
                <textarea id="settingsBio" class="login-input" placeholder="Kendinizden bahsedin..." rows="3"></textarea>
            </div>
            
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 25px; padding: 15px; background: var(--bg-tertiary); border-radius: 8px;">
                <div>
                    <div style="font-weight: 500; font-size: 14px;">GÃ¶rÃ¼nmez Mod</div>
                    <div class="text-sm text-muted">Ã‡evrimiÃ§i gÃ¶rÃ¼nmez olun</div>
                </div>
                <label style="position: relative; display: inline-block; width: 50px; height: 26px;">
                    <input type="checkbox" id="settingsInvisible" style="opacity: 0; width: 0; height: 0;">
                    <span style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background: var(--bg-primary); border-radius: 34px; transition: .4s;"></span>
                    <span style="position: absolute; content: ''; height: 18px; width: 18px; left: 4px; bottom: 4px; background: white; border-radius: 50%; transition: .4s;"></span>
                </label>
            </div>
            
            <div class="flex gap-2">
                <button id="cancelSettings" class="btn btn-secondary" style="flex: 1;">Ä°ptal</button>
                <button id="saveSettings" class="btn btn-primary" style="flex: 1;">
                    <i class="fas fa-save"></i> Kaydet
                </button>
            </div>
        </div>
    </div>

    <!-- KAMERA MODALI -->
    <div id="cameraModal" class="modal-overlay">
        <div class="modal-content camera-modal">
            <div class="flex items-center justify-between" style="margin-bottom: 20px;">
                <h3 style="font-size: 18px;">Kamera</h3>
                <button id="closeCameraModal" style="background: none; border: none; color: var(--text-secondary); font-size: 24px; cursor: pointer;">Ã—</button>
            </div>
            
            <div class="camera-preview-container">
                <video id="cameraPreview" class="camera-preview" autoplay playsinline></video>
                <canvas id="cameraCanvas" style="display: none;"></canvas>
            </div>
            
            <div class="camera-controls">
                <button id="switchCameraBtn" class="camera-btn warning">
                    <i class="fas fa-sync-alt"></i> Kamera DeÄŸiÅŸtir
                </button>
                <button id="captureImageBtn" class="camera-btn">
                    <i class="fas fa-camera"></i> FotoÄŸraf Ã‡ek
                </button>
                <button id="recordVideoBtn" class="camera-btn danger">
                    <i class="fas fa-video"></i> Video Kaydet
                </button>
                <button id="stopRecordingBtn" class="camera-btn danger" style="display: none;">
                    <i class="fas fa-stop"></i> Durdur
                </button>
            </div>
            
            <div id="cameraPreviewArea" style="margin-top: 20px; display: none;">
                <!-- Ã–nizleme buraya gelecek -->
            </div>
            
            <div class="flex gap-2" style="margin-top: 20px;">
                <button id="cancelCamera" class="btn btn-secondary" style="flex: 1;">Ä°ptal</button>
                <button id="sendCameraMedia" class="btn btn-primary" style="flex: 1;" disabled>
                    <i class="fas fa-paper-plane"></i> GÃ¶nder
                </button>
            </div>
        </div>
    </div>

    <!-- DOSYA YÃœKLEME MODAL -->
    <div id="uploadModal" class="modal-overlay">
        <div class="modal-content">
            <div class="flex items-center justify-between" style="margin-bottom: 20px;">
                <h3 style="font-size: 18px;" id="uploadTitle">Dosya GÃ¶nder</h3>
                <button id="closeUploadModal" style="background: none; border: none; color: var(--text-secondary); font-size: 24px; cursor: pointer;">Ã—</button>
            </div>
            
            <div style="text-align: center; margin-bottom: 25px;">
                <div id="uploadDropZone" style="border: 2px dashed var(--border-light); border-radius: 12px; padding: 40px 20px; cursor: pointer; transition: all 0.2s;">
                    <i class="fas fa-cloud-upload-alt" style="font-size: 48px; color: var(--text-secondary); margin-bottom: 15px;"></i>
                    <div style="font-size: 16px; margin-bottom: 8px;">DosyayÄ± buraya sÃ¼rÃ¼kleyin</div>
                    <div class="text-sm text-muted">veya tÄ±klayarak seÃ§in</div>
                    <div class="text-sm text-muted" style="margin-top: 10px;">Max: 10MB</div>
                </div>
                <input type="file" id="fileInput" style="display: none;" accept="image/*,video/*,.mp4,.avi,.mov">
            </div>
            
            <div id="uploadPreview" style="display: none; margin-bottom: 20px;">
                <!-- Ã–nizleme buraya gelecek -->
            </div>
            
            <div id="uploadProgress" style="display: none; margin-bottom: 20px;">
                <div style="background: var(--bg-tertiary); height: 6px; border-radius: 3px; overflow: hidden;">
                    <div id="uploadProgressBar" style="background: var(--accent-blue); height: 100%; width: 0%; transition: width 0.3s;"></div>
                </div>
                <div style="text-align: center; margin-top: 8px; font-size: 12px; color: var(--text-secondary);">
                    <span id="uploadProgressText">%0</span>
                </div>
            </div>
            
            <div class="flex gap-2">
                <button id="cancelUpload" class="btn btn-secondary" style="flex: 1;">Ä°ptal</button>
                <button id="sendUpload" class="btn btn-primary" style="flex: 1;" disabled>
                    <i class="fas fa-paper-plane"></i> GÃ¶nder
                </button>
            </div>
        </div>
    </div>

    <!-- Ã–ZEL SOHBET PENCERESÄ° (Dinamik oluÅŸturulacak) -->

    <script>
        // ==================== GÃœVENLÄ°K FONKSÄ°YONLARI ====================
        function escapeHtml(text) {
            if (!text) return '';
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;',
                '`': '&#x60;',
                '=': '&#x3D;'
            };
            return String(text).replace(/[&<>"'`=]/g, m => map[m]);
        }

        function hashPassword(password) {
            if (!password) return '';
            let hash = 0;
            for (let i = 0; i < password.length; i++) {
                const char = password.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            return 'hashed_' + Math.abs(hash).toString(36);
        }

        function clearContainer(containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;
            while (container.firstChild) {
                container.removeChild(container.firstChild);
            }
        }

        // ==================== SÄ°STEM DEÄžÄ°ÅžKENLERÄ° ====================
        const SYSTEM = {
            currentUser: null,
            currentChannel: 'general',
            activePM: null,
            pmWindows: {},
            uploadType: null,
            theme: 'night',
            messageCounter: 1,
            intervals: [],
            cameraStream: null,
            mediaRecorder: null,
            recordedChunks: [],
            isRecording: false,
            facingMode: 'user'
        };

        const DATA = {
            users: {},
            channels: {
                general: {
                    id: 'general',
                    name: '#Genel',
                    owner: 'mate',
                    type: 'public',
                    topic: 'EliteChat HoÅŸ Geldiniz',
                    users: new Set(),
                    operators: new Set(),
                    voices: new Set(),
                    bans: new Map(),
                    mutes: new Map(),
                    slowmode: 0,
                    locked: false,
                    userLimit: 0,
                    messages: [],
                    video: { 
                        id: 'jfKfPfyJRdk', 
                        title: 'Lofi Hip Hop Radio ðŸ“š',
                        channel: 'Genel'
                    }
                }
            },
            privateMessages: new Map(),
            registeredUsers: new Map(),
            onlineUsers: new Set(),
            userChannels: new Map(),
            globalBans: new Set(),
            globalMutes: new Set()
        };

        // ==================== GERÃ‡EK ZAMANLI SUNUCU SÄ°STEMÄ° ====================
        class EliteChatServer {
            constructor() {
                this.users = new Map();
                this.channels = new Map();
                this.initializeChannels();
                this.setupLocalStorageSync();
                console.log('âœ… GerÃ§ek zamanlÄ± sunucu baÅŸlatÄ±ldÄ±');
            }
            
            initializeChannels() {
                const generalChannel = {
                    id: 'general',
                    name: '#Genel',
                    owner: 'mate',
                    type: 'public',
                    topic: 'EliteChat HoÅŸ Geldiniz',
                    users: ['mate'],
                    operators: ['mate'],
                    voices: [],
                    bans: {},
                    mutes: {},
                    messages: [],
                    video: {
                        id: 'jfKfPfyJRdk',
                        title: 'Lofi Hip Hop Radio ðŸ“š'
                    }
                };
                
                this.channels.set('general', generalChannel);
                this.saveChannelsToStorage();
                
                // Mate botu ekle
                this.users.set('mate', {
                    id: 'mate',
                    name: 'ðŸ¤–Mate',
                    role: 'owner',
                    registered: true,
                    online: true,
                    invisible: false,
                    avatar: 'M',
                    bio: 'GÃ¼venlik Botu',
                    joinDate: new Date().toISOString(),
                    lastSeen: new Date().toISOString()
                });
                this.saveUsersToStorage();
            }
            
            setupLocalStorageSync() {
                setInterval(() => {
                    this.syncUsers();
                    this.syncMessages();
                    this.syncChannels();
                }, 1000);
            }
            
            syncUsers() {
                try {
                    const serverUsers = JSON.parse(localStorage.getItem('elitechat_server_users') || '[]');
                    serverUsers.forEach(user => {
                        if (!this.users.has(user.id)) {
                            this.users.set(user.id, user);
                        }
                    });
                    
                    const userArray = Array.from(this.users.values());
                    localStorage.setItem('elitechat_server_users', JSON.stringify(userArray));
                } catch (e) {
                    console.error('KullanÄ±cÄ± senkronizasyon hatasÄ±:', e);
                }
            }
            
            syncMessages() {
                try {
                    const allMessages = JSON.parse(localStorage.getItem('elitechat_server_messages') || '[]');
                    
                    allMessages.forEach(msg => {
                        const channel = this.channels.get(msg.channel);
                        if (channel) {
                            const exists = channel.messages.some(m => m.id === msg.id);
                            if (!exists) {
                                channel.messages.push(msg);
                                if (channel.messages.length > 100) {
                                    channel.messages = channel.messages.slice(-100);
                                }
                            }
                        }
                    });
                    
                    this.saveChannelsToStorage();
                } catch (e) {
                    console.error('Mesaj senkronizasyon hatasÄ±:', e);
                }
            }
            
            syncChannels() {
                try {
                    const serverChannels = JSON.parse(localStorage.getItem('elitechat_server_channels') || '[]');
                    
                    serverChannels.forEach(ch => {
                        if (!this.channels.has(ch.id)) {
                            this.channels.set(ch.id, ch);
                        }
                    });
                } catch (e) {
                    console.error('Kanal senkronizasyon hatasÄ±:', e);
                }
            }
            
            registerUser(userData) {
                console.log('Yeni kullanÄ±cÄ± kaydediliyor:', userData.name);
                
                this.users.set(userData.id, userData);
                
                const generalChannel = this.channels.get('general');
                if (generalChannel) {
                    if (!generalChannel.users.includes(userData.id)) {
                        generalChannel.users.push(userData.id);
                        this.saveChannelsToStorage();
                    }
                }
                
                this.broadcastToAll({
                    type: 'user_joined',
                    user: userData,
                    timestamp: Date.now()
                });
                
                this.saveUsersToStorage();
                
                return userData;
            }
            
            sendMessage(messageData) {
                const channel = this.channels.get(messageData.channel);
                if (!channel) return null;
                
                const message = {
                    id: `msg_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
                    type: 'message',
                    userId: messageData.userId,
                    text: messageData.text,
                    time: Date.now(),
                    channel: messageData.channel
                };
                
                channel.messages.push(message);
                this.saveChannelsToStorage();
                
                this.saveMessageToStorage(message);
                
                this.broadcastToAll({
                    type: 'new_message',
                    message: message,
                    channel: messageData.channel
                });
                
                return message;
            }
            
            sendPrivateMessage(pmData) {
                const message = {
                    id: `pm_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
                    type: 'pm',
                    from: pmData.from,
                    to: pmData.to,
                    text: pmData.text,
                    time: Date.now(),
                    read: false
                };
                
                this.savePrivateMessageToStorage(message);
                
                this.sendToUser(pmData.to, {
                    type: 'private_message',
                    message: message
                });
                
                return message;
            }
            
            createChannel(channelData) {
                const channelId = channelData.name.substring(1).toLowerCase().replace(/[^a-z0-9]/g, '_');
                
                if (this.channels.has(channelId)) {
                    return null;
                }
                
                const newChannel = {
                    id: channelId,
                    name: channelData.name,
                    owner: channelData.owner,
                    type: channelData.type || 'public',
                    topic: channelData.topic || 'Yeni sohbet kanalÄ±',
                    users: [channelData.owner, 'mate'],
                    operators: [],
                    voices: [],
                    bans: {},
                    mutes: {},
                    messages: [],
                    video: {
                        id: 'jfKfPfyJRdk',
                        title: 'Lofi Hip Hop Radio ðŸ“š'
                    }
                };
                
                this.channels.set(channelId, newChannel);
                this.saveChannelsToStorage();
                
                this.broadcastToAll({
                    type: 'channel_created',
                    channel: newChannel
                });
                
                return newChannel;
            }
            
            broadcastToAll(data) {
                const broadcastEvents = JSON.parse(localStorage.getItem('elitechat_broadcast') || '[]');
                broadcastEvents.push({
                    ...data,
                    _timestamp: Date.now()
                });
                
                if (broadcastEvents.length > 50) {
                    broadcastEvents.splice(0, broadcastEvents.length - 50);
                }
                
                localStorage.setItem('elitechat_broadcast', JSON.stringify(broadcastEvents));
                
                window.dispatchEvent(new CustomEvent('elitechat_broadcast', { detail: data }));
            }
            
            sendToUser(userId, data) {
                const userEvents = JSON.parse(localStorage.getItem(`elitechat_user_${userId}`) || '[]');
                userEvents.push({
                    ...data,
                    _timestamp: Date.now()
                });
                
                if (userEvents.length > 20) {
                    userEvents.splice(0, userEvents.length - 20);
                }
                
                localStorage.setItem(`elitechat_user_${userId}`, JSON.stringify(userEvents));
                
                window.dispatchEvent(new CustomEvent(`elitechat_user_${userId}`, { detail: data }));
            }
            
            saveMessageToStorage(message) {
                const allMessages = JSON.parse(localStorage.getItem('elitechat_server_messages') || '[]');
                allMessages.push(message);
                
                if (allMessages.length > 500) {
                    allMessages.splice(0, allMessages.length - 500);
                }
                
                localStorage.setItem('elitechat_server_messages', JSON.stringify(allMessages));
            }
            
            savePrivateMessageToStorage(message) {
                const pmKey = [message.from, message.to].sort().join('_');
                const allPMs = JSON.parse(localStorage.getItem('elitechat_server_pms') || '{}');
                
                if (!allPMs[pmKey]) {
                    allPMs[pmKey] = [];
                }
                
                allPMs[pmKey].push(message);
                
                if (allPMs[pmKey].length > 200) {
                    allPMs[pmKey].splice(0, allPMs[pmKey].length - 200);
                }
                
                localStorage.setItem('elitechat_server_pms', JSON.stringify(allPMs));
            }
            
            saveUsersToStorage() {
                const userArray = Array.from(this.users.values());
                localStorage.setItem('elitechat_server_users', JSON.stringify(userArray));
            }
            
            saveChannelsToStorage() {
                const channelArray = Array.from(this.channels.values());
                localStorage.setItem('elitechat_server_channels', JSON.stringify(channelArray));
            }
            
            disconnectUser(userId) {
                this.users.delete(userId);
                
                this.channels.forEach(channel => {
                    if (channel.users) {
                        const index = channel.users.indexOf(userId);
                        if (index > -1) {
                            channel.users.splice(index, 1);
                        }
                    }
                });
                
                this.saveChannelsToStorage();
                this.saveUsersToStorage();
                
                this.broadcastToAll({
                    type: 'user_left',
                    userId: userId,
                    timestamp: Date.now()
                });
            }
        }

        // ==================== Ä°STEMCÄ° (CLIENT) SÄ°STEMÄ° ====================
        class EliteChatClient {
            constructor() {
                this.userId = null;
                this.isConnected = false;
                this.eventListeners = new Map();
                this.server = window.eliteChatServer;
                this.setupEventListeners();
                this.startSync();
            }
            
            connect(userData) {
                if (!this.server) return false;
                
                this.userId = userData.id;
                this.isConnected = true;
                
                this.server.registerUser(userData);
                
                console.log(`âœ… BaÄŸlantÄ± kuruldu: ${userData.name}`);
                
                this.emit('connected', { user: userData });
                
                return true;
            }
            
            sendMessage(channelId, text) {
                if (!this.isConnected || !this.userId) return null;
                
                const messageData = {
                    userId: this.userId,
                    text: text,
                    channel: channelId
                };
                
                return this.server.sendMessage(messageData);
            }
            
            sendPrivateMessage(toUserId, text) {
                if (!this.isConnected || !this.userId) return null;
                
                const pmData = {
                    from: this.userId,
                    to: toUserId,
                    text: text
                };
                
                return this.server.sendPrivateMessage(pmData);
            }
            
            createChannel(channelData) {
                if (!this.isConnected) return null;
                
                return this.server.createChannel(channelData);
            }
            
            on(event, callback) {
                if (!this.eventListeners.has(event)) {
                    this.eventListeners.set(event, []);
                }
                this.eventListeners.get(event).push(callback);
            }
            
            emit(event, data) {
                const listeners = this.eventListeners.get(event);
                if (listeners) {
                    listeners.forEach(callback => {
                        try {
                            callback(data);
                        } catch (err) {
                            console.error(`Event callback error (${event}):`, err);
                        }
                    });
                }
            }
            
            setupEventListeners() {
                window.addEventListener('elitechat_broadcast', (e) => {
                    const data = e.detail;
                    this.handleServerEvent(data);
                });
                
                const checkUserEvents = () => {
                    if (this.userId) {
                        const userEvents = JSON.parse(localStorage.getItem(`elitechat_user_${this.userId}`) || '[]');
                        
                        userEvents.forEach(event => {
                            if (event._timestamp > (this.lastEventTime || 0)) {
                                this.handleServerEvent(event);
                                this.lastEventTime = event._timestamp;
                            }
                        });
                    }
                };
                
                setInterval(checkUserEvents, 1000);
            }
            
            handleServerEvent(data) {
                switch (data.type) {
                    case 'new_message':
                        this.emit('new_message', data);
                        break;
                        
                    case 'private_message':
                        this.emit('private_message', data);
                        break;
                        
                    case 'user_joined':
                        this.emit('user_joined', data);
                        break;
                        
                    case 'user_left':
                        this.emit('user_left', data);
                        break;
                        
                    case 'channel_created':
                        this.emit('channel_created', data);
                        break;
                }
            }
            
            startSync() {
                setInterval(() => {
                    if (this.isConnected) {
                        this.syncWithServer();
                    }
                }, 2000);
            }
            
            syncWithServer() {
                this.emit('sync_users', {
                    users: Array.from(this.server?.users?.values() || [])
                });
                
                this.emit('sync_channels', {
                    channels: Array.from(this.server?.channels?.values() || [])
                });
            }
            
            disconnect() {
                if (this.userId && this.server) {
                    this.server.disconnectUser(this.userId);
                }
                
                this.isConnected = false;
                this.userId = null;
                
                this.emit('disconnected', {});
            }
        }

        // ==================== MATE BOT SÄ°STEMÄ° ====================
        class MateBot {
            constructor() {
                this.id = 'mate';
                this.name = 'ðŸ¤–Mate';
                this.role = 'owner';
                this.registered = true;
                this.online = true;
                this.invisible = false;
                this.avatar = 'M';
                this.bio = 'GÃ¼venlik Botu - Sadece gÃ¼venlik ve owner mesajlarÄ±nÄ± iletirim';
                this.joinDate = new Date();
                this.lastSeen = new Date();
                
                DATA.users[this.id] = this;
                DATA.onlineUsers.add(this.id);
                DATA.registeredUsers.set(this.id, {
                    password: hashPassword('mate123'),
                    role: 'owner',
                    bio: this.bio,
                    joinDate: this.joinDate
                });
                
                Object.values(DATA.channels).forEach(channel => {
                    channel.users.add(this.id);
                });
            }
            
            sendSecurityAlert(message, channelId = 'general') {
                const channel = DATA.channels[channelId];
                if (!channel) return;
                
                const alertMessage = {
                    id: 'alert_' + Date.now(),
                    type: 'security',
                    userId: this.id,
                    text: `ðŸ”’ **GÃœVENLÄ°K**: ${message}`,
                    time: new Date(),
                    channel: channelId
                };
                
                channel.messages.push(alertMessage);
                
                if (SYSTEM.currentChannel === channelId) {
                    this.displayMessage(alertMessage);
                }
            }
            
            displayMessage(message) {
                const container = document.getElementById('chatMessages');
                if (!container) return;
                
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message';
                messageDiv.dataset.messageId = message.id;
                
                messageDiv.innerHTML = `
                    <div class="message-sender">
                        <span style="font-weight: 500; color: var(--accent-red);">${this.name}</span>
                        ${getRoleBadge(this.role)}
                    </div>
                    <div class="message-text" style="background: rgba(239, 68, 68, 0.1); border-left: 3px solid var(--accent-red);">
                        ${escapeHtml(message.text)}
                    </div>
                    <div class="message-time">${formatTime(message.time)}</div>
                `;
                
                container.appendChild(messageDiv);
                container.scrollTop = container.scrollHeight;
            }
        }

        const mateBot = new MateBot();

        // ==================== UTILITY FONKSÄ°YONLARI ====================
        function generateMessageId() {
            return Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        function formatTime(date = new Date()) {
            return date.toLocaleTimeString('tr-TR', { 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: false
            });
        }

        function getRoleBadge(role) {
            const badges = {
                'owner': '<span class="role-badge role-owner">O</span>',
                'admin': '<span class="role-badge role-admin">A</span>',
                'coadmin': '<span class="role-badge role-coadmin">C</span>',
                'operator': '<span class="role-badge role-operator">OP</span>',
                'voice': '<span class="role-badge role-voice">V</span>'
            };
            return badges[role] || '';
        }

        function showNotification(title, message, type = 'info') {
            console.log(`[${type.toUpperCase()}] ${title}: ${message}`);
            
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification(title, { body: message });
            }
        }

        function hasVideoPermission(channelId) {
            const channel = DATA.channels[channelId];
            if (!channel) return false;
            
            const user = SYSTEM.currentUser;
            if (!user) return false;
            
            if (user.role === 'owner') return true;
            if (user.role === 'admin') return true;
            if (user.role === 'coadmin' && channel.owner === user.id) return true;
            if (channel.owner === user.id) return true;
            
            return false;
        }

        // ==================== GÄ°RÄ°Åž SÄ°STEMÄ° ====================
        function handleLogin() {
            const nickInput = document.getElementById('nickInput');
            const passInput = document.getElementById('passInput');
            const nick = nickInput.value.trim();
            const pass = passInput.value;
            
            const cleanNick = nick.replace(/[^a-zA-Z0-9._]/g, '');
            
            if (!cleanNick || cleanNick.length < 2) {
                alert('KullanÄ±cÄ± adÄ± en az 2 karakter olmalÄ±dÄ±r (sadece harf, rakam, . ve _)');
                nickInput.value = '';
                nickInput.focus();
                return;
            }
            
            const userId = cleanNick.toLowerCase();
            
            if (userId === 'mate') {
                alert('Bu kullanÄ±cÄ± adÄ± sistem tarafÄ±ndan kullanÄ±lÄ±yor!');
                nickInput.value = '';
                nickInput.focus();
                return;
            }
            
            const userData = {
                id: userId,
                name: cleanNick,
                role: 'user',
                registered: !!pass,
                online: true,
                invisible: false,
                avatar: cleanNick.charAt(0).toUpperCase(),
                bio: '',
                joinDate: new Date().toISOString(),
                lastSeen: new Date().toISOString()
            };
            
            const client = window.eliteChatClient;
            const connected = client.connect(userData);
            
            if (!connected) {
                alert('Sunucuya baÄŸlanÄ±lamadÄ±!');
                return;
            }
            
            SYSTEM.currentUser = userData;
            DATA.users[userId] = userData;
            DATA.onlineUsers.add(userId);
            
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('app').classList.remove('hidden');
            
            addSystemMessage(`ðŸŽ‰ ${SYSTEM.currentUser.name} sohbete katÄ±ldÄ±!`);
            
            updateOnlineList();
            updatePanelInfo();
            loadChannelMessages('general');
            
            startAutoUpdates();
            
            nickInput.value = '';
            passInput.value = '';
        }

        // ==================== ONLINE LÄ°STE SÄ°STEMÄ° ====================
        function updateOnlineList() {
            const container = document.getElementById('userList');
            const countElement = document.getElementById('onlineCount');
            
            if (!container) return;
            
            clearContainer('userList');
            
            const channel = DATA.channels[SYSTEM.currentChannel];
            if (!channel) return;
            
            const channelUsers = Array.from(channel.users)
                .map(userId => DATA.users[userId])
                .filter(user => user && !user.invisible)
                .sort((a, b) => {
                    const roleOrder = { owner: 1, admin: 2, coadmin: 3, operator: 4, voice: 5, user: 6 };
                    const roleDiff = roleOrder[a.role] - roleOrder[b.role];
                    if (roleDiff !== 0) return roleDiff;
                    return a.name.localeCompare(b.name);
                });
            
            const onlineCount = channelUsers.filter(u => u.online).length;
            if (countElement) {
                countElement.textContent = `(${onlineCount})`;
            }
            
            const channelUsersElement = document.getElementById('channelUsers');
            if (channelUsersElement) {
                channelUsersElement.textContent = channelUsers.length;
            }
            
            if (channelUsers.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 30px 20px; color: var(--text-secondary);">
                        <i class="fas fa-user-slash" style="font-size: 32px; margin-bottom: 10px; opacity: 0.5;"></i>
                        <div style="font-size: 13px;">HenÃ¼z kullanÄ±cÄ± yok</div>
                    </div>
                `;
                return;
            }
            
            channelUsers.forEach(user => {
                const item = document.createElement('div');
                item.className = `user-item ${user.online ? 'online' : ''}`;
                if (SYSTEM.activePM === user.id) {
                    item.classList.add('active');
                }
                
                const displayName = user.id === 'mate' ? 'ðŸ¤–Mate' : user.name;
                
                item.innerHTML = `
                    <div class="user-avatar ${user.online ? 'online' : ''}">
                        ${user.avatar}
                    </div>
                    <div class="user-info">
                        <div class="user-name">
                            ${escapeHtml(displayName)}
                            ${getRoleBadge(user.role)}
                        </div>
                        <div class="user-status">
                            ${user.online ? 'ðŸŸ¢ Ã‡evrimiÃ§i' : 'âš« Ã‡evrimdÄ±ÅŸÄ±'}
                        </div>
                    </div>
                `;
                
                item.addEventListener('click', () => {
                    if (user.id !== SYSTEM.currentUser.id) {
                        openPrivateChat(user.id);
                    }
                });
                
                container.appendChild(item);
            });
            
            updatePMConversationList();
        }

        // ==================== SOHBET SÄ°STEMÄ° ====================
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const text = input.value.trim();
            
            if (!text) return;
            
            if (text.startsWith('/')) {
                handleIRCCommand(text);
                input.value = '';
                return;
            }
            
            if (SYSTEM.activePM) {
                sendPrivateMessage(SYSTEM.activePM, text);
            } else {
                sendChannelMessage(text);
            }
            
            input.value = '';
            input.focus();
        }

        function sendChannelMessage(text) {
            const channel = DATA.channels[SYSTEM.currentChannel];
            if (!channel) return;
            
            if (DATA.globalMutes.has(SYSTEM.currentUser.id)) {
                addSystemMessage('âš ï¸ Global susturulmuÅŸsunuz! Mesaj gÃ¶nderemezsiniz.');
                return;
            }
            
            if (channel.mutes.has(SYSTEM.currentUser.id)) {
                const muteEnd = channel.mutes.get(SYSTEM.currentUser.id);
                if (new Date() < muteEnd) {
                    addSystemMessage('âš ï¸ Bu kanalda susturulmuÅŸsunuz! Mesaj gÃ¶nderemezsiniz.');
                    return;
                }
                channel.mutes.delete(SYSTEM.currentUser.id);
            }
            
            if (channel.slowmode > 0) {
                const lastMessage = channel.messages
                    .filter(m => m.userId === SYSTEM.currentUser.id)
                    .pop();
                if (lastMessage) {
                    const timeDiff = (new Date() - new Date(lastMessage.time)) / 1000;
                    if (timeDiff < channel.slowmode) {
                        addSystemMessage(`â±ï¸ YavaÅŸ mod aktif! ${Math.ceil(channel.slowmode - timeDiff)} saniye bekleyin.`);
                        return;
                    }
                }
            }
            
            const client = window.eliteChatClient;
            const serverMessage = client.sendMessage(SYSTEM.currentChannel, text);
            
            if (serverMessage) {
                const localMessage = {
                    id: serverMessage.id,
                    type: 'message',
                    userId: SYSTEM.currentUser.id,
                    text: text,
                    time: new Date(serverMessage.time),
                    channel: SYSTEM.currentChannel
                };
                
                channel.messages.push(localMessage);
                addMessageToChat(localMessage, SYSTEM.currentUser);
            }
        }

        function sendPrivateMessage(toUserId, text) {
            if (!DATA.users[toUserId]) {
                addSystemMessage('âŒ KullanÄ±cÄ± bulunamadÄ±!');
                return;
            }
            
            const client = window.eliteChatClient;
            const serverPM = client.sendPrivateMessage(toUserId, text);
            
            if (serverPM) {
                const pmKey = [SYSTEM.currentUser.id, toUserId].sort().join('_');
                
                if (!DATA.privateMessages.has(pmKey)) {
                    DATA.privateMessages.set(pmKey, []);
                }
                
                const messages = DATA.privateMessages.get(pmKey);
                const localMessage = {
                    id: serverPM.id,
                    type: 'pm',
                    from: SYSTEM.currentUser.id,
                    to: toUserId,
                    text: text,
                    time: new Date(serverPM.time),
                    read: false
                };
                
                messages.push(localMessage);
                
                if (SYSTEM.pmWindows[toUserId]) {
                    addMessageToPMWindow(toUserId, localMessage);
                }
                
                updatePMConversationList();
                
                showNotification(DATA.users[toUserId].name, text, 'pm');
            }
        }

        function addMessageToChat(message, user) {
            const container = document.getElementById('chatMessages');
            if (!container) return;
            
            if (container.children.length === 1 && 
                container.children[0].querySelector('.fas.fa-comments')) {
                clearContainer('chatMessages');
            }
            
            const isOutgoing = user.id === SYSTEM.currentUser.id;
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isOutgoing ? 'message-outgoing' : 'message-incoming'}`;
            messageDiv.dataset.messageId = message.id;
            
            const displayName = user.id === 'mate' ? 'ðŸ¤–Mate' : user.name;
            
            messageDiv.innerHTML = `
                <div class="message-sender">
                    <span style="font-weight: 500;">${escapeHtml(displayName)}</span>
                    ${getRoleBadge(user.role)}
                    ${user.registered ? '<i class="fas fa-check-circle" style="color: var(--accent-blue); font-size: 10px;"></i>' : ''}
                </div>
                <div class="message-text">${escapeHtml(message.text)}</div>
                <div class="message-time">${formatTime(message.time)}</div>
            `;
            
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }

        function addSystemMessage(text) {
            const container = document.getElementById('chatMessages');
            if (!container) return;
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message';
            messageDiv.style.textAlign = 'center';
            messageDiv.style.maxWidth = '100%';
            
            messageDiv.innerHTML = `
                <div style="display: inline-block; background: var(--bg-tertiary); padding: 8px 16px; border-radius: 16px; color: var(--text-secondary); font-style: italic; font-size: 13px;">
                    ${escapeHtml(text)}
                </div>
            `;
            
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }

        function loadChannelMessages(channelId) {
            const container = document.getElementById('chatMessages');
            if (!container) return;
            
            clearContainer('chatMessages');
            
            const channel = DATA.channels[channelId];
            if (!channel || !channel.messages || channel.messages.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px; color: var(--text-secondary);">
                        <i class="fas fa-comments" style="font-size: 48px; margin-bottom: 15px; opacity: 0.5;"></i>
                        <h3 style="margin-bottom: 10px;">${channel.name.replace('#', '')} KanalÄ±</h3>
                        <p>Bu kanalda henÃ¼z mesaj yok. Ä°lk mesajÄ± siz gÃ¶nderin!</p>
                    </div>
                `;
                return;
            }
            
            channel.messages.forEach(msg => {
                const user = DATA.users[msg.userId];
                if (user) {
                    addMessageToChat(msg, user);
                }
            });
            
            container.scrollTop = container.scrollHeight;
        }

        // ==================== KANAL SÄ°STEMÄ° ====================
        function switchChannel(channelId) {
            if (!DATA.channels[channelId]) return;
            
            SYSTEM.currentChannel = channelId;
            SYSTEM.activePM = null;
            
            document.querySelectorAll('.channel-tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.dataset.channel === channelId) {
                    tab.classList.add('active');
                }
            });
            
            const channel = DATA.channels[channelId];
            document.getElementById('currentChannel').textContent = channel.name.replace('#', '');
            document.getElementById('channelTopic').textContent = channel.topic;
            document.getElementById('panelChannelName').textContent = channel.name;
            document.getElementById('panelChannelTopic').textContent = channel.topic;
            document.getElementById('panelChannelVideo').textContent = channel.video.title;
            document.getElementById('videoChannel').textContent = channel.name.replace('#', '');
            
            const videoBtn = document.getElementById('videoManagerBtn');
            const changeVideoBtn = document.getElementById('changeVideoBtn');
            
            if (hasVideoPermission(channelId)) {
                videoBtn.classList.remove('hidden');
                changeVideoBtn.classList.remove('hidden');
            } else {
                videoBtn.classList.add('hidden');
                changeVideoBtn.classList.add('hidden');
            }
            
            loadChannelMessages(channelId);
            updateOnlineList();
            loadChannelVideo();
            
            Object.keys(SYSTEM.pmWindows).forEach(userId => {
                closePMWindow(userId);
            });
        }

        function createNewChannel() {
            const nameInput = document.getElementById('channelName');
            const typeSelect = document.getElementById('channelType');
            const topicInput = document.getElementById('channelTopicInput');
            
            const name = nameInput.value.trim();
            const type = typeSelect.value;
            const topic = topicInput.value.trim() || 'Yeni sohbet kanalÄ±';
            
            if (!name || !name.startsWith('#')) {
                alert('Kanal adÄ± # ile baÅŸlamalÄ±!');
                return;
            }
            
            const channelId = name.substring(1).toLowerCase().replace(/[^a-z0-9]/g, '_');
            
            if (DATA.channels[channelId]) {
                alert('Bu kanal adÄ± zaten kullanÄ±lÄ±yor!');
                return;
            }
            
            if (DATA.userChannels.has(SYSTEM.currentUser.id)) {
                alert('Zaten bir kanalÄ±nÄ±z var! Her kullanÄ±cÄ± sadece 1 kanal aÃ§abilir.');
                return;
            }
            
            const client = window.eliteChatClient;
            const channelData = {
                name: name,
                owner: SYSTEM.currentUser.id,
                type: type,
                topic: topic
            };
            
            const newChannel = client.createChannel(channelData);
            
            if (newChannel) {
                DATA.channels[channelId] = {
                    id: channelId,
                    name: name,
                    owner: SYSTEM.currentUser.id,
                    type: type,
                    topic: topic,
                    users: new Set([SYSTEM.currentUser.id, 'mate']),
                    operators: new Set(),
                    voices: new Set(),
                    bans: new Map(),
                    mutes: new Map(),
                    slowmode: 0,
                    locked: false,
                    userLimit: 0,
                    messages: [],
                    video: {
                        id: 'jfKfPfyJRdk',
                        title: 'Lofi Hip Hop Radio ðŸ“š',
                        channel: name.replace('#', '')
                    }
                };
                
                DATA.userChannels.set(SYSTEM.currentUser.id, channelId);
                
                const tabsContainer = document.getElementById('channelTabs');
                const tab = document.createElement('div');
                tab.className = 'channel-tab';
                tab.dataset.channel = channelId;
                tab.innerHTML = `<i class="fas fa-hashtag"></i> ${name.substring(1)}`;
                tab.addEventListener('click', () => switchChannel(channelId));
                tabsContainer.appendChild(tab);
                
                switchChannel(channelId);
                closeModal('channelModal');
                
                nameInput.value = '';
                topicInput.value = '';
                
                addSystemMessage(`ðŸŽŠ ${SYSTEM.currentUser.name} yeni kanal oluÅŸturdu: ${name}`);
            }
        }

        // ==================== EVENT LISTENERS ====================
        document.addEventListener('DOMContentLoaded', function() {
            // Sunucuyu baÅŸlat
            if (!window.eliteChatServer) {
                window.eliteChatServer = new EliteChatServer();
            }
            
            // Client'i baÅŸlat
            window.eliteChatClient = new EliteChatClient();
            
            // Mevcut event listener'lar
            document.getElementById('loginButton').addEventListener('click', handleLogin);
            
            document.getElementById('nickInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') handleLogin();
            });
            document.getElementById('passInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') handleLogin();
            });
            
            document.getElementById('sendBtn').addEventListener('click', sendMessage);
            document.getElementById('messageInput').addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
            
            document.querySelectorAll('.panel-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    switchPanel(tab.dataset.panel);
                });
            });
            
            const buttonEvents = {
                'createChannelBtn': () => openModal('channelModal'),
                'settingsBtn': openSettings,
                'themeBtn': toggleTheme,
                'videoManagerBtn': changeChannelVideo,
                'changeVideoBtn': changeChannelVideo,
                'fullscreenBtn': () => {
                    const player = document.getElementById('youtubePlayer');
                    if (player.requestFullscreen) {
                        player.requestFullscreen();
                    }
                },
                'channelInfoBtn': () => {
                    const channel = DATA.channels[SYSTEM.currentChannel];
                    if (!channel) return;
                    
                    document.getElementById('infoChannelName').textContent = channel.name;
                    document.getElementById('infoChannelTopic').textContent = channel.topic;
                    document.getElementById('infoChannelOwner').textContent = 
                        DATA.users[channel.owner]?.name || channel.owner;
                    document.getElementById('infoChannelType').textContent = 
                        channel.type === 'public' ? 'Public' : 
                        channel.type === 'private' ? 'Private' : 'Secret';
                    document.getElementById('infoChannelVideo').textContent = channel.video.title;
                    document.getElementById('infoChannelUsers').textContent = channel.users.size;
                    
                    openModal('channelInfoModal');
                },
                'newPmBtn': () => openModal('newPmModal'),
                
                'closeVideoModal': () => closeModal('videoModal'),
                'cancelVideo': () => closeModal('videoModal'),
                'saveVideo': saveChannelVideo,
                'closeChannelModal': () => closeModal('channelModal'),
                'cancelChannel': () => closeModal('channelModal'),
                'createChannel': createNewChannel,
                'closeChannelInfo': () => closeModal('channelInfoModal'),
                'closeSettings': () => closeModal('settingsModal'),
                'cancelSettings': () => closeModal('settingsModal'),
                'saveSettings': saveSettings,
                'changeAvatarBtn': changeAvatar,
                'closeNewPmModal': () => closeModal('newPmModal'),
                'cancelNewPm': () => closeModal('newPmModal'),
                'startNewPm': () => {
                    const userInput = document.getElementById('pmUserInput');
                    const messageInput = document.getElementById('pmFirstMessage');
                    
                    const targetUser = userInput.value.trim().toLowerCase();
                    const message = messageInput.value.trim();
                    
                    if (!targetUser) {
                        alert('KullanÄ±cÄ± adÄ± gerekli!');
                        return;
                    }
                    
                    if (!DATA.users[targetUser]) {
                        alert('KullanÄ±cÄ± bulunamadÄ±!');
                        return;
                    }
                    
                    if (targetUser === SYSTEM.currentUser.id) {
                        alert('Kendinize mesaj gÃ¶nderemezsiniz!');
                        return;
                    }
                    
                    closeModal('newPmModal');
                    openPrivateChat(targetUser);
                    
                    if (message) {
                        sendPrivateMessage(targetUser, message);
                    }
                    
                    userInput.value = '';
                    messageInput.value = '';
                },
                
                'closeUploadModal': () => closeModal('uploadModal'),
                'cancelUpload': () => closeModal('uploadModal'),
                'sendUpload': uploadFile
            };
            
            Object.keys(buttonEvents).forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('click', buttonEvents[id]);
                }
            });
            
            const pmUserInput = document.getElementById('pmUserInput');
            if (pmUserInput) {
                pmUserInput.addEventListener('input', function() {
                    const query = this.value.trim().toLowerCase();
                    const suggestions = document.getElementById('pmUserSuggestions');
                    
                    if (!query) {
                        suggestions.innerHTML = '';
                        return;
                    }
                    
                    const matches = Object.values(DATA.users)
                        .filter(user => 
                            user.id !== SYSTEM.currentUser.id && 
                            user.id.includes(query) &&
                            user.id !== 'mate')
                        .slice(0, 5);
                    
                    suggestions.innerHTML = '';
                    
                    if (matches.length === 0) {
                        suggestions.innerHTML = '<div style="padding: 10px; text-align: center; color: var(--text-secondary); font-size: 13px;">KullanÄ±cÄ± bulunamadÄ±</div>';
                        return;
                    }
                    
                    matches.forEach(user => {
                        const div = document.createElement('div');
                        div.style.padding = '8px';
                        div.style.cursor = 'pointer';
                        div.style.borderBottom = '1px solid var(--border-light)';
                        div.style.display = 'flex';
                        div.style.alignItems = 'center';
                        div.style.gap = '10px';
                        
                        div.innerHTML = `
                            <div style="width: 30px; height: 30px; border-radius: 50%; background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple)); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">${escapeHtml(user.avatar)}</div>
                            <div>
                                <div style="font-weight: 500;">${escapeHtml(user.name)}</div>
                                <div style="font-size: 11px; color: var(--text-secondary);">
                                    ${user.online ? 'ðŸŸ¢ Ã‡evrimiÃ§i' : 'âš« Ã‡evrimdÄ±ÅŸÄ±'}
                                </div>
                            </div>
                        `;
                        
                        div.addEventListener('click', () => {
                            pmUserInput.value = user.name;
                            suggestions.innerHTML = '';
                        });
                        
                        suggestions.appendChild(div);
                    });
                });
            }
            
            // GerÃ§ek zamanlÄ± event listener'larÄ± kur
            const client = window.eliteChatClient;
            
            client.on('new_message', (data) => {
                if (data.channel === SYSTEM.currentChannel && 
                    data.message.userId !== SYSTEM.currentUser.id) {
                    
                    const user = DATA.users[data.message.userId];
                    if (user) {
                        const localMessage = {
                            id: data.message.id,
                            type: 'message',
                            userId: data.message.userId,
                            text: data.message.text,
                            time: new Date(data.message.time),
                            channel: data.message.channel
                        };
                        
                        const channel = DATA.channels[data.message.channel];
                        if (channel) {
                            const exists = channel.messages.some(m => m.id === data.message.id);
                            if (!exists) {
                                channel.messages.push(localMessage);
                            }
                        }
                        
                        addMessageToChat(localMessage, user);
                    }
                }
            });
            
            client.on('private_message', (data) => {
                const message = data.message;
                
                if (message.to === SYSTEM.currentUser.id) {
                    const pmKey = [message.from, message.to].sort().join('_');
                    
                    if (!DATA.privateMessages.has(pmKey)) {
                        DATA.privateMessages.set(pmKey, []);
                    }
                    
                    const messages = DATA.privateMessages.get(pmKey);
                    const localMessage = {
                        id: message.id,
                        type: 'pm',
                        from: message.from,
                        to: message.to,
                        text: message.text,
                        time: new Date(message.time),
                        read: false
                    };
                    
                    messages.push(localMessage);
                    
                    if (SYSTEM.pmWindows[message.from]) {
                        addMessageToPMWindow(message.from, localMessage);
                    }
                    
                    updatePMConversationList();
                    
                    const sender = DATA.users[message.from];
                    if (sender) {
                        showNotification(sender.name, message.text, 'pm');
                    }
                }
            });
            
            client.on('user_joined', (data) => {
                const user = data.user;
                
                DATA.users[user.id] = user;
                DATA.onlineUsers.add(user.id);
                
                const generalChannel = DATA.channels.general;
                if (generalChannel) {
                    generalChannel.users.add(user.id);
                }
                
                if (SYSTEM.currentChannel === 'general') {
                    addSystemMessage(`ðŸŽ‰ ${user.name} sohbete katÄ±ldÄ±!`);
                }
                
                updateOnlineList();
            });
            
            client.on('user_left', (data) => {
                const userId = data.userId;
                
                if (DATA.users[userId]) {
                    DATA.users[userId].online = false;
                    DATA.onlineUsers.delete(userId);
                }
                
                Object.values(DATA.channels).forEach(channel => {
                    channel.users.delete(userId);
                });
                
                updateOnlineList();
            });
            
            client.on('channel_created', (data) => {
                const channel = data.channel;
                
                DATA.channels[channel.id] = {
                    ...channel,
                    users: new Set(channel.users || []),
                    operators: new Set(channel.operators || []),
                    voices: new Set(channel.voices || []),
                    bans: new Map(Object.entries(channel.bans || {})),
                    mutes: new Map(Object.entries(channel.mutes || {})),
                    messages: channel.messages || []
                };
                
                let tabExists = false;
                document.querySelectorAll('.channel-tab').forEach(tab => {
                    if (tab.dataset.channel === channel.id) {
                        tabExists = true;
                    }
                });
                
                if (!tabExists) {
                    const tabsContainer = document.getElementById('channelTabs');
                    const tab = document.createElement('div');
                    tab.className = 'channel-tab';
                    tab.dataset.channel = channel.id;
                    tab.innerHTML = `<i class="fas fa-hashtag"></i> ${channel.name.substring(1)}`;
                    tab.addEventListener('click', () => switchChannel(channel.id));
                    tabsContainer.appendChild(tab);
                }
                
                addSystemMessage(`ðŸ“¢ Yeni kanal oluÅŸturuldu: ${channel.name}`);
            });
            
            client.on('sync_users', (data) => {
                const serverUsers = data.users;
                
                serverUsers.forEach(serverUser => {
                    if (!DATA.users[serverUser.id]) {
                        DATA.users[serverUser.id] = serverUser;
                        DATA.onlineUsers.add(serverUser.id);
                    }
                });
                
                updateOnlineList();
            });
            
            client.on('sync_channels', (data) => {
                const serverChannels = data.channels;
                
                serverChannels.forEach(serverChannel => {
                    if (!DATA.channels[serverChannel.id]) {
                        DATA.channels[serverChannel.id] = {
                            ...serverChannel,
                            users: new Set(serverChannel.users || []),
                            operators: new Set(serverChannel.operators || []),
                            voices: new Set(serverChannel.voices || []),
                            bans: new Map(Object.entries(serverChannel.bans || {})),
                            mutes: new Map(Object.entries(serverChannel.mutes || {})),
                            messages: serverChannel.messages || []
                        };
                    }
                });
            });
            
            // Sayfa kapatÄ±lÄ±rken baÄŸlantÄ±yÄ± kes
            window.addEventListener('beforeunload', function() {
                const client = window.eliteChatClient;
                if (client && client.isConnected) {
                    client.disconnect();
                }
                
                stopAutoUpdates();
            });
            
            console.log('âœ… EliteChat sistemi baÅŸlatÄ±ldÄ±!');
        });

        // ==================== DÄ°ÄžER FONKSÄ°YONLAR (KÄ±saltÄ±lmÄ±ÅŸ) ====================
        function updatePanelInfo() {
            const channel = DATA.channels[SYSTEM.currentChannel];
            if (!channel) return;
            
            document.getElementById('panelChannelName').textContent = channel.name;
            document.getElementById('panelChannelTopic').textContent = channel.topic;
            document.getElementById('panelChannelVideo').textContent = channel.video.title;
        }

        function switchPanel(panelName) {
            document.getElementById('onlinePanel').classList.add('hidden');
            document.getElementById('pmPanel').classList.add('hidden');
            
            document.querySelectorAll('.panel-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(`${panelName}Panel`).classList.remove('hidden');
            document.querySelector(`.panel-tab[data-panel="${panelName}"]`).classList.add('active');
            
            if (panelName === 'pm') {
                updatePMConversationList();
            }
        }

        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'flex';
            }
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'none';
            }
        }

        function toggleTheme() {
            if (SYSTEM.theme === 'night') {
                document.body.classList.add('day-mode');
                document.body.classList.remove('night-mode');
                SYSTEM.theme = 'day';
            } else {
                document.body.classList.add('night-mode');
                document.body.classList.remove('day-mode');
                SYSTEM.theme = 'night';
            }
        }

        function openSettings() {
            const settings = SYSTEM.currentUser;
            if (!settings) return;
            
            document.getElementById('settingsNick').value = settings.name;
            document.getElementById('settingsAvatar').textContent = settings.avatar;
            document.getElementById('settingsBio').value = settings.bio || '';
            document.getElementById('settingsInvisible').checked = settings.invisible;
            
            openModal('settingsModal');
        }

        function saveSettings() {
            const nickInput = document.getElementById('settingsNick');
            const bioInput = document.getElementById('settingsBio');
            const invisibleInput = document.getElementById('settingsInvisible');
            
            const newNick = nickInput.value.trim();
            const bio = bioInput.value.trim();
            const invisible = invisibleInput.checked;
            
            if (newNick && newNick !== SYSTEM.currentUser.name) {
                changeNick(newNick);
            }
            
            SYSTEM.currentUser.bio = bio;
            SYSTEM.currentUser.invisible = invisible;
            
            closeModal('settingsModal');
            updateOnlineList();
            addSystemMessage('âœ… AyarlarÄ±nÄ±z gÃ¼ncellendi.');
        }

        function changeAvatar() {
            const newAvatar = prompt('Yeni avatar karakteri (1 karakter):', SYSTEM.currentUser.avatar);
            if (newAvatar && newAvatar.length === 1) {
                SYSTEM.currentUser.avatar = newAvatar;
                document.getElementById('settingsAvatar').textContent = newAvatar;
                updateOnlineList();
            }
        }

        function loadChannelVideo() {
            const channel = DATA.channels[SYSTEM.currentChannel];
            if (!channel || !channel.video) return;
            
            const player = document.getElementById('youtubePlayer');
            const titleElement = document.getElementById('videoTitle');
            
            if (player && titleElement) {
                player.src = `https://www.youtube-nocookie.com/embed/${channel.video.id}?autoplay=1&mute=1&rel=0&controls=1&modestbranding=1`;
                titleElement.textContent = channel.video.title;
                document.getElementById('panelChannelVideo').textContent = channel.video.title;
            }
        }

        function changeChannelVideo() {
            const channel = DATA.channels[SYSTEM.currentChannel];
            if (!channel) return;
            
            if (!hasVideoPermission(SYSTEM.currentChannel)) {
                alert('Video deÄŸiÅŸtirme yetkiniz yok!');
                return;
            }
            
            document.getElementById('videoUrl').value = '';
            document.getElementById('videoTitleInput').value = channel.video.title || '';
            openModal('videoModal');
        }

        function saveChannelVideo() {
            const urlInput = document.getElementById('videoUrl');
            const titleInput = document.getElementById('videoTitleInput');
            
            const url = urlInput.value.trim();
            const title = titleInput.value.trim() || 'YouTube Video';
            
            if (!url) {
                alert('YouTube URL veya Video ID gerekli!');
                return;
            }
            
            let videoId = url;
            
            try {
                if (url.includes('youtube.com') || url.includes('youtu.be')) {
                    const urlObj = new URL(url.includes('http') ? url : 'https://' + url);
                    if (urlObj.hostname.includes('youtu.be')) {
                        videoId = urlObj.pathname.substring(1);
                    } else {
                        videoId = urlObj.searchParams.get('v') || url.split('v=')[1]?.split('&')[0];
                    }
                }
                
                if (!videoId || videoId.length !== 11) {
                    throw new Error('GeÃ§ersiz Video ID');
                }
            } catch (e) {
                if (url.length === 11) {
                    videoId = url;
                } else {
                    alert('GeÃ§erli bir YouTube URL veya Video ID girin!');
                    return;
                }
            }
            
            const channel = DATA.channels[SYSTEM.currentChannel];
            if (channel) {
                channel.video = {
                    id: videoId,
                    title: title,
                    channel: channel.name.replace('#', '')
                };
                
                loadChannelVideo();
                addSystemMessage(`ðŸŽ¥ ${SYSTEM.currentUser.name} kanal videosunu deÄŸiÅŸtirdi: ${title}`);
                closeModal('videoModal');
            }
        }

        // ==================== Ã–ZEL SOHBET FONKSÄ°YONLARI (KÄ±saltÄ±lmÄ±ÅŸ) ====================
        function openPrivateChat(userId) {
            if (!DATA.users[userId] || userId === SYSTEM.currentUser.id) return;
            
            SYSTEM.activePM = userId;
            
            if (SYSTEM.pmWindows[userId]) {
                SYSTEM.pmWindows[userId].classList.remove('minimized');
                return;
            }
            
            createPMWindow(userId);
            updateOnlineList();
            updatePMConversationList();
        }

        function createPMWindow(userId) {
            const user = DATA.users[userId];
            if (!user) return;
            
            const pmWindow = document.createElement('div');
            pmWindow.className = 'pm-window';
            pmWindow.id = `pm-window-${userId}`;
            
            const displayName = user.id === 'mate' ? 'ðŸ¤–Mate' : user.name;
            
            pmWindow.innerHTML = `
                <div class="pm-window-header" data-user-id="${userId}">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div class="user-avatar ${user.online ? 'online' : ''}" style="width: 30px; height: 30px; font-size: 14px;">
                            ${user.avatar}
                        </div>
                        <div>
                            <div style="font-weight: 600; font-size: 14px;">
                                ${escapeHtml(displayName)}
                                ${getRoleBadge(user.role)}
                            </div>
                            <div style="font-size: 11px; color: var(--text-secondary);">
                                ${user.online ? 'ðŸŸ¢ Ã‡evrimiÃ§i' : 'âš« Ã‡evrimdÄ±ÅŸÄ±'}
                            </div>
                        </div>
                    </div>
                    <div style="display: flex; gap: 5px;">
                        <button class="btn btn-sm btn-minimize-pm" style="background: none; border: none; color: var(--text-secondary); padding: 4px 8px;">
                            <i class="fas fa-minus"></i>
                        </button>
                        <button class="btn btn-sm btn-close-pm" style="background: none; border: none; color: var(--text-secondary); padding: 4px 8px;">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
                <div class="pm-window-messages" id="pm-messages-${userId}">
                    <!-- Mesajlar buraya gelecek -->
                </div>
                <div class="pm-window-input">
                    <div class="message-input-container">
                        <textarea class="message-input pm-input" id="pm-input-${userId}" 
                                  placeholder="${displayName} ile mesajlaÅŸÄ±n..." 
                                  rows="2"></textarea>
                    </div>
                    <div class="input-actions" style="margin-top: 10px;">
                        <div class="flex gap-2">
                            <button class="btn btn-secondary btn-sm btn-pm-image" data-user-id="${userId}">
                                <i class="fas fa-image"></i>
                            </button>
                            <button class="btn btn-secondary btn-sm btn-pm-camera" data-user-id="${userId}">
                                <i class="fas fa-camera"></i>
                            </button>
                        </div>
                        <button class="btn btn-primary btn-send-pm" data-user-id="${userId}">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(pmWindow);
            SYSTEM.pmWindows[userId] = pmWindow;
            
            const header = pmWindow.querySelector('.pm-window-header');
            const minimizeBtn = pmWindow.querySelector('.btn-minimize-pm');
            const closeBtn = pmWindow.querySelector('.btn-close-pm');
            const sendBtn = pmWindow.querySelector('.btn-send-pm');
            const input = pmWindow.querySelector(`#pm-input-${userId}`);
            
            header.addEventListener('click', (e) => {
                if (e.target === header || e.target.closest('.pm-window-header') === header) {
                    pmWindow.classList.toggle('minimized');
                }
            });
            
            minimizeBtn?.addEventListener('click', (e) => {
                e.stopPropagation();
                pmWindow.classList.toggle('minimized');
            });
            
            closeBtn?.addEventListener('click', () => {
                closePMWindow(userId);
            });
            
            sendBtn?.addEventListener('click', () => {
                const text = input.value.trim();
                if (text) {
                    sendPrivateMessage(userId, text);
                    input.value = '';
                    input.focus();
                }
            });
            
            input?.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    const text = input.value.trim();
                    if (text) {
                        sendPrivateMessage(userId, text);
                        input.value = '';
                    }
                }
            });
            
            loadPMMessages(userId);
        }

        function closePMWindow(userId) {
            const pmWindow = document.getElementById(`pm-window-${userId}`);
            if (pmWindow) {
                pmWindow.remove();
                delete SYSTEM.pmWindows[userId];
                
                if (SYSTEM.activePM === userId) {
                    SYSTEM.activePM = null;
                    updateOnlineList();
                }
            }
        }

        function loadPMMessages(userId) {
            const container = document.getElementById(`pm-messages-${userId}`);
            if (!container) return;
            
            clearContainer(`pm-messages-${userId}`);
            
            const pmKey = [SYSTEM.currentUser.id, userId].sort().join('_');
            const messages = DATA.privateMessages.get(pmKey) || [];
            
            if (messages.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px; color: var(--text-secondary);">
                        <i class="fas fa-comment" style="font-size: 48px; margin-bottom: 15px; opacity: 0.5;"></i>
                        <h3 style="margin-bottom: 10px;">${DATA.users[userId]?.name} ile Sohbet</h3>
                        <p>HenÃ¼z mesaj yok. Ä°lk mesajÄ± siz gÃ¶nderin!</p>
                    </div>
                `;
                return;
            }
            
            messages.forEach(msg => {
                const isOutgoing = msg.from === SYSTEM.currentUser.id;
                const sender = DATA.users[msg.from];
                if (!sender) return;
                
                const displayName = sender.id === 'mate' ? 'ðŸ¤–Mate' : sender.name;
                
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${isOutgoing ? 'message-outgoing' : 'message-incoming'}`;
                messageDiv.dataset.messageId = msg.id;
                
                messageDiv.innerHTML = `
                    <div class="message-sender">
                        <span style="font-weight: 500;">${escapeHtml(displayName)}</span>
                        ${getRoleBadge(sender.role)}
                    </div>
                    <div class="message-text">${escapeHtml(msg.text)}</div>
                    <div class="message-time">${formatTime(msg.time)}</div>
                `;
                
                container.appendChild(messageDiv);
            });
            
            container.scrollTop = container.scrollHeight;
        }

        function addMessageToPMWindow(userId, message) {
            const container = document.getElementById(`pm-messages-${userId}`);
            if (!container) return;
            
            if (container.children.length === 1 && 
                container.children[0].querySelector('.fas.fa-comment')) {
                clearContainer(`pm-messages-${userId}`);
            }
            
            const isOutgoing = message.from === SYSTEM.currentUser.id;
            const sender = DATA.users[message.from];
            if (!sender) return;
            
            const displayName = sender.id === 'mate' ? 'ðŸ¤–Mate' : sender.name;
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isOutgoing ? 'message-outgoing' : 'message-incoming'}`;
            messageDiv.dataset.messageId = message.id;
            
            messageDiv.innerHTML = `
                <div class="message-sender">
                    <span style="font-weight: 500;">${escapeHtml(displayName)}</span>
                    ${getRoleBadge(sender.role)}
                </div>
                <div class="message-text">${escapeHtml(message.text)}</div>
                <div class="message-time">${formatTime(message.time)}</div>
            `;
            
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }

        function updatePMConversationList() {
            const container = document.getElementById('pmConversationList');
            if (!container) return;
            
            clearContainer('pmConversationList');
            
            const conversations = new Map();
            
            DATA.privateMessages.forEach((messages, pmKey) => {
                const [user1, user2] = pmKey.split('_');
                const otherUserId = user1 === SYSTEM.currentUser.id ? user2 : 
                                  user2 === SYSTEM.currentUser.id ? user1 : null;
                
                if (otherUserId && DATA.users[otherUserId]) {
                    const lastMessage = messages[messages.length - 1];
                    const unreadCount = messages.filter(m => 
                        m.from !== SYSTEM.currentUser.id && !m.read
                    ).length;
                    
                    conversations.set(otherUserId, {
                        user: DATA.users[otherUserId],
                        lastMessage: lastMessage,
                        unreadCount: unreadCount,
                        messageCount: messages.length
                    });
                }
            });
            
            const sortedConversations = Array.from(conversations.values())
                .sort((a, b) => {
                    if (!a.lastMessage) return 1;
                    if (!b.lastMessage) return -1;
                    return new Date(b.lastMessage.time) - new Date(a.lastMessage.time);
                });
            
            if (sortedConversations.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 30px 20px; color: var(--text-secondary);">
                        <i class="fas fa-comments" style="font-size: 32px; margin-bottom: 10px; opacity: 0.5;"></i>
                        <div style="font-size: 13px;">HenÃ¼z Ã¶zel sohbetiniz yok</div>
                    </div>
                `;
                return;
            }
            
            sortedConversations.forEach(conv => {
                const item = document.createElement('div');
                item.className = `pm-item ${conv.unreadCount > 0 ? 'unread' : ''}`;
                
                const displayName = conv.user.id === 'mate' ? 'ðŸ¤–Mate' : conv.user.name;
                
                const lastMessageText = conv.lastMessage ? 
                    (conv.lastMessage.text.length > 30 ? 
                     conv.lastMessage.text.substring(0, 30) + '...' : 
                     conv.lastMessage.text) : 
                    'Mesaj yok';
                
                const lastMessageTime = conv.lastMessage ? 
                    formatTime(conv.lastMessage.time) : '';
                
                item.innerHTML = `
                    <div class="pm-avatar">
                        ${conv.user.avatar}
                    </div>
                    <div class="pm-info">
                        <div class="pm-name">
                            ${escapeHtml(displayName)}
                            ${conv.unreadCount > 0 ? 
                              `<span style="background: var(--accent-blue); color: white; font-size: 10px; padding: 1px 5px; border-radius: 10px; margin-left: 5px;">${conv.unreadCount}</span>` : 
                              ''}
                        </div>
                        <div class="pm-preview">${escapeHtml(lastMessageText)}</div>
                    </div>
                    <div class="pm-time">${lastMessageTime}</div>
                `;
                
                item.addEventListener('click', () => {
                    openPrivateChat(conv.user.id);
                });
                
                container.appendChild(item);
            });
        }

        // ==================== OTOMATÄ°K GÃœNCELLEMELER ====================
        function startAutoUpdates() {
            const interval1 = setInterval(() => {
                const viewerCount = document.getElementById('viewerCount');
                if (viewerCount) {
                    const current = parseInt(viewerCount.textContent.replace(/[^0-9]/g, '')) || 1200;
                    const change = Math.floor(Math.random() * 100) - 50;
                    const newCount = Math.max(100, current + change);
                    viewerCount.textContent = newCount >= 1000 ? (newCount/1000).toFixed(1) + 'K' : newCount.toString();
                }
            }, 30000);
            
            SYSTEM.intervals.push(interval1);
        }

        function stopAutoUpdates() {
            SYSTEM.intervals.forEach(interval => clearInterval(interval));
            SYSTEM.intervals = [];
        }

        // ==================== IRC KOMUT FONKSÄ°YONLARI (KÄ±saltÄ±lmÄ±ÅŸ) ====================
        function handleIRCCommand(fullCommand) {
            const parts = fullCommand.split(' ');
            const cmd = parts[0].toLowerCase();
            const args = parts.slice(1);
            
            const commands = {
                '/nick': () => {
                    if (args.length >= 1) changeNick(args[0]);
                    else addSystemMessage('âŒ KullanÄ±m: /nick yeni_nick');
                },
                '/join': () => {
                    if (args.length >= 1) {
                        let channelName = args[0];
                        if (!channelName.startsWith('#')) channelName = '#' + channelName;
                        joinChannel(channelName);
                    } else {
                        addSystemMessage('âŒ KullanÄ±m: /join #kanal');
                    }
                },
                '/leave': () => leaveChannel(),
                '/msg': () => {
                    if (args.length >= 2) {
                        const target = args[0];
                        const message = args.slice(1).join(' ');
                        sendPrivateMessage(target.toLowerCase(), message);
                    } else {
                        addSystemMessage('âŒ KullanÄ±m: /msg nick mesaj');
                    }
                },
                '/me': () => {
                    if (args.length >= 1) {
                        const action = args.join(' ');
                        sendChannelMessage(`* ${SYSTEM.currentUser.name} ${action}`);
                    } else {
                        addSystemMessage('âŒ KullanÄ±m: /me eylem');
                    }
                },
                '/who': () => listChannelUsers(),
                '/clear': () => clearChat(),
                '/topic': () => {
                    if (args.length >= 1) changeTopic(args.join(' '));
                    else addSystemMessage('âŒ KullanÄ±m: /topic yeni_konu');
                },
                '/help': () => showIRCHelp(),
                '/ping': () => addSystemMessage('ðŸ“ Pong!'),
                '/time': () => addSystemMessage(`ðŸ•’ ${new Date().toLocaleString('tr-TR')}`),
                '/quit': () => {
                    addSystemMessage('ðŸ‘‹ Ã‡Ä±kÄ±ÅŸ yapÄ±lÄ±yor...');
                    setTimeout(() => {
                        window.location.reload();
                    }, 1000);
                }
            };
            
            if (commands[cmd]) {
                commands[cmd]();
            } else {
                addSystemMessage(`âŒ Bilinmeyen komut: ${cmd}. /help yazarak yardÄ±m alÄ±n.`);
            }
        }

        function changeNick(newNick) {
            if (!newNick || newNick.length < 2) {
                addSystemMessage('âŒ GeÃ§ersiz nick! (min 2 karakter)');
                return;
            }
            
            const cleanNick = newNick.replace(/[^a-zA-Z0-9._]/g, '');
            const userId = cleanNick.toLowerCase();
            
            if (userId === 'mate') {
                addSystemMessage('âŒ Bu kullanÄ±cÄ± adÄ± sistem tarafÄ±ndan kullanÄ±lÄ±yor!');
                return;
            }
            
            if (DATA.users[userId] && userId !== SYSTEM.currentUser.id) {
                addSystemMessage('âŒ Bu kullanÄ±cÄ± adÄ± zaten kullanÄ±lÄ±yor!');
                return;
            }
            
            const oldNick = SYSTEM.currentUser.name;
            const oldUserId = SYSTEM.currentUser.id;
            
            SYSTEM.currentUser.name = cleanNick;
            SYSTEM.currentUser.avatar = cleanNick.charAt(0).toUpperCase();
            
            delete DATA.users[oldUserId];
            DATA.users[userId] = SYSTEM.currentUser;
            
            DATA.onlineUsers.delete(oldUserId);
            DATA.onlineUsers.add(userId);
            
            Object.values(DATA.channels).forEach(channel => {
                if (channel.users.has(oldUserId)) {
                    channel.users.delete(oldUserId);
                    channel.users.add(userId);
                }
            });
            
            addSystemMessage(`âœ… Nick deÄŸiÅŸtirildi: ${oldNick} â†’ ${cleanNick}`);
            updateOnlineList();
        }

        function joinChannel(channelName) {
            const channelId = channelName.substring(1).toLowerCase().replace(/[^a-z0-9]/g, '_');
            
            if (!DATA.channels[channelId]) {
                addSystemMessage(`âŒ Kanal bulunamadÄ±: ${channelName}`);
                return;
            }
            
            const channel = DATA.channels[channelId];
            
            if (channel.bans.has(SYSTEM.currentUser.id)) {
                const banInfo = channel.bans.get(SYSTEM.currentUser.id);
                addSystemMessage(`âŒ Bu kanaldan banlÄ±sÄ±nÄ±z! Sebep: ${banInfo.reason}`);
                return;
            }
            
            channel.users.add(SYSTEM.currentUser.id);
            
            let tabExists = false;
            document.querySelectorAll('.channel-tab').forEach(tab => {
                if (tab.dataset.channel === channelId) {
                    tabExists = true;
                }
            });
            
            if (!tabExists) {
                const tabsContainer = document.getElementById('channelTabs');
                const tab = document.createElement('div');
                tab.className = 'channel-tab';
                tab.dataset.channel = channelId;
                tab.innerHTML = `<i class="fas fa-hashtag"></i> ${channel.name.substring(1)}`;
                tab.addEventListener('click', () => switchChannel(channelId));
                tabsContainer.appendChild(tab);
            }
            
            switchChannel(channelId);
            addSystemMessage(`âœ… ${channelName} kanalÄ±na katÄ±ldÄ±nÄ±z`);
        }

        function leaveChannel() {
            if (SYSTEM.currentChannel === 'general') {
                addSystemMessage('âŒ Genel kanaldan ayrÄ±lamazsÄ±nÄ±z!');
                return;
            }
            
            const channel = DATA.channels[SYSTEM.currentChannel];
            const channelName = channel.name;
            
            channel.users.delete(SYSTEM.currentUser.id);
            
            const tab = document.querySelector(`.channel-tab[data-channel="${SYSTEM.currentChannel}"]`);
            if (tab) tab.remove();
            
            switchChannel('general');
            addSystemMessage(`âœ… ${channelName} kanalÄ±ndan ayrÄ±ldÄ±nÄ±z`);
        }

        function listChannelUsers() {
            const channel = DATA.channels[SYSTEM.currentChannel];
            if (!channel) return;
            
            const users = Array.from(channel.users)
                .map(id => DATA.users[id])
                .filter(u => u)
                .sort((a, b) => {
                    const roleOrder = { owner: 1, admin: 2, coadmin: 3, operator: 4, voice: 5, user: 6 };
                    const roleDiff = roleOrder[a.role] - roleOrder[b.role];
                    if (roleDiff !== 0) return roleDiff;
                    return a.name.localeCompare(b.name);
                });
            
            let message = `ðŸ‘¥ ${channel.name} KullanÄ±cÄ±larÄ± (${users.length}):\n`;
            users.forEach(user => {
                const displayName = user.id === 'mate' ? 'ðŸ¤–Mate' : user.name;
                message += `â€¢ ${displayName} ${getRoleBadge(user.role)}\n`;
            });
            
            const lines = message.split('\n');
            lines.forEach(line => {
                if (line.trim()) {
                    addSystemMessage(line);
                }
            });
        }

        function changeTopic(newTopic) {
            const channel = DATA.channels[SYSTEM.currentChannel];
            if (!channel) return;
            
            if (channel.owner !== SYSTEM.currentUser.id && 
                SYSTEM.currentUser.role !== 'owner' && 
                SYSTEM.currentUser.role !== 'admin') {
                addSystemMessage('âŒ Kanal konusunu deÄŸiÅŸtirme yetkiniz yok!');
                return;
            }
            
            const oldTopic = channel.topic;
            channel.topic = newTopic;
            
            document.getElementById('channelTopic').textContent = newTopic;
            document.getElementById('panelChannelTopic').textContent = newTopic;
            
            addSystemMessage(`ðŸ“ Kanal konusu deÄŸiÅŸtirildi: "${oldTopic}" â†’ "${newTopic}"`);
        }

        function clearChat() {
            const container = document.getElementById('chatMessages');
            if (container) {
                clearContainer('chatMessages');
                addSystemMessage('âœ… Sohbet temizlendi');
            }
        }

        function showIRCHelp() {
            const helpText = `
ðŸ“‹ IRC KOMUTLARI:

ðŸ‘¤ GENEL KOMUTLAR:
/nick yeni_nick       - KullanÄ±cÄ± adÄ±nÄ± deÄŸiÅŸtir
/join #kanal          - Kanala katÄ±l
/leave                - Kanaldan ayrÄ±l
/msg nick mesaj       - Ã–zel mesaj gÃ¶nder
/me eylem             - Eylem mesajÄ± gÃ¶nder
/who                  - Kanal kullanÄ±cÄ±larÄ±nÄ± listele
/clear                - Sohbeti temizle
/topic yeni_konu      - Kanal konusunu deÄŸiÅŸtir
/ping                 - Ping kontrolÃ¼
/time                 - ZamanÄ± gÃ¶ster
/help                 - Bu yardÄ±mÄ± gÃ¶ster
/quit                 - Ã‡Ä±kÄ±ÅŸ yap
            `;
            
            helpText.trim().split('\n').forEach(line => {
                if (line.trim()) {
                    addSystemMessage(line);
                }
            });
        }
    </script>
</body>
</html>
