<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CanlÄ± YayÄ±n Sohbet</title>

  <!-- Firebase SDK'lar -->
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-storage-compat.js"></script>

  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: system-ui, sans-serif;
      background: #0f0f0f;
      color: #e0e0e0;
      height: 100vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    header {
      background: #1a1a1a;
      padding: 12px 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #333;
    }
    .main {
      flex: 1;
      display: flex;
      overflow: hidden;
    }
    #video-container {
      flex: 3;
      background: #000;
    }
    #chat-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      min-width: 320px;
      background: #111;
      border-left: 1px solid #222;
    }
    #users-container {
      width: 240px;
      background: #0a0a0a;
      border-left: 1px solid #222;
      padding: 16px;
      overflow-y: auto;
    }
    #messages, #private-messages {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
    }
    .message {
      margin: 8px 0;
      padding: 10px 14px;
      border-radius: 12px;
      max-width: 80%;
      word-break: break-word;
    }
    .message.own {
      background: #e91e63;
      color: white;
      margin-left: auto;
    }
    .message.other {
      background: #2a2a2a;
    }
    .message img {
      max-width: 220px;
      border-radius: 8px;
      margin-top: 6px;
      display: block;
    }
    #input-area {
      padding: 12px;
      background: #1a1a1a;
      border-top: 1px solid #333;
      display: flex;
      gap: 8px;
    }
    input, button {
      padding: 10px 14px;
      border: none;
      border-radius: 8px;
    }
    input {
      flex: 1;
      background: #222;
      color: white;
    }
    button {
      background: #e91e63;
      color: white;
      cursor: pointer;
    }
    button:hover {
      background: #c2185b;
    }
    #private-panel {
      position: fixed;
      bottom: 0;
      right: 0;
      width: 360px;
      height: 420px;
      background: #111;
      border: 1px solid #444;
      transform: translateX(100%);
      transition: transform 0.3s;
      z-index: 100;
      display: flex;
      flex-direction: column;
    }
    #private-panel.open {
      transform: translateX(0);
    }
    #private-header {
      padding: 12px;
      background: #1f1f1f;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #333;
    }
    .user-item {
      padding: 8px 0;
      cursor: pointer;
      border-bottom: 1px solid #222;
    }
    .user-item:hover {
      background: #1a1a1a;
    }
    @media (max-width: 900px) {
      .main { flex-direction: column; }
      #users-container {
        width: 100%;
        height: 140px;
        border-left: none;
        border-top: 1px solid #333;
      }
      #chat-container { min-width: auto; }
    }
  </style>
</head>
<body>

  <header>
    <div>ðŸŽ¤ CanlÄ± YayÄ±n & Sohbet</div>
    <div id="login-area">
      <input id="nickname" placeholder="KullanÄ±cÄ± adÄ±n" />
      <button id="join-btn">Gir</button>
    </div>
  </header>

  <div class="main">
    <div id="video-container">
      <!-- BURAYA KENDÄ° YOUTUBE CANLI YAYIN KODUNU YAPIÅžTIR -->
      <iframe 
        id="youtube-iframe"
        width="100%" 
        height="100%" 
        src="https://www.youtube.com/embed/RN4h0sBtzlc?autoplay=1&mute=0&controls=1"
        frameborder="0" 
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
        allowfullscreen>
      </iframe>
    </div>

    <div id="chat-container">
      <div id="messages"></div>
      <div id="input-area">
        <input id="message-input" placeholder="Mesaj yaz..." />
        <button id="send-btn">GÃ¶nder</button>
      </div>
    </div>

    <div id="users-container">
      <h3 style="margin-bottom:12px; color:#e91e63">Online KullanÄ±cÄ±lar</h3>
      <div id="user-list"></div>
    </div>
  </div>

  <!-- Ã–zel sohbet penceresi (saÄŸ altta) -->
  <div id="private-panel">
    <div id="private-header">
      <span id="private-title">Ã–zel sohbet: ...</span>
      <button onclick="closePrivate()">Ã—</button>
    </div>
    <div id="private-messages"></div>
    <div id="input-area">
      <input id="private-message-input" placeholder="Ã–zel mesaj..." />
      <input type="file" id="private-image-input" accept="image/*" style="display:none;" />
      <button onclick="document.getElementById('private-image-input').click()">ðŸ“Ž</button>
      <button id="send-private-btn">GÃ¶nder</button>
    </div>
  </div>

  <script>
    // ====================================================
    //  BURAYA FIREBASE CONFIG'Ä°NÄ° YAPISTIRACAKSIN
    // ====================================================
   
      const firebaseConfig = {
  apiKey: "AIzaSyCrn_tXJZCAlKhem45aXxj4f0h26EPOQ70",
  authDomain: "popboxmusicchat.firebaseapp.com",
  databaseURL: "https://popboxmusicchat-default-rtdb.firebaseio.com",
  projectId: "popboxmusicchat",
  storageBucket: "popboxmusicchat.appspot.com",
  messagingSenderId: "206625719024",
  appId: "1:206625719024:web:d28f478a2c96d10412f835",
  measurementId: "G-SB1K22FLEX"
    };

    // Firebase baÅŸlat
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();
    const storage = firebase.storage();

    let currentNick = "";
    let currentPrivateToUid = null;
    let currentPrivateToNick = "";

    // GiriÅŸ yapma
    document.getElementById("join-btn").onclick = () => {
      const nick = document.getElementById("nickname").value.trim();
      if (!nick) return alert("LÃ¼tfen bir kullanÄ±cÄ± adÄ± girin");

      auth.signInAnonymously()
        .then(() => {
          currentNick = nick;
          const uid = auth.currentUser.uid;

          db.ref("users/" + uid).set({
            nick: nick,
            online: true,
            lastSeen: Date.now()
          });

          document.getElementById("login-area").innerHTML = `HoÅŸ geldin, <b>${nick}</b>`;
        })
        .catch(err => alert("GiriÅŸ hatasÄ±: " + err.message));
    };

    // Online kullanÄ±cÄ± listesi
    db.ref("users").on("value", snapshot => {
      const list = document.getElementById("user-list");
      list.innerHTML = "";
      snapshot.forEach(child => {
        const user = child.val();
        if (user.online) {
          const div = document.createElement("div");
          div.className = "user-item";
          div.textContent = user.nick;
          div.onclick = () => openPrivateChat(child.key, user.nick);
          list.appendChild(div);
        }
      });
    });

    // Genel mesaj gÃ¶nderme
    document.getElementById("send-btn").onclick = sendPublicMessage;
    document.getElementById("message-input").addEventListener("keypress", e => {
      if (e.key === "Enter") sendPublicMessage();
    });

    function sendPublicMessage() {
      const text = document.getElementById("message-input").value.trim();
      if (!text || !currentNick) return;

      db.ref("messages").push({
        nick: currentNick,
        text,
        timestamp: Date.now()
      });
      document.getElementById("message-input").value = "";
    }

    db.ref("messages").limitToLast(100).on("child_added", snapshot => {
      const msg = snapshot.val();
      const div = document.createElement("div");
      div.className = `message ${msg.nick === currentNick ? "own" : "other"}`;
      div.innerHTML = `<strong>${msg.nick}:</strong> ${msg.text}`;
      document.getElementById("messages").appendChild(div);
      div.scrollIntoView({ behavior: "smooth" });
    });

    // Ã–zel sohbet aÃ§ma
    function openPrivateChat(uid, nick) {
      currentPrivateToUid = uid;
      currentPrivateToNick = nick;
      document.getElementById("private-title").textContent = `Ã–zel: ${nick}`;
      document.getElementById("private-panel").classList.add("open");
      document.getElementById("private-messages").innerHTML = "";

      const chatId = [auth.currentUser.uid, uid].sort().join("_");
      db.ref(`private/${chatId}`).limitToLast(60).on("child_added", snapshot => {
        const msg = snapshot.val();
        const div = document.createElement("div");
        div.className = `message ${msg.from === auth.currentUser.uid ? "own" : "other"}`;
        div.innerHTML = `<strong>${msg.fromNick}:</strong> ${msg.text || ""}`;
        if (msg.imageUrl) {
          const img = document.createElement("img");
          img.src = msg.imageUrl;
          div.appendChild(img);
        }
        document.getElementById("private-messages").appendChild(div);
        div.scrollIntoView();
      });
    }

    function closePrivate() {
      document.getElementById("private-panel").classList.remove("open");
      currentPrivateToUid = null;
    }

    // Ã–zel mesaj gÃ¶nderme
    document.getElementById("send-private-btn").onclick = () => {
      const text = document.getElementById("private-message-input").value.trim();
      if (!text || !currentPrivateToUid) return;

      const chatId = [auth.currentUser.uid, currentPrivateToUid].sort().join("_");
      db.ref(`private/${chatId}`).push({
        from: auth.currentUser.uid,
        fromNick: currentNick,
        text,
        timestamp: Date.now()
      });
      document.getElementById("private-message-input").value = "";
    };

    // Ã–zel sohbet fotoÄŸraf gÃ¶nderme
    document.getElementById("private-image-input").onchange = e => {
      const file = e.target.files[0];
      if (!file || !currentPrivateToUid) return;

      const chatId = [auth.currentUser.uid, currentPrivateToUid].sort().join("_");
      const storageRef = storage.ref(`private_images/${Date.now()}_${file.name}`);

      storageRef.put(file).then(() => {
        storageRef.getDownloadURL().then(url => {
          db.ref(`private/${chatId}`).push({
            from: auth.currentUser.uid,
            fromNick: currentNick,
            imageUrl: url,
            timestamp: Date.now()
          });
        });
      }).catch(err => alert("FotoÄŸraf yÃ¼klenemedi: " + err.message));
    };
  </script>
</body>
</html>
