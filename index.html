<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Popbox Music Chat</title>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>

    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background: #0f0f0f;
            color: #f1f1f1;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        header {
            height: 50px;
            background: #000;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 15px;
            border-bottom: 1px solid #333;
        }
        .logo {
            font-size: 20px;
            font-weight: bold;
            color: #ff0000;
        }
        .online {
            color: #4caf50;
            font-weight: bold;
        }
        #messages {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }
        .message {
            margin: 8px 0;
            padding: 10px;
            border-radius: 8px;
            max-width: 80%;
            background: #1e1e1e;
        }
        .message.own {
            background: #065fd4;
            margin-left: auto;
        }
        #input-area {
            padding: 10px;
            background: #111;
            display: flex;
        }
        #message-input {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 20px;
            background: #222;
            color: white;
            margin-right: 8px;
        }
        button {
            padding: 10px 16px;
            background: #ff0000;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
        }
        #login-screen {
            position: fixed;
            inset: 0;
            background: #000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 15px;
            z-index: 1000;
        }
        input {
            padding: 12px;
            width: 90%;
            max-width: 350px;
            border-radius: 6px;
            border: none;
            background: #222;
            color: white;
        }
        .hidden { display: none !important; }
        .owner-panel {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 20px;
            overflow-y: auto;
            z-index: 999;
        }
        .story-bar {
            height: 70px;
            overflow-x: auto;
            display: flex;
            gap: 12px;
            padding: 10px;
            background: rgba(0,0,0,0.7);
        }
        .story-item {
            width: 55px;
            height: 55px;
            border-radius: 50%;
            background: #ff6b6b;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            cursor: pointer;
        }
    </style>
</head>
<body>

<div id="login-screen">
    <h2 style="color:#ff0000">Popbox Music Chat</h2>
    <input id="nick" placeholder="Nick (b√ºy√ºk/k√º√ß√ºk harf farketmez)">
    <input id="password" type="password" placeholder="≈ûifre (sadece kayƒ±tlƒ±ysa)">
    <button onclick="girisYap()">Giri≈ü Yap</button>
    <p id="hata" style="color:#ff4444"></p>
</div>

<div id="main" class="hidden">
    <header>
        <div class="logo">‚ñ∂Ô∏è Popbox Live</div>
        <div>Online: <span id="online-count" class="online">0</span></div>
        <button onclick="cikisYap()">√áƒ±kƒ±≈ü</button>
    </header>

    <!-- Story Bar -->
    <div id="story-bar" class="story-bar"></div>

    <div id="messages"></div>

    <div id="input-area">
        <input id="message-input" placeholder="Mesaj yaz...">
        <button onclick="mesajGonder()">G√∂nder</button>
        <input type="file" id="dosyaSec" accept="image/*,video/*" style="display:none" onchange="dosyaYukle()">
        <button onclick="document.getElementById('dosyaSec').click()">üìé</button>
    </div>
</div>

<!-- Owner Panel -->
<div id="owner-panel" class="owner-panel hidden">
    <h2>Owner Panel (MateKy)</h2>
    <button onclick="document.getElementById('owner-panel').classList.add('hidden')">Kapat</button>
    <hr>
    <textarea id="sistem-mesaj" placeholder="Sistem mesajƒ± at..." rows="3"></textarea>
    <button onclick="sistemMesajGonder()">G√∂nder</button>
    <hr>
    <button onclick="storyOlustur()">Yeni Story Olu≈ütur</button>
    <hr>
    <div id="ozel-mesajlar"></div>
</div>

<script>
// Firebase Config (senin config'in)
const firebaseConfig = {
  apiKey: "AIzaSyCrn_tXJZCAlKhem45aXxj4f0h26EPOQ70",
  authDomain: "popboxmusicchat.firebaseapp.com",
  databaseURL: "https://popboxmusicchat-default-rtdb.firebaseio.com",
  projectId: "popboxmusicchat",
  storageBucket: "popboxmusicchat.firebasestorage.app",
  messagingSenderId: "206625719024",
  appId: "1:206625719024:web:d28f478a2c96d10412f835"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const storage = firebase.storage();

const messagesRef = db.ref('messages');
const usersRef = db.ref('users');
const onlineRef = db.ref('online');
const storiesRef = db.ref('stories');
const privateRef = db.ref('private-messages');

let mevcutKullanici = null;
const OWNER_NICK = "mateky";
const OWNER_SIFRE = "sahil7407@SCM";

function normalizeNick(nick) {
  return nick ? nick.toLowerCase().trim() : '';
}

function hataGoster(msg) {
  document.getElementById('hata').textContent = msg;
}

function girisYap() {
  const nick = document.getElementById('nick').value.trim();
  const sifre = document.getElementById('password').value;

  if (!nick) {
    hataGoster("Nick girin");
    return;
  }

  const normNick = normalizeNick(nick);

  if (normNick === normalizeNick(OWNER_NICK)) {
    if (sifre !== OWNER_SIFRE) {
      hataGoster("Owner ≈üifresi yanlƒ±≈ü");
      return;
    }
    mevcutKullanici = { nick: OWNER_NICK, role: "owner" };
  } else {
    // Normal kullanƒ±cƒ± - ≈üifre sormadan giri≈ü
    mevcutKullanici = { nick, role: "user" };
  }

  // Online ekle
  onlineRef.child(normNick).set(true);
  onlineRef.child(normNick).onDisconnect().remove();

  document.getElementById('login-screen').classList.add('hidden');
  document.getElementById('main').classList.remove('hidden');

  mesajlariDinle();
  onlineSayisiniGuncelle();
  storyleriYukle();

  if (mevcutKullanici.role === "owner") {
    document.getElementById('owner-panel').classList.remove('hidden');
  }

  mesajEkle("Sistem", `Ho≈ü geldin ${nick}!`);
}

function mesajlariDinle() {
  messagesRef.on('child_added', snap => {
    const msg = snap.val();
    mesajEkle(msg.nick, msg.text, normalizeNick(msg.nick) === normalizeNick(mevcutKullanici.nick));
  });
}

function mesajEkle(nick, text, benimMi) {
  const div = document.createElement('div');
  div.className = 'message' + (benimMi ? ' own' : '');
  div.innerHTML = `<strong>${nick}:</strong> ${text}`;
  document.getElementById('messages').appendChild(div);
  div.scrollIntoView();
}

function mesajGonder() {
  const input = document.getElementById('message-input');
  const text = input.value.trim();
  if (!text) return;

  messagesRef.push({
    nick: mevcutKullanici.nick,
    text,
    timestamp: Date.now()
  });
  input.value = '';
}

function onlineSayisiniGuncelle() {
  onlineRef.on('value', snap => {
    document.getElementById('online-count').textContent = snap.numChildren();
  });
}

function cikisYap() {
  onlineRef.child(normalizeNick(mevcutKullanici.nick)).remove();
  location.reload();
}

// Story Sistemi (basit)
function storyOlustur() {
  const text = prompt("Story metni:");
  if (!text) return;

  storiesRef.push({
    sender: mevcutKullanici.nick,
    text,
    timestamp: Date.now(),
    expires: Date.now() + 24*60*60*1000
  });
}

function storyleriYukle() {
  storiesRef.on('child_added', snap => {
    const story = snap.val();
    if (story.expires > Date.now()) {
      const item = document.createElement('div');
      item.className = 'story-item';
      item.textContent = story.sender[0];
      item.onclick = () => alert(story.text);
      document.getElementById('story-bar').appendChild(item);
    }
  });
}

// Dosya Y√ºkleme
function dosyaYukle() {
  const file = document.getElementById('dosyaSec').files[0];
  if (!file) return;

  const ref = storage.ref('media/' + file.name);
  ref.put(file).then(() => {
    ref.getDownloadURL().then(url => {
      messagesRef.push({
        nick: mevcutKullanici.nick,
        text: url,
        type: file.type.startsWith('image') ? 'image' : 'video',
        timestamp: Date.now()
      });
    });
  });
}

// Owner Sistem Mesajƒ±
function sistemMesajGonder() {
  const text = document.getElementById('sistem-mesaj').value.trim();
  if (!text) return;

  messagesRef.push({
    nick: "Sƒ∞STEM",
    text,
    timestamp: Date.now()
  });
  document.getElementById('sistem-mesaj').value = '';
}

// Enter ile g√∂nderme
document.getElementById('message-input').addEventListener('keypress', e => {
  if (e.key === 'Enter') mesajGonder();
});
  </script>
</body>
</html>
