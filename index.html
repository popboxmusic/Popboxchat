<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Popbox â€¢ Yetkili Medya Paneli</title>
    
    <!-- FONTS & ICONS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- FIREBASE -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background: #0f0f0f; color: #fff; overflow: hidden; height: 100vh; }
        
        /* LOGIN */
        .login-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: #0f0f0f;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 3000;
        }
        .login-box {
            width: 420px;
            max-width: 90%;
            background: #1a1a1a;
            border: 1px solid #2a2a2a;
            border-radius: 24px;
            padding: 40px;
        }
        .login-logo {
            display: flex;
            justify-content: center;
            margin-bottom: 32px;
        }
        .login-logo i { font-size: 56px; color: #ff0000; }
        .login-title {
            font-size: 28px;
            font-weight: 700;
            text-align: center;
            margin-bottom: 8px;
            color: #fff;
        }
        .login-subtitle {
            text-align: center;
            color: #aaa;
            font-size: 14px;
            margin-bottom: 32px;
        }
        .login-input {
            width: 100%;
            padding: 16px;
            background: #0f0f0f;
            border: 1px solid #2a2a2a;
            border-radius: 12px;
            color: #fff;
            font-size: 15px;
            margin-bottom: 16px;
        }
        .login-btn {
            width: 100%;
            padding: 16px;
            background: #ff0000;
            border: none;
            border-radius: 12px;
            color: #fff;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
        }
        .login-error {
            color: #ff4444;
            display: none;
            margin-bottom: 16px;
            text-align: center;
        }
        .hidden { display: none !important; }
        
        /* APP */
        .app {
            display: flex;
            height: 100vh;
            width: 100vw;
        }
        
        /* SIDEBAR */
        .sidebar {
            width: 80px;
            background: #0a0a0a;
            border-right: 1px solid #2a2a2a;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 24px 0;
            gap: 24px;
        }
        .menu-item {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #aaa;
            cursor: pointer;
            font-size: 20px;
        }
        .menu-item:hover { background: #272727; color: #fff; }
        .menu-item.active { background: #3f3f3f; color: #fff; }
        .user-avatar {
            margin-top: auto;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: #1a1a1a;
            border: 2px solid #3f3f3f;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: #fff;
        }
        
        /* CHAT */
        .chat-panel {
            flex: 1;
            background: #0f0f0f;
            display: flex;
            flex-direction: column;
        }
        .chat-header {
            padding: 16px 24px;
            border-bottom: 1px solid #2a2a2a;
        }
        .chat-title {
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 600;
        }
        .messages {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        .message {
            max-width: 80%;
            padding: 12px 16px;
            background: #1a1a1a;
            border-radius: 18px;
        }
        .message.right {
            align-self: flex-end;
            background: #ff0000;
        }
        .message-sender {
            font-size: 12px;
            color: #aaa;
            margin-bottom: 4px;
        }
        .message-time {
            font-size: 10px;
            color: #aaa;
            margin-top: 4px;
        }
        .message-input-container {
            padding: 20px 24px;
            background: #0a0a0a;
            border-top: 1px solid #2a2a2a;
        }
        .input-wrapper {
            display: flex;
            gap: 12px;
            background: #1a1a1a;
            border: 1px solid #2a2a2a;
            border-radius: 28px;
            padding: 8px 8px 8px 20px;
        }
        .message-input {
            flex: 1;
            background: transparent;
            border: none;
            color: #fff;
            font-size: 14px;
            padding: 12px 0;
            outline: none;
        }
        .send-btn {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: #272727;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        .send-btn:hover { background: #3f3f3f; }
        
        /* OWNER BUTONU */
        #ownerPanelBtn {
            border: 2px solid #ffd700;
            color: #ffd700;
        }
    </style>
</head>
<body>
    <!-- LOGIN -->
    <div id="loginOverlay" class="login-overlay">
        <div class="login-box">
            <div class="login-logo">
                <i class="fab fa-youtube"></i>
            </div>
            <h2 class="login-title">Popbox</h2>
            <p class="login-subtitle">Yetkili medya kontrol paneli</p>
            
            <input type="text" id="nickname" class="login-input" placeholder="KullanÄ±cÄ± adÄ±">
            <input type="password" id="password" class="login-input" placeholder="Åžifre">
            
            <div id="loginError" class="login-error">HatalÄ± ÅŸifre!</div>
            
            <button id="loginBtn" class="login-btn" onclick="handleLogin()">
                <i class="fas fa-sign-in-alt"></i> GiriÅŸ Yap
            </button>
        </div>
    </div>

    <!-- ANA UYGULAMA -->
    <div id="app" class="app hidden">
        <!-- SIDEBAR -->
        <div class="sidebar">
            <div class="menu-item active" onclick="showUsersPanel()">
                <i class="fas fa-users"></i>
            </div>
            <div class="menu-item" onclick="toggleNotificationPanel()">
                <i class="fas fa-bell"></i>
            </div>
            <div class="menu-item" onclick="focusMediaPanel()">
                <i class="fab fa-youtube"></i>
            </div>
            <div id="ownerPanelBtn" class="menu-item" style="display: none;" onclick="window.location.href='owner.html'">
                <i class="fas fa-crown"></i>
            </div>
            <div class="user-avatar" id="userAvatar">
                <span id="avatarText"></span>
            </div>
        </div>

        <!-- CHAT PANEL -->
        <div class="chat-panel">
            <div class="chat-header">
                <div class="chat-title">
                    <i class="fas fa-hashtag"></i>
                    <span id="currentChannel">genel sohbet</span>
                </div>
            </div>
            
            <div class="messages" id="messages"></div>
            
            <div class="message-input-container">
                <div class="input-wrapper">
                    <textarea id="messageInput" class="message-input" placeholder="Mesaj yazÄ±n..." rows="1"></textarea>
                    <div class="send-btn" onclick="sendMessage()">
                        <i class="fas fa-paper-plane"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ðŸ” FIREBASE KONFÄ°G - BURADA DURSUN, SONRA TAÅžIRIZ
        const firebaseConfig = {
            apiKey: "AIzaSyCrn_tXJZCAlKhem45aXxj4f0h26EPOQ70",
            authDomain: "popboxmusicchat.firebaseapp.com",
            databaseURL: "https://popboxmusicchat-default-rtdb.firebaseio.com",
            projectId: "popboxmusicchat",
            storageBucket: "popboxmusicchat.appspot.com",
            messagingSenderId: "206625719024",
            appId: "1:206625719024:web:d28f478a2c96d10412f835"
        };

        // ========== GLOBAL ==========
        let database;
        let currentUser = null;
        let isOwner = false;
        let isAdmin = false;

        // ========== FIREBASE BAÅžLAT ==========
        function initFirebase() {
            if (!firebase.apps.length) {
                firebase.initializeApp(firebaseConfig);
            }
            database = firebase.database();
            console.log('âœ… Firebase baÅŸlatÄ±ldÄ±!');
            
            // MESAJLARI DÄ°NLE
            database.ref('messages').limitToLast(50).on('value', (snapshot) => {
                const messages = snapshot.val();
                if (messages) {
                    updateMessages(messages);
                }
            });
        }

        // ========== GÄ°RÄ°Åž ==========
        function handleLogin() {
            const nickname = document.getElementById('nickname').value.trim();
            const password = document.getElementById('password').value;
            
            if (!nickname) {
                showError('KullanÄ±cÄ± adÄ± gerekli!');
                return;
            }
            
            // ðŸ” OWNER KONTROLÃœ
            if (nickname.toLowerCase() === 'mateky') {
                if (password !== 'Sahi17407@SCM') {
                    showError('HatalÄ± ÅŸifre!');
                    return;
                }
                isOwner = true;
                isAdmin = true;
                currentUser = { name: 'MateKy', role: 'owner' };
                document.getElementById('ownerPanelBtn').style.display = 'flex';
            }
            // ðŸ” ADMIN KONTROLÃœ
            else if (nickname.toLowerCase() === 'popbox' || nickname.toLowerCase() === 'popboxmusic') {
                currentUser = { name: nickname, role: 'admin' };
                isAdmin = true;
            }
            else {
                currentUser = { name: nickname, role: 'user' };
            }
            
            // GÄ°RÄ°Åž BAÅžARILI
            document.getElementById('loginOverlay').classList.add('hidden');
            document.getElementById('app').classList.remove('hidden');
            document.getElementById('avatarText').textContent = currentUser.name.charAt(0).toUpperCase();
            
            initFirebase();
            
            // ONLINE OLARAK KAYDET
            if (database) {
                database.ref(`onlineUsers/${currentUser.name}`).set({
                    name: currentUser.name,
                    role: currentUser.role,
                    lastSeen: Date.now()
                });
            }
            
            // HOÅžGELDÄ°N MESAJI
            addSystemMessage(`ðŸŽ‰ ${currentUser.name} (${currentUser.role}) sohbete katÄ±ldÄ±!`);
        }

        // ========== MESAJ GÃ–NDER ==========
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const text = input.value.trim();
            
            if (!text || !database || !currentUser) return;
            
            // KOMUT KONTROLÃœ
            if (text.startsWith('/')) {
                handleCommand(text);
                input.value = '';
                return;
            }
            
            // NORMAL MESAJ
            database.ref('messages').push({
                sender: currentUser.name,
                text: text,
                role: currentUser.role,
                timestamp: Date.now()
            });
            
            input.value = '';
        }

        // ========== KOMUT Ä°ÅžLE ==========
        function handleCommand(cmd) {
            const parts = cmd.substring(1).split(' ');
            const command = parts[0].toLowerCase();
            
            if (command === 'help' || command === 'yardÄ±m') {
                addSystemMessage('ðŸ“‹ KOMUTLAR: /help, /ping, /temizle');
            }
            else if (command === 'ping') {
                addSystemMessage('ðŸ“ Pong!');
            }
            else if (command === 'temizle' || command === 'clear') {
                if (isOwner || isAdmin) {
                    if (confirm('Sohbeti temizlemek istediÄŸinize emin misiniz?')) {
                        database.ref('messages').remove();
                        addSystemMessage('âœ… Sohbet temizlendi!');
                    }
                } else {
                    addSystemMessage('â›” Bu komutu kullanma yetkiniz yok!');
                }
            }
            else {
                addSystemMessage(`âŒ Bilinmeyen komut: ${cmd}`);
            }
        }

        // ========== MESAJLARI GÃœNCELLE ==========
        function updateMessages(messagesData) {
            const container = document.getElementById('messages');
            container.innerHTML = '';
            
            Object.values(messagesData).forEach(msg => {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${msg.sender === currentUser?.name ? 'right' : ''}`;
                
                let sender = msg.sender;
                if (msg.role === 'owner') sender = 'ðŸ‘‘ ' + sender;
                else if (msg.role === 'admin') sender = 'âš¡ ' + sender;
                
                const time = new Date(msg.timestamp).toLocaleTimeString('tr-TR', {
                    hour: '2-digit', minute: '2-digit'
                });
                
                messageDiv.innerHTML = `
                    <div class="message-sender">${sender}</div>
                    <div>${msg.text}</div>
                    <div class="message-time">${time}</div>
                `;
                
                container.appendChild(messageDiv);
            });
            
            container.scrollTop = container.scrollHeight;
        }

        // ========== SÄ°STEM MESAJI ==========
        function addSystemMessage(text) {
            if (!database) return;
            database.ref('messages').push({
                sender: 'Sistem',
                text: text,
                role: 'system',
                timestamp: Date.now()
            });
        }

        // ========== HATA GÃ–STER ==========
        function showError(message) {
            const errorEl = document.getElementById('loginError');
            errorEl.textContent = message;
            errorEl.style.display = 'block';
            setTimeout(() => { errorEl.style.display = 'none'; }, 3000);
        }

        // ========== DUMMY FONKSÄ°YONLAR ==========
        function showUsersPanel() { console.log('users'); }
        function toggleNotificationPanel() { console.log('notifications'); }
        function focusMediaPanel() { console.log('media'); }
        function switchUserTab(tab) { console.log('tab', tab); }
        function switchMediaTab(tab) { console.log('media', tab); }

        // ========== ENTER TUÅžU ==========
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                if (document.activeElement.id === 'nickname' || document.activeElement.id === 'password') {
                    handleLogin();
                    e.preventDefault();
                } else if (document.activeElement.id === 'messageInput') {
                    sendMessage();
                    e.preventDefault();
                }
            }
        });
    </script>
</body>
</html>
