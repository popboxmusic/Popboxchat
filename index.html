<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Popbox Music - Zarif Sohbet Platformu</title>
    
    <!-- FIREBASE SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    
    <style>
        /* ZARƒ∞F YOUTUBE MUSIC TEMA */
        :root {
            /* Renk Paleti */
            --primary: #ff0000;
            --primary-light: #ff3333;
            --primary-dark: #cc0000;
            --secondary: #ff6b6b;
            --accent: #4fc3f7;
            --success: #4caf50;
            --warning: #ff9800;
            --danger: #f44336;
            --dark: #0f0f0f;
            --darker: #0a0a0a;
            --light: #ffffff;
            --gray-100: #f5f5f5;
            --gray-200: #eeeeee;
            --gray-300: #e0e0e0;
            --gray-400: #bdbdbd;
            --gray-500: #9e9e9e;
            --gray-600: #757575;
            --gray-700: #616161;
            --gray-800: #424242;
            --gray-900: #212121;
            
            /* Rol Renkleri */
            --owner: linear-gradient(135deg, #ff4081, #ff6b6b);
            --admin: linear-gradient(135deg, #ff0000, #ff3333);
            --coadmin: linear-gradient(135deg, #ff9800, #ffb74d);
            --operator: linear-gradient(135deg, #2196f3, #64b5f6);
            --vip: linear-gradient(135deg, #9c27b0, #ba68c8);
            --user: linear-gradient(135deg, #4caf50, #81c784);
            
            /* Tema Varsayƒ±lanlarƒ± */
            --bg-primary: var(--dark);
            --bg-secondary: var(--darker);
            --bg-tertiary: #181818;
            --bg-card: rgba(255, 255, 255, 0.05);
            --bg-input: rgba(255, 255, 255, 0.08);
            --bg-hover: rgba(255, 255, 255, 0.1);
            --text-primary: var(--light);
            --text-secondary: var(--gray-400);
            --text-muted: var(--gray-600);
            --border-color: rgba(255, 255, 255, 0.1);
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.3);
            --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.4);
            --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.5);
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 24px;
            --radius-full: 9999px;
            
            /* Animasyonlar */
            --transition-fast: 150ms ease;
            --transition-normal: 300ms ease;
            --transition-slow: 500ms ease;
        }
        
        /* GECE TEMA */
        body.night-mode {
            --bg-primary: #1a1a2e;
            --bg-secondary: #16213e;
            --bg-tertiary: #0f3460;
            --bg-card: rgba(255, 255, 255, 0.07);
            --bg-input: rgba(255, 255, 255, 0.1);
            --text-primary: #e6f1ff;
            --text-secondary: #a8b2d1;
            --border-color: rgba(100, 149, 237, 0.2);
        }
        
        /* G√úND√úZ TEMA */
        body.light-mode {
            --bg-primary: #f8f9fa;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f1f3f5;
            --bg-card: rgba(0, 0, 0, 0.03);
            --bg-input: rgba(0, 0, 0, 0.05);
            --text-primary: #212529;
            --text-secondary: #495057;
            --border-color: rgba(0, 0, 0, 0.1);
        }
        
        /* RESET & BASE STYLES */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        html, body {
            height: 100%;
            width: 100%;
            overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: var(--transition-normal);
        }
        
        /* ANIMATIONS */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* ZARƒ∞F HEADER */
        .header {
            height: 70px;
            background: var(--bg-secondary);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border-color);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 28px;
            box-shadow: var(--shadow-sm);
            transition: var(--transition-normal);
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 16px;
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
            text-decoration: none;
        }
        
        .logo-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background: var(--primary);
            border-radius: var(--radius-full);
            color: white;
            font-size: 20px;
            animation: pulse 2s infinite;
        }
        
        .nav-controls {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        /* ICON BUTTONS */
        .icon-btn {
            width: 44px;
            height: 44px;
            border-radius: var(--radius-full);
            background: var(--bg-card);
            border: none;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 20px;
            transition: var(--transition-fast);
            position: relative;
        }
        
        .icon-btn:hover {
            background: var(--bg-hover);
            transform: translateY(-1px);
        }
        
        .icon-btn.active {
            background: var(--primary);
            color: white;
        }
        
        .badge {
            position: absolute;
            top: -4px;
            right: -4px;
            min-width: 20px;
            height: 20px;
            padding: 0 6px;
            background: var(--danger);
            color: white;
            font-size: 11px;
            font-weight: 600;
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid var(--bg-secondary);
        }
        
        /* HAYALET STORY BAR */
        .story-bar {
            position: fixed;
            top: 70px;
            left: 0;
            right: 0;
            background: rgba(15, 15, 15, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border-color);
            z-index: 900;
            padding: 16px 28px;
            transform: translateY(-100%);
            opacity: 0;
            transition: var(--transition-normal);
            max-height: 0;
            overflow: hidden;
        }
        
        .story-bar.active {
            transform: translateY(0);
            opacity: 1;
            max-height: 140px;
        }
        
        .story-scroll {
            display: flex;
            gap: 20px;
            overflow-x: auto;
            padding: 4px;
            scrollbar-width: thin;
        }
        
        .story-scroll::-webkit-scrollbar {
            height: 4px;
        }
        
        .story-scroll::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-full);
        }
        
        .story-scroll::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: var(--radius-full);
        }
        
        .story-item {
            flex: 0 0 auto;
            width: 80px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: var(--transition-fast);
        }
        
        .story-item:hover {
            transform: translateY(-2px);
        }
        
        .story-avatar {
            width: 64px;
            height: 64px;
            border-radius: var(--radius-full);
            background: var(--bg-card);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            position: relative;
            overflow: hidden;
            border: 3px solid transparent;
            background-clip: padding-box;
        }
        
        .story-avatar::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: var(--admin);
            border-radius: inherit;
            z-index: -1;
        }
        
        .story-avatar.seen::before {
            background: var(--gray-600);
        }
        
        .story-user {
            font-size: 12px;
            font-weight: 500;
            color: var(--text-secondary);
            text-align: center;
            max-width: 100%;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        /* ANA LAYOUT */
        .main-container {
            display: flex;
            height: calc(100vh - 70px);
            margin-top: 70px;
            position: relative;
            transition: var(--transition-normal);
        }
        
        /* SIDEBAR - KANAL Lƒ∞STESƒ∞ */
        .sidebar {
            width: 280px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
            overflow: hidden;
            transition: var(--transition-normal);
        }
        
        .sidebar-header {
            padding: 24px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .create-channel-btn {
            width: 100%;
            padding: 14px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: var(--radius-md);
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: var(--transition-fast);
        }
        
        .create-channel-btn:hover {
            background: var(--primary-light);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }
        
        .channels-list {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }
        
        .channel-item {
            padding: 14px;
            margin-bottom: 8px;
            background: var(--bg-card);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition-fast);
            border: 1px solid transparent;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .channel-item:hover {
            background: var(--bg-hover);
            border-color: var(--primary);
            transform: translateX(4px);
        }
        
        .channel-item.active {
            background: var(--bg-hover);
            border-color: var(--primary);
        }
        
        .channel-icon {
            width: 36px;
            height: 36px;
            border-radius: var(--radius-md);
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 16px;
        }
        
        .channel-info {
            flex: 1;
        }
        
        .channel-name {
            font-weight: 600;
            font-size: 15px;
            margin-bottom: 4px;
        }
        
        .channel-meta {
            font-size: 12px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* ANA ƒ∞√áERƒ∞K ALANI */
        .content-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        /* VIDEO CONTAINER */
        .video-container {
            height: 320px;
            background: #000;
            position: relative;
            border-bottom: 1px solid var(--border-color);
            flex-shrink: 0;
        }
        
        .video-wrapper {
            width: 100%;
            height: 100%;
            position: relative;
        }
        
        #youtube-player {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .video-placeholder {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
        }
        
        /* GENƒ∞≈û CHAT ALANI */
        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--bg-primary);
            overflow: hidden;
        }
        
        .chat-header {
            padding: 20px 28px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-shrink: 0;
        }
        
        .chat-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
        }
        
        .chat-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .online-count {
            padding: 8px 16px;
            background: var(--bg-card);
            border-radius: var(--radius-full);
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* MESAJLAR ALANI */
        .messages-area {
            flex: 1;
            overflow-y: auto;
            padding: 24px 28px;
            display: flex;
            flex-direction: column;
            gap: 16px;
            background: var(--bg-primary);
        }
        
        .message {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: 16px 20px;
            animation: fadeIn 0.3s ease;
            border-left: 4px solid var(--primary);
            transition: var(--transition-fast);
        }
        
        .message:hover {
            background: var(--bg-hover);
        }
        
        .message.owner { border-left-color: #ff4081; background: linear-gradient(135deg, rgba(255, 64, 129, 0.1), rgba(255, 107, 107, 0.1)); }
        .message.admin { border-left-color: var(--primary); background: linear-gradient(135deg, rgba(255, 0, 0, 0.1), rgba(255, 51, 51, 0.1)); }
        .message.coadmin { border-left-color: var(--warning); background: linear-gradient(135deg, rgba(255, 152, 0, 0.1), rgba(255, 183, 77, 0.1)); }
        .message.operator { border-left-color: var(--accent); background: linear-gradient(135deg, rgba(33, 150, 243, 0.1), rgba(100, 181, 246, 0.1)); }
        .message.vip { border-left-color: #9c27b0; background: linear-gradient(135deg, rgba(156, 39, 176, 0.1), rgba(186, 104, 200, 0.1)); }
        .message.system { border-left-color: var(--success); background: linear-gradient(135deg, rgba(76, 175, 80, 0.1), rgba(129, 199, 132, 0.1)); }
        .message.private { border-left-color: #9c27b0; background: linear-gradient(135deg, rgba(156, 39, 176, 0.1), rgba(186, 104, 200, 0.1)); }
        
        .message-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .message-user {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }
        
        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: var(--radius-full);
            background: var(--bg-input);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .user-name {
            font-weight: 600;
            font-size: 15px;
        }
        
        .message-time {
            font-size: 13px;
            color: var(--text-secondary);
        }
        
        .message-content {
            font-size: 15px;
            line-height: 1.5;
            color: var(--text-primary);
            word-break: break-word;
        }
        
        .message-image {
            max-width: 100%;
            max-height: 300px;
            border-radius: var(--radius-md);
            margin-top: 12px;
            cursor: pointer;
            border: 1px solid var(--border-color);
        }
        
        .message-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
            opacity: 0;
            transition: var(--transition-fast);
        }
        
        .message:hover .message-actions {
            opacity: 1;
        }
        
        .action-btn {
            padding: 6px 12px;
            background: var(--bg-input);
            border: none;
            border-radius: var(--radius-full);
            color: var(--text-secondary);
            font-size: 13px;
            cursor: pointer;
            transition: var(--transition-fast);
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .action-btn:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }
        
        /* CHAT INPUT */
        .chat-input-area {
            padding: 20px 28px;
            background: var(--bg-secondary);
            border-top: 1px solid var(--border-color);
            flex-shrink: 0;
        }
        
        .input-wrapper {
            display: flex;
            gap: 16px;
            align-items: flex-end;
        }
        
        .input-actions {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .action-icon {
            width: 44px;
            height: 44px;
            border-radius: var(--radius-full);
            background: var(--bg-card);
            border: none;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 20px;
            transition: var(--transition-fast);
        }
        
        .action-icon:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }
        
        #message-input {
            flex: 1;
            padding: 16px 20px;
            background: var(--bg-input);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            color: var(--text-primary);
            font-size: 15px;
            font-family: inherit;
            resize: none;
            min-height: 52px;
            max-height: 150px;
            outline: none;
            transition: var(--transition-normal);
        }
        
        #message-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(255, 0, 0, 0.1);
        }
        
        #message-input::placeholder {
            color: var(--text-muted);
        }
        
        .send-btn {
            width: 52px;
            height: 52px;
            border-radius: var(--radius-full);
            background: var(--primary);
            border: none;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 22px;
            transition: var(--transition-fast);
            flex-shrink: 0;
        }
        
        .send-btn:hover {
            background: var(--primary-light);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        /* Bƒ∞LDƒ∞Rƒ∞M PANELƒ∞ */
        .notification-panel {
            position: fixed;
            top: 70px;
            right: 28px;
            width: 380px;
            max-height: 500px;
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-lg);
            z-index: 1100;
            display: none;
            flex-direction: column;
            overflow: hidden;
            animation: slideIn 0.3s ease;
        }
        
        .notification-panel.active {
            display: flex;
        }
        
        .panel-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .panel-title {
            font-size: 18px;
            font-weight: 600;
        }
        
        .panel-close {
            width: 32px;
            height: 32px;
            border-radius: var(--radius-full);
            background: var(--bg-card);
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: var(--transition-fast);
        }
        
        .panel-close:hover {
            background: var(--bg-hover);
        }
        
        .notification-list {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }
        
        .notification-item {
            padding: 16px;
            background: var(--bg-card);
            border-radius: var(--radius-md);
            margin-bottom: 12px;
            cursor: pointer;
            transition: var(--transition-fast);
            border-left: 4px solid var(--primary);
        }
        
        .notification-item:hover {
            background: var(--bg-hover);
            transform: translateX(4px);
        }
        
        .notification-item.unread {
            border-left-color: var(--danger);
            background: linear-gradient(135deg, rgba(244, 67, 54, 0.1), rgba(255, 107, 107, 0.1));
        }
        
        /* ≈ûƒ∞KAYET PANELƒ∞ */
        .report-panel {
            position: fixed;
            top: 70px;
            right: 28px;
            width: 380px;
            max-height: 500px;
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            border: 1px solid var(--danger);
            box-shadow: var(--shadow-lg);
            z-index: 1100;
            display: none;
            flex-direction: column;
            overflow: hidden;
        }
        
        .report-panel.active {
            display: flex;
        }
        
        .report-header {
            padding: 20px;
            background: linear-gradient(135deg, var(--danger), #ff6b6b);
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        /* Gƒ∞Rƒ∞≈û EKRANI */
        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(30px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            animation: fadeIn 0.5s ease;
        }
        
        .login-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(40px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-xl);
            padding: 48px;
            width: 90%;
            max-width: 420px;
            box-shadow: var(--shadow-lg);
            animation: fadeIn 0.6s ease 0.2s both;
        }
        
        .login-logo {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .login-logo .logo-icon {
            width: 80px;
            height: 80px;
            font-size: 36px;
            background: var(--primary);
            animation: pulse 2s infinite;
        }
        
        .login-title {
            font-size: 32px;
            font-weight: 700;
            color: white;
            text-align: center;
        }
        
        .login-subtitle {
            color: var(--gray-400);
            text-align: center;
            line-height: 1.5;
            margin-bottom: 32px;
        }
        
        .login-input {
            width: 100%;
            padding: 18px 20px;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-lg);
            color: white;
            font-size: 16px;
            margin-bottom: 16px;
            transition: var(--transition-normal);
            outline: none;
        }
        
        .login-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(255, 0, 0, 0.2);
            background: rgba(255, 255, 255, 0.12);
        }
        
        .login-btn {
            width: 100%;
            padding: 18px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: var(--radius-lg);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition-fast);
            margin-top: 8px;
        }
        
        .login-btn:hover {
            background: var(--primary-light);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .login-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .login-error {
            color: var(--danger);
            font-size: 14px;
            margin-top: 16px;
            text-align: center;
            padding: 12px;
            background: rgba(244, 67, 54, 0.1);
            border-radius: var(--radius-md);
            border: 1px solid rgba(244, 67, 54, 0.2);
            display: none;
        }
        
        /* MODALLAR */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(20px);
            z-index: 1900;
            display: none;
            animation: fadeIn 0.3s ease;
        }
        
        .modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--bg-secondary);
            border-radius: var(--radius-xl);
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-lg);
            z-index: 2000;
            display: none;
            animation: fadeIn 0.4s ease;
            min-width: 400px;
            max-width: 90%;
            max-height: 90vh;
            overflow: hidden;
        }
        
        .modal.active {
            display: block;
        }
        
        .modal-header {
            padding: 24px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: 700;
        }
        
        .modal-body {
            padding: 24px;
            max-height: 60vh;
            overflow-y: auto;
        }
        
        .modal-footer {
            padding: 24px;
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }
        
        /* FORM ELEMANLARI */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 14px 16px;
            background: var(--bg-input);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            font-size: 15px;
            transition: var(--transition-normal);
            outline: none;
        }
        
        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(255, 0, 0, 0.1);
        }
        
        .form-textarea {
            min-height: 100px;
            resize: vertical;
            font-family: inherit;
        }
        
        /* BUTTONS */
        .btn {
            padding: 12px 24px;
            border-radius: var(--radius-md);
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition-fast);
            border: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--primary-light);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }
        
        .btn-secondary {
            background: var(--bg-card);
            color: var(--text-primary);
        }
        
        .btn-secondary:hover {
            background: var(--bg-hover);
        }
        
        .btn-danger {
            background: var(--danger);
            color: white;
        }
        
        .btn-danger:hover {
            background: #ef5350;
        }
        
        .btn-success {
            background: var(--success);
            color: white;
        }
        
        .btn-success:hover {
            background: #66bb6a;
        }
        
        /* STORY MODAL */
        .story-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 1800;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .story-content {
            max-width: 400px;
            width: 90%;
            background: var(--bg-secondary);
            border-radius: var(--radius-xl);
            overflow: hidden;
            position: relative;
        }
        
        /* UTILITY CLASSES */
        .hidden { display: none !important; }
        .loading { animation: spin 1s linear infinite; }
        
        /* SCROLLBAR STYLING */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--bg-card);
            border-radius: var(--radius-full);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--gray-600);
            border-radius: var(--radius-full);
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--gray-500);
        }
        
        /* MOBƒ∞L RESPONSIVE */
        @media (max-width: 768px) {
            .header {
                padding: 0 20px;
                height: 60px;
            }
            
            .main-container {
                margin-top: 60px;
                height: calc(100vh - 60px);
            }
            
            .sidebar {
                position: fixed;
                left: -280px;
                top: 60px;
                bottom: 0;
                z-index: 900;
                transition: var(--transition-normal);
            }
            
            .sidebar.active {
                left: 0;
            }
            
            .content-area {
                width: 100%;
            }
            
            .video-container {
                height: 240px;
            }
            
            .chat-header {
                padding: 16px 20px;
            }
            
            .messages-area {
                padding: 16px 20px;
            }
            
            .chat-input-area {
                padding: 16px 20px;
            }
            
            .notification-panel,
            .report-panel {
                width: calc(100% - 40px);
                right: 20px;
            }
            
            .story-bar {
                padding: 12px 20px;
            }
            
            .modal {
                min-width: unset;
                width: 95%;
            }
            
            .mobile-menu-btn {
                display: block !important;
            }
        }
        
        @media (min-width: 769px) {
            .mobile-menu-btn {
                display: none !important;
            }
        }
    </style>
</head>
<body>
    <!-- Gƒ∞Rƒ∞≈û EKRANI -->
    <div class="login-screen" id="loginScreen">
        <div class="login-card">
            <div class="login-logo">
                <div class="logo-icon">üéµ</div>
                <div class="login-title">Popbox Music</div>
            </div>
            
            <div class="login-subtitle">
                üéß Canlƒ± m√ºzik dinleme ve sohbet platformu<br>
                üîí G√ºvenli ve moderat√∂rl√º ortam<br>
                üé® Zarif ve modern aray√ºz
            </div>
            
            <input type="text" class="login-input" id="loginNick" placeholder="Kullanƒ±cƒ± adƒ±nƒ±z" autocomplete="off" autofocus>
            
            <div class="login-error" id="loginError"></div>
            
            <button class="login-btn" id="loginBtn" onclick="login()">
                üéµ Giri≈ü Yap
            </button>
        </div>
    </div>

    <!-- HEADER -->
    <div class="header">
        <div class="logo">
            <div class="logo-icon">üéµ</div>
            <span>Popbox Music</span>
        </div>
        
        <div class="nav-controls">
            <!-- Story/Hikaye Butonu -->
            <button class="icon-btn" id="storyBtn" onclick="toggleStoryBar()" title="Story/Hikaye">
                üì±
                <span class="badge hidden" id="storyBadge">0</span>
            </button>
            
            <!-- Bildirim Butonu -->
            <button class="icon-btn" id="notificationBtn" onclick="toggleNotificationPanel()" title="Bildirimler">
                üîî
                <span class="badge hidden" id="notificationBadge">0</span>
            </button>
            
            <!-- ≈ûikayet Butonu (Sadece Yetkililer) -->
            <button class="icon-btn hidden" id="reportBtn" onclick="toggleReportPanel()" title="≈ûikayetler">
                ‚ö†Ô∏è
                <span class="badge hidden" id="reportBadge">0</span>
            </button>
            
            <!-- Online Kullanƒ±cƒ±lar -->
            <button class="icon-btn" id="onlineBtn" onclick="toggleUserList()" title="Online Kullanƒ±cƒ±lar">
                üë•
                <span class="badge" id="onlineCount">0</span>
            </button>
            
            <!-- Tema Deƒüi≈ütir -->
            <button class="icon-btn" onclick="toggleTheme()" title="Tema Deƒüi≈ütir">
                üé®
            </button>
            
            <!-- Mobil Men√º -->
            <button class="icon-btn mobile-menu-btn" onclick="toggleSidebar()" title="Men√º">
                ‚ò∞
            </button>
        </div>
    </div>

    <!-- HAYALET STORY BAR -->
    <div class="story-bar" id="storyBar">
        <div class="story-scroll" id="storyScroll">
            <!-- Story'ler buraya eklenecek -->
        </div>
    </div>

    <!-- ANA LAYOUT -->
    <div class="main-container">
        <!-- SOL SIDEBAR - KANAL Lƒ∞STESƒ∞ -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <button class="create-channel-btn" onclick="openCreateChannelModal()">
                    ‚ûï Kanal Olu≈ütur
                </button>
            </div>
            
            <div class="channels-list" id="channelsList">
                <!-- Kanallar buraya eklenecek -->
            </div>
        </div>

        <!-- ANA ƒ∞√áERƒ∞K -->
        <div class="content-area">
            <!-- VIDEO CONTAINER -->
            <div class="video-container">
                <div class="video-wrapper">
                    <div id="youtube-player"></div>
                    <div class="video-placeholder">
                        <div style="font-size: 48px; margin-bottom: 16px;">üéµ</div>
                        <div style="font-size: 24px; font-weight: 600;">Popbox Music</div>
                        <div style="font-size: 16px; opacity: 0.8; margin-top: 8px;">Canlƒ± m√ºzik keyfi</div>
                    </div>
                </div>
            </div>

            <!-- CHAT CONTAINER -->
            <div class="chat-container">
                <div class="chat-header">
                    <div class="chat-title" id="channelTitle">üé§ Genel Sohbet</div>
                    <div class="chat-info">
                        <div class="online-count">
                            üë• <span id="chatOnlineCount">0</span> ki≈üi
                        </div>
                        <button class="action-btn" onclick="openStoryModal()" title="Story Payla≈ü">
                            üì± Story
                        </button>
                    </div>
                </div>

                <!-- MESAJLAR ALANI -->
                <div class="messages-area" id="messagesArea">
                    <div class="message system">
                        <div class="message-content">
                            üéâ Popbox Music Live'e ho≈ü geldiniz! Canlƒ± m√ºzik dinleyin ve sohbet edin.
                        </div>
                    </div>
                </div>

                <!-- CHAT INPUT -->
                <div class="chat-input-area">
                    <div class="input-wrapper">
                        <div class="input-actions">
                            <button class="action-icon" onclick="openImageUpload()" title="Resim G√∂nder">
                                üì∑
                            </button>
                            <button class="action-icon" onclick="openPrivateChat()" title="√ñzel Mesaj">
                                üîí
                            </button>
                        </div>
                        
                        <textarea 
                            id="messageInput" 
                            placeholder="Mesajƒ±nƒ±zƒ± yazƒ±n... (/yardƒ±m komutlarƒ± g√∂sterir)"
                            rows="1"
                            oninput="autoResize(this)"
                        ></textarea>
                        
                        <button class="send-btn" onclick="sendMessage()">
                            ‚Üó
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bƒ∞LDƒ∞Rƒ∞M PANELƒ∞ -->
    <div class="notification-panel" id="notificationPanel">
        <div class="panel-header">
            <div class="panel-title">üîî Bildirimler</div>
            <button class="panel-close" onclick="closeNotificationPanel()">√ó</button>
        </div>
        <div class="notification-list" id="notificationList">
            <!-- Bildirimler buraya eklenecek -->
        </div>
    </div>

    <!-- ≈ûƒ∞KAYET PANELƒ∞ -->
    <div class="report-panel hidden" id="reportPanel">
        <div class="report-header">
            <div class="panel-title">‚ö†Ô∏è ≈ûikayetler</div>
            <button class="panel-close" onclick="closeReportPanel()">√ó</button>
        </div>
        <div class="notification-list" id="reportList">
            <!-- ≈ûikayetler buraya eklenecek -->
        </div>
    </div>

    <!-- MODAL OVERLAY -->
    <div class="modal-overlay" id="modalOverlay"></div>

    <!-- KANAL OLU≈ûTURMA MODALI -->
    <div class="modal" id="createChannelModal">
        <div class="modal-header">
            <div class="modal-title">üé¨ Yeni Kanal Olu≈ütur</div>
            <button class="panel-close" onclick="closeModal('createChannelModal')">√ó</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label class="form-label">Kanal Adƒ±</label>
                <input type="text" class="form-input" id="channelName" placeholder="√ñrn: Popbox M√ºzik Odasƒ±">
            </div>
            <div class="form-group">
                <label class="form-label">YouTube Video URL</label>
                <input type="text" class="form-input" id="youtubeUrl" placeholder="https://www.youtube.com/watch?v=...">
                <small style="color: var(--text-secondary); margin-top: 4px; display: block;">
                    Sadece YouTube videolarƒ± eklenebilir.
                </small>
            </div>
            <div class="form-group">
                <label class="form-label">Kanal A√ßƒ±klamasƒ± (Opsiyonel)</label>
                <textarea class="form-textarea" id="channelDescription" placeholder="Kanalƒ±nƒ±zƒ±n a√ßƒ±klamasƒ±..."></textarea>
            </div>
            <div class="form-group">
                <label class="form-label">G√∂r√ºn√ºrl√ºk</label>
                <select class="form-select" id="channelVisibility">
                    <option value="public">üåç Herkese A√ßƒ±k</option>
                    <option value="private">üîí √ñzel</option>
                    <option value="registered">üë• Sadece Kayƒ±tlƒ± Kullanƒ±cƒ±lar</option>
                </select>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeModal('createChannelModal')">ƒ∞ptal</button>
            <button class="btn btn-primary" onclick="createChannel()">Olu≈ütur</button>
        </div>
    </div>

    <!-- STORY OLU≈ûTURMA MODALI -->
    <div class="modal" id="storyCreateModal">
        <div class="modal-header">
            <div class="modal-title">üì± Yeni Story</div>
            <button class="panel-close" onclick="closeModal('storyCreateModal')">√ó</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label class="form-label">Story Metni</label>
                <textarea class="form-textarea" id="storyText" placeholder="Story'nizde payla≈ümak istediƒüiniz mesaj..."></textarea>
            </div>
            <div class="form-group">
                <label class="form-label">Resim Ekle (Opsiyonel)</label>
                <input type="file" class="form-input" id="storyImage" accept="image/*" onchange="previewStoryImage()">
                <div id="storyImagePreview" style="margin-top: 12px; display: none;">
                    <img id="previewImg" style="max-width: 100%; max-height: 200px; border-radius: var(--radius-md);">
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">G√∂r√ºn√ºrl√ºk</label>
                <select class="form-select" id="storyVisibility">
                    <option value="public">üåç Herkese G√∂ster</option>
                    <option value="private">üîí Sadece √ñzel Sohbette</option>
                </select>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeModal('storyCreateModal')">ƒ∞ptal</button>
            <button class="btn btn-primary" onclick="createStory()">Payla≈ü</button>
        </div>
    </div>

    <!-- ADMIN PANEL MODALI -->
    <div class="modal" id="adminPanelModal">
        <div class="modal-header">
            <div class="modal-title">‚öôÔ∏è Admin Paneli</div>
            <button class="panel-close" onclick="closeModal('adminPanelModal')">√ó</button>
        </div>
        <div class="modal-body">
            <div style="display: flex; gap: 12px; margin-bottom: 24px;">
                <button class="btn btn-primary" onclick="showUserManagement()">üë• Kullanƒ±cƒ±lar</button>
                <button class="btn btn-secondary" onclick="showBanManagement()">üö´ Banlar</button>
                <button class="btn btn-secondary" onclick="showReports()">‚ö†Ô∏è ≈ûikayetler</button>
            </div>
            
            <div id="adminPanelContent">
                <!-- Admin panel i√ßeriƒüi buraya eklenecek -->
            </div>
        </div>
    </div>

    <!-- √ñZEL SOHBET MODALI -->
    <div class="modal" id="privateChatModal">
        <div class="modal-header">
            <div class="modal-title" id="privateChatTitle">üîí √ñzel Sohbet</div>
            <button class="panel-close" onclick="closeModal('privateChatModal')">√ó</button>
        </div>
        <div class="modal-body" style="height: 400px; overflow-y: auto;" id="privateChatMessages">
            <!-- √ñzel mesajlar buraya eklenecek -->
        </div>
        <div class="modal-footer">
            <input type="text" class="form-input" id="privateMessageInput" placeholder="√ñzel mesaj yazƒ±n..." style="flex: 1;">
            <button class="btn btn-primary" onclick="sendPrivateMessage()">G√∂nder</button>
        </div>
    </div>

    <!-- RESƒ∞M Y√úKLEME -->
    <input type="file" id="imageUploadInput" accept="image/*" style="display: none;">

    <script>
        // ========== FIREBASE KONFƒ∞G√úRASYONU ==========
        const firebaseConfig = {
            apiKey: "AIzaSyCrn_tXJZCAlKhem45aXxj4f0h26EPOQ70",
            authDomain: "popboxmusicchat.firebaseapp.com",
            databaseURL: "https://popboxmusicchat-default-rtdb.firebaseio.com",
            projectId: "popboxmusicchat",
            storageBucket: "popboxmusicchat.firebasestorage.app",
            messagingSenderId: "206625719024",
            appId: "1:206625719024:web:d28f478a2c96d10412f835",
            measurementId: "G-SB1K22FLEX"
        };

        // ========== GLOBAL DEƒûƒ∞≈ûKENLER ==========
        let database;
        let currentUser = null;
        let currentChannel = 'general';
        let currentPrivateChat = null;
        let isAdmin = false;
        let isCoAdmin = false;
        let isOperator = false;
        let youtubePlayer = null;
        let notifications = [];
        let reports = [];
        let stories = [];
        let channels = {};
        let storyBarOpen = false;
        let notificationPanelOpen = false;
        let reportPanelOpen = false;

        // ========== FIREBASE BA≈ûLATMA ==========
        function initializeFirebase() {
            try {
                firebase.initializeApp(firebaseConfig);
                database = firebase.database();
                
                // Baƒülantƒ± durumu takibi
                const connectedRef = database.ref(".info/connected");
                connectedRef.on("value", function(snap) {
                    if (snap.val() === true) {
                        console.log("‚úÖ Firebase baƒülandƒ±");
                        showLoginSuccess("Baƒülantƒ± kuruldu!");
                    } else {
                        console.log("‚ùå Firebase baƒülantƒ±sƒ± kesildi");
                        showLoginError("Baƒülantƒ± kesildi!");
                    }
                });
                
                initMateBot();
                loadChannels();
                loadStories();
                
            } catch (error) {
                console.error("Firebase ba≈ülatma hatasƒ±:", error);
                showLoginError("Firebase ba≈ülatƒ±lamadƒ±!");
            }
        }

        // ========== MATE BOT Sƒ∞STEMƒ∞ ==========
        class MateBot {
            constructor() {
                this.name = "MATE Bot";
                this.warnings = [
                    "‚ö†Ô∏è L√ºtfen k√ºf√ºr ve hakaret i√ßeren mesajlar yazmayƒ±n!",
                    "‚ö†Ô∏è Spam mesajlardan ka√ßƒ±nƒ±n, aksi takdirde ceza alabilirsiniz.",
                    "‚ö†Ô∏è Diƒüer kullanƒ±cƒ±lara saygƒ±lƒ± olun.",
                    "‚ö†Ô∏è Kurallara uymayan i√ßerikler silinebilir.",
                    "üîí Chat ortamƒ±nƒ± g√ºvenli tutalƒ±m!"
                ];
                this.lastWarningTime = 0;
                this.warningInterval = 30 * 60 * 1000; // 30 dakika
            }

            sendWelcome(username) {
                setTimeout(() => {
                    this.sendMessage(`üëã Ho≈ü geldin ${username}! Kurallara uyduƒüun s√ºrece keyifli sohbetler!`);
                }, 2000);
            }

            sendRandomWarning() {
                const now = Date.now();
                if (now - this.lastWarningTime > this.warningInterval) {
                    const warning = this.warnings[Math.floor(Math.random() * this.warnings.length)];
                    this.sendMessage(warning);
                    this.lastWarningTime = now;
                }
            }

            checkMessage(message) {
                const bannedWords = [
                    "k√ºf√ºr1", "k√ºf√ºr2", "spam", "reklam"
                ];
                
                const lowerMessage = message.toLowerCase();
                for (const word of bannedWords) {
                    if (lowerMessage.includes(word)) {
                        return {
                            safe: false,
                            reason: "Uygunsuz i√ßerik tespit edildi!"
                        };
                    }
                }
                
                // Spam kontrol√º
                if (message.length > 500) {
                    return {
                        safe: false,
                        reason: "Mesaj √ßok uzun!"
                    };
                }
                
                return { safe: true };
            }

            sendMessage(text) {
                if (!database) return;
                
                const messageData = {
                    sender: this.name,
                    text: text,
                    type: 'system',
                    timestamp: Date.now(),
                    time: new Date().toLocaleTimeString('tr-TR', { 
                        hour: '2-digit', 
                        minute: '2-digit' 
                    })
                };
                
                database.ref('channels/' + currentChannel + '/messages').push(messageData);
            }

            joinChannel(channelId) {
                this.sendMessage(`üîí MATE Bot bu kanala katƒ±ldƒ±. G√ºvenli sohbet i√ßin buradayƒ±m!`);
            }
        }

        let mateBot = new MateBot();

        function initMateBot() {
            // Her 30 dakikada bir uyarƒ± g√∂nder
            setInterval(() => {
                mateBot.sendRandomWarning();
            }, 30 * 60 * 1000);
        }

        // ========== Gƒ∞Rƒ∞≈û Sƒ∞STEMƒ∞ ==========
        function login() {
            const nick = document.getElementById('loginNick').value.trim();
            const loginBtn = document.getElementById('loginBtn');
            const loginError = document.getElementById('loginError');
            
            if (!nick) {
                showLoginError("L√ºtfen bir kullanƒ±cƒ± adƒ± girin!");
                return;
            }
            
            if (nick.length < 3 || nick.length > 20) {
                showLoginError("Kullanƒ±cƒ± adƒ± 3-20 karakter arasƒ±nda olmalƒ±!");
                return;
            }
            
            loginBtn.disabled = true;
            loginBtn.textContent = "Giri≈ü yapƒ±lƒ±yor...";
            loginError.style.display = 'none';
            
            // Nick normalizasyonu (b√ºy√ºk/k√º√ß√ºk harf koruma)
            const normalizedNick = normalizeNick(nick);
            
            // Kayƒ±tlƒ± kullanƒ±cƒ± kontrol√º
            checkRegisteredUser(normalizedNick).then(isRegistered => {
                if (isRegistered) {
                    // Kayƒ±tlƒ± kullanƒ±cƒ± - ≈üifre iste
                    const password = prompt("üîê Bu kullanƒ±cƒ± kayƒ±tlƒ±dƒ±r. ≈ûifrenizi girin:");
                    if (!password) {
                        loginBtn.disabled = false;
                        loginBtn.textContent = "üéµ Giri≈ü Yap";
                        return;
                    }
                    
                    verifyPassword(normalizedNick, password).then(valid => {
                        if (valid) {
                            completeLogin(nick, normalizedNick, true);
                        } else {
                            showLoginError("Hatalƒ± ≈üifre!");
                            loginBtn.disabled = false;
                            loginBtn.textContent = "üéµ Giri≈ü Yap";
                        }
                    });
                } else {
                    // Yeni kullanƒ±cƒ±
                    completeLogin(nick, normalizedNick, false);
                }
            }).catch(error => {
                console.error("Giri≈ü hatasƒ±:", error);
                showLoginError("Giri≈ü hatasƒ±!");
                loginBtn.disabled = false;
                loginBtn.textContent = "üéµ Giri≈ü Yap";
            });
        }

        function normalizeNick(nick) {
            return nick.toLowerCase().replace(/\s+/g, '');
        }

        async function checkRegisteredUser(nick) {
            try {
                const snapshot = await database.ref('registeredUsers/' + nick).once('value');
                return snapshot.exists();
            } catch (error) {
                return false;
            }
        }

        async function verifyPassword(nick, password) {
            try {
                const snapshot = await database.ref('registeredUsers/' + nick).once('value');
                const user = snapshot.val();
                return user && user.password === password;
            } catch (error) {
                return false;
            }
        }

        async function completeLogin(originalNick, normalizedNick, isRegistered) {
            try {
                // Aynƒ± nick kontrol√º
                const usersRef = database.ref('onlineUsers');
                const snapshot = await usersRef.once('value');
                const users = snapshot.val() || {};
                
                let existingUser = null;
                for (const [username, userData] of Object.entries(users)) {
                    if (normalizeNick(username) === normalizedNick) {
                        existingUser = username;
                        break;
                    }
                }
                
                if (existingUser && existingUser !== originalNick) {
                    showLoginError(`"${existingUser}" kullanƒ±cƒ±sƒ± zaten online!`);
                    document.getElementById('loginBtn').disabled = false;
                    document.getElementById('loginBtn').textContent = "üéµ Giri≈ü Yap";
                    return;
                }
                
                // Admin kontrol√º
                let role = 'user';
                if (normalizedNick === 'admin' || normalizedNick === 'popbox') {
                    role = 'admin';
                    isAdmin = true;
                } else if (isRegistered) {
                    const userData = await database.ref('registeredUsers/' + normalizedNick).once('value');
                    const data = userData.val();
                    if (data) {
                        role = data.role || 'user';
                        if (role === 'admin') isAdmin = true;
                        if (role === 'coadmin') isCoAdmin = true;
                        if (role === 'operator') isOperator = true;
                    }
                }
                
                // Kullanƒ±cƒ± bilgilerini kaydet
                currentUser = {
                    name: originalNick,
                    normalizedName: normalizedNick,
                    role: role,
                    isRegistered: isRegistered,
                    joinedAt: Date.now()
                };
                
                await usersRef.child(originalNick).set({
                    name: originalNick,
                    normalizedName: normalizedNick,
                    role: role,
                    isRegistered: isRegistered,
                    lastSeen: Date.now(),
                    isOnline: true
                });
                
                // √áƒ±kƒ±≈üta kaldƒ±r
                usersRef.child(originalNick).onDisconnect().remove();
                
                // Giri≈ü ekranƒ±nƒ± kapat
                document.getElementById('loginScreen').style.display = 'none';
                
                // Yetkili kontrollerini g√ºncelle
                updateAdminControls();
                
                // Ba≈ülangƒ±√ß mesajƒ±
                addSystemMessage(`üéâ ${originalNick} sohbete katƒ±ldƒ±!`);
                
                // MATE Bot kar≈üƒ±lama mesajƒ±
                setTimeout(() => {
                    mateBot.sendWelcome(originalNick);
                }, 1000);
                
                // YouTube player'ƒ± ba≈ülat
                initializeYouTubePlayer();
                
            } catch (error) {
                console.error("Giri≈ü tamamlama hatasƒ±:", error);
                showLoginError("Giri≈ü hatasƒ±!");
                document.getElementById('loginBtn').disabled = false;
                document.getElementById('loginBtn').textContent = "üéµ Giri≈ü Yap";
            }
        }

        function showLoginError(message) {
            const errorEl = document.getElementById('loginError');
            errorEl.textContent = message;
            errorEl.style.display = 'block';
        }

        function showLoginSuccess(message) {
            console.log(message);
        }

        // ========== YOUTUBE PLAYER ==========
        function initializeYouTubePlayer() {
            if (typeof YT !== 'undefined' && YT.Player) {
                youtubePlayer = new YT.Player('youtube-player', {
                    height: '100%',
                    width: '100%',
                    videoId: 'i75BZYOAPl4',
                    playerVars: {
                        'autoplay': 1,
                        'controls': 1,
                        'rel': 0,
                        'modestbranding': 1,
                        'playsinline': 1
                    },
                    events: {
                        'onReady': function(event) {
                            document.querySelector('.video-placeholder').style.display = 'none';
                        }
                    }
                });
            }
        }

        function onYouTubeIframeAPIReady() {
            initializeYouTubePlayer();
        }
        window.onYouTubeIframeAPIReady = onYouTubeIframeAPIReady;

        // ========== KANAL Sƒ∞STEMƒ∞ ==========
        async function loadChannels() {
            try {
                const snapshot = await database.ref('channels').once('value');
                channels = snapshot.val() || {};
                
                if (!channels.general) {
                    // Genel kanalƒ± olu≈ütur
                    await database.ref('channels/general').set({
                        name: 'üé§ Genel Sohbet',
                        description: 'Ana sohbet kanalƒ±',
                        createdBy: 'system',
                        createdAt: Date.now(),
                        type: 'public',
                        youtubeUrl: 'i75BZYOAPl4'
                    });
                    channels.general = {
                        name: 'üé§ Genel Sohbet',
                        description: 'Ana sohbet kanalƒ±',
                        type: 'public'
                    };
                }
                
                updateChannelsList();
                switchChannel('general');
                
            } catch (error) {
                console.error("Kanal y√ºkleme hatasƒ±:", error);
            }
        }

        function updateChannelsList() {
            const container = document.getElementById('channelsList');
            container.innerHTML = '';
            
            Object.entries(channels).forEach(([channelId, channel]) => {
                const item = document.createElement('div');
                item.className = 'channel-item' + (channelId === currentChannel ? ' active' : '');
                item.onclick = () => switchChannel(channelId);
                
                item.innerHTML = `
                    <div class="channel-icon">üéµ</div>
                    <div class="channel-info">
                        <div class="channel-name">${channel.name}</div>
                        <div class="channel-meta">
                            <span>üë§ ${channel.userCount || 0}</span>
                            <span>${channel.type === 'private' ? 'üîí' : 'üåç'}</span>
                        </div>
                    </div>
                `;
                
                container.appendChild(item);
            });
        }

        async function switchChannel(channelId) {
            currentChannel = channelId;
            const channel = channels[channelId];
            
            document.getElementById('channelTitle').textContent = channel.name;
            updateChannelsList();
            
            // Mesajlarƒ± y√ºkle
            loadChannelMessages();
            
            // YouTube video deƒüi≈ütir
            if (channel.youtubeUrl && youtubePlayer) {
                youtubePlayer.loadVideoById(channel.youtubeUrl);
            }
            
            // MATE Bot'u kanala ekle
            mateBot.joinChannel(channelId);
        }

        async function loadChannelMessages() {
            try {
                const messagesRef = database.ref('channels/' + currentChannel + '/messages');
                
                messagesRef.limitToLast(100).on('value', (snapshot) => {
                    const messages = snapshot.val() || {};
                    updateMessages(messages);
                });
                
            } catch (error) {
                console.error("Mesaj y√ºkleme hatasƒ±:", error);
            }
        }

        function updateMessages(messages) {
            const container = document.getElementById('messagesArea');
            container.innerHTML = '';
            
            const messagesArray = [];
            Object.entries(messages).forEach(([id, message]) => {
                messagesArray.push({ id, ...message });
            });
            
            messagesArray.sort((a, b) => a.timestamp - b.timestamp);
            
            messagesArray.forEach(msg => {
                const messageEl = document.createElement('div');
                messageEl.className = `message ${msg.type || 'user'} ${msg.sender === currentUser.name ? 'own' : ''}`;
                
                const time = new Date(msg.timestamp).toLocaleTimeString('tr-TR', {
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                let actions = '';
                if (msg.sender === currentUser.name || isAdmin || isCoAdmin || isOperator) {
                    actions = `
                        <div class="message-actions">
                            <button class="action-btn" onclick="deleteMessage('${msg.id}')">üóëÔ∏è</button>
                            ${msg.sender !== currentUser.name ? `<button class="action-btn" onclick="reportMessage('${msg.id}', '${msg.sender}')">‚ö†Ô∏è</button>` : ''}
                        </div>
                    `;
                }
                
                let content = msg.text;
                if (msg.image) {
                    content += `<br><img src="${msg.image}" class="message-image" onclick="showImageModal('${msg.image}')">`;
                }
                
                messageEl.innerHTML = `
                    <div class="message-header">
                        <div class="message-user" onclick="openUserProfile('${msg.sender}')">
                            <div class="user-avatar" style="background: ${getUserColor(msg.sender)}">${msg.sender.charAt(0)}</div>
                            <div>
                                <div class="user-name">${getUserPrefix(msg)}${msg.sender}</div>
                                <div class="message-time">${time}</div>
                            </div>
                        </div>
                    </div>
                    <div class="message-content">${content}</div>
                    ${actions}
                `;
                
                container.appendChild(messageEl);
            });
            
            container.scrollTop = container.scrollHeight;
        }

        function getUserPrefix(msg) {
            if (msg.type === 'owner') return 'ü§¥ ';
            if (msg.type === 'admin') return '‚≠êÔ∏è ';
            if (msg.type === 'coadmin') return '‚ö°Ô∏è ';
            if (msg.type === 'operator') return 'üõ†Ô∏è ';
            if (msg.type === 'vip') return 'üåü ';
            if (msg.type === 'system') return 'ü§ñ ';
            return '';
        }

        function getUserColor(username) {
            const colors = [
                'var(--primary)', 'var(--accent)', '#9c27b0', '#ff9800', '#4caf50', '#2196f3'
            ];
            let hash = 0;
            for (let i = 0; i < username.length; i++) {
                hash = username.charCodeAt(i) + ((hash << 5) - hash);
            }
            return colors[Math.abs(hash) % colors.length];
        }

        // ========== MESAJ G√ñNDERME ==========
        async function sendMessage() {
            if (!currentUser) return;
            
            const input = document.getElementById('messageInput');
            const text = input.value.trim();
            
            if (!text) return;
            
            // MATE Bot kontrol√º
            const check = mateBot.checkMessage(text);
            if (!check.safe) {
                addSystemMessage(`‚ö†Ô∏è ${check.reason}`);
                return;
            }
            
            // Komut kontrol√º
            if (text.startsWith('/')) {
                handleCommand(text);
                input.value = '';
                autoResize(input);
                return;
            }
            
            try {
                const messageData = {
                    sender: currentUser.name,
                    text: text,
                    type: currentUser.role,
                    timestamp: Date.now(),
                    time: new Date().toLocaleTimeString('tr-TR', {
                        hour: '2-digit',
                        minute: '2-digit'
                    })
                };
                
                await database.ref('channels/' + currentChannel + '/messages').push(messageData);
                
                input.value = '';
                autoResize(input);
                
                // Online durumu g√ºncelle
                await database.ref('onlineUsers/' + currentUser.name).update({
                    lastSeen: Date.now()
                });
                
            } catch (error) {
                console.error("Mesaj g√∂nderme hatasƒ±:", error);
                addSystemMessage("‚ùå Mesaj g√∂nderilemedi!");
            }
        }

        async function deleteMessage(messageId) {
            if (!currentUser) return;
            
            try {
                await database.ref('channels/' + currentChannel + '/messages/' + messageId).remove();
            } catch (error) {
                console.error("Mesaj silme hatasƒ±:", error);
            }
        }

        function reportMessage(messageId, sender) {
            if (!currentUser) return;
            
            const reason = prompt(`${sender} kullanƒ±cƒ±sƒ±nƒ±n mesajƒ±nƒ± neden ≈üikayet ediyorsunuz?`);
            if (!reason) return;
            
            try {
                database.ref('reports').push({
                    reporter: currentUser.name,
                    reportedUser: sender,
                    messageId: messageId,
                    channel: currentChannel,
                    reason: reason,
                    timestamp: Date.now()
                });
                
                addSystemMessage("‚úÖ ≈ûikayetiniz alƒ±ndƒ±!");
                
            } catch (error) {
                console.error("≈ûikayet hatasƒ±:", error);
            }
        }

        // ========== KOMUT Sƒ∞STEMƒ∞ ==========
        function handleCommand(cmd) {
            const parts = cmd.substring(1).split(' ');
            const command = parts[0].toLowerCase();
            const args = parts.slice(1);
            
            switch(command) {
                case 'yardƒ±m':
                    showHelp();
                    break;
                    
                case 'kanal':
                    if (args[0] === 'olu≈ütur') {
                        openCreateChannelModal();
                    } else if (args[0] === 'liste') {
                        showChannelList();
                    }
                    break;
                    
                case 'kullanƒ±cƒ±lar':
                    showOnlineUsers();
                    break;
                    
                case 'story':
                    openStoryModal();
                    break;
                    
                case 'admin':
                    if (isAdmin || isCoAdmin || isOperator) {
                        openAdminPanel();
                    }
                    break;
                    
                case 'temizle':
                    if (isAdmin || isCoAdmin || isOperator) {
                        clearChat();
                    }
                    break;
                    
                case 'ban':
                    if (isAdmin || isCoAdmin) {
                        if (args[0]) banUser(args[0], args.slice(1).join(' '));
                    }
                    break;
                    
                case 'unban':
                    if (isAdmin || isCoAdmin) {
                        if (args[0]) unbanUser(args[0]);
                    }
                    break;
                    
                case 'kick':
                    if (isAdmin || isCoAdmin || isOperator) {
                        if (args[0]) kickUser(args[0], args.slice(1).join(' '));
                    }
                    break;
                    
                case '√∂zel':
                    if (args[0]) openPrivateChatWith(args[0]);
                    break;
                    
                default:
                    addSystemMessage(`‚ùå Bilinmeyen komut: ${command}`);
            }
        }

        function showHelp() {
            let help = "üéµ **POPBOX MUSIC KOMUTLARI**\n\n";
            
            help += "**Temel Komutlar:**\n";
            help += "/yardƒ±m - Bu mesajƒ± g√∂ster\n";
            help += "/kullanƒ±cƒ±lar - Online kullanƒ±cƒ±larƒ± g√∂ster\n";
            help += "/story - Yeni story payla≈ü\n\n";
            
            help += "**Kanal Komutlarƒ±:**\n";
            help += "/kanal olu≈ütur - Yeni kanal olu≈ütur\n";
            help += "/kanal liste - Kanallarƒ± listele\n\n";
            
            if (isAdmin || isCoAdmin || isOperator) {
                help += "**Yetkili Komutlarƒ±:**\n";
                if (isAdmin || isCoAdmin) {
                    help += "/ban [kullanƒ±cƒ±] [sebep] - Kullanƒ±cƒ±yƒ± banla\n";
                    help += "/unban [kullanƒ±cƒ±] - Banƒ± kaldƒ±r\n";
                }
                help += "/kick [kullanƒ±cƒ±] [sebep] - Kullanƒ±cƒ±yƒ± at\n";
                help += "/temizle - Sohbeti temizle\n";
                help += "/admin - Admin paneli\n\n";
            }
            
            help += "**√ñzel Mesaj:**\n";
            help += "/√∂zel [kullanƒ±cƒ±] - √ñzel sohbet ba≈ülat";
            
            addSystemMessage(help);
        }

        // ========== STORY Sƒ∞STEMƒ∞ ==========
        async function loadStories() {
            try {
                const snapshot = await database.ref('stories').once('value');
                const storiesData = snapshot.val() || {};
                
                stories = [];
                const now = Date.now();
                
                Object.entries(storiesData).forEach(([id, story]) => {
                    if (story.expiresAt > now) {
                        stories.push({ id, ...story });
                    } else {
                        // S√ºresi dolan story'leri sil
                        database.ref('stories/' + id).remove();
                    }
                });
                
                updateStoryBar();
                
            } catch (error) {
                console.error("Story y√ºkleme hatasƒ±:", error);
            }
        }

        function updateStoryBar() {
            const container = document.getElementById('storyScroll');
            const badge = document.getElementById('storyBadge');
            
            container.innerHTML = '';
            
            // Son 24 saat i√ßindeki story'ler
            const last24Hours = stories.filter(story => 
                story.timestamp > Date.now() - (24 * 60 * 60 * 1000)
            );
            
            if (last24Hours.length === 0) {
                badge.classList.add('hidden');
                return;
            }
            
            badge.textContent = last24Hours.length;
            badge.classList.remove('hidden');
            
            // Kullanƒ±cƒ± ba≈üƒ±na son story
            const userStories = {};
            last24Hours.forEach(story => {
                if (!userStories[story.sender] || story.timestamp > userStories[story.sender].timestamp) {
                    userStories[story.sender] = story;
                }
            });
            
            Object.values(userStories).forEach(story => {
                const seen = localStorage.getItem(`story_seen_${story.sender}`) === 'true';
                
                const item = document.createElement('div');
                item.className = 'story-item';
                item.onclick = () => openStoryView(story.sender);
                
                item.innerHTML = `
                    <div class="story-avatar ${seen ? 'seen' : ''}">
                        ${story.sender.charAt(0).toUpperCase()}
                    </div>
                    <div class="story-user">${story.sender}</div>
                `;
                
                container.appendChild(item);
            });
        }

        function openStoryModal() {
            if (!currentUser) {
                addSystemMessage("‚ö†Ô∏è √ñnce giri≈ü yapmalƒ±sƒ±nƒ±z!");
                return;
            }
            
            if (!currentUser.isRegistered && !isAdmin && !isCoAdmin && !isOperator) {
                addSystemMessage("‚ö†Ô∏è Sadece kayƒ±tlƒ± kullanƒ±cƒ±lar story payla≈üabilir!");
                return;
            }
            
            openModal('storyCreateModal');
        }

        async function createStory() {
            const text = document.getElementById('storyText').value.trim();
            const visibility = document.getElementById('storyVisibility').value;
            
            if (!text) {
                alert("L√ºtfen bir mesaj yazƒ±n!");
                return;
            }
            
            try {
                const storyData = {
                    sender: currentUser.name,
                    text: text,
                    visibility: visibility,
                    timestamp: Date.now(),
                    expiresAt: Date.now() + (24 * 60 * 60 * 1000), // 24 saat
                    likes: 0,
                    reports: 0
                };
                
                // Resim y√ºkleme
                const imageInput = document.getElementById('storyImage');
                if (imageInput.files[0]) {
                    const reader = new FileReader();
                    reader.onload = async function(e) {
                        storyData.image = e.target.result;
                        await database.ref('stories').push(storyData);
                        closeModal('storyCreateModal');
                        loadStories();
                        addSystemMessage("‚úÖ Story payla≈üƒ±ldƒ±!");
                    };
                    reader.readAsDataURL(imageInput.files[0]);
                } else {
                    await database.ref('stories').push(storyData);
                    closeModal('storyCreateModal');
                    loadStories();
                    addSystemMessage("‚úÖ Story payla≈üƒ±ldƒ±!");
                }
                
            } catch (error) {
                console.error("Story olu≈üturma hatasƒ±:", error);
                alert("Story olu≈üturulamadƒ±!");
            }
        }

        function openStoryView(username) {
            const userStories = stories.filter(story => 
                story.sender === username && story.timestamp > Date.now() - (24 * 60 * 60 * 1000)
            );
            
            if (userStories.length === 0) return;
            
            localStorage.setItem(`story_seen_${username}`, 'true');
            
            // Story modalƒ±nƒ± g√∂ster
            alert(`${username}'in story'si: ${userStories[0].text}`);
            updateStoryBar();
        }

        // ========== KANAL OLU≈ûTURMA ==========
        function openCreateChannelModal() {
            if (!currentUser || !currentUser.isRegistered) {
                addSystemMessage("‚ö†Ô∏è Sadece kayƒ±tlƒ± kullanƒ±cƒ±lar kanal olu≈üturabilir!");
                return;
            }
            
            openModal('createChannelModal');
        }

        async function createChannel() {
            const name = document.getElementById('channelName').value.trim();
            const youtubeUrl = document.getElementById('youtubeUrl').value.trim();
            const description = document.getElementById('channelDescription').value.trim();
            const visibility = document.getElementById('channelVisibility').value;
            
            if (!name) {
                alert("L√ºtfen kanal adƒ± girin!");
                return;
            }
            
            if (!youtubeUrl) {
                alert("L√ºtfen YouTube video URL'si girin!");
                return;
            }
            
            // YouTube video ID √ßƒ±karma
            let videoId = null;
            const patterns = [
                /youtube\.com\/watch\?v=([^&]+)/,
                /youtu\.be\/([^?]+)/,
                /youtube\.com\/embed\/([^?]+)/
            ];
            
            for (const pattern of patterns) {
                const match = youtubeUrl.match(pattern);
                if (match) {
                    videoId = match[1];
                    break;
                }
            }
            
            if (!videoId) {
                alert("Ge√ßerli bir YouTube URL'si girin!");
                return;
            }
            
            try {
                const channelId = 'channel_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                
                const channelData = {
                    name: name,
                    description: description,
                    youtubeUrl: videoId,
                    type: visibility,
                    createdBy: currentUser.name,
                    createdAt: Date.now(),
                    userCount: 0
                };
                
                await database.ref('channels/' + channelId).set(channelData);
                channels[channelId] = channelData;
                
                closeModal('createChannelModal');
                updateChannelsList();
                addSystemMessage("‚úÖ Kanal olu≈üturuldu!");
                
                // MATE Bot'u yeni kanala ekle
                mateBot.joinChannel(channelId);
                
            } catch (error) {
                console.error("Kanal olu≈üturma hatasƒ±:", error);
                alert("Kanal olu≈üturulamadƒ±!");
            }
        }

        // ========== Bƒ∞LDƒ∞Rƒ∞M Sƒ∞STEMƒ∞ ==========
        function toggleStoryBar() {
            const bar = document.getElementById('storyBar');
            const btn = document.getElementById('storyBtn');
            
            storyBarOpen = !storyBarOpen;
            
            if (storyBarOpen) {
                bar.classList.add('active');
                btn.classList.add('active');
            } else {
                bar.classList.remove('active');
                btn.classList.remove('active');
            }
        }

        function toggleNotificationPanel() {
            const panel = document.getElementById('notificationPanel');
            notificationPanelOpen = !notificationPanelOpen;
            
            if (notificationPanelOpen) {
                panel.classList.add('active');
                loadNotifications();
            } else {
                panel.classList.remove('active');
            }
            
            if (reportPanelOpen) {
                closeReportPanel();
            }
        }

        function closeNotificationPanel() {
            document.getElementById('notificationPanel').classList.remove('active');
            notificationPanelOpen = false;
        }

        function toggleReportPanel() {
            const panel = document.getElementById('reportPanel');
            reportPanelOpen = !reportPanelOpen;
            
            if (reportPanelOpen) {
                panel.classList.add('active');
                loadReports();
            } else {
                panel.classList.remove('active');
            }
            
            if (notificationPanelOpen) {
                closeNotificationPanel();
            }
        }

        function closeReportPanel() {
            document.getElementById('reportPanel').classList.remove('active');
            reportPanelOpen = false;
        }

        function updateNotificationBadge(count) {
            const badge = document.getElementById('notificationBadge');
            if (count > 0) {
                badge.textContent = count > 99 ? '99+' : count;
                badge.classList.remove('hidden');
            } else {
                badge.classList.add('hidden');
            }
        }

        function updateReportBadge(count) {
            const badge = document.getElementById('reportBadge');
            if (count > 0) {
                badge.textContent = count > 99 ? '99+' : count;
                badge.classList.remove('hidden');
            } else {
                badge.classList.add('hidden');
            }
        }

        async function loadNotifications() {
            try {
                const snapshot = await database.ref('notifications').limitToLast(50).once('value');
                const notificationsData = snapshot.val() || {};
                
                const container = document.getElementById('notificationList');
                container.innerHTML = '';
                
                Object.entries(notificationsData).forEach(([id, notification]) => {
                    const item = document.createElement('div');
                    item.className = 'notification-item' + (notification.read ? '' : ' unread');
                    item.onclick = () => handleNotificationClick(id, notification);
                    
                    const time = new Date(notification.timestamp).toLocaleTimeString('tr-TR', {
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    
                    item.innerHTML = `
                        <div style="font-weight: 600; margin-bottom: 4px;">${notification.sender}</div>
                        <div style="color: var(--text-secondary); margin-bottom: 4px;">${notification.message}</div>
                        <div style="font-size: 12px; color: var(--text-muted);">${time}</div>
                    `;
                    
                    container.appendChild(item);
                });
                
                updateNotificationBadge(Object.keys(notificationsData).length);
                
            } catch (error) {
                console.error("Bildirim y√ºkleme hatasƒ±:", error);
            }
        }

        async function loadReports() {
            try {
                const snapshot = await database.ref('reports').limitToLast(50).once('value');
                const reportsData = snapshot.val() || {};
                
                const container = document.getElementById('reportList');
                container.innerHTML = '';
                
                Object.entries(reportsData).forEach(([id, report]) => {
                    const item = document.createElement('div');
                    item.className = 'notification-item unread';
                    
                    const time = new Date(report.timestamp).toLocaleTimeTimeString('tr-TR', {
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    
                    item.innerHTML = `
                        <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                            <div style="font-weight: 600;">${report.reportedUser}</div>
                            <div style="font-size: 12px; color: var(--text-muted);">${time}</div>
                        </div>
                        <div style="color: var(--text-secondary); margin-bottom: 4px;">
                            <strong>≈ûikayet Eden:</strong> ${report.reporter}<br>
                            <strong>Sebep:</strong> ${report.reason}
                        </div>
                        <div class="message-actions">
                            <button class="action-btn" onclick="resolveReport('${id}')">√á√∂z</button>
                            <button class="action-btn" onclick="deleteReport('${id}')">Sil</button>
                            <button class="action-btn" onclick="viewReport('${id}')">G√∂r√ºnt√ºle</button>
                        </div>
                    `;
                    
                    container.appendChild(item);
                });
                
                updateReportBadge(Object.keys(reportsData).length);
                
            } catch (error) {
                console.error("≈ûikayet y√ºkleme hatasƒ±:", error);
            }
        }

        // ========== YETKƒ∞Lƒ∞ KONTROLLERƒ∞ ==========
        function updateAdminControls() {
            const reportBtn = document.getElementById('reportBtn');
            
            if (isAdmin || isCoAdmin || isOperator) {
                reportBtn.classList.remove('hidden');
            } else {
                reportBtn.classList.add('hidden');
            }
        }

        // ========== UTILITY FONKSƒ∞YONLAR ==========
        function autoResize(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = Math.min(textarea.scrollHeight, 150) + 'px';
        }

        function addSystemMessage(text) {
            const container = document.getElementById('messagesArea');
            const messageEl = document.createElement('div');
            messageEl.className = 'message system';
            messageEl.innerHTML = `<div class="message-content">${text}</div>`;
            container.appendChild(messageEl);
            container.scrollTop = container.scrollHeight;
        }

        function openModal(modalId) {
            document.getElementById('modalOverlay').style.display = 'block';
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById('modalOverlay').style.display = 'none';
            document.getElementById(modalId).classList.remove('active');
        }

        function toggleTheme() {
            const body = document.body;
            const themeBtn = document.querySelector('[title="Tema Deƒüi≈ütir"]');
            
            if (body.classList.contains('light-mode')) {
                body.classList.remove('light-mode');
                body.classList.add('night-mode');
                themeBtn.textContent = 'üåô';
                localStorage.setItem('theme', 'night');
            } else if (body.classList.contains('night-mode')) {
                body.classList.remove('night-mode');
                themeBtn.textContent = 'üåû';
                localStorage.setItem('theme', 'default');
            } else {
                body.classList.add('light-mode');
                themeBtn.textContent = '‚òÄÔ∏è';
                localStorage.setItem('theme', 'light');
            }
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('active');
        }

        function toggleUserList() {
            // Online kullanƒ±cƒ±larƒ± g√∂ster
            showOnlineUsers();
        }

        async function showOnlineUsers() {
            try {
                const snapshot = await database.ref('onlineUsers').once('value');
                const users = snapshot.val() || {};
                
                let userList = "üë• **ONLINE KULLANICILAR**\n\n";
                
                Object.entries(users).forEach(([username, userData]) => {
                    const role = userData.role || 'user';
                    const roleIcon = role === 'admin' ? '‚≠êÔ∏è' : role === 'coadmin' ? '‚ö°Ô∏è' : role === 'operator' ? 'üõ†Ô∏è' : 'üë§';
                    userList += `${roleIcon} ${username}\n`;
                });
                
                addSystemMessage(userList);
                
                // Online sayacƒ±nƒ± g√ºncelle
                const onlineCount = Object.keys(users).length;
                document.getElementById('onlineCount').textContent = onlineCount;
                document.getElementById('chatOnlineCount').textContent = onlineCount;
                
            } catch (error) {
                console.error("Online kullanƒ±cƒ± y√ºkleme hatasƒ±:", error);
            }
        }

        function showChannelList() {
            let channelList = "üé¨ **KANALLAR**\n\n";
            
            Object.entries(channels).forEach(([id, channel]) => {
                channelList += `${channel.type === 'private' ? 'üîí' : 'üåç'} ${channel.name}\n`;
            });
            
            addSystemMessage(channelList);
        }

        function openAdminPanel() {
            if (!isAdmin && !isCoAdmin && !isOperator) {
                addSystemMessage("‚ö†Ô∏è Bu panele eri≈üim yetkiniz yok!");
                return;
            }
            
            openModal('adminPanelModal');
            showUserManagement();
        }

        async function showUserManagement() {
            try {
                const snapshot = await database.ref('registeredUsers').once('value');
                const users = snapshot.val() || {};
                
                let html = '<h3 style="margin-bottom: 16px;">üë• Kayƒ±tlƒ± Kullanƒ±cƒ±lar</h3>';
                
                Object.entries(users).forEach(([username, userData]) => {
                    html += `
                        <div style="display: flex; align-items: center; justify-content: space-between; padding: 12px; background: var(--bg-card); border-radius: var(--radius-md); margin-bottom: 8px;">
                            <div>
                                <strong>${username}</strong><br>
                                <small style="color: var(--text-secondary);">${userData.role || 'user'}</small>
                            </div>
                            <div>
                                <button class="action-btn" onclick="changeUserRole('${username}')">Rol Deƒüi≈ütir</button>
                                <button class="action-btn" onclick="deleteUser('${username}')">Sil</button>
                            </div>
                        </div>
                    `;
                });
                
                document.getElementById('adminPanelContent').innerHTML = html;
                
            } catch (error) {
                console.error("Kullanƒ±cƒ± y√∂netimi hatasƒ±:", error);
            }
        }

        async function banUser(username, reason) {
            if (!isAdmin && !isCoAdmin) {
                addSystemMessage("‚ö†Ô∏è Ban yetkiniz yok!");
                return;
            }
            
            try {
                await database.ref('bans/' + username).set({
                    bannedBy: currentUser.name,
                    reason: reason || 'Belirtilmemi≈ü',
                    timestamp: Date.now(),
                    expiresAt: Date.now() + (24 * 60 * 60 * 1000) // 24 saat
                });
                
                // Online kullanƒ±cƒ±dan √ßƒ±kar
                await database.ref('onlineUsers/' + username).remove();
                
                addSystemMessage(`üö´ ${username} kullanƒ±cƒ±sƒ± banlandƒ±!`);
                
            } catch (error) {
                console.error("Ban hatasƒ±:", error);
                addSystemMessage("‚ùå Ban i≈ülemi ba≈üarƒ±sƒ±z!");
            }
        }

        async function kickUser(username, reason) {
            if (!isAdmin && !isCoAdmin && !isOperator) {
                addSystemMessage("‚ö†Ô∏è Kick yetkiniz yok!");
                return;
            }
            
            try {
                await database.ref('onlineUsers/' + username).remove();
                addSystemMessage(`üë¢ ${username} kullanƒ±cƒ±sƒ± atƒ±ldƒ±!`);
                
            } catch (error) {
                console.error("Kick hatasƒ±:", error);
                addSystemMessage("‚ùå Kick i≈ülemi ba≈üarƒ±sƒ±z!");
            }
        }

        async function clearChat() {
            if (!isAdmin && !isCoAdmin && !isOperator) {
                addSystemMessage("‚ö†Ô∏è Bu i≈ülem i√ßin yetkiniz yok!");
                return;
            }
            
            if (confirm("T√ºm mesajlarƒ± temizlemek istediƒüinize emin misiniz?")) {
                try {
                    await database.ref('channels/' + currentChannel + '/messages').remove();
                    addSystemMessage("‚úÖ Sohbet temizlendi!");
                } catch (error) {
                    console.error("Sohbet temizleme hatasƒ±:", error);
                    addSystemMessage("‚ùå Sohbet temizlenemedi!");
                }
            }
        }

        // ========== SAYFA Y√úKLENDƒ∞ƒûƒ∞NDE ==========
        window.addEventListener('load', function() {
            // Tema y√ºkle
            const savedTheme = localStorage.getItem('theme') || 'default';
            if (savedTheme === 'night') {
                document.body.classList.add('night-mode');
            } else if (savedTheme === 'light') {
                document.body.classList.add('light-mode');
            }
            
            // Firebase ba≈ülat
            initializeFirebase();
            
            // YouTube API kontrol√º
            if (typeof YT === 'undefined') {
                const tag = document.createElement('script');
                tag.src = "https://www.youtube.com/iframe_api";
                const firstScriptTag = document.getElementsByTagName('script')[0];
                firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
            }
            
            // Enter tu≈üu ile mesaj g√∂nderme
            document.getElementById('messageInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
            
            // Giri≈ü input'unda Enter
            document.getElementById('loginNick').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    login();
                }
            });
            
            // Modal overlay tƒ±klama
            document.getElementById('modalOverlay').addEventListener('click', function() {
                const modals = document.querySelectorAll('.modal.active');
                modals.forEach(modal => {
                    modal.classList.remove('active');
                });
                this.style.display = 'none';
            });
        });

        // ========== GLOBAL FONKSƒ∞YONLAR ==========
        window.login = login;
        window.sendMessage = sendMessage;
        window.toggleStoryBar = toggleStoryBar;
        window.toggleNotificationPanel = toggleNotificationPanel;
        window.toggleReportPanel = toggleReportPanel;
        window.toggleTheme = toggleTheme;
        window.toggleSidebar = toggleSidebar;
        window.openCreateChannelModal = openCreateChannelModal;
        window.createChannel = createChannel;
        window.openStoryModal = openStoryModal;
        window.createStory = createStory;
        window.openPrivateChat = openPrivateChat;
        window.openImageUpload = openImageUpload;
        window.closeModal = closeModal;
        window.closeNotificationPanel = closeNotificationPanel;
        window.closeReportPanel = closeReportPanel;
        window.deleteMessage = deleteMessage;
        window.reportMessage = reportMessage;
        window.previewStoryImage = previewStoryImage;
    </script>
    
    <!-- YouTube IFrame API -->
    <script src="https://www.youtube.com/iframe_api"></script>
</body>
</html>
