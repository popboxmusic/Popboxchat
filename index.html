<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EliteChat - Profesyonel IRC Platformu</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* === TEMEL STÄ°LLER === */
        :root {
            --bg-primary: #0a0a0a; --bg-secondary: #111111; --bg-tertiary: #1a1a1a;
            --text-primary: #ffffff; --text-secondary: #b0b0b0; --accent-blue: #3b82f6;
            --accent-green: #10b981; --accent-red: #ef4444; --border-light: #222222;
            --accent-purple: #8b5cf6; --accent-yellow: #f59e0b;
        }
        body.day-mode {
            --bg-primary: #f8fafc; --bg-secondary: #ffffff; --bg-tertiary: #f1f5f9;
            --text-primary: #0f172a; --text-secondary: #475569; --border-light: #e2e8f0;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body, html { height: 100%; width: 100%; overflow: hidden; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: var(--bg-primary); color: var(--text-primary);
            display: flex; flex-direction: column;
        }
        body::before {
            content: ''; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-image: 
                radial-gradient(circle at 25px 25px, rgba(255, 255, 255, 0.05) 2%, transparent 2.5%),
                radial-gradient(circle at 75px 75px, rgba(255, 255, 255, 0.05) 2%, transparent 2.5%);
            background-size: 100px 100px; pointer-events: none; z-index: -1;
        }
        body.day-mode::before {
            background-image: 
                radial-gradient(circle at 25px 25px, rgba(0, 0, 0, 0.03) 2%, transparent 2.5%),
                radial-gradient(circle at 75px 75px, rgba(0, 0, 0, 0.03) 2%, transparent 2.5%);
        }
        
        /* === GÄ°RÄ°Åž EKRANI === */
        .login-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.95); display: flex; align-items: center;
            justify-content: center; z-index: 1000;
        }
        .login-container {
            background: var(--bg-secondary); padding: 40px; border-radius: 12px;
            width: 420px; max-width: 90%; border: 1px solid var(--border-light);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }
        .login-input {
            width: 100%; padding: 14px; margin: 12px 0; background: var(--bg-tertiary);
            border: 1px solid var(--border-light); color: var(--text-primary);
            border-radius: 8px; font-size: 15px;
        }
        .login-btn {
            width: 100%; padding: 14px; background: var(--accent-blue); color: white;
            border: none; border-radius: 8px; cursor: pointer; font-size: 15px;
            font-weight: 600; margin-top: 15px; transition: background 0.2s;
        }
        .login-btn:hover { background: #2563eb; }
        
        /* === ANA UYGULAMA === */
        .app-container { display: flex; flex-direction: column; height: 100vh; width: 100vw; overflow: hidden; }
        
        /* ÃœST BAR */
        .top-bar {
            display: flex; height: 70px; min-height: 70px; background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-light); padding: 0 25px;
            align-items: center; justify-content: space-between; flex-shrink: 0;
        }
        .channel-tabs { display: flex; gap: 8px; overflow-x: auto; max-width: 600px; padding: 5px 0; flex: 1; margin: 0 20px; }
        .channel-tab {
            padding: 10px 18px; background: var(--bg-tertiary); border-radius: 8px;
            cursor: pointer; white-space: nowrap; font-size: 14px; transition: all 0.2s;
            border: 1px solid var(--border-light);
        }
        .channel-tab:hover { background: var(--bg-primary); }
        .channel-tab.active { background: var(--accent-blue); color: white; border-color: var(--accent-blue); }
        
        /* ANA Ä°Ã‡ERÄ°K */
        .main-content { display: flex; flex: 1; overflow: hidden; min-height: 0; }
        
        /* SOL PANEL - Online Listesi & Ã–zel Sohbetler */
        .left-panel {
            width: 320px; min-width: 320px; background: var(--bg-secondary);
            border-right: 1px solid var(--border-light); display: flex;
            flex-direction: column; flex-shrink: 0;
        }
        .panel-tabs {
            display: flex; border-bottom: 1px solid var(--border-light);
        }
        .panel-tab {
            flex: 1; padding: 15px; text-align: center; cursor: pointer;
            background: var(--bg-tertiary); border: none; color: var(--text-primary);
            font-weight: 500; transition: all 0.2s;
        }
        .panel-tab.active {
            background: var(--bg-secondary); border-bottom: 2px solid var(--accent-blue);
        }
        .panel-content {
            flex: 1; overflow-y: auto; display: flex; flex-direction: column;
        }
        .panel-section {
            padding: 20px; border-bottom: 1px solid var(--border-light);
        }
        .panel-section h3 {
            font-size: 14px; color: var(--text-secondary); margin-bottom: 15px;
            text-transform: uppercase; letter-spacing: 0.5px;
        }
        
        /* KullanÄ±cÄ± Listesi */
        .user-list { flex: 1; padding: 10px; }
        .user-item {
            padding: 12px; border-radius: 8px; cursor: pointer; display: flex;
            align-items: center; gap: 12px; margin-bottom: 8px; transition: all 0.2s;
            border: 1px solid transparent;
        }
        .user-item:hover {
            background: var(--bg-tertiary); border-color: var(--border-light);
        }
        .user-item.active {
            background: var(--accent-blue); color: white; border-color: var(--accent-blue);
        }
        .user-item.active .user-status { color: rgba(255,255,255,0.8); }
        .user-avatar {
            width: 40px; height: 40px; border-radius: 50%; 
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            display: flex; align-items: center; justify-content: center; color: white;
            font-weight: bold; font-size: 16px; flex-shrink: 0; position: relative;
        }
        .user-avatar.online::after {
            content: ''; position: absolute; bottom: 0; right: 0;
            width: 10px; height: 10px; background: var(--accent-green);
            border-radius: 50%; border: 2px solid var(--bg-secondary);
        }
        .user-info { flex: 1; min-width: 0; }
        .user-name { 
            font-weight: 600; font-size: 14px; margin-bottom: 2px;
            display: flex; align-items: center; gap: 6px;
        }
        .user-status { font-size: 12px; color: var(--text-secondary); }
        
        /* Ã–zel Sohbet Listesi */
        .pm-list { padding: 10px; }
        .pm-item {
            padding: 12px; border-radius: 8px; cursor: pointer; display: flex;
            align-items: center; gap: 12px; margin-bottom: 8px; transition: all 0.2s;
            border: 1px solid var(--border-light); background: var(--bg-tertiary);
        }
        .pm-item:hover { background: var(--bg-primary); }
        .pm-item.unread { border-color: var(--accent-blue); background: rgba(59, 130, 246, 0.1); }
        .pm-avatar {
            width: 36px; height: 36px; border-radius: 50%; 
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-blue));
            display: flex; align-items: center; justify-content: center; color: white;
            font-weight: bold; font-size: 14px; flex-shrink: 0;
        }
        .pm-info { flex: 1; min-width: 0; }
        .pm-name { font-weight: 600; font-size: 13px; margin-bottom: 2px; }
        .pm-preview { 
            font-size: 12px; color: var(--text-secondary);
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }
        .pm-time {
            font-size: 10px; color: var(--text-secondary); margin-left: 8px;
        }
        
        /* ORTA PANEL - Sohbet */
        .chat-panel { flex: 1; display: flex; flex-direction: column; min-width: 0; }
        .chat-header {
            padding: 0 25px; height: 70px; border-bottom: 1px solid var(--border-light);
            display: flex; align-items: center; justify-content: space-between;
            background: var(--bg-secondary); flex-shrink: 0;
        }
        .chat-header-info { flex: 1; }
        .chat-header-actions { display: flex; gap: 10px; }
        .chat-messages { 
            flex: 1; overflow-y: auto; padding: 20px; background: var(--bg-primary);
            display: flex; flex-direction: column;
        }
        .message { 
            margin-bottom: 15px; max-width: 75%; animation: fadeIn 0.3s ease;
            display: flex; flex-direction: column;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .message-outgoing { 
            margin-left: auto; align-items: flex-end;
        }
        .message-incoming { align-items: flex-start; }
        .message-sender { 
            font-size: 12px; color: var(--text-secondary); margin-bottom: 4px;
            display: flex; align-items: center; gap: 8px;
        }
        .message-text {
            background: var(--bg-tertiary); padding: 12px 16px; border-radius: 12px;
            font-size: 14px; line-height: 1.5; word-break: break-word;
            max-width: 100%;
        }
        .message-outgoing .message-text { 
            background: var(--accent-blue); color: white; 
            border-bottom-right-radius: 4px;
        }
        .message-incoming .message-text { border-bottom-left-radius: 4px; }
        .message-time {
            font-size: 10px; color: var(--text-secondary); margin-top: 4px;
            opacity: 0.7;
        }
        .message-media {
            margin-top: 8px; border-radius: 8px; overflow: hidden;
            max-width: 300px; cursor: pointer;
        }
        .message-media img, .message-media video {
            width: 100%; height: auto; display: block;
        }
        .chat-input-area {
            padding: 20px; border-top: 1px solid var(--border-light); 
            background: var(--bg-secondary); flex-shrink: 0;
        }
        .message-input-container {
            display: flex; gap: 10px; align-items: flex-end;
        }
        .message-input {
            flex: 1; padding: 14px; background: var(--bg-tertiary); 
            border: 1px solid var(--border-light); color: var(--text-primary);
            border-radius: 10px; resize: none; font-size: 14px; line-height: 1.5;
            min-height: 60px; max-height: 150px; font-family: inherit;
        }
        .message-input:focus { outline: none; border-color: var(--accent-blue); }
        .input-actions {
            display: flex; justify-content: space-between; margin-top: 12px;
        }
        .media-buttons {
            display: flex; gap: 8px;
        }
        .media-btn {
            padding: 8px 12px; background: var(--bg-tertiary); 
            border: 1px solid var(--border-light); border-radius: 6px;
            color: var(--text-primary); cursor: pointer; font-size: 13px;
            display: flex; align-items: center; gap: 6px; transition: all 0.2s;
        }
        .media-btn:hover {
            background: var(--bg-primary); border-color: var(--accent-blue);
        }
        
        /* SAÄž PANEL - Video */
        .right-panel {
            width: 400px; min-width: 400px; background: #000; 
            display: flex; flex-direction: column; flex-shrink: 0;
            border-left: 1px solid #333;
        }
        .video-header { 
            padding: 15px; background: rgba(0, 0, 0, 0.9); color: white; 
            border-bottom: 1px solid #333; flex-shrink: 0;
            display: flex; justify-content: space-between; align-items: center;
        }
        .video-container { 
            flex: 1; background: #000; position: relative; min-height: 0;
            display: flex; align-items: center; justify-content: center;
        }
        .youtube-video { 
            width: 100%; height: 100%; border: none; display: block;
        }
        .video-controls { 
            padding: 15px; background: rgba(0, 0, 0, 0.9); 
            border-top: 1px solid #333; flex-shrink: 0;
        }
        .video-info {
            display: flex; justify-content: space-between; align-items: center;
            font-size: 13px; color: rgba(255,255,255,0.7);
        }
        
        /* BUTONLAR */
        .btn {
            padding: 8px 16px; border-radius: 6px; border: none; 
            cursor: pointer; font-size: 13px; font-weight: 500; 
            transition: all 0.2s; display: inline-flex; align-items: center; gap: 6px;
        }
        .btn-sm { padding: 6px 12px; font-size: 12px; }
        .btn-primary { background: var(--accent-blue); color: white; }
        .btn-primary:hover { background: #2563eb; }
        .btn-secondary { 
            background: var(--bg-tertiary); color: var(--text-primary); 
            border: 1px solid var(--border-light);
        }
        .btn-secondary:hover { background: var(--bg-primary); }
        .btn-success { background: var(--accent-green); color: white; }
        .btn-success:hover { background: #059669; }
        .btn-danger { background: var(--accent-red); color: white; }
        .btn-danger:hover { background: #dc2626; }
        .btn-warning { background: var(--accent-yellow); color: white; }
        .btn-warning:hover { background: #d97706; }
        
        /* MODALLAR */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.8); display: none; align-items: center;
            justify-content: center; z-index: 2000; backdrop-filter: blur(5px);
        }
        .modal-content {
            background: var(--bg-secondary); padding: 24px; border-radius: 12px;
            max-width: 500px; width: 90%; max-height: 90vh; overflow-y: auto;
            border: 1px solid var(--border-light); box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
        }
        
        /* KAMERA MODALI */
        .camera-modal {
            max-width: 800px;
        }
        .camera-preview-container {
            width: 100%; height: 400px; background: #000; border-radius: 8px;
            overflow: hidden; margin-bottom: 15px; position: relative;
        }
        .camera-preview {
            width: 100%; height: 100%; object-fit: cover;
        }
        .camera-controls {
            display: flex; justify-content: center; gap: 15px; margin-top: 15px;
        }
        .camera-btn {
            padding: 10px 20px; border-radius: 50px; border: none;
            background: var(--accent-blue); color: white; cursor: pointer;
            font-weight: 500; display: flex; align-items: center; gap: 8px;
        }
        .camera-btn.danger { background: var(--accent-red); }
        .camera-btn.warning { background: var(--accent-yellow); }
        
        /* UTILITIES */
        .hidden { display: none !important; }
        .text-sm { font-size: 13px; }
        .text-muted { color: var(--text-secondary); }
        .flex { display: flex; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .gap-2 { gap: 8px; }
        .gap-3 { gap: 12px; }
        .w-full { width: 100%; }
        
        /* SCROLLBAR */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg-tertiary); border-radius: 3px; }
        ::-webkit-scrollbar-thumb { background: var(--border-light); border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #444; }
        
        /* ROL BADGELERÄ° */
        .role-badge {
            font-size: 10px; padding: 1px 6px; border-radius: 10px; 
            margin-left: 4px; font-weight: 600;
        }
        .role-owner { background: linear-gradient(135deg, var(--accent-purple), #3b82f6); color: white; }
        .role-admin { background: var(--accent-blue); color: white; }
        .role-coadmin { background: var(--accent-yellow); color: white; }
        .role-operator { background: var(--accent-green); color: white; }
        .role-voice { background: var(--accent-purple); color: white; opacity: 0.9; }
        
        /* RESPONSIVE */
        @media (max-width: 1200px) {
            .right-panel { width: 350px; min-width: 350px; }
            .left-panel { width: 280px; min-width: 280px; }
        }
        @media (max-width: 992px) {
            .right-panel { display: none; }
            .left-panel { width: 250px; min-width: 250px; }
        }
        @media (max-width: 768px) {
            .left-panel { display: none; }
            .channel-tabs { max-width: 300px; }
            .top-bar { padding: 0 15px; }
        }
        @media (max-width: 480px) {
            .channel-tabs { max-width: 200px; }
            .chat-header { padding: 0 15px; }
            .chat-messages { padding: 15px; }
            .chat-input-area { padding: 15px; }
        }
        
        /* Ã–ZEL SOHBET PENCERESÄ° */
        .pm-window {
            position: fixed; bottom: 0; right: 400px; width: calc(100% - 400px - 320px);
            height: 80vh; background: var(--bg-secondary); border-radius: 12px 12px 0 0;
            border: 1px solid var(--border-light); border-bottom: none;
            box-shadow: 0 -10px 30px rgba(0,0,0,0.3); display: flex; flex-direction: column;
            z-index: 100; transition: transform 0.3s ease;
        }
        @media (max-width: 992px) {
            .pm-window { right: 0; width: 100%; }
        }
        .pm-window.minimized { transform: translateY(calc(100% - 50px)); }
        .pm-window-header {
            padding: 15px; border-bottom: 1px solid var(--border-light); 
            background: var(--bg-tertiary); display: flex; justify-content: space-between;
            align-items: center; cursor: pointer;
        }
        .pm-window-messages {
            flex: 1; overflow-y: auto; padding: 20px; background: var(--bg-primary);
        }
        .pm-window-input {
            padding: 15px; border-top: 1px solid var(--border-light); 
            background: var(--bg-secondary);
        }
        
        /* LOADING */
        .loading { 
            display: inline-block; width: 20px; height: 20px;
            border: 2px solid var(--border-light); border-top-color: var(--accent-blue);
            border-radius: 50%; animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="night-mode">
    <!-- GÄ°RÄ°Åž EKRANI -->
    <div id="loginScreen" class="login-screen">
        <div class="login-container">
            <div style="text-align: center; margin-bottom: 30px;">
                <div style="width: 80px; height: 80px; background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple)); border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; color: white; font-size: 32px; font-weight: bold; margin-bottom: 15px;">EC</div>
                <h1 style="font-size: 28px; margin-bottom: 8px;">EliteChat</h1>
                <p class="text-muted">Profesyonel IRC Platformu</p>
            </div>
            
            <input type="text" id="nickInput" class="login-input" placeholder="KullanÄ±cÄ± adÄ±" autofocus>
            <input type="password" id="passInput" class="login-input" placeholder="Åžifre (isteÄŸe baÄŸlÄ±)">
            
            <button class="login-btn" id="loginButton">
                <i class="fas fa-sign-in-alt"></i> GiriÅŸ Yap
            </button>
            
            <div style="margin-top: 25px; padding-top: 20px; border-top: 1px solid var(--border-light);">
                <p class="text-sm text-muted" style="text-align: center;">
                    <strong>Ä°lk GiriÅŸ:</strong><br>
                    Nickinizi ve ÅŸifrenizi belirleyin<br>
                    Åžifre opsiyonel - ÅŸifresiz giriÅŸ misafir olur
                </p>
            </div>
        </div>
    </div>

    <!-- ANA UYGULAMA -->
    <div id="app" class="hidden">
        <div class="app-container">
            <!-- ÃœST BAR -->
            <div class="top-bar">
                <div class="flex items-center gap-3">
                    <div style="width: 36px; height: 36px; background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple)); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">EC</div>
                    <span style="font-size: 18px; font-weight: 600;">EliteChat</span>
                </div>

                <!-- KANAL SEKMELERÄ° -->
                <div class="channel-tabs" id="channelTabs">
                    <div class="channel-tab active" data-channel="general">
                        <i class="fas fa-hashtag"></i> Genel
                    </div>
                </div>

                <div class="flex items-center gap-2">
                    <button id="createChannelBtn" class="btn btn-success btn-sm">
                        <i class="fas fa-plus"></i> Kanal AÃ§
                    </button>
                    <button id="settingsBtn" class="btn btn-secondary btn-sm">
                        <i class="fas fa-cog"></i>
                    </button>
                    <button id="themeBtn" class="btn btn-secondary btn-sm">
                        <i class="fas fa-moon"></i>
                    </button>
                </div>
            </div>

            <!-- ANA Ä°Ã‡ERÄ°K -->
            <div class="main-content">
                <!-- SOL PANEL -->
                <div class="left-panel">
                    <div class="panel-tabs">
                        <button class="panel-tab active" data-panel="online">
                            <i class="fas fa-users"></i> Online
                        </button>
                        <button class="panel-tab" data-panel="pm">
                            <i class="fas fa-comments"></i> Ã–zel
                        </button>
                    </div>
                    
                    <!-- ONLINE LÄ°STESÄ° -->
                    <div class="panel-content" id="onlinePanel">
                        <div class="panel-section">
                            <h3>Ã‡evrimiÃ§i KullanÄ±cÄ±lar <span id="onlineCount">(0)</span></h3>
                            <div class="user-list" id="userList">
                                <!-- KullanÄ±cÄ±lar buraya gelecek -->
                            </div>
                        </div>
                        
                        <div class="panel-section">
                            <h3>Kanal Bilgisi</h3>
                            <div style="font-size: 13px;">
                                <div style="margin-bottom: 8px;">
                                    <strong>Kanal:</strong> <span id="panelChannelName">#Genel</span>
                                </div>
                                <div style="margin-bottom: 8px;">
                                    <strong>Konu:</strong> <span id="panelChannelTopic">EliteChat HoÅŸ Geldiniz</span>
                                </div>
                                <div>
                                    <strong>Video:</strong> <span id="panelChannelVideo">Lofi Hip Hop Radio ðŸ“š</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Ã–ZEL MESAJ LÄ°STESÄ° -->
                    <div class="panel-content hidden" id="pmPanel">
                        <div class="panel-section">
                            <h3>Ã–zel Sohbetler</h3>
                            <div class="pm-list" id="pmConversationList">
                                <!-- Ã–zel sohbetler buraya gelecek -->
                            </div>
                        </div>
                        
                        <div class="panel-section">
                            <button id="newPmBtn" class="btn btn-primary w-full">
                                <i class="fas fa-plus"></i> Yeni Ã–zel Sohbet
                            </button>
                        </div>
                    </div>
                </div>

                <!-- ORTA PANEL - SOHBET -->
                <div class="chat-panel">
                    <div class="chat-header">
                        <div class="chat-header-info">
                            <h2 style="font-size: 18px; margin-bottom: 4px;">
                                <i class="fas fa-hashtag"></i> <span id="currentChannel">Genel</span>
                            </h2>
                            <p class="text-muted" style="font-size: 14px;">
                                <span id="channelUsers">0</span> kullanÄ±cÄ± â€¢ 
                                <span id="channelTopic">EliteChat HoÅŸ Geldiniz</span>
                            </p>
                        </div>
                        <div class="chat-header-actions">
                            <button id="videoManagerBtn" class="btn btn-secondary btn-sm">
                                <i class="fas fa-video"></i> Video
                            </button>
                            <button id="channelInfoBtn" class="btn btn-secondary btn-sm">
                                <i class="fas fa-info-circle"></i>
                            </button>
                        </div>
                    </div>

                    <div class="chat-messages" id="chatMessages">
                        <div style="text-align: center; padding: 40px 20px; color: var(--text-secondary);">
                            <i class="fas fa-comments" style="font-size: 48px; margin-bottom: 15px; opacity: 0.5;"></i>
                            <h3 style="margin-bottom: 10px;">EliteChat'e HoÅŸ Geldiniz</h3>
                            <p>Mesaj yazmaya baÅŸlayÄ±n veya birine Ã¶zel mesaj gÃ¶nderin</p>
                        </div>
                    </div>

                    <div class="chat-input-area">
                        <div class="message-input-container">
                            <textarea class="message-input" id="messageInput" 
                                      placeholder="Mesaj yazÄ±n... (IRC komutlarÄ± iÃ§in / kullanÄ±n)" 
                                      rows="3"></textarea>
                        </div>
                        <div class="input-actions">
                            <div class="media-buttons">
                                <button class="media-btn" id="imageBtn">
                                    <i class="fas fa-image"></i> Resim
                                </button>
                                <button class="media-btn" id="videoBtn">
                                    <i class="fas fa-video"></i> Video
                                </button>
                                <button class="media-btn" id="fileBtn">
                                    <i class="fas fa-paperclip"></i> Dosya
                                </button>
                            </div>
                            <button id="sendBtn" class="btn btn-primary">
                                <i class="fas fa-paper-plane"></i> GÃ¶nder
                            </button>
                        </div>
                    </div>
                </div>

                <!-- SAÄž PANEL - VÄ°DEO -->
                <div class="right-panel">
                    <div class="video-header">
                        <div>
                            <h3 style="font-size: 16px; margin-bottom: 2px;">
                                <i class="fas fa-play-circle"></i> <span id="videoTitle">Lofi Hip Hop Radio ðŸ“š</span>
                            </h3>
                            <p style="font-size: 12px; color: rgba(255,255,255,0.7);">
                                <i class="fas fa-hashtag"></i> <span id="videoChannel">Genel</span>
                            </p>
                        </div>
                        <div class="flex gap-2">
                            <button id="changeVideoBtn" class="btn btn-sm" style="background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.2);">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button id="fullscreenBtn" class="btn btn-sm" style="background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.2);">
                                <i class="fas fa-expand"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="video-container">
                        <iframe class="youtube-video" id="youtubePlayer" 
                                src="https://www.youtube.com/embed/jfKfPfyJRdk?autoplay=1&mute=1&rel=0&controls=1&modestbranding=1" 
                                frameborder="0" 
                                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                                allowfullscreen>
                        </iframe>
                    </div>
                    
                    <div class="video-controls">
                        <div class="video-info">
                            <div>
                                <i class="fas fa-eye"></i> <span id="viewerCount">1.2K</span> izleyici
                            </div>
                            <div>
                                <i class="fas fa-clock"></i> 24/7
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODALLAR -->
    <!-- Video DeÄŸiÅŸtirme Modal -->
    <div id="videoModal" class="modal-overlay">
        <div class="modal-content">
            <div class="flex items-center justify-between" style="margin-bottom: 20px;">
                <h3 style="font-size: 18px;">Video YÃ¶netimi</h3>
                <button id="closeVideoModal" style="background: none; border: none; color: var(--text-secondary); font-size: 24px; cursor: pointer;">Ã—</button>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px;">
                    YouTube URL veya Video ID
                </label>
                <input type="text" id="videoUrl" class="login-input" 
                       placeholder="Ã–rnek: https://youtube.com/watch?v=VIDEO_ID veya sadece VIDEO_ID">
            </div>
            
            <div style="margin-bottom: 25px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px;">
                    Video BaÅŸlÄ±ÄŸÄ±
                </label>
                <input type="text" id="videoTitleInput" class="login-input" 
                       placeholder="Video baÅŸlÄ±ÄŸÄ± (isteÄŸe baÄŸlÄ±)">
            </div>
            
            <div class="flex gap-2">
                <button id="cancelVideo" class="btn btn-secondary" style="flex: 1;">Ä°ptal</button>
                <button id="saveVideo" class="btn btn-primary" style="flex: 1;">
                    <i class="fas fa-save"></i> Kaydet
                </button>
            </div>
        </div>
    </div>

    <!-- Kanal OluÅŸturma Modal -->
    <div id="channelModal" class="modal-overlay">
        <div class="modal-content">
            <div class="flex items-center justify-between" style="margin-bottom: 20px;">
                <h3 style="font-size: 18px;">Yeni Kanal OluÅŸtur</h3>
                <button id="closeChannelModal" style="background: none; border: none; color: var(--text-secondary); font-size: 24px; cursor: pointer;">Ã—</button>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px;">Kanal AdÄ±</label>
                <input type="text" id="channelName" class="login-input" placeholder="#kanal_adi">
            </div>
            
            <div style="margin-bottom: 25px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px;">Kanal TÃ¼rÃ¼</label>
                <select id="channelType" class="login-input">
                    <option value="public">Public - Herkes katÄ±labilir</option>
                    <option value="private">Private - Sadece davetliler</option>
                    <option value="secret">Secret - Gizli kanal</option>
                </select>
            </div>
            
            <div style="margin-bottom: 25px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px;">Kanal Konusu</label>
                <input type="text" id="channelTopicInput" class="login-input" placeholder="Kanal konusu">
            </div>
            
            <div class="flex gap-2">
                <button id="cancelChannel" class="btn btn-secondary" style="flex: 1;">Ä°ptal</button>
                <button id="createChannel" class="btn btn-success" style="flex: 1;">
                    <i class="fas fa-plus"></i> OluÅŸtur
                </button>
            </div>
        </div>
    </div>

    <!-- Yeni Ã–zel Sohbet Modal -->
    <div id="newPmModal" class="modal-overlay">
        <div class="modal-content">
            <div class="flex items-center justify-between" style="margin-bottom: 20px;">
                <h3 style="font-size: 18px;">Yeni Ã–zel Sohbet</h3>
                <button id="closeNewPmModal" style="background: none; border: none; color: var(--text-secondary); font-size: 24px; cursor: pointer;">Ã—</button>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px;">KullanÄ±cÄ± AdÄ±</label>
                <input type="text" id="pmUserInput" class="login-input" placeholder="KullanÄ±cÄ± adÄ± yazÄ±n">
                <div id="pmUserSuggestions" style="margin-top: 10px; max-height: 200px; overflow-y: auto;"></div>
            </div>
            
            <div style="margin-bottom: 25px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px;">Ä°lk Mesaj</label>
                <textarea id="pmFirstMessage" class="login-input" placeholder="Ä°lk mesajÄ±nÄ±z..." rows="3"></textarea>
            </div>
            
            <div class="flex gap-2">
                <button id="cancelNewPm" class="btn btn-secondary" style="flex: 1;">Ä°ptal</button>
                <button id="startNewPm" class="btn btn-primary" style="flex: 1;">
                    <i class="fas fa-paper-plane"></i> BaÅŸlat
                </button>
            </div>
        </div>
    </div>

    <!-- Kanal Bilgisi Modal -->
    <div id="channelInfoModal" class="modal-overlay">
        <div class="modal-content">
            <div class="flex items-center justify-between" style="margin-bottom: 20px;">
                <h3 style="font-size: 18px;">Kanal Bilgisi</h3>
                <button id="closeChannelInfo" style="background: none; border: none; color: var(--text-secondary); font-size: 24px; cursor: pointer;">Ã—</button>
            </div>
            
            <div style="margin-bottom: 20px;">
                <div style="font-size: 14px; margin-bottom: 10px;">
                    <strong>Kanal:</strong> <span id="infoChannelName">#Genel</span>
                </div>
                <div style="font-size: 14px; margin-bottom: 10px;">
                    <strong>Konu:</strong> <span id="infoChannelTopic">EliteChat HoÅŸ Geldiniz</span>
                </div>
                <div style="font-size: 14px; margin-bottom: 10px;">
                    <strong>Sahibi:</strong> <span id="infoChannelOwner">System</span>
                </div>
                <div style="font-size: 14px; margin-bottom: 10px;">
                    <strong>TÃ¼r:</strong> <span id="infoChannelType">Public</span>
                </div>
                <div style="font-size: 14px; margin-bottom: 10px;">
                    <strong>Video:</strong> <span id="infoChannelVideo">Lofi Hip Hop Radio ðŸ“š</span>
                </div>
                <div style="font-size: 14px;">
                    <strong>KullanÄ±cÄ±lar:</strong> <span id="infoChannelUsers">0</span>
                </div>
            </div>
            
            <div id="channelInfoActions" class="flex gap-2">
                <!-- Yetkili butonlarÄ± buraya dinamik eklenecek -->
            </div>
        </div>
    </div>

    <!-- Ayarlar Modal -->
    <div id="settingsModal" class="modal-overlay">
        <div class="modal-content">
            <div class="flex items-center justify-between" style="margin-bottom: 20px;">
                <h3 style="font-size: 18px;">Ayarlar</h3>
                <button id="closeSettings" style="background: none; border: none; color: var(--text-secondary); font-size: 24px; cursor: pointer;">Ã—</button>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px;">KullanÄ±cÄ± AdÄ±</label>
                <input type="text" id="settingsNick" class="login-input" value="">
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px;">Avatar</label>
                <div style="display: flex; align-items: center; gap: 15px;">
                    <div id="settingsAvatar" style="width: 60px; height: 60px; border-radius: 50%; background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple)); display: flex; align-items: center; justify-content: center; color: white; font-size: 24px; font-weight: bold; cursor: pointer;"></div>
                    <button id="changeAvatarBtn" class="btn btn-secondary">
                        <i class="fas fa-edit"></i> DeÄŸiÅŸtir
                    </button>
                </div>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px;">Biyografi</label>
                <textarea id="settingsBio" class="login-input" placeholder="Kendinizden bahsedin..." rows="3"></textarea>
            </div>
            
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 25px; padding: 15px; background: var(--bg-tertiary); border-radius: 8px;">
                <div>
                    <div style="font-weight: 500; font-size: 14px;">GÃ¶rÃ¼nmez Mod</div>
                    <div class="text-sm text-muted">Ã‡evrimiÃ§i gÃ¶rÃ¼nmez olun</div>
                </div>
                <label style="position: relative; display: inline-block; width: 50px; height: 26px;">
                    <input type="checkbox" id="settingsInvisible" style="opacity: 0; width: 0; height: 0;">
                    <span style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background: var(--bg-primary); border-radius: 34px; transition: .4s;"></span>
                    <span style="position: absolute; content: ''; height: 18px; width: 18px; left: 4px; bottom: 4px; background: white; border-radius: 50%; transition: .4s;"></span>
                </label>
            </div>
            
            <div class="flex gap-2">
                <button id="cancelSettings" class="btn btn-secondary" style="flex: 1;">Ä°ptal</button>
                <button id="saveSettings" class="btn btn-primary" style="flex: 1;">
                    <i class="fas fa-save"></i> Kaydet
                </button>
            </div>
        </div>
    </div>

    <!-- KAMERA MODALI -->
    <div id="cameraModal" class="modal-overlay">
        <div class="modal-content camera-modal">
            <div class="flex items-center justify-between" style="margin-bottom: 20px;">
                <h3 style="font-size: 18px;">Kamera</h3>
                <button id="closeCameraModal" style="background: none; border: none; color: var(--text-secondary); font-size: 24px; cursor: pointer;">Ã—</button>
            </div>
            
            <div class="camera-preview-container">
                <video id="cameraPreview" class="camera-preview" autoplay playsinline></video>
                <canvas id="cameraCanvas" style="display: none;"></canvas>
            </div>
            
            <div class="camera-controls">
                <button id="switchCameraBtn" class="camera-btn warning">
                    <i class="fas fa-sync-alt"></i> Kamera DeÄŸiÅŸtir
                </button>
                <button id="captureImageBtn" class="camera-btn">
                    <i class="fas fa-camera"></i> FotoÄŸraf Ã‡ek
                </button>
                <button id="recordVideoBtn" class="camera-btn danger">
                    <i class="fas fa-video"></i> Video Kaydet
                </button>
                <button id="stopRecordingBtn" class="camera-btn danger" style="display: none;">
                    <i class="fas fa-stop"></i> Durdur
                </button>
            </div>
            
            <div id="cameraPreviewArea" style="margin-top: 20px; display: none;">
                <!-- Ã–nizleme buraya gelecek -->
            </div>
            
            <div class="flex gap-2" style="margin-top: 20px;">
                <button id="cancelCamera" class="btn btn-secondary" style="flex: 1;">Ä°ptal</button>
                <button id="sendCameraMedia" class="btn btn-primary" style="flex: 1;" disabled>
                    <i class="fas fa-paper-plane"></i> GÃ¶nder
                </button>
            </div>
        </div>
    </div>

    <!-- DOSYA YÃœKLEME MODAL -->
    <div id="uploadModal" class="modal-overlay">
        <div class="modal-content">
            <div class="flex items-center justify-between" style="margin-bottom: 20px;">
                <h3 style="font-size: 18px;" id="uploadTitle">Dosya YÃ¼kle</h3>
                <button id="closeUploadModal" style="background: none; border: none; color: var(--text-secondary); font-size: 24px; cursor: pointer;">Ã—</button>
            </div>
            
            <div style="text-align: center; margin-bottom: 25px;">
                <div id="uploadDropZone" style="border: 2px dashed var(--border-light); border-radius: 12px; padding: 40px 20px; cursor: pointer; transition: all 0.2s;">
                    <i class="fas fa-cloud-upload-alt" style="font-size: 48px; color: var(--text-secondary); margin-bottom: 15px;"></i>
                    <div style="font-size: 16px; margin-bottom: 8px;">DosyayÄ± buraya sÃ¼rÃ¼kleyin</div>
                    <div class="text-sm text-muted">veya tÄ±klayarak seÃ§in</div>
                    <div class="text-sm text-muted" style="margin-top: 10px;">Max: 10MB</div>
                </div>
                <input type="file" id="fileInput" style="display: none;" accept="image/*,video/*,.mp4,.avi,.mov">
            </div>
            
            <div id="uploadPreview" style="display: none; margin-bottom: 20px;">
                <!-- Ã–nizleme buraya gelecek -->
            </div>
            
            <div id="uploadProgress" style="display: none; margin-bottom: 20px;">
                <div style="background: var(--bg-tertiary); height: 6px; border-radius: 3px; overflow: hidden;">
                    <div id="uploadProgressBar" style="background: var(--accent-blue); height: 100%; width: 0%; transition: width 0.3s;"></div>
                </div>
                <div style="text-align: center; margin-top: 8px; font-size: 12px; color: var(--text-secondary);">
                    <span id="uploadProgressText">%0</span>
                </div>
            </div>
            
            <div class="flex gap-2">
                <button id="cancelUpload" class="btn btn-secondary" style="flex: 1;">Ä°ptal</button>
                <button id="sendUpload" class="btn btn-primary" style="flex: 1;" disabled>
                    <i class="fas fa-paper-plane"></i> GÃ¶nder
                </button>
            </div>
        </div>
    </div>

    <!-- Ã–ZEL SOHBET PENCERESÄ° (Dinamik oluÅŸturulacak) -->

    <script>
        // ==================== GÃœVENLÄ°K FONKSÄ°YONLARI ====================
        function escapeHtml(text) {
            if (!text) return '';
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;',
                '`': '&#x60;',
                '=': '&#x3D;'
            };
            return String(text).replace(/[&<>"'`=]/g, m => map[m]);
        }

        function hashPassword(password) {
            // Basit bir hashleme (gerÃ§ek uygulamada bcrypt kullanÄ±lmalÄ±)
            if (!password) return '';
            let hash = 0;
            for (let i = 0; i < password.length; i++) {
                const char = password.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            return 'hashed_' + Math.abs(hash).toString(36);
        }

        function clearContainer(containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;
            while (container.firstChild) {
                container.removeChild(container.firstChild);
            }
        }

        // ==================== SÄ°STEM DEÄžÄ°ÅžKENLERÄ° ====================
        const SYSTEM = {
            currentUser: null,
            currentChannel: 'general',
            activePM: null,
            pmWindows: {},
            uploadType: null,
            theme: 'night',
            messageCounter: 1,
            intervals: [],
            cameraStream: null,
            mediaRecorder: null,
            recordedChunks: [],
            isRecording: false,
            facingMode: 'user'
        };

        const DATA = {
            users: {},
            channels: {
                general: {
                    id: 'general',
                    name: '#Genel',
                    owner: 'mate',
                    type: 'public',
                    topic: 'EliteChat HoÅŸ Geldiniz',
                    users: new Set(),
                    operators: new Set(),
                    voices: new Set(),
                    bans: new Map(),
                    mutes: new Map(),
                    slowmode: 0,
                    locked: false,
                    userLimit: 0,
                    messages: [],
                    video: { 
                        id: 'jfKfPfyJRdk', 
                        title: 'Lofi Hip Hop Radio ðŸ“š',
                        channel: 'Genel'
                    }
                }
            },
            privateMessages: new Map(),
            registeredUsers: new Map(),
            onlineUsers: new Set(),
            userChannels: new Map(),
            globalBans: new Set(),
            globalMutes: new Set()
        };

        // ==================== MATE BOT SÄ°STEMÄ° ====================
        class MateBot {
            constructor() {
                this.id = 'mate';
                this.name = 'ðŸ¤–Mate';
                this.role = 'owner';
                this.registered = true;
                this.online = true;
                this.invisible = false;
                this.avatar = 'M';
                this.bio = 'GÃ¼venlik Botu - Sadece gÃ¼venlik ve owner mesajlarÄ±nÄ± iletirim';
                this.joinDate = new Date();
                this.lastSeen = new Date();
                
                // Mate'i kullanÄ±cÄ± listesine ekle
                DATA.users[this.id] = this;
                DATA.onlineUsers.add(this.id);
                DATA.registeredUsers.set(this.id, {
                    password: hashPassword('mate123'),
                    role: 'owner',
                    bio: this.bio,
                    joinDate: this.joinDate
                });
                
                // TÃ¼m kanallara Mate'i ekle
                Object.values(DATA.channels).forEach(channel => {
                    channel.users.add(this.id);
                });
            }
            
            sendSecurityAlert(message, channelId = 'general') {
                const channel = DATA.channels[channelId];
                if (!channel) return;
                
                const alertMessage = {
                    id: 'alert_' + Date.now(),
                    type: 'security',
                    userId: this.id,
                    text: `ðŸ”’ **GÃœVENLÄ°K**: ${message}`,
                    time: new Date(),
                    channel: channelId
                };
                
                channel.messages.push(alertMessage);
                
                // EÄŸer kanal aktifse mesajÄ± gÃ¶ster
                if (SYSTEM.currentChannel === channelId) {
                    this.displayMessage(alertMessage);
                }
                
                // Owner'a Ã¶zel mesaj gÃ¶nder (eÄŸer owner online ise)
                if (DATA.users['mateky'] && DATA.users['mateky'].online) {
                    this.sendPrivateAlert(message, 'mateky');
                }
            }
            
            sendPrivateAlert(message, userId) {
                const user = DATA.users[userId];
                if (!user) return;
                
                const pmKey = [this.id, userId].sort().join('_');
                if (!DATA.privateMessages.has(pmKey)) {
                    DATA.privateMessages.set(pmKey, []);
                }
                
                const messages = DATA.privateMessages.get(pmKey);
                const alertMessage = {
                    id: 'pm_alert_' + Date.now(),
                    type: 'pm',
                    from: this.id,
                    to: userId,
                    text: `ðŸ” **SÄ°STEM ALERT**: ${message}`,
                    time: new Date(),
                    read: false
                };
                
                messages.push(alertMessage);
                
                // Ã–zel sohbet penceresi aÃ§Ä±ksa gÃ¶ster
                if (SYSTEM.pmWindows[userId]) {
                    this.displayPMMessage(alertMessage, userId);
                }
                
                showNotification('ðŸ¤– Mate Alert', message, 'security');
            }
            
            displayMessage(message) {
                const container = document.getElementById('chatMessages');
                if (!container) return;
                
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message';
                messageDiv.dataset.messageId = message.id;
                
                messageDiv.innerHTML = `
                    <div class="message-sender">
                        <span style="font-weight: 500; color: var(--accent-red);">${this.name}</span>
                        ${getRoleBadge(this.role)}
                    </div>
                    <div class="message-text" style="background: rgba(239, 68, 68, 0.1); border-left: 3px solid var(--accent-red);">
                        ${escapeHtml(message.text)}
                    </div>
                    <div class="message-time">${formatTime(message.time)}</div>
                `;
                
                container.appendChild(messageDiv);
                container.scrollTop = container.scrollHeight;
            }
            
            displayPMMessage(message, userId) {
                const container = document.getElementById(`pm-messages-${userId}`);
                if (!container) return;
                
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message message-incoming';
                messageDiv.dataset.messageId = message.id;
                
                messageDiv.innerHTML = `
                    <div class="message-sender">
                        <span style="font-weight: 500; color: var(--accent-red);">${this.name}</span>
                        ${getRoleBadge(this.role)}
                    </div>
                    <div class="message-text" style="background: rgba(239, 68, 68, 0.1); border-left: 3px solid var(--accent-red);">
                        ${escapeHtml(message.text)}
                    </div>
                    <div class="message-time">${formatTime(message.time)}</div>
                `;
                
                container.appendChild(messageDiv);
                container.scrollTop = container.scrollHeight;
            }
            
            checkUserSecurity(userId) {
                const user = DATA.users[userId];
                if (!user) return;
                
                // Global ban kontrolÃ¼
                if (DATA.globalBans.has(userId)) {
                    this.sendSecurityAlert(`${user.name} global banlÄ±!`, 'general');
                    return false;
                }
                
                // Global mute kontrolÃ¼
                if (DATA.globalMutes.has(userId)) {
                    this.sendSecurityAlert(`${user.name} global susturulmuÅŸ!`, 'general');
                    return false;
                }
                
                return true;
            }
            
            broadcastOwnerMessage(message, targetUser = null) {
                if (targetUser) {
                    // Belirli kullanÄ±cÄ±ya Ã¶zel mesaj
                    this.sendPrivateAlert(`ðŸ“¨ Owner MesajÄ±: ${message}`, targetUser);
                } else {
                    // TÃ¼m kanallarda broadcast
                    Object.keys(DATA.channels).forEach(channelId => {
                        this.sendSecurityAlert(`ðŸ“¢ Owner Duyurusu: ${message}`, channelId);
                    });
                }
            }
        }

        // Mate Bot'u baÅŸlat
        const mateBot = new MateBot();

        // ==================== UTILITY FONKSÄ°YONLARI ====================
        function generateMessageId() {
            return Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        function formatTime(date = new Date()) {
            return date.toLocaleTimeString('tr-TR', { 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: false
            });
        }

        function getRoleBadge(role) {
            const badges = {
                'owner': '<span class="role-badge role-owner">O</span>',
                'admin': '<span class="role-badge role-admin">A</span>',
                'coadmin': '<span class="role-badge role-coadmin">C</span>',
                'operator': '<span class="role-badge role-operator">OP</span>',
                'voice': '<span class="role-badge role-voice">V</span>'
            };
            return badges[role] || '';
        }

        function showNotification(title, message, type = 'info') {
            console.log(`[${type.toUpperCase()}] ${title}: ${message}`);
            
            // TarayÄ±cÄ± notification'Ä± (izin verilmiÅŸse)
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification(title, { body: message });
            }
        }

        function hasVideoPermission(channelId) {
            const channel = DATA.channels[channelId];
            if (!channel) return false;
            
            const user = SYSTEM.currentUser;
            if (!user) return false;
            
            // Owner her zaman yetkilidir
            if (user.role === 'owner') return true;
            
            // Admin her kanalda yetkilidir
            if (user.role === 'admin') return true;
            
            // Coadmin sadece kendi kanalÄ±nda yetkilidir
            if (user.role === 'coadmin' && channel.owner === user.id) return true;
            
            // Kanal sahibi kendi kanalÄ±nda yetkilidir
            if (channel.owner === user.id) return true;
            
            return false;
        }

        // ==================== GÄ°RÄ°Åž SÄ°STEMÄ° ====================
        function handleLogin() {
            const nickInput = document.getElementById('nickInput');
            const passInput = document.getElementById('passInput');
            const nick = nickInput.value.trim();
            const pass = passInput.value;
            
            if (!nick || nick.length < 2) {
                alert('GeÃ§erli bir kullanÄ±cÄ± adÄ± girin (min 2 karakter)');
                return;
            }
            
            const userId = nick.toLowerCase();
            
            // Mate bot korumasÄ±
            if (userId === 'mate') {
                alert('Bu kullanÄ±cÄ± adÄ± sistem tarafÄ±ndan kullanÄ±lÄ±yor!');
                return;
            }
            
            // GÃ¼venlik kontrolÃ¼
            if (!mateBot.checkUserSecurity(userId)) {
                alert('GiriÅŸ engellendi! LÃ¼tyetfen sistem yÃ¶neticisiyle iletiÅŸime geÃ§in.');
                return;
            }
            
            // KullanÄ±cÄ±yÄ± kaydet/oluÅŸtur
            if (DATA.registeredUsers.has(userId)) {
                const userData = DATA.registeredUsers.get(userId);
                const hashedPass = hashPassword(pass);
                if (hashedPass !== userData.password) {
                    alert('YanlÄ±ÅŸ ÅŸifre!');
                    mateBot.sendSecurityAlert(`${nick} yanlÄ±ÅŸ ÅŸifre denemesi!`);
                    return;
                }
                // KayÄ±tlÄ± kullanÄ±cÄ± giriÅŸi
                SYSTEM.currentUser = {
                    id: userId,
                    name: nick,
                    role: userData.role || 'user',
                    registered: true,
                    online: true,
                    invisible: false,
                    avatar: nick.charAt(0).toUpperCase(),
                    bio: userData.bio || '',
                    joinDate: userData.joinDate || new Date(),
                    lastSeen: new Date()
                };
            } else {
                // Yeni kullanÄ±cÄ±
                SYSTEM.currentUser = {
                    id: userId,
                    name: nick,
                    role: 'user',
                    registered: !!pass,
                    online: true,
                    invisible: false,
                    avatar: nick.charAt(0).toUpperCase(),
                    bio: '',
                    joinDate: new Date(),
                    lastSeen: new Date()
                };
                
                if (pass) {
                    // Åžifre ile kayÄ±t
                    DATA.registeredUsers.set(userId, {
                        password: hashPassword(pass),
                        role: 'user',
                        bio: '',
                        joinDate: new Date()
                    });
                    
                    // Owner kontrolÃ¼
                    if (userId === 'mateky') {
                        SYSTEM.currentUser.role = 'owner';
                        DATA.registeredUsers.get(userId).role = 'owner';
                        mateBot.broadcastOwnerMessage('Owner sisteme giriÅŸ yaptÄ±!');
                    }
                }
                
                // Yeni kullanÄ±cÄ± gÃ¼venlik bildirimi
                mateBot.sendSecurityAlert(`Yeni kullanÄ±cÄ±: ${nick} ${pass ? '(kayÄ±tlÄ±)' : '(misafir)'}`);
            }
            
            // KullanÄ±cÄ±yÄ± data'ya ekle
            DATA.users[userId] = SYSTEM.currentUser;
            DATA.onlineUsers.add(userId);
            
            // Genel kanala ekle
            DATA.channels.general.users.add(userId);
            
            // ArayÃ¼zÃ¼ gÃ¶ster
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('app').classList.remove('hidden');
            
            // Sistem mesajÄ±
            addSystemMessage(`ðŸŽ‰ ${SYSTEM.currentUser.name} sohbete katÄ±ldÄ±!`);
            
            // Ä°lk yÃ¼klemeler
            updateOnlineList();
            updatePanelInfo();
            loadChannelMessages('general');
            
            // Otomatik gÃ¼ncelleme baÅŸlat
            startAutoUpdates();
        }

        // ==================== ONLINE LÄ°STE SÄ°STEMÄ° ====================
        function updateOnlineList() {
            const container = document.getElementById('userList');
            const countElement = document.getElementById('onlineCount');
            
            if (!container) return;
            
            clearContainer('userList');
            
            const channel = DATA.channels[SYSTEM.currentChannel];
            if (!channel) return;
            
            const channelUsers = Array.from(channel.users)
                .map(userId => DATA.users[userId])
                .filter(user => user && !user.invisible)
                .sort((a, b) => {
                    const roleOrder = { owner: 1, admin: 2, coadmin: 3, operator: 4, voice: 5, user: 6 };
                    const roleDiff = roleOrder[a.role] - roleOrder[b.role];
                    if (roleDiff !== 0) return roleDiff;
                    return a.name.localeCompare(b.name);
                });
            
            const onlineCount = channelUsers.filter(u => u.online).length;
            if (countElement) {
                countElement.textContent = `(${onlineCount})`;
            }
            
            const channelUsersElement = document.getElementById('channelUsers');
            if (channelUsersElement) {
                channelUsersElement.textContent = channelUsers.length;
            }
            
            if (channelUsers.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 30px 20px; color: var(--text-secondary);">
                        <i class="fas fa-user-slash" style="font-size: 32px; margin-bottom: 10px; opacity: 0.5;"></i>
                        <div style="font-size: 13px;">HenÃ¼z kullanÄ±cÄ± yok</div>
                    </div>
                `;
                return;
            }
            
            channelUsers.forEach(user => {
                const item = document.createElement('div');
                item.className = `user-item ${user.online ? 'online' : ''}`;
                if (SYSTEM.activePM === user.id) {
                    item.classList.add('active');
                }
                
                const displayName = user.id === 'mate' ? 'ðŸ¤–Mate' : user.name;
                
                item.innerHTML = `
                    <div class="user-avatar ${user.online ? 'online' : ''}">
                        ${user.avatar}
                    </div>
                    <div class="user-info">
                        <div class="user-name">
                            ${escapeHtml(displayName)}
                            ${getRoleBadge(user.role)}
                        </div>
                        <div class="user-status">
                            ${user.online ? 'ðŸŸ¢ Ã‡evrimiÃ§i' : 'âš« Ã‡evrimdÄ±ÅŸÄ±'}
                        </div>
                    </div>
                `;
                
                item.addEventListener('click', () => {
                    if (user.id !== SYSTEM.currentUser.id) {
                        openPrivateChat(user.id);
                    }
                });
                
                container.appendChild(item);
            });
            
            updatePMConversationList();
        }

        // ==================== SOHBET SÄ°STEMÄ° ====================
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const text = input.value.trim();
            
            if (!text) return;
            
            if (text.startsWith('/')) {
                handleIRCCommand(text);
                input.value = '';
                return;
            }
            
            if (SYSTEM.activePM) {
                sendPrivateMessage(SYSTEM.activePM, text);
            } else {
                sendChannelMessage(text);
            }
            
            input.value = '';
            input.focus();
        }

        function sendChannelMessage(text) {
            const channel = DATA.channels[SYSTEM.currentChannel];
            if (!channel) return;
            
            // Global mute kontrolÃ¼
            if (DATA.globalMutes.has(SYSTEM.currentUser.id)) {
                addSystemMessage('âš ï¸ Global susturulmuÅŸsunuz! Mesaj gÃ¶nderemezsiniz.');
                return;
            }
            
            // Kanal mute kontrolÃ¼
            if (channel.mutes.has(SYSTEM.currentUser.id)) {
                const muteEnd = channel.mutes.get(SYSTEM.currentUser.id);
                if (new Date() < muteEnd) {
                    addSystemMessage('âš ï¸ Bu kanalda susturulmuÅŸsunuz! Mesaj gÃ¶nderemezsiniz.');
                    return;
                }
                channel.mutes.delete(SYSTEM.currentUser.id);
            }
            
            // Slowmode kontrolÃ¼
            if (channel.slowmode > 0) {
                // Basit slowmode kontrolÃ¼
                const lastMessage = channel.messages
                    .filter(m => m.userId === SYSTEM.currentUser.id)
                    .pop();
                if (lastMessage) {
                    const timeDiff = (new Date() - new Date(lastMessage.time)) / 1000;
                    if (timeDiff < channel.slowmode) {
                        addSystemMessage(`â±ï¸ YavaÅŸ mod aktif! ${Math.ceil(channel.slowmode - timeDiff)} saniye bekleyin.`);
                        return;
                    }
                }
            }
            
            const message = {
                id: generateMessageId(),
                type: 'message',
                userId: SYSTEM.currentUser.id,
                text: text,
                time: new Date(),
                channel: SYSTEM.currentChannel
            };
            
            channel.messages.push(message);
            addMessageToChat(message, SYSTEM.currentUser);
            
            // Mate bot spam kontrolÃ¼
            if (text.length > 500) {
                mateBot.sendSecurityAlert(`${SYSTEM.currentUser.name} uzun mesaj gÃ¶nderdi (${text.length} karakter)`);
            }
        }

        function sendPrivateMessage(toUserId, text) {
            if (!DATA.users[toUserId]) {
                addSystemMessage('âŒ KullanÄ±cÄ± bulunamadÄ±!');
                return;
            }
            
            const pmKey = [SYSTEM.currentUser.id, toUserId].sort().join('_');
            
            if (!DATA.privateMessages.has(pmKey)) {
                DATA.privateMessages.set(pmKey, []);
            }
            
            const messages = DATA.privateMessages.get(pmKey);
            const message = {
                id: generateMessageId(),
                type: 'pm',
                from: SYSTEM.currentUser.id,
                to: toUserId,
                text: text,
                time: new Date(),
                read: false
            };
            
            messages.push(message);
            
            if (SYSTEM.pmWindows[toUserId]) {
                addMessageToPMWindow(toUserId, message);
            }
            
            updatePMConversationList();
            
            if (toUserId !== SYSTEM.currentUser.id) {
                showNotification(DATA.users[toUserId].name, text, 'pm');
            }
            
            // Mate bot Ã¶zel mesaj izleme
            if (text.toLowerCase().includes('ÅŸifre') || text.toLowerCase().includes('password')) {
                mateBot.sendSecurityAlert(`${SYSTEM.currentUser.name} ÅŸifre iÃ§eren Ã¶zel mesaj gÃ¶nderdi: ${toUserId} kullanÄ±cÄ±sÄ±na`);
            }
        }

        function addMessageToChat(message, user) {
            const container = document.getElementById('chatMessages');
            if (!container) return;
            
            // Ä°lk mesaj boÅŸsa temizle
            if (container.children.length === 1 && 
                container.children[0].querySelector('.fas.fa-comments')) {
                clearContainer('chatMessages');
            }
            
            const isOutgoing = user.id === SYSTEM.currentUser.id;
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isOutgoing ? 'message-outgoing' : 'message-incoming'}`;
            messageDiv.dataset.messageId = message.id;
            
            const displayName = user.id === 'mate' ? 'ðŸ¤–Mate' : user.name;
            
            messageDiv.innerHTML = `
                <div class="message-sender">
                    <span style="font-weight: 500;">${escapeHtml(displayName)}</span>
                    ${getRoleBadge(user.role)}
                    ${user.registered ? '<i class="fas fa-check-circle" style="color: var(--accent-blue); font-size: 10px;"></i>' : ''}
                </div>
                <div class="message-text">${escapeHtml(message.text)}</div>
                <div class="message-time">${formatTime(message.time)}</div>
            `;
            
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }

        function addSystemMessage(text) {
            const container = document.getElementById('chatMessages');
            if (!container) return;
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message';
            messageDiv.style.textAlign = 'center';
            messageDiv.style.maxWidth = '100%';
            
            messageDiv.innerHTML = `
                <div style="display: inline-block; background: var(--bg-tertiary); padding: 8px 16px; border-radius: 16px; color: var(--text-secondary); font-style: italic; font-size: 13px;">
                    ${escapeHtml(text)}
                </div>
            `;
            
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }

        function loadChannelMessages(channelId) {
            const container = document.getElementById('chatMessages');
            if (!container) return;
            
            clearContainer('chatMessages');
            
            const channel = DATA.channels[channelId];
            if (!channel || !channel.messages || channel.messages.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px; color: var(--text-secondary);">
                        <i class="fas fa-comments" style="font-size: 48px; margin-bottom: 15px; opacity: 0.5;"></i>
                        <h3 style="margin-bottom: 10px;">${channel.name.replace('#', '')} KanalÄ±</h3>
                        <p>Bu kanalda henÃ¼z mesaj yok. Ä°lk mesajÄ± siz gÃ¶nderin!</p>
                    </div>
                `;
                return;
            }
            
            channel.messages.forEach(msg => {
                const user = DATA.users[msg.userId];
                if (user) {
                    addMessageToChat(msg, user);
                }
            });
            
            container.scrollTop = container.scrollHeight;
        }

        // ==================== KANAL SÄ°STEMÄ° ====================
        function switchChannel(channelId) {
            if (!DATA.channels[channelId]) return;
            
            SYSTEM.currentChannel = channelId;
            SYSTEM.activePM = null;
            
            document.querySelectorAll('.channel-tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.dataset.channel === channelId) {
                    tab.classList.add('active');
                }
            });
            
            const channel = DATA.channels[channelId];
            document.getElementById('currentChannel').textContent = channel.name.replace('#', '');
            document.getElementById('channelTopic').textContent = channel.topic;
            document.getElementById('panelChannelName').textContent = channel.name;
            document.getElementById('panelChannelTopic').textContent = channel.topic;
            document.getElementById('panelChannelVideo').textContent = channel.video.title;
            document.getElementById('videoChannel').textContent = channel.name.replace('#', '');
            
            // Video butonunu yetkiye gÃ¶re gÃ¶ster
            const videoBtn = document.getElementById('videoManagerBtn');
            const changeVideoBtn = document.getElementById('changeVideoBtn');
            
            if (hasVideoPermission(channelId)) {
                videoBtn.classList.remove('hidden');
                changeVideoBtn.classList.remove('hidden');
            } else {
                videoBtn.classList.add('hidden');
                changeVideoBtn.classList.add('hidden');
            }
            
            loadChannelMessages(channelId);
            updateOnlineList();
            loadChannelVideo();
            
            Object.keys(SYSTEM.pmWindows).forEach(userId => {
                closePMWindow(userId);
            });
        }

        function createNewChannel() {
            const nameInput = document.getElementById('channelName');
            const typeSelect = document.getElementById('channelType');
            const topicInput = document.getElementById('channelTopicInput');
            
            const name = nameInput.value.trim();
            const type = typeSelect.value;
            const topic = topicInput.value.trim() || 'Yeni sohbet kanalÄ±';
            
            if (!name || !name.startsWith('#')) {
                alert('Kanal adÄ± # ile baÅŸlamalÄ±!');
                return;
            }
            
            const channelId = name.substring(1).toLowerCase().replace(/[^a-z0-9]/g, '_');
            
            if (DATA.channels[channelId]) {
                alert('Bu kanal adÄ± zaten kullanÄ±lÄ±yor!');
                return;
            }
            
            if (DATA.userChannels.has(SYSTEM.currentUser.id)) {
                alert('Zaten bir kanalÄ±nÄ±z var! Her kullanÄ±cÄ± sadece 1 kanal aÃ§abilir.');
                return;
            }
            
            DATA.channels[channelId] = {
                id: channelId,
                name: name,
                owner: SYSTEM.currentUser.id,
                type: type,
                topic: topic,
                users: new Set([SYSTEM.currentUser.id, 'mate']), // Mate bot'u da ekle
                operators: new Set(),
                voices: new Set(),
                bans: new Map(),
                mutes: new Map(),
                slowmode: 0,
                locked: false,
                userLimit: 0,
                messages: [],
                video: {
                    id: 'jfKfPfyJRdk',
                    title: 'Lofi Hip Hop Radio ðŸ“š',
                    channel: name.replace('#', '')
                }
            };
            
            DATA.userChannels.set(SYSTEM.currentUser.id, channelId);
            
            // Mate bot'a yeni kanal bildirimi
            mateBot.sendSecurityAlert(`Yeni kanal oluÅŸturuldu: ${name} (${SYSTEM.currentUser.name} tarafÄ±ndan)`, channelId);
            
            const tabsContainer = document.getElementById('channelTabs');
            const tab = document.createElement('div');
            tab.className = 'channel-tab';
            tab.dataset.channel = channelId;
            tab.innerHTML = `<i class="fas fa-hashtag"></i> ${name.substring(1)}`;
            tab.addEventListener('click', () => switchChannel(channelId));
            tabsContainer.appendChild(tab);
            
            switchChannel(channelId);
            closeModal('channelModal');
            
            nameInput.value = '';
            topicInput.value = '';
            
            addSystemMessage(`ðŸŽŠ ${SYSTEM.currentUser.name} yeni kanal oluÅŸturdu: ${name}`);
        }

        // ==================== VIDEO SÄ°STEMÄ° ====================
        function loadChannelVideo() {
            const channel = DATA.channels[SYSTEM.currentChannel];
            if (!channel || !channel.video) return;
            
            const player = document.getElementById('youtubePlayer');
            const titleElement = document.getElementById('videoTitle');
            
            if (player && titleElement) {
                player.src = `https://www.youtube.com/embed/${channel.video.id}?autoplay=1&mute=1&rel=0&controls=1&modestbranding=1`;
                titleElement.textContent = channel.video.title;
                document.getElementById('panelChannelVideo').textContent = channel.video.title;
            }
        }

        function changeChannelVideo() {
            const channel = DATA.channels[SYSTEM.currentChannel];
            if (!channel) return;
            
            if (!hasVideoPermission(SYSTEM.currentChannel)) {
                alert('Video deÄŸiÅŸtirme yetkiniz yok!');
                return;
            }
            
            document.getElementById('videoUrl').value = '';
            document.getElementById('videoTitleInput').value = channel.video.title || '';
            openModal('videoModal');
        }

        function saveChannelVideo() {
            const urlInput = document.getElementById('videoUrl');
            const titleInput = document.getElementById('videoTitleInput');
            
            const url = urlInput.value.trim();
            const title = titleInput.value.trim() || 'YouTube Video';
            
            if (!url) {
                alert('YouTube URL veya Video ID gerekli!');
                return;
            }
            
            let videoId = url;
            
            // GeliÅŸtirilmiÅŸ video ID Ã§Ä±karma
            try {
                if (url.includes('youtube.com') || url.includes('youtu.be')) {
                    const urlObj = new URL(url.includes('http') ? url : 'https://' + url);
                    if (urlObj.hostname.includes('youtu.be')) {
                        videoId = urlObj.pathname.substring(1);
                    } else {
                        videoId = urlObj.searchParams.get('v') || url.split('v=')[1]?.split('&')[0];
                    }
                }
                
                if (!videoId || videoId.length !== 11) {
                    throw new Error('GeÃ§ersiz Video ID');
                }
            } catch (e) {
                if (url.length === 11) {
                    videoId = url;
                } else {
                    alert('GeÃ§erli bir YouTube URL veya Video ID girin!');
                    return;
                }
            }
            
            const channel = DATA.channels[SYSTEM.currentChannel];
            if (channel) {
                channel.video = {
                    id: videoId,
                    title: title,
                    channel: channel.name.replace('#', '')
                };
                
                loadChannelVideo();
                
                // Mate bot log
                mateBot.sendSecurityAlert(`${SYSTEM.currentUser.name} video deÄŸiÅŸtirdi: ${title}`, SYSTEM.currentChannel);
                
                addSystemMessage(`ðŸŽ¥ ${SYSTEM.currentUser.name} kanal videosunu deÄŸiÅŸtirdi: ${title}`);
                closeModal('videoModal');
            }
        }

        // ==================== KAMERA SÄ°STEMÄ° ====================
        async function openCameraModal(targetUserId = null) {
            try {
                SYSTEM.uploadType = { 
                    type: 'camera', 
                    target: targetUserId || SYSTEM.currentChannel, 
                    isPM: !!targetUserId,
                    facingMode: SYSTEM.facingMode 
                };
                
                openModal('cameraModal');
                
                const constraints = {
                    video: { 
                        facingMode: SYSTEM.facingMode,
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    },
                    audio: true
                };
                
                if (SYSTEM.cameraStream) {
                    stopCamera();
                }
                
                SYSTEM.cameraStream = await navigator.mediaDevices.getUserMedia(constraints);
                const preview = document.getElementById('cameraPreview');
                preview.srcObject = SYSTEM.cameraStream;
                
                // ButonlarÄ± aktif et
                document.getElementById('captureImageBtn').disabled = false;
                document.getElementById('recordVideoBtn').disabled = false;
                document.getElementById('switchCameraBtn').disabled = false;
                
            } catch (err) {
                console.error('Kamera hatasÄ±:', err);
                alert('Kamera eriÅŸim izni gerekiyor!');
                closeModal('cameraModal');
            }
        }

        async function switchCamera() {
            if (!SYSTEM.cameraStream) return;
            
            stopCamera();
            
            SYSTEM.facingMode = SYSTEM.facingMode === 'user' ? 'environment' : 'user';
            SYSTEM.uploadType.facingMode = SYSTEM.facingMode;
            
            await openCameraModal(SYSTEM.uploadType?.target);
        }

        function stopCamera() {
            if (SYSTEM.cameraStream) {
                SYSTEM.cameraStream.getTracks().forEach(track => track.stop());
                SYSTEM.cameraStream = null;
            }
            
            if (SYSTEM.mediaRecorder && SYSTEM.isRecording) {
                SYSTEM.mediaRecorder.stop();
                SYSTEM.isRecording = false;
            }
            
            const preview = document.getElementById('cameraPreview');
            if (preview) {
                preview.srcObject = null;
            }
        }

        function captureImage() {
            const video = document.getElementById('cameraPreview');
            const canvas = document.getElementById('cameraCanvas');
            const previewArea = document.getElementById('cameraPreviewArea');
            const sendBtn = document.getElementById('sendCameraMedia');
            
            if (!video || !canvas) return;
            
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            
            const imageData = canvas.toDataURL('image/jpeg');
            
            previewArea.style.display = 'block';
            previewArea.innerHTML = `
                <h4 style="margin-bottom: 10px; font-size: 14px;">FotoÄŸraf Ã–nizleme:</h4>
                <img src="${imageData}" style="max-width: 100%; max-height: 200px; border-radius: 8px; border: 2px solid var(--accent-blue);">
                <div style="margin-top: 10px; font-size: 12px; color: var(--text-secondary);">
                    FotoÄŸraf hazÄ±r! GÃ¶ndermek iÃ§in "GÃ¶nder" butonuna basÄ±n.
                </div>
            `;
            
            sendBtn.disabled = false;
            SYSTEM.uploadType.mediaData = imageData;
            SYSTEM.uploadType.mediaType = 'image';
        }

        function startRecording() {
            if (!SYSTEM.cameraStream) return;
            
            const recordBtn = document.getElementById('recordVideoBtn');
            const stopBtn = document.getElementById('stopRecordingBtn');
            const sendBtn = document.getElementById('sendCameraMedia');
            
            SYSTEM.recordedChunks = [];
            SYSTEM.mediaRecorder = new MediaRecorder(SYSTEM.cameraStream, {
                mimeType: 'video/webm;codecs=vp9'
            });
            
            SYSTEM.mediaRecorder.ondataavailable = (event) => {
                if (event.data.size > 0) {
                    SYSTEM.recordedChunks.push(event.data);
                }
            };
            
            SYSTEM.mediaRecorder.onstop = () => {
                const blob = new Blob(SYSTEM.recordedChunks, { type: 'video/webm' });
                const url = URL.createObjectURL(blob);
                
                const previewArea = document.getElementById('cameraPreviewArea');
                previewArea.style.display = 'block';
                previewArea.innerHTML = `
                    <h4 style="margin-bottom: 10px; font-size: 14px;">Video Ã–nizleme:</h4>
                    <video src="${url}" controls style="max-width: 100%; max-height: 200px; border-radius: 8px; border: 2px solid var(--accent-blue);"></video>
                    <div style="margin-top: 10px; font-size: 12px; color: var(--text-secondary);">
                        Video hazÄ±r! GÃ¶ndermek iÃ§in "GÃ¶nder" butonuna basÄ±n.
                    </div>
                `;
                
                sendBtn.disabled = false;
                SYSTEM.uploadType.mediaData = url;
                SYSTEM.uploadType.mediaType = 'video';
                SYSTEM.uploadType.mediaBlob = blob;
            };
            
            SYSTEM.mediaRecorder.start();
            SYSTEM.isRecording = true;
            
            recordBtn.style.display = 'none';
            stopBtn.style.display = 'inline-flex';
        }

        function stopRecording() {
            if (SYSTEM.mediaRecorder && SYSTEM.isRecording) {
                SYSTEM.mediaRecorder.stop();
                SYSTEM.isRecording = false;
                
                const recordBtn = document.getElementById('recordVideoBtn');
                const stopBtn = document.getElementById('stopRecordingBtn');
                
                recordBtn.style.display = 'inline-flex';
                stopBtn.style.display = 'none';
            }
        }

        function sendCameraMedia() {
            if (!SYSTEM.uploadType || !SYSTEM.uploadType.mediaData) return;
            
            const uploadType = SYSTEM.uploadType;
            const message = `[KAMERA - ${uploadType.mediaType.toUpperCase()}] ${new Date().toLocaleTimeString('tr-TR')}`;
            
            if (uploadType.isPM) {
                sendPrivateMessage(uploadType.target, message);
            } else {
                sendChannelMessage(message);
            }
            
            // Preview temizle
            document.getElementById('cameraPreviewArea').style.display = 'none';
            document.getElementById('sendCameraMedia').disabled = true;
            
            // Kamera kapat
            stopCamera();
            closeModal('cameraModal');
            
            showNotification('Kamera MedyasÄ±', `${uploadType.mediaType} baÅŸarÄ±yla gÃ¶nderildi.`);
        }

        // ==================== Ã–ZEL SOHBET SÄ°STEMÄ° ====================
        function openPrivateChat(userId) {
            if (!DATA.users[userId] || userId === SYSTEM.currentUser.id) return;
            
            SYSTEM.activePM = userId;
            
            if (SYSTEM.pmWindows[userId]) {
                SYSTEM.pmWindows[userId].classList.remove('minimized');
                return;
            }
            
            createPMWindow(userId);
            updateOnlineList();
            updatePMConversationList();
        }

        function createPMWindow(userId) {
            const user = DATA.users[userId];
            if (!user) return;
            
            const pmWindow = document.createElement('div');
            pmWindow.className = 'pm-window';
            pmWindow.id = `pm-window-${userId}`;
            
            const displayName = user.id === 'mate' ? 'ðŸ¤–Mate' : user.name;
            
            pmWindow.innerHTML = `
                <div class="pm-window-header" data-user-id="${userId}">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div class="user-avatar ${user.online ? 'online' : ''}" style="width: 30px; height: 30px; font-size: 14px;">
                            ${user.avatar}
                        </div>
                        <div>
                            <div style="font-weight: 600; font-size: 14px;">
                                ${escapeHtml(displayName)}
                                ${getRoleBadge(user.role)}
                            </div>
                            <div style="font-size: 11px; color: var(--text-secondary);">
                                ${user.online ? 'ðŸŸ¢ Ã‡evrimiÃ§i' : 'âš« Ã‡evrimdÄ±ÅŸÄ±'}
                            </div>
                        </div>
                    </div>
                    <div style="display: flex; gap: 5px;">
                        <button class="btn btn-sm btn-minimize-pm" style="background: none; border: none; color: var(--text-secondary); padding: 4px 8px;">
                            <i class="fas fa-minus"></i>
                        </button>
                        <button class="btn btn-sm btn-close-pm" style="background: none; border: none; color: var(--text-secondary); padding: 4px 8px;">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
                <div class="pm-window-messages" id="pm-messages-${userId}">
                    <!-- Mesajlar buraya gelecek -->
                </div>
                <div class="pm-window-input">
                    <div class="message-input-container">
                        <textarea class="message-input pm-input" id="pm-input-${userId}" 
                                  placeholder="${displayName} ile mesajlaÅŸÄ±n..." 
                                  rows="2"></textarea>
                    </div>
                    <div class="input-actions" style="margin-top: 10px;">
                        <div class="media-buttons">
                            <button class="media-btn btn-pm-image" data-user-id="${userId}">
                                <i class="fas fa-image"></i>
                            </button>
                            <button class="media-btn btn-pm-video" data-user-id="${userId}">
                                <i class="fas fa-video"></i>
                            </button>
                            <button class="media-btn btn-pm-camera" data-user-id="${userId}">
                                <i class="fas fa-camera"></i>
                            </button>
                        </div>
                        <button class="btn btn-primary btn-send-pm" data-user-id="${userId}">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(pmWindow);
            SYSTEM.pmWindows[userId] = pmWindow;
            
            // Event listener'lar
            const header = pmWindow.querySelector('.pm-window-header');
            const minimizeBtn = pmWindow.querySelector('.btn-minimize-pm');
            const closeBtn = pmWindow.querySelector('.btn-close-pm');
            const sendBtn = pmWindow.querySelector('.btn-send-pm');
            const input = pmWindow.querySelector(`#pm-input-${userId}`);
            
            header.addEventListener('click', (e) => {
                if (e.target === header || e.target.closest('.pm-window-header') === header) {
                    pmWindow.classList.toggle('minimized');
                }
            });
            
            minimizeBtn?.addEventListener('click', (e) => {
                e.stopPropagation();
                pmWindow.classList.toggle('minimized');
            });
            
            closeBtn?.addEventListener('click', () => {
                closePMWindow(userId);
            });
            
            sendBtn?.addEventListener('click', () => {
                const text = input.value.trim();
                if (text) {
                    sendPrivateMessage(userId, text);
                    input.value = '';
                    input.focus();
                }
            });
            
            input?.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    const text = input.value.trim();
                    if (text) {
                        sendPrivateMessage(userId, text);
                        input.value = '';
                    }
                }
            });
            
            // Medya butonlarÄ±
            pmWindow.querySelector('.btn-pm-image')?.addEventListener('click', () => {
                SYSTEM.uploadType = { type: 'image', target: userId, isPM: true };
                openUploadModal('Resim GÃ¶nder');
            });
            
            pmWindow.querySelector('.btn-pm-video')?.addEventListener('click', () => {
                SYSTEM.uploadType = { type: 'video', target: userId, isPM: true };
                openUploadModal('Video GÃ¶nder');
            });
            
            pmWindow.querySelector('.btn-pm-camera')?.addEventListener('click', () => {
                openCameraModal(userId);
            });
            
            loadPMMessages(userId);
        }

        function closePMWindow(userId) {
            const pmWindow = document.getElementById(`pm-window-${userId}`);
            if (pmWindow) {
                pmWindow.remove();
                delete SYSTEM.pmWindows[userId];
                
                if (SYSTEM.activePM === userId) {
                    SYSTEM.activePM = null;
                    updateOnlineList();
                }
            }
        }

        function loadPMMessages(userId) {
            const container = document.getElementById(`pm-messages-${userId}`);
            if (!container) return;
            
            clearContainer(`pm-messages-${userId}`);
            
            const pmKey = [SYSTEM.currentUser.id, userId].sort().join('_');
            const messages = DATA.privateMessages.get(pmKey) || [];
            
            if (messages.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px; color: var(--text-secondary);">
                        <i class="fas fa-comment" style="font-size: 48px; margin-bottom: 15px; opacity: 0.5;"></i>
                        <h3 style="margin-bottom: 10px;">${DATA.users[userId]?.name} ile Sohbet</h3>
                        <p>HenÃ¼z mesaj yok. Ä°lk mesajÄ± siz gÃ¶nderin!</p>
                    </div>
                `;
                return;
            }
            
            messages.forEach(msg => {
                const isOutgoing = msg.from === SYSTEM.currentUser.id;
                const sender = DATA.users[msg.from];
                if (!sender) return;
                
                const displayName = sender.id === 'mate' ? 'ðŸ¤–Mate' : sender.name;
                
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${isOutgoing ? 'message-outgoing' : 'message-incoming'}`;
                messageDiv.dataset.messageId = msg.id;
                
                messageDiv.innerHTML = `
                    <div class="message-sender">
                        <span style="font-weight: 500;">${escapeHtml(displayName)}</span>
                        ${getRoleBadge(sender.role)}
                    </div>
                    <div class="message-text">${escapeHtml(msg.text)}</div>
                    <div class="message-time">${formatTime(msg.time)}</div>
                `;
                
                container.appendChild(messageDiv);
            });
            
            container.scrollTop = container.scrollHeight;
        }

        function addMessageToPMWindow(userId, message) {
            const container = document.getElementById(`pm-messages-${userId}`);
            if (!container) return;
            
            if (container.children.length === 1 && 
                container.children[0].querySelector('.fas.fa-comment')) {
                clearContainer(`pm-messages-${userId}`);
            }
            
            const isOutgoing = message.from === SYSTEM.currentUser.id;
            const sender = DATA.users[message.from];
            if (!sender) return;
            
            const displayName = sender.id === 'mate' ? 'ðŸ¤–Mate' : sender.name;
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isOutgoing ? 'message-outgoing' : 'message-incoming'}`;
            messageDiv.dataset.messageId = message.id;
            
            messageDiv.innerHTML = `
                <div class="message-sender">
                    <span style="font-weight: 500;">${escapeHtml(displayName)}</span>
                    ${getRoleBadge(sender.role)}
                </div>
                <div class="message-text">${escapeHtml(message.text)}</div>
                <div class="message-time">${formatTime(message.time)}</div>
            `;
            
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }

        function updatePMConversationList() {
            const container = document.getElementById('pmConversationList');
            if (!container) return;
            
            clearContainer('pmConversationList');
            
            const conversations = new Map();
            
            DATA.privateMessages.forEach((messages, pmKey) => {
                const [user1, user2] = pmKey.split('_');
                const otherUserId = user1 === SYSTEM.currentUser.id ? user2 : 
                                  user2 === SYSTEM.currentUser.id ? user1 : null;
                
                if (otherUserId && DATA.users[otherUserId]) {
                    const lastMessage = messages[messages.length - 1];
                    const unreadCount = messages.filter(m => 
                        m.from !== SYSTEM.currentUser.id && !m.read
                    ).length;
                    
                    conversations.set(otherUserId, {
                        user: DATA.users[otherUserId],
                        lastMessage: lastMessage,
                        unreadCount: unreadCount,
                        messageCount: messages.length
                    });
                }
            });
            
            const sortedConversations = Array.from(conversations.values())
                .sort((a, b) => {
                    if (!a.lastMessage) return 1;
                    if (!b.lastMessage) return -1;
                    return new Date(b.lastMessage.time) - new Date(a.lastMessage.time);
                });
            
            if (sortedConversations.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 30px 20px; color: var(--text-secondary);">
                        <i class="fas fa-comments" style="font-size: 32px; margin-bottom: 10px; opacity: 0.5;"></i>
                        <div style="font-size: 13px;">HenÃ¼z Ã¶zel sohbetiniz yok</div>
                    </div>
                `;
                return;
            }
            
            sortedConversations.forEach(conv => {
                const item = document.createElement('div');
                item.className = `pm-item ${conv.unreadCount > 0 ? 'unread' : ''}`;
                
                const displayName = conv.user.id === 'mate' ? 'ðŸ¤–Mate' : conv.user.name;
                
                const lastMessageText = conv.lastMessage ? 
                    (conv.lastMessage.text.length > 30 ? 
                     conv.lastMessage.text.substring(0, 30) + '...' : 
                     conv.lastMessage.text) : 
                    'Mesaj yok';
                
                const lastMessageTime = conv.lastMessage ? 
                    formatTime(conv.lastMessage.time) : '';
                
                item.innerHTML = `
                    <div class="pm-avatar">
                        ${conv.user.avatar}
                    </div>
                    <div class="pm-info">
                        <div class="pm-name">
                            ${escapeHtml(displayName)}
                            ${conv.unreadCount > 0 ? 
                              `<span style="background: var(--accent-blue); color: white; font-size: 10px; padding: 1px 5px; border-radius: 10px; margin-left: 5px;">${conv.unreadCount}</span>` : 
                              ''}
                        </div>
                        <div class="pm-preview">${escapeHtml(lastMessageText)}</div>
                    </div>
                    <div class="pm-time">${lastMessageTime}</div>
                `;
                
                item.addEventListener('click', () => {
                    openPrivateChat(conv.user.id);
                });
                
                container.appendChild(item);
            });
        }

        // ==================== IRC KOMUT SÄ°STEMÄ° ====================
        function handleIRCCommand(fullCommand) {
            const parts = fullCommand.split(' ');
            const cmd = parts[0].toLowerCase();
            const args = parts.slice(1);
            
            const commands = {
                '/nick': () => {
                    if (args.length >= 1) changeNick(args[0]);
                    else addSystemMessage('âŒ KullanÄ±m: /nick yeni_nick');
                },
                '/join': () => {
                    if (args.length >= 1) {
                        let channelName = args[0];
                        if (!channelName.startsWith('#')) channelName = '#' + channelName;
                        joinChannel(channelName);
                    } else {
                        addSystemMessage('âŒ KullanÄ±m: /join #kanal');
                    }
                },
                '/leave': () => leaveChannel(),
                '/part': () => leaveChannel(),
                '/msg': () => {
                    if (args.length >= 2) {
                        const target = args[0];
                        const message = args.slice(1).join(' ');
                        sendPrivateMessage(target.toLowerCase(), message);
                    } else {
                        addSystemMessage('âŒ KullanÄ±m: /msg nick mesaj');
                    }
                },
                '/me': () => {
                    if (args.length >= 1) {
                        const action = args.join(' ');
                        sendChannelMessage(`* ${SYSTEM.currentUser.name} ${action}`);
                    } else {
                        addSystemMessage('âŒ KullanÄ±m: /me eylem');
                    }
                },
                '/who': () => listChannelUsers(),
                '/whois': () => {
                    if (args.length >= 1) showUserInfo(args[0]);
                    else addSystemMessage('âŒ KullanÄ±m: /whois nick');
                },
                '/clear': () => clearChat(),
                '/topic': () => {
                    if (args.length >= 1) changeTopic(args.join(' '));
                    else addSystemMessage('âŒ KullanÄ±m: /topic yeni_konu');
                },
                '/help': () => showIRCHelp(),
                '/kick': () => {
                    if (args.length >= 1) kickUser(args[0], args[1]);
                    else addSystemMessage('âŒ KullanÄ±m: /kick nick [sebep]');
                },
                '/ban': () => {
                    if (args.length >= 1) banUser(args[0], args.slice(1).join(' '));
                    else addSystemMessage('âŒ KullanÄ±m: /ban nick [sebep]');
                },
                '/mute': () => {
                    if (args.length >= 2) muteUser(args[0], parseInt(args[1]));
                    else addSystemMessage('âŒ KullanÄ±m: /mute nick sÃ¼re_saniye');
                },
                '/op': () => {
                    if (args.length >= 1) opUser(args[0]);
                    else addSystemMessage('âŒ KullanÄ±m: /op nick');
                },
                '/voice': () => {
                    if (args.length >= 1) voiceUser(args[0]);
                    else addSystemMessage('âŒ KullanÄ±m: /voice nick');
                },
                '/lock': () => lockChannel(),
                '/unlock': () => unlockChannel(),
                '/limit': () => {
                    if (args.length >= 1) setUserLimit(parseInt(args[0]));
                    else addSystemMessage('âŒ KullanÄ±m: /limit sayÄ±');
                },
                '/slowmode': () => {
                    if (args.length >= 1) setSlowmode(parseInt(args[0]));
                    else addSystemMessage('âŒ KullanÄ±m: /slowmode saniye');
                },
                '/gban': () => {
                    if (args.length >= 1) globalBan(args[0], args.slice(1).join(' '));
                    else addSystemMessage('âŒ KullanÄ±m: /gban nick [sebep]');
                },
                '/gmute': () => {
                    if (args.length >= 1) globalMute(args[0], args.slice(1).join(' '));
                    else addSystemMessage('âŒ KullanÄ±m: /gmute nick [sebep]');
                },
                '/duyuru': () => {
                    if (args.length >= 1) sendAnnouncement(args.join(' '));
                    else addSystemMessage('âŒ KullanÄ±m: /duyuru mesaj');
                },
                '/yetki': () => {
                    if (args.length >= 3) manageRole(args[1], args[2], args[3]);
                    else addSystemMessage('âŒ KullanÄ±m: /yetki ver/al nick rol');
                },
                '/invite': () => {
                    if (args.length >= 2) inviteUser(args[0], args[1]);
                    else addSystemMessage('âŒ KullanÄ±m: /invite nick #kanal');
                },
                '/mode': () => {
                    if (args.length >= 2) changeMode(args[0], args.slice(1));
                    else addSystemMessage('âŒ KullanÄ±m: /mode +/-mod parametre');
                },
                '/list': () => listChannels(),
                '/names': () => listChannelUsers(),
                '/quit': () => {
                    addSystemMessage('ðŸ‘‹ Ã‡Ä±kÄ±ÅŸ yapÄ±lÄ±yor...');
                    setTimeout(() => {
                        window.location.reload();
                    }, 1000);
                },
                '/ping': () => addSystemMessage('ðŸ“ Pong!'),
                '/time': () => addSystemMessage(`ðŸ•’ ${new Date().toLocaleString('tr-TR')}`),
                '/version': () => addSystemMessage('â„¹ï¸ EliteChat v2.0 - Profesyonel IRC Platformu'),
                '/stats': () => showStats()
            };
            
            if (commands[cmd]) {
                commands[cmd]();
            } else {
                addSystemMessage(`âŒ Bilinmeyen komut: ${cmd}. /help yazarak yardÄ±m alÄ±n.`);
            }
        }

        // YETKÄ°LÄ° KOMUT FONKSÄ°YONLARI
        function hasChannelPermission(channelId, permission = 'operator') {
            const channel = DATA.channels[channelId];
            if (!channel || !SYSTEM.currentUser) return false;
            
            const user = SYSTEM.currentUser;
            
            // Owner her ÅŸeyi yapabilir
            if (user.role === 'owner') return true;
            
            // Admin her kanalda yetkilidir
            if (user.role === 'admin') return true;
            
            // Kanal sahibi kendi kanalÄ±nda her ÅŸeyi yapabilir
            if (channel.owner === user.id) return true;
            
            // Operator yetkisi kontrolÃ¼
            if (permission === 'operator') {
                return channel.operators.has(user.id) || user.role === 'coadmin';
            }
            
            // Voice yetkisi kontrolÃ¼
            if (permission === 'voice') {
                return channel.voices.has(user.id) || channel.operators.has(user.id);
            }
            
            return false;
        }

        function kickUser(nick, reason = '') {
            const channel = DATA.channels[SYSTEM.currentChannel];
            if (!channel) return;
            
            if (!hasChannelPermission(SYSTEM.currentChannel, 'operator')) {
                addSystemMessage('âŒ Bu komutu kullanma yetkiniz yok!');
                return;
            }
            
            const userId = nick.toLowerCase();
            const user = DATA.users[userId];
            
            if (!user || !channel.users.has(userId)) {
                addSystemMessage(`âŒ KullanÄ±cÄ± bulunamadÄ±: ${nick}`);
                return;
            }
            
            // Kendini atamaz
            if (userId === SYSTEM.currentUser.id) {
                addSystemMessage('âŒ Kendinizi atamazsÄ±nÄ±z!');
                return;
            }
            
            // Owner'Ä± atamaz
            if (user.role === 'owner') {
                addSystemMessage('âŒ Owner atÄ±lamaz!');
                return;
            }
            
            // Ãœst yetkilileri atamaz
            if (user.role === 'admin' && SYSTEM.currentUser.role !== 'owner') {
                addSystemMessage('âŒ Admin atÄ±lamaz!');
                return;
            }
            
            channel.users.delete(userId);
            addSystemMessage(`ðŸš« ${SYSTEM.currentUser.name}, ${nick} kullanÄ±cÄ±sÄ±nÄ± attÄ± ${reason ? `(${reason})` : ''}`);
            mateBot.sendSecurityAlert(`${SYSTEM.currentUser.name}, ${nick} kullanÄ±cÄ±sÄ±nÄ± attÄ±`, SYSTEM.currentChannel);
            updateOnlineList();
        }

        function banUser(nick, reason = '') {
            const channel = DATA.channels[SYSTEM.currentChannel];
            if (!channel) return;
            
            if (!hasChannelPermission(SYSTEM.currentChannel, 'operator')) {
                addSystemMessage('âŒ Bu komutu kullanma yetkiniz yok!');
                return;
            }
            
            const userId = nick.toLowerCase();
            const user = DATA.users[userId];
            
            if (!user) {
                addSystemMessage(`âŒ KullanÄ±cÄ± bulunamadÄ±: ${nick}`);
                return;
            }
            
            // Kendini banlayamaz
            if (userId === SYSTEM.currentUser.id) {
                addSystemMessage('âŒ Kendinizi banlayamazsÄ±nÄ±z!');
                return;
            }
            
            // Owner'Ä± banlayamaz
            if (user.role === 'owner') {
                addSystemMessage('âŒ Owner banlanamaz!');
                return;
            }
            
            channel.bans.set(userId, { 
                reason: reason || 'Belirtilmedi', 
                time: new Date(), 
                by: SYSTEM.currentUser.id 
            });
            
            if (channel.users.has(userId)) {
                channel.users.delete(userId);
            }
            
            addSystemMessage(`ðŸš« ${SYSTEM.currentUser.name}, ${nick} kullanÄ±cÄ±sÄ±nÄ± banladÄ± ${reason ? `(${reason})` : ''}`);
            mateBot.sendSecurityAlert(`${SYSTEM.currentUser.name}, ${nick} kullanÄ±cÄ±sÄ±nÄ± banladÄ±`, SYSTEM.currentChannel);
            updateOnlineList();
        }

        function muteUser(nick, seconds = 60) {
            const channel = DATA.channels[SYSTEM.currentChannel];
            if (!channel) return;
            
            if (!hasChannelPermission(SYSTEM.currentChannel, 'operator')) {
                addSystemMessage('âŒ Bu komutu kullanma yetkiniz yok!');
                return;
            }
            
            const userId = nick.toLowerCase();
            const user = DATA.users[userId];
            
            if (!user || !channel.users.has(userId)) {
                addSystemMessage(`âŒ KullanÄ±cÄ± bulunamadÄ±: ${nick}`);
                return;
            }
            
            // Kendini susturamaz
            if (userId === SYSTEM.currentUser.id) {
                addSystemMessage('âŒ Kendinizi susturamazsÄ±nÄ±z!');
                return;
            }
            
            const muteEnd = new Date(Date.now() + (seconds * 1000));
            channel.mutes.set(userId, muteEnd);
            
            addSystemMessage(`ðŸ”‡ ${SYSTEM.currentUser.name}, ${nick} kullanÄ±cÄ±sÄ±nÄ± ${seconds} saniye susturdu`);
            mateBot.sendSecurityAlert(`${SYSTEM.currentUser.name}, ${nick} kullanÄ±cÄ±sÄ±nÄ± ${seconds} saniye susturdu`, SYSTEM.currentChannel);
        }

        function opUser(nick) {
            const channel = DATA.channels[SYSTEM.currentChannel];
            if (!channel) return;
            
            if (!hasChannelPermission(SYSTEM.currentChannel, 'operator') && channel.owner !== SYSTEM.currentUser.id) {
                addSystemMessage('âŒ Bu komutu kullanma yetkiniz yok!');
                return;
            }
            
            const userId = nick.toLowerCase();
            const user = DATA.users[userId];
            
            if (!user || !channel.users.has(userId)) {
                addSystemMessage(`âŒ KullanÄ±cÄ± bulunamadÄ±: ${nick}`);
                return;
            }
            
            channel.operators.add(userId);
            addSystemMessage(`ðŸ›¡ï¸ ${SYSTEM.currentUser.name}, ${nick} kullanÄ±cÄ±sÄ±na OP yetkisi verdi`);
            updateOnlineList();
        }

        function voiceUser(nick) {
            const channel = DATA.channels[SYSTEM.currentChannel];
            if (!channel) return;
            
            if (!hasChannelPermission(SYSTEM.currentChannel, 'operator')) {
                addSystemMessage('âŒ Bu komutu kullanma yetkiniz yok!');
                return;
            }
            
            const userId = nick.toLowerCase();
            const user = DATA.users[userId];
            
            if (!user || !channel.users.has(userId)) {
                addSystemMessage(`âŒ KullanÄ±cÄ± bulunamadÄ±: ${nick}`);
                return;
            }
            
            channel.voices.add(userId);
            addSystemMessage(`ðŸŽ¤ ${SYSTEM.currentUser.name}, ${nick} kullanÄ±cÄ±sÄ±na Voice yetkisi verdi`);
            updateOnlineList();
        }

        function lockChannel() {
            const channel = DATA.channels[SYSTEM.currentChannel];
            if (!channel) return;
            
            if (!hasChannelPermission(SYSTEM.currentChannel, 'operator') && channel.owner !== SYSTEM.currentUser.id) {
                addSystemMessage('âŒ Bu komutu kullanma yetkiniz yok!');
                return;
            }
            
            channel.locked = true;
            addSystemMessage(`ðŸ”’ ${SYSTEM.currentUser.name} kanalÄ± kilitledi`);
        }

        function unlockChannel() {
            const channel = DATA.channels[SYSTEM.currentChannel];
            if (!channel) return;
            
            if (!hasChannelPermission(SYSTEM.currentChannel, 'operator') && channel.owner !== SYSTEM.currentUser.id) {
                addSystemMessage('âŒ Bu komutu kullanma yetkiniz yok!');
                return;
            }
            
            channel.locked = false;
            addSystemMessage(`ðŸ”“ ${SYSTEM.currentUser.name} kanalÄ±n kilidini aÃ§tÄ±`);
        }

        function setUserLimit(limit) {
            const channel = DATA.channels[SYSTEM.currentChannel];
            if (!channel) return;
            
            if (!hasChannelPermission(SYSTEM.currentChannel, 'operator') && channel.owner !== SYSTEM.currentUser.id) {
                addSystemMessage('âŒ Bu komutu kullanma yetkiniz yok!');
                return;
            }
            
            channel.userLimit = limit;
            addSystemMessage(`ðŸ“Š ${SYSTEM.currentUser.name} kullanÄ±cÄ± limitini ${limit} kiÅŸi yaptÄ±`);
        }

        function setSlowmode(seconds) {
            const channel = DATA.channels[SYSTEM.currentChannel];
            if (!channel) return;
            
            if (!hasChannelPermission(SYSTEM.currentChannel, 'operator') && channel.owner !== SYSTEM.currentUser.id) {
                addSystemMessage('âŒ Bu komutu kullanma yetkiniz yok!');
                return;
            }
            
            channel.slowmode = seconds;
            addSystemMessage(`â±ï¸ ${SYSTEM.currentUser.name} yavaÅŸ modu ${seconds} saniye yaptÄ±`);
        }

        // SÄ°STEM KOMUTLARI (Owner/Admin)
        function globalBan(nick, reason = '') {
            if (SYSTEM.currentUser.role !== 'owner' && SYSTEM.currentUser.role !== 'admin') {
                addSystemMessage('âŒ Bu komutu kullanma yetkiniz yok!');
                return;
            }
            
            const userId = nick.toLowerCase();
            const user = DATA.users[userId];
            
            if (!user) {
                addSystemMessage(`âŒ KullanÄ±cÄ± bulunamadÄ±: ${nick}`);
                return;
            }
            
            // Owner'Ä± global banlayamaz
            if (user.role === 'owner') {
                addSystemMessage('âŒ Owner global banlanamaz!');
                return;
            }
            
            DATA.globalBans.add(userId);
            
            // TÃ¼m kanallardan at
            Object.values(DATA.channels).forEach(channel => {
                if (channel.users.has(userId)) {
                    channel.users.delete(userId);
                }
            });
            
            addSystemMessage(`ðŸŒ ${SYSTEM.currentUser.name}, ${nick} kullanÄ±cÄ±sÄ±nÄ± GLOBAL banladÄ± ${reason ? `(${reason})` : ''}`);
            mateBot.sendSecurityAlert(`${SYSTEM.currentUser.name}, ${nick} kullanÄ±cÄ±sÄ±nÄ± GLOBAL banladÄ±`);
        }

        function globalMute(nick, reason = '') {
            if (SYSTEM.currentUser.role !== 'owner' && SYSTEM.currentUser.role !== 'admin') {
                addSystemMessage('âŒ Bu komutu kullanma yetkiniz yok!');
                return;
            }
            
            const userId = nick.toLowerCase();
            const user = DATA.users[userId];
            
            if (!user) {
                addSystemMessage(`âŒ KullanÄ±cÄ± bulunamadÄ±: ${nick}`);
                return;
            }
            
            DATA.globalMutes.add(userId);
            addSystemMessage(`ðŸŒ ${SYSTEM.currentUser.name}, ${nick} kullanÄ±cÄ±sÄ±nÄ± GLOBAL susturdu ${reason ? `(${reason})` : ''}`);
            mateBot.sendSecurityAlert(`${SYSTEM.currentUser.name}, ${nick} kullanÄ±cÄ±sÄ±nÄ± GLOBAL susturdu`);
        }

        function sendAnnouncement(message) {
            if (SYSTEM.currentUser.role !== 'owner' && SYSTEM.currentUser.role !== 'admin') {
                addSystemMessage('âŒ Bu komutu kullanma yetkiniz yok!');
                return;
            }
            
            Object.values(DATA.channels).forEach(channel => {
                const announcement = {
                    id: 'announce_' + Date.now(),
                    type: 'announcement',
                    userId: SYSTEM.currentUser.id,
                    text: `ðŸ“¢ **SÄ°STEM DUYURUSU**: ${message}`,
                    time: new Date(),
                    channel: channel.id
                };
                
                channel.messages.push(announcement);
                
                if (SYSTEM.currentChannel === channel.id) {
                    const announcementDiv = document.createElement('div');
                    announcementDiv.className = 'message';
                    announcementDiv.style.textAlign = 'center';
                    
                    announcementDiv.innerHTML = `
                        <div style="display: inline-block; background: linear-gradient(135deg, var(--accent-yellow), var(--accent-red)); padding: 10px 20px; border-radius: 12px; color: white; font-weight: bold; margin: 10px 0;">
                            ðŸ“¢ ${escapeHtml(message)}
                        </div>
                        <div style="font-size: 10px; color: var(--text-secondary);">
                            ${SYSTEM.currentUser.name} tarafÄ±ndan
                        </div>
                    `;
                    
                    const container = document.getElementById('chatMessages');
                    if (container) {
                        container.appendChild(announcementDiv);
                        container.scrollTop = container.scrollHeight;
                    }
                }
            });
            
            mateBot.sendSecurityAlert(`${SYSTEM.currentUser.name} sistem duyurusu yaptÄ±: ${message}`);
        }

        function manageRole(action, nick, role) {
            if (SYSTEM.currentUser.role !== 'owner') {
                addSystemMessage('âŒ Bu komutu kullanma yetkiniz yok!');
                return;
            }
            
            const userId = nick.toLowerCase();
            const user = DATA.users[userId];
            
            if (!user) {
                addSystemMessage(`âŒ KullanÄ±cÄ± bulunamadÄ±: ${nick}`);
                return;
            }
            
            if (action === 'ver') {
                const validRoles = ['owner', 'admin', 'coadmin', 'operator', 'user'];
                if (!validRoles.includes(role)) {
                    addSystemMessage(`âŒ GeÃ§ersiz rol: ${role}`);
                    return;
                }
                
                user.role = role;
                if (DATA.registeredUsers.has(userId)) {
                    DATA.registeredUsers.get(userId).role = role;
                }
                
                addSystemMessage(`ðŸŽ–ï¸ ${SYSTEM.currentUser.name}, ${nick} kullanÄ±cÄ±sÄ±na ${role} rolÃ¼ verdi`);
                mateBot.sendSecurityAlert(`${SYSTEM.currentUser.name}, ${nick} kullanÄ±cÄ±sÄ±na ${role} rolÃ¼ verdi`);
                
            } else if (action === 'al') {
                user.role = 'user';
                if (DATA.registeredUsers.has(userId)) {
                    DATA.registeredUsers.get(userId).role = 'user';
                }
                
                addSystemMessage(`ðŸŽ–ï¸ ${SYSTEM.currentUser.name}, ${nick} kullanÄ±cÄ±sÄ±nÄ±n yetkilerini aldÄ±`);
                mateBot.sendSecurityAlert(`${SYSTEM.currentUser.name}, ${nick} kullanÄ±cÄ±sÄ±nÄ±n yetkilerini aldÄ±`);
            }
            
            updateOnlineList();
        }

        function inviteUser(nick, channelName) {
            const channelId = channelName.substring(1).toLowerCase().replace(/[^a-z0-9]/g, '_');
            const channel = DATA.channels[channelId];
            
            if (!channel) {
                addSystemMessage(`âŒ Kanal bulunamadÄ±: ${channelName}`);
                return;
            }
            
            if (!hasChannelPermission(channelId, 'operator') && channel.owner !== SYSTEM.currentUser.id) {
                addSystemMessage('âŒ Bu komutu kullanma yetkiniz yok!');
                return;
            }
            
            const userId = nick.toLowerCase();
            const user = DATA.users[userId];
            
            if (!user) {
                addSystemMessage(`âŒ KullanÄ±cÄ± bulunamadÄ±: ${nick}`);
                return;
            }
            
            if (channel.users.has(userId)) {
                addSystemMessage(`â„¹ï¸ ${nick} zaten bu kanalda`);
                return;
            }
            
            if (channel.locked && !channel.users.has(userId)) {
                addSystemMessage('âŒ Kanal kilitli!');
                return;
            }
            
            if (channel.userLimit > 0 && channel.users.size >= channel.userLimit) {
                addSystemMessage('âŒ Kanal doldu!');
                return;
            }
            
            channel.users.add(userId);
            addSystemMessage(`ðŸ“¨ ${SYSTEM.currentUser.name}, ${nick} kullanÄ±cÄ±sÄ±nÄ± ${channelName} kanalÄ±na davet etti`);
            
            // KullanÄ±cÄ±ya Ã¶zel mesaj gÃ¶nder
            sendPrivateMessage(userId, `${SYSTEM.currentUser.name} sizi ${channelName} kanalÄ±na davet etti! /join ${channelName} yazarak katÄ±labilirsiniz.`);
        }

        // DÄ°ÄžER KOMUT FONKSÄ°YONLARI
        function changeNick(newNick) {
            if (!newNick || newNick.length < 2) {
                addSystemMessage('âŒ GeÃ§ersiz nick! (min 2 karakter)');
                return;
            }
            
            const oldNick = SYSTEM.currentUser.name;
            const userId = newNick.toLowerCase();
            
            // Mate bot kontrolÃ¼
            if (userId === 'mate') {
                addSystemMessage('âŒ Bu kullanÄ±cÄ± adÄ± sistem tarafÄ±ndan kullanÄ±lÄ±yor!');
                return;
            }
            
            // KullanÄ±cÄ± adÄ± zaten alÄ±nmÄ±ÅŸ mÄ±?
            if (DATA.users[userId] && userId !== SYSTEM.currentUser.id) {
                addSystemMessage('âŒ Bu kullanÄ±cÄ± adÄ± zaten kullanÄ±lÄ±yor!');
                return;
            }
            
            // Nick deÄŸiÅŸikliÄŸi
            const oldUserId = SYSTEM.currentUser.id;
            SYSTEM.currentUser.name = newNick;
            SYSTEM.currentUser.avatar = newNick.charAt(0).toUpperCase();
            
            // KullanÄ±cÄ± verisini gÃ¼ncelle
            delete DATA.users[oldUserId];
            DATA.users[userId] = SYSTEM.currentUser;
            
            // Online listeyi gÃ¼ncelle
            DATA.onlineUsers.delete(oldUserId);
            DATA.onlineUsers.add(userId);
            
            // Kanallardaki kullanÄ±cÄ±yÄ± gÃ¼ncelle
            Object.values(DATA.channels).forEach(channel => {
                if (channel.users.has(oldUserId)) {
                    channel.users.delete(oldUserId);
                    channel.users.add(userId);
                }
            });
            
            addSystemMessage(`âœ… Nick deÄŸiÅŸtirildi: ${oldNick} â†’ ${newNick}`);
            mateBot.sendSecurityAlert(`${oldNick} nick deÄŸiÅŸtirdi: ${newNick}`);
            updateOnlineList();
        }

        function joinChannel(channelName) {
            const channelId = channelName.substring(1).toLowerCase().replace(/[^a-z0-9]/g, '_');
            
            if (!DATA.channels[channelId]) {
                addSystemMessage(`âŒ Kanal bulunamadÄ±: ${channelName}`);
                return;
            }
            
            const channel = DATA.channels[channelId];
            
            // Ban kontrolÃ¼
            if (channel.bans.has(SYSTEM.currentUser.id)) {
                const banInfo = channel.bans.get(SYSTEM.currentUser.id);
                addSystemMessage(`âŒ Bu kanaldan banlÄ±sÄ±nÄ±z! Sebep: ${banInfo.reason}`);
                return;
            }
            
            // Kilit kontrolÃ¼
            if (channel.locked && !channel.users.has(SYSTEM.currentUser.id)) {
                addSystemMessage('âŒ Kanal kilitli!');
                return;
            }
            
            // Limit kontrolÃ¼
            if (channel.userLimit > 0 && channel.users.size >= channel.userLimit) {
                addSystemMessage('âŒ Kanal doldu!');
                return;
            }
            
            // Private/Secret kanal kontrolÃ¼
            if (channel.type !== 'public' && !channel.users.has(SYSTEM.currentUser.id)) {
                addSystemMessage('âŒ Bu kanala eriÅŸim izniniz yok!');
                return;
            }
            
            // KullanÄ±cÄ±yÄ± ekle
            channel.users.add(SYSTEM.currentUser.id);
            
            // Sekme kontrolÃ¼
            let tabExists = false;
            document.querySelectorAll('.channel-tab').forEach(tab => {
                if (tab.dataset.channel === channelId) {
                    tabExists = true;
                }
            });
            
            if (!tabExists) {
                const tabsContainer = document.getElementById('channelTabs');
                const tab = document.createElement('div');
                tab.className = 'channel-tab';
                tab.dataset.channel = channelId;
                tab.innerHTML = `<i class="fas fa-hashtag"></i> ${channel.name.substring(1)}`;
                tab.addEventListener('click', () => switchChannel(channelId));
                tabsContainer.appendChild(tab);
            }
            
            switchChannel(channelId);
            addSystemMessage(`âœ… ${channelName} kanalÄ±na katÄ±ldÄ±nÄ±z`);
        }

        function leaveChannel() {
            if (SYSTEM.currentChannel === 'general') {
                addSystemMessage('âŒ Genel kanaldan ayrÄ±lamazsÄ±nÄ±z!');
                return;
            }
            
            const channel = DATA.channels[SYSTEM.currentChannel];
            const channelName = channel.name;
            
            channel.users.delete(SYSTEM.currentUser.id);
            
            const tab = document.querySelector(`.channel-tab[data-channel="${SYSTEM.currentChannel}"]`);
            if (tab) tab.remove();
            
            switchChannel('general');
            addSystemMessage(`âœ… ${channelName} kanalÄ±ndan ayrÄ±ldÄ±nÄ±z`);
        }

        function listChannelUsers() {
            const channel = DATA.channels[SYSTEM.currentChannel];
            if (!channel) return;
            
            const users = Array.from(channel.users)
                .map(id => DATA.users[id])
                .filter(u => u)
                .sort((a, b) => {
                    const roleOrder = { owner: 1, admin: 2, coadmin: 3, operator: 4, voice: 5, user: 6 };
                    const roleDiff = roleOrder[a.role] - roleOrder[b.role];
                    if (roleDiff !== 0) return roleDiff;
                    return a.name.localeCompare(b.name);
                });
            
            let message = `ðŸ‘¥ ${channel.name} KullanÄ±cÄ±larÄ± (${users.length}):\n`;
            users.forEach(user => {
                const displayName = user.id === 'mate' ? 'ðŸ¤–Mate' : user.name;
                message += `â€¢ ${displayName} ${getRoleBadge(user.role)}\n`;
            });
            
            // MesajÄ± parÃ§alara bÃ¶l (uzunsa)
            const lines = message.split('\n');
            lines.forEach(line => {
                if (line.trim()) {
                    addSystemMessage(line);
                }
            });
        }

        function showUserInfo(nick) {
            const userId = nick.toLowerCase();
            const user = DATA.users[userId];
            
            if (!user) {
                addSystemMessage(`âŒ KullanÄ±cÄ± bulunamadÄ±: ${nick}`);
                return;
            }
            
            const displayName = user.id === 'mate' ? 'ðŸ¤–Mate' : user.name;
            
            let info = `ðŸ‘¤ ${displayName} Bilgisi:\n`;
            info += `Rol: ${user.role}\n`;
            info += `Durum: ${user.online ? 'ðŸŸ¢ Ã‡evrimiÃ§i' : 'âš« Ã‡evrimdÄ±ÅŸÄ±'}\n`;
            info += `KayÄ±tlÄ±: ${user.registered ? 'Evet âœ“' : 'HayÄ±r âœ—'}\n`;
            info += `GÃ¶rÃ¼nmez: ${user.invisible ? 'Evet' : 'HayÄ±r'}\n`;
            info += `KatÄ±lma: ${user.joinDate.toLocaleDateString('tr-TR')}\n`;
            info += `Son GÃ¶rÃ¼lme: ${user.lastSeen.toLocaleTimeString('tr-TR')}`;
            
            // Aktif olduÄŸu kanallar
            const userChannels = [];
            Object.values(DATA.channels).forEach(channel => {
                if (channel.users.has(userId)) {
                    userChannels.push(channel.name);
                }
            });
            
            if (userChannels.length > 0) {
                info += `\nKanallar: ${userChannels.join(', ')}`;
            }
            
            addSystemMessage(info);
        }

        function changeTopic(newTopic) {
            const channel = DATA.channels[SYSTEM.currentChannel];
            if (!channel) return;
            
            if (!hasChannelPermission(SYSTEM.currentChannel, 'operator') && channel.owner !== SYSTEM.currentUser.id) {
                addSystemMessage('âŒ Kanal konusunu deÄŸiÅŸtirme yetkiniz yok!');
                return;
            }
            
            const oldTopic = channel.topic;
            channel.topic = newTopic;
            
            document.getElementById('channelTopic').textContent = newTopic;
            document.getElementById('panelChannelTopic').textContent = newTopic;
            
            addSystemMessage(`ðŸ“ Kanal konusu deÄŸiÅŸtirildi: "${oldTopic}" â†’ "${newTopic}"`);
            mateBot.sendSecurityAlert(`${SYSTEM.currentUser.name} kanal konusunu deÄŸiÅŸtirdi: "${newTopic}"`, SYSTEM.currentChannel);
        }

        function clearChat() {
            const container = document.getElementById('chatMessages');
            if (container) {
                clearContainer('chatMessages');
                addSystemMessage('âœ… Sohbet temizlendi');
            }
        }

        function listChannels() {
            const channels = Object.values(DATA.channels)
                .filter(channel => channel.type === 'public' || channel.users.has(SYSTEM.currentUser.id))
                .sort((a, b) => a.name.localeCompare(b.name));
            
            if (channels.length === 0) {
                addSystemMessage('âŒ HiÃ§ kanal bulunamadÄ±');
                return;
            }
            
            let message = `ðŸ“‹ Kanallar (${channels.length}):\n`;
            channels.forEach(channel => {
                const userCount = Array.from(channel.users).filter(id => DATA.users[id] && !DATA.users[id].invisible).length;
                const topic = channel.topic.length > 30 ? channel.topic.substring(0, 30) + '...' : channel.topic;
                message += `â€¢ ${channel.name} (${userCount} kiÅŸi) - ${topic}\n`;
            });
            
            const lines = message.split('\n');
            lines.forEach(line => {
                if (line.trim()) {
                    addSystemMessage(line);
                }
            });
        }

        function showStats() {
            const totalUsers = Object.keys(DATA.users).length;
            const onlineUsers = Array.from(DATA.onlineUsers).filter(id => DATA.users[id] && !DATA.users[id].invisible).length;
            const totalChannels = Object.keys(DATA.channels).length;
            const totalMessages = Object.values(DATA.channels).reduce((sum, channel) => sum + channel.messages.length, 0);
            const totalPMs = Array.from(DATA.privateMessages.values()).reduce((sum, messages) => sum + messages.length, 0);
            
            let stats = `ðŸ“Š EliteChat Ä°statistikleri:\n`;
            stats += `Toplam KullanÄ±cÄ±: ${totalUsers}\n`;
            stats += `Ã‡evrimiÃ§i: ${onlineUsers}\n`;
            stats += `Kanallar: ${totalChannels}\n`;
            stats += `Kanal MesajlarÄ±: ${totalMessages}\n`;
            stats += `Ã–zel Mesajlar: ${totalPMs}\n`;
            stats += `KayÄ±tlÄ± KullanÄ±cÄ±lar: ${DATA.registeredUsers.size}\n`;
            stats += `Sistem: EliteChat v2.0`;
            
            addSystemMessage(stats);
        }

        function showIRCHelp() {
            const helpText = `
ðŸ“‹ IRC KOMUTLARI:

ðŸ‘¤ GENEL KOMUTLAR:
/nick yeni_nick       - KullanÄ±cÄ± adÄ±nÄ± deÄŸiÅŸtir
/join #kanal          - Kanala katÄ±l
/leave, /part         - Kanaldan ayrÄ±l
/msg nick mesaj       - Ã–zel mesaj gÃ¶nder
/me eylem             - Eylem mesajÄ± gÃ¶nder
/who, /names          - Kanal kullanÄ±cÄ±larÄ±nÄ± listele
/whois nick           - KullanÄ±cÄ± bilgisi gÃ¶ster
/list                 - KanallarÄ± listele
/clear                - Sohbeti temizle
/topic yeni_konu      - Kanal konusunu deÄŸiÅŸtir
/invite nick #kanal   - KullanÄ±cÄ±yÄ± kanala davet et
/ping                 - Ping kontrolÃ¼
/time                 - ZamanÄ± gÃ¶ster
/version              - SÃ¼rÃ¼m bilgisi
/stats                - Ä°statistikleri gÃ¶ster
/help                 - Bu yardÄ±mÄ± gÃ¶ster
/quit                 - Ã‡Ä±kÄ±ÅŸ yap

ðŸ›¡ï¸ YETKÄ°LÄ° KOMUTLARI (OP/Channel Owner):
/kick nick [sebep]    - KullanÄ±cÄ±yÄ± at
/ban nick [sebep]     - KullanÄ±cÄ±yÄ± banla
/mute nick sÃ¼re       - KullanÄ±cÄ±yÄ± sustur (saniye)
/op nick              - OP yetkisi ver
/voice nick           - Voice yetkisi ver
/lock                 - KanalÄ± kilitle
/unlock               - KanalÄ±n kilidini aÃ§
/limit sayÄ±           - KullanÄ±cÄ± limiti koy
/slowmode saniye      - YavaÅŸ mod aÃ§
/mode +/-mod param    - Kanal modlarÄ±nÄ± deÄŸiÅŸtir

ðŸ‘‘ SÄ°STEM KOMUTLARI (Owner/Admin):
/gban nick [sebep]    - Global ban
/gmute nick [sebep]   - Global sustur
/duyuru mesaj         - Sistem duyurusu
/yetki ver nick rol   - Yetki ver (owner/admin/coadmin)
/yetki al nick        - Yetki al
            `;
            
            helpText.trim().split('\n').forEach(line => {
                if (line.trim()) {
                    addSystemMessage(line);
                }
            });
        }

        // ==================== OTOMATÄ°K GÃœNCELLEMELER ====================
        function startAutoUpdates() {
            // Viewer count gÃ¼ncelle
            const interval1 = setInterval(() => {
                const viewerCount = document.getElementById('viewerCount');
                if (viewerCount) {
                    const current = parseInt(viewerCount.textContent.replace(/[^0-9]/g, '')) || 1200;
                    const change = Math.floor(Math.random() * 100) - 50;
                    const newCount = Math.max(100, current + change);
                    viewerCount.textContent = newCount >= 1000 ? (newCount/1000).toFixed(1) + 'K' : newCount.toString();
                }
            }, 30000);
            
            SYSTEM.intervals.push(interval1);
            
            // Ã–zel mesaj kontrolÃ¼
            const interval2 = setInterval(() => {
                updatePMConversationList();
                
                // Kanal mesajlarÄ±nÄ± otomatik yÃ¼kle
                const channel = DATA.channels[SYSTEM.currentChannel];
                if (channel && channel.messages.length > 0) {
                    const lastMessage = channel.messages[channel.messages.length - 1];
                    const lastMessageTime = new Date(lastMessage.time);
                    const now = new Date();
                    
                    // EÄŸer son mesaj 10 saniyeden eskiyse, otomatik cevap
                    if ((now - lastMessageTime) > 10000 && 
                        Math.random() > 0.7 &&
                        lastMessage.userId !== SYSTEM.currentUser.id &&
                        lastMessage.userId !== 'mate') {
                        
                        const otherUsers = Array.from(channel.users)
                            .map(id => DATA.users[id])
                            .filter(u => u && u.id !== SYSTEM.currentUser.id && u.online && u.registered && u.id !== 'mate');
                        
                        if (otherUsers.length > 0) {
                            const randomUser = otherUsers[Math.floor(Math.random() * otherUsers.length)];
                            const replies = [
                                "GÃ¼zel noktaya deÄŸindin!",
                                "KatÄ±lÄ±yorum ðŸ‘",
                                "Harika bir fikir!",
                                "Bu konuda daha fazla konuÅŸalÄ±m",
                                "TeÅŸekkÃ¼rler paylaÅŸÄ±m iÃ§in"
                            ];
                            const replyText = replies[Math.floor(Math.random() * replies.length)];
                            
                            const replyMessage = {
                                id: generateMessageId(),
                                type: 'message',
                                userId: randomUser.id,
                                text: replyText,
                                time: new Date(),
                                channel: SYSTEM.currentChannel
                            };
                            
                            channel.messages.push(replyMessage);
                            addMessageToChat(replyMessage, randomUser);
                        }
                    }
                }
            }, 5000);
            
            SYSTEM.intervals.push(interval2);
            
            // GÃ¼venlik kontrolÃ¼
            const interval3 = setInterval(() => {
                // Global banlÄ± kullanÄ±cÄ±larÄ± kontrol et
                if (SYSTEM.currentUser && DATA.globalBans.has(SYSTEM.currentUser.id)) {
                    addSystemMessage('âŒ Global banlÄ±sÄ±nÄ±z! Sistemden Ã§Ä±kartÄ±lÄ±yorsunuz...');
                    setTimeout(() => {
                        window.location.reload();
                    }, 3000);
                }
                
                // Mute sÃ¼relerini kontrol et
                const channel = DATA.channels[SYSTEM.currentChannel];
                if (channel) {
                    const now = new Date();
                    channel.mutes.forEach((muteEnd, userId) => {
                        if (now > muteEnd) {
                            channel.mutes.delete(userId);
                            if (userId === SYSTEM.currentUser.id) {
                                addSystemMessage('âœ… Susturma sÃ¼reniz doldu. ArtÄ±k mesaj gÃ¶nderebilirsiniz.');
                            }
                        }
                    });
                }
            }, 10000);
            
            SYSTEM.intervals.push(interval3);
        }

        function stopAutoUpdates() {
            SYSTEM.intervals.forEach(interval => clearInterval(interval));
            SYSTEM.intervals = [];
        }

        // ==================== PANEL YÃ–NETÄ°MÄ° ====================
        function updatePanelInfo() {
            const channel = DATA.channels[SYSTEM.currentChannel];
            if (!channel) return;
            
            document.getElementById('panelChannelName').textContent = channel.name;
            document.getElementById('panelChannelTopic').textContent = channel.topic;
            document.getElementById('panelChannelVideo').textContent = channel.video.title;
        }

        function switchPanel(panelName) {
            document.getElementById('onlinePanel').classList.add('hidden');
            document.getElementById('pmPanel').classList.add('hidden');
            
            document.querySelectorAll('.panel-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(`${panelName}Panel`).classList.remove('hidden');
            document.querySelector(`.panel-tab[data-panel="${panelName}"]`).classList.add('active');
            
            if (panelName === 'pm') {
                updatePMConversationList();
            }
        }

        // ==================== DOSYA YÃœKLEME SÄ°STEMÄ° ====================
        function openUploadModal(title) {
            const modal = document.getElementById('uploadModal');
            const titleElement = document.getElementById('uploadTitle');
            const dropZone = document.getElementById('uploadDropZone');
            const fileInput = document.getElementById('fileInput');
            const preview = document.getElementById('uploadPreview');
            const progress = document.getElementById('uploadProgress');
            const sendBtn = document.getElementById('sendUpload');
            
            if (!modal || !titleElement) return;
            
            titleElement.textContent = title;
            preview.style.display = 'none';
            preview.innerHTML = '';
            progress.style.display = 'none';
            sendBtn.disabled = true;
            fileInput.value = '';
            
            dropZone.onclick = () => fileInput.click();
            
            dropZone.ondragover = (e) => {
                e.preventDefault();
                dropZone.style.borderColor = 'var(--accent-blue)';
                dropZone.style.background = 'var(--bg-tertiary)';
            };
            
            dropZone.ondragleave = () => {
                dropZone.style.borderColor = 'var(--border-light)';
                dropZone.style.background = 'transparent';
            };
            
            dropZone.ondrop = (e) => {
                e.preventDefault();
                dropZone.style.borderColor = 'var(--border-light)';
                dropZone.style.background = 'transparent';
                
                if (e.dataTransfer.files.length > 0) {
                    handleFileSelect(e.dataTransfer.files[0]);
                }
            };
            
            fileInput.onchange = () => {
                if (fileInput.files.length > 0) {
                    handleFileSelect(fileInput.files[0]);
                }
            };
            
            modal.style.display = 'flex';
        }

        function handleFileSelect(file) {
            if (!file) return;
            
            if (file.size > 10 * 1024 * 1024) {
                alert('Dosya Ã§ok bÃ¼yÃ¼k! Maksimum 10MB.');
                return;
            }
            
            const preview = document.getElementById('uploadPreview');
            const sendBtn = document.getElementById('sendUpload');
            
            preview.style.display = 'block';
            
            if (file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    preview.innerHTML = `
                        <div style="text-align: center;">
                            <img src="${e.target.result}" style="max-width: 100%; max-height: 200px; border-radius: 8px;">
                            <div style="margin-top: 10px; font-size: 13px;">
                                ${escapeHtml(file.name)} (${(file.size / 1024).toFixed(1)} KB)
                            </div>
                        </div>
                    `;
                    sendBtn.disabled = false;
                };
                reader.readAsDataURL(file);
            } else if (file.type.startsWith('video/')) {
                preview.innerHTML = `
                    <div style="text-align: center;">
                        <div style="background: var(--bg-tertiary); padding: 20px; border-radius: 8px; margin-bottom: 10px;">
                            <i class="fas fa-video" style="font-size: 48px; color: var(--text-secondary);"></i>
                        </div>
                        <div style="font-size: 13px;">
                            ${escapeHtml(file.name)} (${(file.size / 1024).toFixed(1)} KB)
                        </div>
                        <div style="font-size: 12px; color: var(--text-secondary); margin-top: 5px;">
                            ${escapeHtml(file.type)}
                        </div>
                    </div>
                `;
                sendBtn.disabled = false;
            } else {
                preview.innerHTML = `
                    <div style="text-align: center;">
                        <div style="background: var(--bg-tertiary); padding: 20px; border-radius: 8px; margin-bottom: 10px;">
                            <i class="fas fa-file" style="font-size: 48px; color: var(--text-secondary);"></i>
                        </div>
                        <div style="font-size: 13px;">
                            ${escapeHtml(file.name)} (${(file.size / 1024).toFixed(1)} KB)
                        </div>
                        <div style="font-size: 12px; color: var(--text-secondary); margin-top: 5px;">
                            ${escapeHtml(file.type || 'Bilinmeyen dosya tÃ¼rÃ¼')}
                        </div>
                    </div>
                `;
                sendBtn.disabled = false;
            }
        }

        function uploadFile() {
            const fileInput = document.getElementById('fileInput');
            const progress = document.getElementById('uploadProgress');
            const progressBar = document.getElementById('uploadProgressBar');
            const progressText = document.getElementById('uploadProgressText');
            const sendBtn = document.getElementById('sendUpload');
            
            if (!fileInput.files.length) return;
            
            const file = fileInput.files[0];
            const uploadType = SYSTEM.uploadType;
            
            if (!uploadType) return;
            
            progress.style.display = 'block';
            sendBtn.disabled = true;
            
            let progressValue = 0;
            const interval = setInterval(() => {
                progressValue += 5 + Math.random() * 10;
                if (progressValue > 100) progressValue = 100;
                
                progressBar.style.width = `${progressValue}%`;
                progressText.textContent = `%${Math.round(progressValue)}`;
                
                if (progressValue >= 100) {
                    clearInterval(interval);
                    
                    setTimeout(() => {
                        const fileName = escapeHtml(file.name);
                        const fileSize = (file.size / 1024).toFixed(1);
                        
                        if (uploadType.isPM) {
                            sendPrivateMessage(uploadType.target, 
                                `[${uploadType.type.toUpperCase()}] ${fileName} (${fileSize} KB)`);
                        } else {
                            sendChannelMessage(
                                `[${uploadType.type.toUpperCase()}] ${fileName} (${fileSize} KB)`);
                        }
                        
                        closeModal('uploadModal');
                        showNotification('Dosya GÃ¶nderildi', `${fileName} baÅŸarÄ±yla gÃ¶nderildi.`);
                        
                        // Mate bot log
                        if (uploadType.type !== 'camera') {
                            mateBot.sendSecurityAlert(`${SYSTEM.currentUser.name} dosya gÃ¶nderdi: ${fileName} (${fileSize} KB)`, 
                                uploadType.isPM ? null : SYSTEM.currentChannel);
                        }
                    }, 500);
                }
            }, 100);
        }

        // ==================== MODAL YÃ–NETÄ°MÄ° ====================
        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'flex';
            }
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'none';
                
                // Kamera modalÄ± kapatÄ±lÄ±yorsa kamerayÄ± durdur
                if (modalId === 'cameraModal') {
                    stopCamera();
                }
                
                SYSTEM.uploadType = null;
            }
        }

        function closeAllModals() {
            const modals = document.querySelectorAll('.modal-overlay');
            modals.forEach(modal => {
                modal.style.display = 'none';
            });
            
            stopCamera();
            SYSTEM.uploadType = null;
        }

        // ==================== TEMA SÄ°STEMÄ° ====================
        function toggleTheme() {
            if (SYSTEM.theme === 'night') {
                document.body.classList.add('day-mode');
                document.body.classList.remove('night-mode');
                SYSTEM.theme = 'day';
            } else {
                document.body.classList.add('night-mode');
                document.body.classList.remove('day-mode');
                SYSTEM.theme = 'night';
            }
        }

        // ==================== AYARLAR SÄ°STEMÄ° ====================
        function openSettings() {
            const settings = SYSTEM.currentUser;
            if (!settings) return;
            
            document.getElementById('settingsNick').value = settings.name;
            document.getElementById('settingsAvatar').textContent = settings.avatar;
            document.getElementById('settingsBio').value = settings.bio || '';
            document.getElementById('settingsInvisible').checked = settings.invisible;
            
            openModal('settingsModal');
        }

        function saveSettings() {
            const nickInput = document.getElementById('settingsNick');
            const bioInput = document.getElementById('settingsBio');
            const invisibleInput = document.getElementById('settingsInvisible');
            
            const newNick = nickInput.value.trim();
            const bio = bioInput.value.trim();
            const invisible = invisibleInput.checked;
            
            if (newNick && newNick !== SYSTEM.currentUser.name) {
                changeNick(newNick);
            }
            
            SYSTEM.currentUser.bio = bio;
            SYSTEM.currentUser.invisible = invisible;
            
            closeModal('settingsModal');
            updateOnlineList();
            addSystemMessage('âœ… AyarlarÄ±nÄ±z gÃ¼ncellendi.');
        }

        function changeAvatar() {
            const newAvatar = prompt('Yeni avatar karakteri (1 karakter):', SYSTEM.currentUser.avatar);
            if (newAvatar && newAvatar.length === 1) {
                SYSTEM.currentUser.avatar = newAvatar;
                document.getElementById('settingsAvatar').textContent = newAvatar;
                updateOnlineList();
            }
        }

        // ==================== EVENT LISTENERS ====================
        document.addEventListener('DOMContentLoaded', function() {
            // GiriÅŸ butonu
            document.getElementById('loginButton').addEventListener('click', handleLogin);
            
            // Enter ile giriÅŸ
            document.getElementById('nickInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') handleLogin();
            });
            document.getElementById('passInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') handleLogin();
            });
            
            // Mesaj gÃ¶nderme
            document.getElementById('sendBtn').addEventListener('click', sendMessage);
            document.getElementById('messageInput').addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
            
            // Panel tab'larÄ±
            document.querySelectorAll('.panel-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    switchPanel(tab.dataset.panel);
                });
            });
            
            // Kameradan gÃ¶rÃ¼ntÃ¼ Ã§ekme
            document.getElementById('captureImageBtn')?.addEventListener('click', captureImage);
            document.getElementById('recordVideoBtn')?.addEventListener('click', startRecording);
            document.getElementById('stopRecordingBtn')?.addEventListener('click', stopRecording);
            document.getElementById('switchCameraBtn')?.addEventListener('click', switchCamera);
            document.getElementById('sendCameraMedia')?.addEventListener('click', sendCameraMedia);
            
            // Kamera modal butonlarÄ±
            document.getElementById('closeCameraModal')?.addEventListener('click', () => closeModal('cameraModal'));
            document.getElementById('cancelCamera')?.addEventListener('click', () => closeModal('cameraModal'));
            
            // Buton event'leri
            const buttonEvents = {
                'createChannelBtn': () => openModal('channelModal'),
                'settingsBtn': openSettings,
                'themeBtn': toggleTheme,
                'videoManagerBtn': changeChannelVideo,
                'changeVideoBtn': changeChannelVideo,
                'fullscreenBtn': () => {
                    const player = document.getElementById('youtubePlayer');
                    if (player.requestFullscreen) {
                        player.requestFullscreen();
                    }
                },
                'channelInfoBtn': () => {
                    const channel = DATA.channels[SYSTEM.currentChannel];
                    if (!channel) return;
                    
                    document.getElementById('infoChannelName').textContent = channel.name;
                    document.getElementById('infoChannelTopic').textContent = channel.topic;
                    document.getElementById('infoChannelOwner').textContent = 
                        DATA.users[channel.owner]?.name || channel.owner;
                    document.getElementById('infoChannelType').textContent = 
                        channel.type === 'public' ? 'Public' : 
                        channel.type === 'private' ? 'Private' : 'Secret';
                    document.getElementById('infoChannelVideo').textContent = channel.video.title;
                    document.getElementById('infoChannelUsers').textContent = channel.users.size;
                    
                    openModal('channelInfoModal');
                },
                'newPmBtn': () => openModal('newPmModal'),
                
                // Modal kapatma butonlarÄ±
                'closeVideoModal': () => closeModal('videoModal'),
                'cancelVideo': () => closeModal('videoModal'),
                'saveVideo': saveChannelVideo,
                'closeChannelModal': () => closeModal('channelModal'),
                'cancelChannel': () => closeModal('channelModal'),
                'createChannel': createNewChannel,
                'closeChannelInfo': () => closeModal('channelInfoModal'),
                'closeSettings': () => closeModal('settingsModal'),
                'cancelSettings': () => closeModal('settingsModal'),
                'saveSettings': saveSettings,
                'changeAvatarBtn': changeAvatar,
                'closeNewPmModal': () => closeModal('newPmModal'),
                'cancelNewPm': () => closeModal('newPmModal'),
                'startNewPm': () => {
                    const userInput = document.getElementById('pmUserInput');
                    const messageInput = document.getElementById('pmFirstMessage');
                    
                    const targetUser = userInput.value.trim().toLowerCase();
                    const message = messageInput.value.trim();
                    
                    if (!targetUser) {
                        alert('KullanÄ±cÄ± adÄ± gerekli!');
                        return;
                    }
                    
                    if (!DATA.users[targetUser]) {
                        alert('KullanÄ±cÄ± bulunamadÄ±!');
                        return;
                    }
                    
                    if (targetUser === SYSTEM.currentUser.id) {
                        alert('Kendinize mesaj gÃ¶nderemezsiniz!');
                        return;
                    }
                    
                    closeModal('newPmModal');
                    openPrivateChat(targetUser);
                    
                    if (message) {
                        sendPrivateMessage(targetUser, message);
                    }
                    
                    userInput.value = '';
                    messageInput.value = '';
                },
                
                // Dosya yÃ¼kleme
                'closeUploadModal': () => closeModal('uploadModal'),
                'cancelUpload': () => closeModal('uploadModal'),
                'sendUpload': uploadFile,
                
                // Medya butonlarÄ±
                'imageBtn': () => {
                    SYSTEM.uploadType = { type: 'image', target: SYSTEM.currentChannel, isPM: false };
                    openUploadModal('Resim GÃ¶nder');
                },
                'videoBtn': () => {
                    SYSTEM.uploadType = { type: 'video', target: SYSTEM.currentChannel, isPM: false };
                    openUploadModal('Video GÃ¶nder');
                },
                'fileBtn': () => {
                    SYSTEM.uploadType = { type: 'file', target: SYSTEM.currentChannel, isPM: false };
                    openUploadModal('Dosya GÃ¶nder');
                }
            };
            
            // Buton event'lerini ata
            Object.keys(buttonEvents).forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('click', buttonEvents[id]);
                }
            });
            
            // KullanÄ±cÄ± arama Ã¶nerileri
            const pmUserInput = document.getElementById('pmUserInput');
            if (pmUserInput) {
                pmUserInput.addEventListener('input', function() {
                    const query = this.value.trim().toLowerCase();
                    const suggestions = document.getElementById('pmUserSuggestions');
                    
                    if (!query) {
                        suggestions.innerHTML = '';
                        return;
                    }
                    
                    const matches = Object.values(DATA.users)
                        .filter(user => 
                            user.id !== SYSTEM.currentUser.id && 
                            user.id.includes(query) &&
                            user.id !== 'mate')
                        .slice(0, 5);
                    
                    suggestions.innerHTML = '';
                    
                    if (matches.length === 0) {
                        suggestions.innerHTML = '<div style="padding: 10px; text-align: center; color: var(--text-secondary); font-size: 13px;">KullanÄ±cÄ± bulunamadÄ±</div>';
                        return;
                    }
                    
                    matches.forEach(user => {
                        const div = document.createElement('div');
                        div.style.padding = '8px';
                        div.style.cursor = 'pointer';
                        div.style.borderBottom = '1px solid var(--border-light)';
                        div.style.display = 'flex';
                        div.style.alignItems = 'center';
                        div.style.gap = '10px';
                        
                        div.innerHTML = `
                            <div style="width: 30px; height: 30px; border-radius: 50%; background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple)); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">${escapeHtml(user.avatar)}</div>
                            <div>
                                <div style="font-weight: 500;">${escapeHtml(user.name)}</div>
                                <div style="font-size: 11px; color: var(--text-secondary);">
                                    ${user.online ? 'ðŸŸ¢ Ã‡evrimiÃ§i' : 'âš« Ã‡evrimdÄ±ÅŸÄ±'}
                                </div>
                            </div>
                        `;
                        
                        div.addEventListener('click', () => {
                            pmUserInput.value = user.name;
                            suggestions.innerHTML = '';
                        });
                        
                        suggestions.appendChild(div);
                    });
                });
            }
            
            // ESC ile modal kapatma
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    closeAllModals();
                }
            });
            
            // Modal overlay tÄ±klama ile kapatma
            document.querySelectorAll('.modal-overlay').forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.style.display = 'none';
                        SYSTEM.uploadType = null;
                        stopCamera();
                    }
                });
            });
            
            // Sayfa kapatma
            window.addEventListener('beforeunload', () => {
                stopAutoUpdates();
                stopCamera();
            });
            
            // Bildirim izni
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission();
            }
            
            // Ä°lk yÃ¼kleme
            setTimeout(() => {
                if (SYSTEM.currentUser) {
                    addSystemMessage('ðŸ¤– EliteChat sistemine hoÅŸ geldiniz! Mate gÃ¼venlik botu aktif.');
                }
            }, 1000);
        });
    </script>
</body>
</html>
