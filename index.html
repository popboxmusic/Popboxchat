<!-- CETCETY - TAM S√úR√úM (T√úM √ñZELLƒ∞KLER) -->
<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CETCETY ‚Ä¢ Tam S√ºr√ºm</title>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- YouTube API -->
    <script src="https://www.youtube.com/iframe_api"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <style>
        /* ========== TEMEL STILLER ========== */
        html, body {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background: #0f0f0f; color: #fff; overflow: hidden; height: 100vh; transition: 0.2s; }
        body.light-theme { background: #f5f5f5; color: #1a1a1a; }
        
        .app {
            width: 100vw;
            height: 100vh;
            display: flex;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
        }
        
        .main-content {
            flex: 1;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }
        
        .chat-container {
            height: 100vh;
            display: flex;
            flex-direction: column;
            flex: 1;
        }
        
        .messages {
            flex: 1;
            overflow-y: auto;
            min-height: 0;
        }
        
        .media-panel, .left-panel {
            height: 100vh;
            overflow-y: auto;
        }

        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #1a1a1a; }
        ::-webkit-scrollbar-thumb { background: #3f3f3f; border-radius: 3px; }

        /* ========== Gƒ∞Rƒ∞≈û EKRANI ========== */
        #loginOverlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.8); backdrop-filter: blur(10px);
            display: flex; align-items: center; justify-content: center;
            z-index: 1000;
        }
        #loginOverlay.hidden { display: none; }
        .login-panel {
            width: 360px; background: rgba(20,20,20,0.9); border: 1px solid rgba(255,255,255,0.1);
            border-radius: 16px; padding: 32px; color: #fff;
        }
        .login-panel h2 { text-align: center; margin-bottom: 24px; font-size: 24px; }
        .login-panel input {
            width: 100%; padding: 12px 16px; background: #2a2a2a; border: 1px solid #3f3f3f;
            border-radius: 8px; color: #fff; font-size: 14px; margin-bottom: 16px;
        }
        .login-panel input:focus { border-color: #ff0000; outline: none; }
        .password-wrapper { position: relative; }
        .password-wrapper input { padding-right: 45px; }
        .password-toggle {
            position: absolute; right: 12px; top: 14px; color: #aaa; cursor: pointer;
        }
        .login-panel button {
            width: 100%; padding: 14px; background: #ff0000; border: none; border-radius: 8px;
            color: #fff; font-weight: 600; font-size: 16px; cursor: pointer;
        }
        .login-panel button:hover { background: #cc0000; }

        /* ========== SOL ƒ∞KON PANELƒ∞ ========== */
        .icon-panel {
            width: 72px; background: #0a0a0a; border-right: 1px solid #2a2a2a;
            display: flex; flex-direction: column; align-items: center; padding: 24px 0; gap: 24px;
            flex-shrink: 0; z-index: 20;
        }
        .icon-item {
            width: 48px; height: 48px; border-radius: 50%; display: flex; align-items: center;
            justify-content: center; color: #aaa; cursor: pointer; transition: 0.2s; font-size: 20px;
            position: relative;
        }
        .icon-item:hover { background: #2a2a2a; color: #fff; }
        .icon-item.active { color: #fff; background: #ff0000; }
        .icon-badge {
            position: absolute; top: -4px; right: -4px; width: 18px; height: 18px; border-radius: 50%;
            background: #ff4444; color: white; font-size: 10px; display: flex; align-items: center;
            justify-content: center; border: 2px solid #0a0a0a;
        }
        .profile-avatar {
            margin-top: auto; width: 48px; height: 48px; border-radius: 50%;
            background: #ff0000; cursor: pointer; display: flex; align-items: center;
            justify-content: center; font-weight: 600; color: #fff;
            overflow: hidden;
        }
        .profile-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* ========== SOL PANEL ========== */
        .left-panel {
            width: 280px; background: #0a0a0a; border-right: 1px solid #2a2a2a;
            display: flex; flex-direction: column; flex-shrink: 0;
        }
        .panel-header {
            padding: 16px 20px; border-bottom: 1px solid #2a2a2a;
            display: flex; align-items: center; justify-content: space-between;
        }
        .panel-header h3 { display: flex; align-items: center; gap: 8px; font-size: 14px; }
        .panel-close {
            width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center;
            justify-content: center; color: #aaa; cursor: pointer;
        }
        .panel-close:hover { background: #2a2a2a; color: #fff; }
        .panel-content { flex: 1; overflow-y: auto; padding: 20px; }

        /* ========== Lƒ∞STE √ñƒûELERƒ∞ ========== */
        .channel-item, .online-item, .user-item {
            display: flex; align-items: center; gap: 12px; padding: 12px; border-radius: 8px;
            cursor: pointer; margin-bottom: 4px; transition: 0.2s;
        }
        .channel-item:hover, .online-item:hover, .user-item:hover { background: #1a1a1a; }
        .channel-avatar, .online-avatar, .user-avatar {
            width: 36px; height: 36px; border-radius: 50%; background: #1a1a1a;
            display: flex; align-items: center; justify-content: center; color: #ff0000; font-size: 16px;
        }
        .online-avatar { background: #0a5c36; color: #fff; }
        .online-status {
            width: 8px; height: 8px; border-radius: 50%; background: #2ecc71; display: inline-block; margin-right: 6px;
        }

        /* ========== CHAT PANELƒ∞ ========== */
        .chat-container {
            flex: 1; display: flex; flex-direction: column; min-width: 0; background: #0f0f0f;
            position: relative;
        }
        .chat-header {
            padding: 16px 24px; border-bottom: 1px solid #2a2a2a; display: flex;
            align-items: center; justify-content: space-between;
        }
        .chat-title { display: flex; align-items: center; gap: 12px; font-weight: 600; }
        .chat-title i { color: #ff0000; }
        .channel-info-bar { color: #aaa; font-size: 13px; }
        .messages {
            flex: 1; overflow-y: auto; padding: 24px; display: flex; flex-direction: column; gap: 16px;
        }
        .message {
            display: flex; flex-direction: column; max-width: 70%; padding: 8px 12px;
            border-radius: 18px; background: #2a2a2a;
        }
        .message.right { align-self: flex-end; background: #ff0000; color: #fff; }
        .message-header { display: flex; gap: 8px; font-size: 12px; color: #aaa; margin-bottom: 4px; }
        .message.right .message-header { color: rgba(255,255,255,0.8); justify-content: flex-end; }
        .system-message {
            align-self: center; color: #aaa; font-size: 12px; padding: 8px 16px;
            background: #1a1a1a; border-radius: 20px; border: 1px solid #2a2a2a;
        }

        .message-input-container {
            padding: 20px 24px; background: #0a0a0a; border-top: 1px solid #2a2a2a;
        }
        .input-wrapper {
            display: flex; align-items: center; gap: 12px; background: #1a1a1a;
            border: 1px solid #2a2a2a; border-radius: 28px; padding: 4px 4px 4px 20px;
        }
        .message-input {
            flex: 1; background: transparent; border: none; color: #fff; font-size: 14px;
            padding: 12px 0; outline: none;
        }
        .send-btn {
            width: 44px; height: 44px; border-radius: 50%; background: #ff0000;
            display: flex; align-items: center; justify-content: center; cursor: pointer;
        }

        /* ========== MEDYA PANELƒ∞ ========== */
        .media-panel {
            width: 380px; background: #0a0a0a; border-left: 1px solid #2a2a2a;
            display: flex; flex-direction: column; flex-shrink: 0;
        }
        .media-header {
            padding: 16px 20px; border-bottom: 1px solid #2a2a2a; display: flex;
            align-items: center; justify-content: space-between;
        }
        .media-title { display: flex; align-items: center; gap: 8px; font-weight: 600; }
        .media-controls { display: flex; gap: 8px; }
        .media-control {
            width: 36px; height: 36px; border-radius: 50%; background: #1a1a1a;
            display: flex; align-items: center; justify-content: center; cursor: pointer;
            border: 1px solid transparent;
        }
        .media-control:hover { background: #ff0000; color: #fff; }
        .media-control.disabled { 
            opacity: 0.3; 
            cursor: not-allowed; 
            pointer-events: none;
        }
        .media-control.admin { border-color: #ff6b6b; }
        .media-control.coadmin { border-color: #6495ed; }
        
        .youtube-player {
            width: 100%; aspect-ratio: 16/9; background: #000; border-bottom: 1px solid #2a2a2a;
            position: relative;
        }
        #youtubeContainer { width: 100%; height: 100%; }
        
        .spotify-player {
            width: 100%; aspect-ratio: 16/9; background: #121212; border-bottom: 1px solid #2a2a2a;
            display: none;
        }
        .spotify-iframe { width: 100%; height: 100%; border: none; }
        
        .player-controls {
            position: absolute; bottom: 16px; left: 0; right: 0; display: flex;
            justify-content: center; gap: 20px; z-index: 10;
        }
        .player-btn {
            width: 44px; height: 44px; border-radius: 50%; background: rgba(0,0,0,0.7);
            border: 2px solid #fff; display: flex; align-items: center;
            justify-content: center; cursor: pointer;
        }
        .player-btn:hover { background: #ff0000; border-color: #ff0000; }
        
        .now-playing {
            padding: 12px 20px; background: #0f0f0f; border-bottom: 1px solid #2a2a2a;
            display: flex; align-items: center; gap: 12px; font-size: 13px;
        }
        
        .playlist-container { flex: 1; overflow-y: auto; padding: 20px; }
        .playlist-header {
            display: flex; justify-content: space-between; margin-bottom: 16px;
            padding-bottom: 8px; border-bottom: 1px solid #2a2a2a;
        }
        .playlist-item {
            display: flex; align-items: center; gap: 12px; padding: 8px; border-radius: 8px;
            cursor: pointer; margin-bottom: 4px;
        }
        .playlist-item:hover { background: #1a1a1a; }
        .playlist-thumb {
            width: 40px; height: 40px; border-radius: 4px; background: #1a1a1a;
            display: flex; align-items: center; justify-content: center;
        }

        /* ========== √ñZEL SOHBET PANELƒ∞ ========== */
        #privateChatPanel {
            position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            width: 100%; height: 100%; background: #0a0a0a; display: none;
            flex-direction: column; z-index: 30;
        }
        #privateChatPanel.active { display: flex; }
        .private-header {
            padding: 16px 20px; border-bottom: 1px solid #2a2a2a;
            display: flex; align-items: center; justify-content: space-between;
        }
        .private-messages {
            flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 16px;
        }
        .private-message {
            max-width: 80%; padding: 8px 12px; border-radius: 18px; background: #2a2a2a;
        }
        .private-message.right { align-self: flex-end; background: #ff0000; color: #fff; }
        .private-message img { max-width: 100%; border-radius: 8px; margin-top: 8px; cursor: pointer; }
        .private-input-container {
            padding: 20px; background: #0a0a0a; border-top: 1px solid #2a2a2a;
        }
        .private-input-wrapper {
            display: flex; gap: 12px; background: #1a1a1a; border: 1px solid #2a2a2a;
            border-radius: 28px; padding: 4px 4px 4px 20px;
        }
        .private-input {
            flex: 1; background: transparent; border: none; color: #fff; font-size: 14px;
            padding: 12px 0; outline: none;
        }
        .private-media-btn, .private-send-btn {
            width: 44px; height: 44px; border-radius: 50%; background: #333;
            display: flex; align-items: center; justify-content: center; cursor: pointer;
        }
        .private-send-btn { background: #ff0000; }

        /* ========== BADGE ========== */
        .badge {
            display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 10px;
            border: 1px solid; background: rgba(0,0,0,0.3); backdrop-filter: blur(2px);
        }
        .badge-owner { color: #ffd700; border-color: rgba(255,215,0,0.5); }
        .badge-admin { color: #ff6b6b; border-color: rgba(255,107,107,0.5); }
        .badge-coadmin { color: #6495ed; border-color: rgba(100,149,237,0.5); }
        .badge-operator { color: #ffa500; border-color: rgba(255,165,0,0.5); }
        .badge-ow { color: #9370db; border-color: rgba(147,112,219,0.5); }

        /* ========== MODAL ========== */
        .modal {
            display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: #1a1a1a; border: 1px solid #333; border-radius: 12px; padding: 24px;
            z-index: 2000; width: 350px;
        }
        .modal.active { display: block; }
        #modalOverlay {
            display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.7); z-index: 1999;
        }
        #modalOverlay.active { display: block; }
        .modal input, .modal select, .modal button {
            width: 100%; padding: 8px; margin: 5px 0; border-radius: 4px; border: none;
        }
        .modal input, .modal select { background: #2a2a2a; color: #fff; }
        .modal button { background: #ff0000; color: #fff; cursor: pointer; }
        .modal button:hover { opacity: 0.8; }

        /* Profil resmi y√ºkleme */
        .avatar-upload {
            position: relative;
            width: 100px;
            height: 100px;
            margin: 0 auto 20px;
            cursor: pointer;
        }
        .avatar-upload img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid #ff0000;
        }
        .avatar-upload .upload-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: 0.2s;
        }
        .avatar-upload:hover .upload-overlay {
            opacity: 1;
        }
    </style>
</head>
<body>
    <!-- Gƒ∞Rƒ∞≈û -->
    <div id="loginOverlay">
        <div class="login-panel">
            <h2>üéß CETCETY</h2>
            <input type="text" id="loginNick" placeholder="Kullanƒ±cƒ± adƒ±">
            <div class="password-wrapper">
                <input type="password" id="loginPassword" placeholder="≈ûifre">
                <i class="fas fa-eye password-toggle" onclick="togglePassword()"></i>
            </div>
            <button onclick="login()">Giri≈ü Yap</button>
        </div>
    </div>

    <!-- ANA UYGULAMA -->
    <div id="app" style="display: none;">
        <!-- SOL ƒ∞KONLAR -->
        <div class="icon-panel">
            <div class="icon-item" onclick="showHome()" title="Ana Sayfa"><i class="fas fa-home"></i></div>
            <div class="icon-item" onclick="showChannels()" title="Kanallar"><i class="fas fa-list-ul"></i></div>
            <div class="icon-item" onclick="showOnline()" title="√áevrimi√ßi"><i class="fas fa-users"></i><span class="icon-badge" id="onlineBadge">0</span></div>
            <div class="icon-item" onclick="toggleMedia()" title="Medya"><i class="fas fa-music"></i></div>
            <div class="profile-avatar" id="profileAvatar" onclick="showProfile()">?</div>
        </div>

        <div class="main-content">
            <!-- SOL PANEL -->
            <div class="left-panel" id="leftPanel">
                <div class="panel-header">
                    <h3><i class="fas fa-list-ul"></i> Kanallar</h3>
                    <div class="panel-close" onclick="showChannels()"><i class="fas fa-times"></i></div>
                </div>
                <div class="panel-content" id="leftPanelContent">
                    <div class="channel-item" onclick="joinChannel('genel')">
                        <div class="channel-avatar"><i class="fas fa-hashtag"></i></div>
                        <div>
                            <div>genel</div>
                            <div style="font-size:11px; color:#aaa;">üëë MateKy</div>
                        </div>
                    </div>
                    <div class="channel-item" onclick="joinChannel('ow')">
                        <div class="channel-avatar"><i class="fas fa-crown"></i></div>
                        <div>
                            <div>ow <span class="badge badge-ow">üîí</span></div>
                            <div style="font-size:11px; color:#aaa;">üëë MateKy</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- CHAT -->
            <div class="chat-container">
                <div class="chat-header">
                    <div class="chat-title">
                        <i class="fas fa-hashtag"></i>
                        <span id="currentChannel">genel</span>
                    </div>
                    <span class="channel-info-bar" id="onlineCount">0 √ßevrimi√ßi</span>
                </div>
                <div class="messages" id="messages">
                    <div class="system-message">CETCETY'ye ho≈ü geldin!</div>
                </div>
                <div class="message-input-container">
                    <div class="input-wrapper">
                        <input type="text" id="messageInput" class="message-input" placeholder="Mesaj yaz..." onkeypress="if(event.key==='Enter') sendMessage()">
                        <div class="send-btn" onclick="sendMessage()"><i class="fas fa-paper-plane"></i></div>
                    </div>
                </div>
            </div>

            <!-- MEDYA PANELƒ∞ -->
            <div class="media-panel">
                <div class="media-header">
                    <div class="media-title">
                        <i class="fab fa-youtube" style="color:#ff0000;" id="mediaIcon"></i>
                        <span id="mediaTitle">YouTube</span>
                    </div>
                    <div class="media-controls">
                        <div id="adminPanelBtn" class="media-control" onclick="toggleAdminPanel()" title="Y√∂netici Paneli" style="display: none;">
                            <i class="fas fa-crown"></i>
                        </div>
                        <div class="media-control" onclick="openAddModal()" title="Ekle"><i class="fas fa-plus"></i></div>
                        <div id="hideChannelBtn" class="media-control" onclick="toggleChannelHidden()" title="Kanal Gizle" style="display: none;">
                            <i class="fas fa-eye"></i>
                        </div>
                    </div>
                </div>
                
                <div id="youtubePlayer" class="youtube-player">
                    <div id="youtubeContainer"></div>
                    <div class="player-controls">
                        <div class="player-btn" onclick="toggleMute()"><i class="fas fa-volume-up" id="muteIcon"></i></div>
                        <div class="player-btn" onclick="togglePlayPause()"><i class="fas fa-pause" id="playPauseIcon"></i></div>
                    </div>
                </div>
                
                <div id="spotifyPlayer" class="spotify-player">
                    <iframe id="spotifyIframe" class="spotify-iframe"></iframe>
                </div>
                
                <div class="now-playing">
                    <i class="fas fa-circle" style="color:#ff0000;"></i>
                    <span id="nowPlaying">CETCETY Radio</span>
                </div>
                
                <div class="playlist-container">
                    <div class="playlist-header">
                        <span><i class="fas fa-list"></i> Playlist</span>
                        <span id="playlistCount">0</span>
                    </div>
                    <div id="playlistItems"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- √ñZEL SOHBET -->
    <div id="privateChatPanel">
        <div class="private-header">
            <span><i class="fas fa-user"></i> <span id="privateChatName">Kullanƒ±cƒ±</span></span>
            <div onclick="closePrivateChat()"><i class="fas fa-times"></i></div>
        </div>
        <div class="private-messages" id="privateMessages"></div>
        <div class="private-input-container">
            <div class="private-input-wrapper">
                <input type="text" id="privateMessageInput" class="private-input" placeholder="Mesaj yaz..." onkeypress="if(event.key==='Enter') sendPrivateMessage()">
                <div class="private-media-btn" onclick="document.getElementById('privateImage').click()"><i class="fas fa-image"></i></div>
                <div class="private-send-btn" onclick="sendPrivateMessage()"><i class="fas fa-paper-plane"></i></div>
            </div>
            <input type="file" id="privateImage" accept="image/*" style="display:none;" onchange="sendPrivateImage(this)">
        </div>
    </div>

    <!-- MEDYA EKLE MODAL -->
    <div id="addModal" class="modal">
        <h3 style="margin-bottom:15px;">Medya Ekle</h3>
        <select id="mediaType">
            <option value="youtube">YouTube Video</option>
            <option value="spotify">Spotify Playlist</option>
        </select>
        <input type="text" id="mediaUrl" placeholder="URL">
        <input type="text" id="mediaTitle" placeholder="Ba≈ülƒ±k">
        <button onclick="addMedia()">Ekle</button>
    </div>

    <!-- Y√ñNETƒ∞Cƒ∞ PANELƒ∞ MODAL -->
    <div id="adminModal" class="modal">
        <h3 style="margin-bottom:15px;">üëë Y√∂netici Paneli</h3>
        <select id="actionType">
            <option value="ban">Ban</option>
            <option value="kick">Kick</option>
            <option value="unban">Unban</option>
            <option value="coadmin">Co-Admin Yap</option>
            <option value="operator">Operator Yap</option>
        </select>
        <input type="text" id="targetUser" placeholder="Kullanƒ±cƒ± adƒ±">
        <input type="text" id="actionReason" placeholder="Sebep (opsiyonel)">
        <button onclick="executeAdminAction()">Uygula</button>
    </div>

    <!-- PROFƒ∞L MODAL -->
    <div id="profileModal" class="modal">
        <h3 style="margin-bottom:15px;">üë§ Profil</h3>
        <div class="avatar-upload" onclick="document.getElementById('avatarUpload').click()">
            <img id="avatarPreview" src="https://via.placeholder.com/100" alt="Profil">
            <div class="upload-overlay">
                <i class="fas fa-camera"></i>
            </div>
        </div>
        <input type="file" id="avatarUpload" accept="image/*" style="display:none;" onchange="previewAvatar(this)">
        <input type="text" id="newNick" placeholder="Yeni nick">
        <input type="password" id="newPass" placeholder="Yeni ≈üifre">
        <button onclick="updateProfile()">G√ºncelle</button>
        <button onclick="logout()" style="background:#ff4444;">√áƒ±kƒ±≈ü Yap</button>
    </div>

    <!-- Modal Arkaplan -->
    <div id="modalOverlay" onclick="closeAllModals()"></div>

    <script>
        // Firebase
        firebase.initializeApp({
            apiKey: "AIzaSyCrn_tXJZCAlKhem45aXxj4f0h26EPOQ70",
            authDomain: "popboxmusicchat.firebaseapp.com",
            databaseURL: "https://popboxmusicchat-default-rtdb.firebaseio.com",
            projectId: "popboxmusicchat",
            storageBucket: "popboxmusicchat.appspot.com",
            messagingSenderId: "206625719024",
            appId: "1:206625719024:web:d28f478a2c96d10412f835"
        });
        const db = firebase.database();

        // Yetki seviyeleri
        const ROLE_LEVELS = {
            'owner': 5,
            'admin': 4,
            'coadmin': 3,
            'operator': 2,
            'user': 1
        };

        // Deƒüi≈ükenler
        let currentUser = null;
        let currentChannel = 'genel';
        let privateChatWith = null;
        let currentMedia = 'youtube';
        let ytPlayer = null;
        let isMuted = false;
        let isPlaying = true;

        // Giri≈ü
        function login() {
            const nick = document.getElementById('loginNick').value.trim();
            const pass = document.getElementById('loginPassword').value.trim();
            if (!nick) return alert('Nick girin');

            let role = 'user';
            if (nick === 'MateKy') {
                if (pass !== 'Sahi17407@SCM') return alert('≈ûifre hatalƒ±');
                role = 'owner';
            }

            currentUser = {
                id: Date.now().toString(),
                name: nick,
                role: role,
                roleLevel: ROLE_LEVELS[role],
                myChannel: null,
                avatar: null,
                password: pass || '',
                blockedNicks: []
            };

            localStorage.setItem('cetcety_user', JSON.stringify(currentUser));

            document.getElementById('loginOverlay').style.display = 'none';
            document.getElementById('app').style.display = 'flex';
            updateAvatarDisplay();

            db.ref(`online/${currentChannel}/${currentUser.id}`).set({ name: nick, role: role });
            listenMessages();
            listenOnline();
            initYouTube();
            loadPlaylists();
            updateMediaButtons();
        }

        function togglePassword() {
            const input = document.getElementById('loginPassword');
            const icon = document.querySelector('.password-toggle');
            input.type = input.type === 'password' ? 'text' : 'password';
            icon.className = input.type === 'password' ? 'fas fa-eye password-toggle' : 'fas fa-eye-slash password-toggle';
        }

        // Yetki kontrol√º
        function hasPermission(requiredRole) {
            if (!currentUser) return false;
            if (currentUser.role === 'owner') return true;
            if (currentUser.role === 'admin') return requiredRole !== 'owner';
            if (currentUser.role === 'coadmin') return requiredRole !== 'owner' && requiredRole !== 'admin';
            if (currentUser.role === 'operator') return requiredRole === 'operator' || requiredRole === 'user';
            return false;
        }

        function updateMediaButtons() {
            const canEdit = hasPermission('coadmin');
            document.getElementById('adminPanelBtn').style.display = hasPermission('admin') ? 'flex' : 'none';
            document.getElementById('hideChannelBtn').style.display = hasPermission('admin') ? 'flex' : 'none';
            
            const addBtn = document.querySelector('.media-control[onclick="openAddModal()"]');
            if (canEdit) {
                addBtn.classList.remove('disabled');
            } else {
                addBtn.classList.add('disabled');
            }
        }

        // Mesajlar
        function listenMessages() {
            db.ref('messages').orderByChild('timestamp').on('child_added', (data) => {
                const msg = data.val();
                if (msg.channel === currentChannel) {
                    showMessage(msg);
                }
            });
        }

        function showMessage(msg) {
            const div = document.createElement('div');
            div.className = `message${msg.sender === currentUser.name ? ' right' : ''}`;
            
            let roleIcon = '';
            if (msg.role === 'owner') roleIcon = 'üëë ';
            else if (msg.role === 'admin') roleIcon = '‚ö° ';
            else if (msg.role === 'coadmin') roleIcon = 'üîß ';
            else if (msg.role === 'operator') roleIcon = 'üõ†Ô∏è ';
            
            div.innerHTML = `
                <div class="message-header">
                    <span>${roleIcon}${msg.sender}</span>
                    <span>${msg.time || ''}</span>
                </div>
                ${msg.text}
            `;
            document.getElementById('messages').appendChild(div);
            div.scrollIntoView();
        }

        function sendMessage() {
            const input = document.getElementById('messageInput');
            const text = input.value.trim();
            if (!text) return;

            db.ref('messages').push({
                sender: currentUser.name,
                role: currentUser.role,
                text: text,
                channel: currentChannel,
                time: new Date().toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' }),
                timestamp: Date.now()
            });

            input.value = '';
        }

        // Online
        function listenOnline() {
            db.ref(`online/${currentChannel}`).on('value', (data) => {
                const users = data.val() || {};
                document.getElementById('onlineCount').innerText = Object.keys(users).length + ' √ßevrimi√ßi';
                document.getElementById('onlineBadge').innerText = Object.keys(users).length;
                if (document.getElementById('leftPanel').querySelector('.panel-header h3')?.innerText.includes('√áevrimi√ßi')) {
                    showOnlineList(users);
                }
            });
        }

        function showOnlineList(users) {
            let html = '';
            for (let id in users) {
                let roleIcon = '';
                if (users[id].role === 'owner') roleIcon = 'üëë ';
                else if (users[id].role === 'admin') roleIcon = '‚ö° ';
                else if (users[id].role === 'coadmin') roleIcon = 'üîß ';
                else if (users[id].role === 'operator') roleIcon = 'üõ†Ô∏è ';
                
                html += `<div class="online-item" onclick="openPrivateChat('${users[id].name}')">
                    <div class="online-avatar">${users[id].name[0]}</div>
                    <div>
                        <div><span class="online-status"></span> ${roleIcon}${users[id].name}</div>
                        <div style="font-size:11px; color:#aaa;">#${currentChannel}</div>
                    </div>
                </div>`;
            }
            document.getElementById('leftPanelContent').innerHTML = html || '<div style="padding:20px;">Kimse yok</div>';
        }

        // Kanal
        function joinChannel(ch) {
            if (ch === 'ow' && currentUser?.name !== 'MateKy') {
                alert('Bu kanala eri≈üemezsin');
                return;
            }
            
            // Kanal gizli mi kontrol et
            const channels = JSON.parse(localStorage.getItem('cetcety_channels') || '{}');
            if (channels[ch]?.hidden && !hasPermission('admin')) {
                alert('Bu kanal gizli');
                return;
            }
            
            db.ref(`online/${currentChannel}/${currentUser.id}`).remove();
            currentChannel = ch;
            document.getElementById('currentChannel').innerText = ch;
            document.getElementById('messages').innerHTML = '<div class="system-message">#${ch} kanalƒ±na katƒ±ldƒ±n</div>';
            db.ref(`online/${ch}/${currentUser.id}`).set({ name: currentUser.name, role: currentUser.role });
            
            if (ch === 'ow' && currentUser?.name === 'MateKy') loadOW();
            updateMediaButtons();
        }

        // Kanal gizle
        function toggleChannelHidden() {
            if (!hasPermission('admin')) {
                alert('Yetkiniz yok!');
                return;
            }
            
            const channels = JSON.parse(localStorage.getItem('cetcety_channels') || '{}');
            if (!channels[currentChannel]) channels[currentChannel] = {};
            channels[currentChannel].hidden = !channels[currentChannel].hidden;
            localStorage.setItem('cetcety_channels', JSON.stringify(channels));
            
            alert(`Kanal ${channels[currentChannel].hidden ? 'gizlendi' : 'g√∂steriliyor'}`);
        }

        // Owner kanalƒ±
        function loadOW() {
            const msgs = JSON.parse(localStorage.getItem('ow_messages') || '[]');
            msgs.forEach(msg => {
                const div = document.createElement('div');
                div.className = 'system-message';
                div.innerHTML = `üîí ${msg.from} ‚Üí ${msg.to}: ${msg.text}`;
                document.getElementById('messages').appendChild(div);
            });
        }

        // √ñzel sohbet
        function openPrivateChat(name) {
            if (name === currentUser.name) return;
            
            // Engellenmi≈ü mi kontrol et
            if (currentUser.blockedNicks?.includes(name)) {
                alert('Bu kullanƒ±cƒ±yƒ± engellediniz');
                return;
            }
            
            privateChatWith = name;
            document.getElementById('privateChatName').innerText = name;
            document.getElementById('privateChatPanel').classList.add('active');
            document.getElementById('privateMessages').innerHTML = '';
            
            db.ref('private').orderByChild('timestamp').on('child_added', (data) => {
                const msg = data.val();
                if ((msg.from === currentUser.name && msg.to === name) ||
                    (msg.from === name && msg.to === currentUser.name)) {
                    showPrivateMessage(msg);
                }
            });
        }

        function showPrivateMessage(msg) {
            const div = document.createElement('div');
            div.className = `private-message${msg.from === currentUser.name ? ' right' : ''}`;
            
            if (msg.type === 'text') {
                div.innerHTML = `<div class="message-header">${msg.from}</div>${msg.text}`;
            } else {
                div.innerHTML = `<div class="message-header">${msg.from}</div><img src="${msg.text}" onclick="window.open(this.src)">`;
            }
            
            document.getElementById('privateMessages').appendChild(div);
            div.scrollIntoView();

            if (currentUser.name !== 'MateKy') {
                const ow = JSON.parse(localStorage.getItem('ow_messages') || '[]');
                ow.push({
                    from: msg.from,
                    to: msg.to,
                    text: msg.type === 'text' ? msg.text : 'üì∏ Resim',
                    time: new Date().toLocaleTimeString()
                });
                localStorage.setItem('ow_messages', JSON.stringify(ow));
            }
        }

        function sendPrivateMessage() {
            const input = document.getElementById('privateMessageInput');
            const text = input.value.trim();
            if (!text || !privateChatWith) return;

            db.ref('private').push({
                from: currentUser.name,
                to: privateChatWith,
                text: text,
                type: 'text',
                timestamp: Date.now()
            });

            input.value = '';
        }

        function sendPrivateImage(input) {
            if (!input.files || !input.files[0] || !privateChatWith) return;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                db.ref('private').push({
                    from: currentUser.name,
                    to: privateChatWith,
                    text: e.target.result,
                    type: 'image',
                    timestamp: Date.now()
                });
            };
            reader.readAsDataURL(input.files[0]);
        }

        function closePrivateChat() {
            document.getElementById('privateChatPanel').classList.remove('active');
            privateChatWith = null;
        }

        // YouTube
        function initYouTube() {
            if (!window.YT) {
                setTimeout(initYouTube, 500);
                return;
            }
            ytPlayer = new YT.Player('youtubeContainer', {
                height: '100%', width: '100%',
                videoId: 'jfKfPfyJRdk',
                playerVars: { autoplay: 1, controls: 0 },
                events: {
                    onStateChange: (e) => {
                        document.getElementById('playPauseIcon').className = e.data === YT.PlayerState.PLAYING ? 'fas fa-pause' : 'fas fa-play';
                        isPlaying = e.data === YT.PlayerState.PLAYING;
                    }
                }
            });
        }

        function toggleMute() {
            if (!ytPlayer) return;
            if (isMuted) {
                ytPlayer.unMute();
                document.getElementById('muteIcon').className = 'fas fa-volume-up';
            } else {
                ytPlayer.mute();
                document.getElementById('muteIcon').className = 'fas fa-volume-mute';
            }
            isMuted = !isMuted;
        }

        function togglePlayPause() {
            if (!ytPlayer) return;
            if (isPlaying) ytPlayer.pauseVideo();
            else ytPlayer.playVideo();
        }

        // Medya ge√ßi≈ü
        function toggleMedia() {
            const youtube = document.getElementById('youtubePlayer');
            const spotify = document.getElementById('spotifyPlayer');
            const icon = document.getElementById('mediaIcon');
            const title = document.getElementById('mediaTitle');

            if (currentMedia === 'youtube') {
                youtube.style.display = 'none';
                spotify.style.display = 'block';
                icon.className = 'fab fa-spotify';
                icon.style.color = '#1DB954';
                title.innerText = 'Spotify';
                currentMedia = 'spotify';
            } else {
                youtube.style.display = 'block';
                spotify.style.display = 'none';
                icon.className = 'fab fa-youtube';
                icon.style.color = '#ff0000';
                title.innerText = 'YouTube';
                currentMedia = 'youtube';
            }
            loadPlaylists();
        }

        // Playlist
        function getPlaylist(type) {
            const saved = localStorage.getItem(type + '_playlist');
            return saved ? JSON.parse(saved) : [];
        }

        function savePlaylist(type, list) {
            localStorage.setItem(type + '_playlist', JSON.stringify(list));
            loadPlaylists();
        }

        function loadPlaylists() {
            const youtube = getPlaylist('youtube');
            const spotify = getPlaylist('spotify');
            const container = document.getElementById('playlistItems');
            let html = '';

            if (currentMedia === 'youtube') {
                youtube.forEach(item => {
                    html += `<div class="playlist-item" onclick="playYoutube('${item.id}')">
                        <div class="playlist-thumb"><i class="fab fa-youtube"></i></div>
                        <div>${item.title}</div>
                    </div>`;
                });
                document.getElementById('playlistCount').innerText = youtube.length + ' video';
            } else {
                spotify.forEach(item => {
                    html += `<div class="playlist-item" onclick="playSpotify('${item.url}')">
                        <div class="playlist-thumb" style="background:#1DB954;"><i class="fab fa-spotify"></i></div>
                        <div>${item.title}</div>
                    </div>`;
                });
                document.getElementById('playlistCount').innerText = spotify.length + ' playlist';
            }
            container.innerHTML = html || '<div style="padding:20px; text-align:center;">Bo≈ü</div>';
        }

        function playYoutube(id) {
            if (ytPlayer) ytPlayer.loadVideoById(id);
            document.getElementById('nowPlaying').innerText = 'YouTube Video';
        }

        function playSpotify(url) {
            document.getElementById('spotifyIframe').src = url;
            document.getElementById('nowPlaying').innerText = 'Spotify Playlist';
        }

        // Modal
        function openAddModal() {
            if (!hasPermission('coadmin')) {
                alert('Yetkiniz yok!');
                return;
            }
            document.getElementById('addModal').style.display = 'block';
            document.getElementById('modalOverlay').style.display = 'block';
        }

        function toggleAdminPanel() {
            if (!hasPermission('admin')) {
                alert('Yetkiniz yok!');
                return;
            }
            document.getElementById('adminModal').style.display = 'block';
            document.getElementById('modalOverlay').style.display = 'block';
        }

        function closeAllModals() {
            document.getElementById('addModal').style.display = 'none';
            document.getElementById('adminModal').style.display = 'none';
            document.getElementById('profileModal').style.display = 'none';
            document.getElementById('modalOverlay').style.display = 'none';
        }

        function addMedia() {
            const type = document.getElementById('mediaType').value;
            const url = document.getElementById('mediaUrl').value.trim();
            let title = document.getElementById('mediaTitle').value.trim();

            if (!url) return alert('URL girin');

            if (type === 'youtube') {
                let videoId = '';
                if (url.includes('youtube.com/watch?v=')) videoId = url.split('v=')[1]?.split('&')[0];
                else if (url.includes('youtu.be/')) videoId = url.split('youtu.be/')[1]?.split('?')[0];
                else videoId = url;

                if (!videoId || videoId.length < 5) return alert('Ge√ßersiz URL');
                if (!title) title = 'Video ' + (getPlaylist('youtube').length + 1);

                const list = getPlaylist('youtube');
                list.push({ id: videoId, title: title, addedBy: currentUser.name });
                savePlaylist('youtube', list);
            } else {
                let embedUrl = url;
                if (url.includes('open.spotify.com/playlist/')) {
                    const id = url.split('playlist/')[1]?.split('?')[0];
                    embedUrl = `https://open.spotify.com/embed/playlist/${id}`;
                }
                if (!title) title = 'Spotify ' + (getPlaylist('spotify').length + 1);

                const list = getPlaylist('spotify');
                list.push({ url: embedUrl, title: title, addedBy: currentUser.name });
                savePlaylist('spotify', list);
            }

            closeAllModals();
            document.getElementById('mediaUrl').value = '';
            document.getElementById('mediaTitle').value = '';
        }

        // Y√∂netici i≈ülemleri
        function executeAdminAction() {
            const action = document.getElementById('actionType').value;
            const target = document.getElementById('targetUser').value.trim();
            const reason = document.getElementById('actionReason').value.trim();

            if (!target) return alert('Kullanƒ±cƒ± adƒ± girin');

            let msg = '';
            if (action === 'ban') msg = `üö´ ${target} yasaklandƒ±${reason ? ': ' + reason : ''}`;
            else if (action === 'kick') msg = `üë¢ ${target} atƒ±ldƒ±${reason ? ': ' + reason : ''}`;
            else if (action === 'unban') msg = `‚úÖ ${target} yasaƒüƒ± kaldƒ±rƒ±ldƒ±`;
            else if (action === 'coadmin') msg = `üîß ${target} co-admin yapƒ±ldƒ±`;
            else if (action === 'operator') msg = `üõ†Ô∏è ${target} operator yapƒ±ldƒ±`;

            addSystemMessage(msg);
            closeAllModals();
        }

        // Profil
        function showProfile() {
            document.getElementById('profileModal').style.display = 'block';
            document.getElementById('modalOverlay').style.display = 'block';
            
            document.getElementById('newNick').value = currentUser.name;
        }

        function previewAvatar(input) {
            if (!input.files || !input.files[0]) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                document.getElementById('avatarPreview').src = e.target.result;
            };
            reader.readAsDataURL(input.files[0]);
        }

        function updateProfile() {
            const newNick = document.getElementById('newNick').value.trim();
            const newPass = document.getElementById('newPass').value.trim();
            const avatar = document.getElementById('avatarPreview').src;

            if (newNick && newNick !== currentUser.name) {
                currentUser.name = newNick;
            }
            if (newPass) {
                currentUser.password = newPass;
            }
            if (avatar !== 'https://via.placeholder.com/100') {
                currentUser.avatar = avatar;
            }

            localStorage.setItem('cetcety_user', JSON.stringify(currentUser));
            updateAvatarDisplay();
            addSystemMessage('‚úÖ Profil g√ºncellendi');
            closeAllModals();
        }

        function updateAvatarDisplay() {
            const avatarEl = document.getElementById('profileAvatar');
            if (currentUser.avatar) {
                avatarEl.innerHTML = `<img src="${currentUser.avatar}">`;
            } else {
                avatarEl.innerText = currentUser.name[0];
            }
        }

        // Panel y√∂netimi
        function showHome() { addSystemMessage('üè† Ana sayfa'); }
        
        function showChannels() {
            document.getElementById('leftPanel').querySelector('.panel-header h3').innerHTML = '<i class="fas fa-list-ul"></i> Kanallar';
            document.getElementById('leftPanelContent').innerHTML = `
                <div class="channel-item" onclick="joinChannel('genel')">
                    <div class="channel-avatar"><i class="fas fa-hashtag"></i></div>
                    <div>
                        <div>genel</div>
                        <div style="font-size:11px; color:#aaa;">üëë MateKy</div>
                    </div>
                </div>
                <div class="channel-item" onclick="joinChannel('ow')">
                    <div class="channel-avatar"><i class="fas fa-crown"></i></div>
                    <div>
                        <div>ow <span class="badge badge-ow">üîí</span></div>
                        <div style="font-size:11px; color:#aaa;">üëë MateKy</div>
                    </div>
                </div>
            `;
        }

        function showOnline() {
            document.getElementById('leftPanel').querySelector('.panel-header h3').innerHTML = '<i class="fas fa-users"></i> √áevrimi√ßi';
            db.ref(`online/${currentChannel}`).once('value', (data) => {
                showOnlineList(data.val() || {});
            });
        }

        function logout() {
            db.ref(`online/${currentChannel}/${currentUser.id}`).remove();
            localStorage.removeItem('cetcety_user');
            location.reload();
        }

        function addSystemMessage(t) {
            const d = document.createElement('div');
            d.className = 'system-message';
            d.innerText = t;
            document.getElementById('messages').appendChild(d);
            d.scrollIntoView();
        }

        // Ba≈ülangƒ±√ß
        document.addEventListener('DOMContentLoaded', () => {
            const saved = localStorage.getItem('cetcety_user');
            if (saved) {
                currentUser = JSON.parse(saved);
                document.getElementById('loginOverlay').style.display = 'none';
                document.getElementById('app').style.display = 'flex';
                updateAvatarDisplay();
                db.ref(`online/${currentChannel}/${currentUser.id}`).set({ name: currentUser.name, role: currentUser.role });
                listenMessages();
                listenOnline();
                initYouTube();
                loadPlaylists();
                updateMediaButtons();
                addSystemMessage(`üëã Ho≈ü geldin, ${currentUser.name}`);
            }
        });
    </script>
</body>
</html>
