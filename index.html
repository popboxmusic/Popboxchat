<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Popbox Music Chat - YouTube Live + Story</title>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>

  <style>
    :root {
      --bg: #0f0f0f;
      --text: #f1f1f1;
      --primary: #ff0000;
      --input-bg: #272727;
      --border: rgba(255,255,255,0.1);
      --online: #4caf50;
      --owner: #ff4081;
    }
    body {
      margin:0; padding:0; background:var(--bg); color:var(--text);
      font-family: Arial, sans-serif; height:100vh; overflow:hidden;
      display:flex; flex-direction:column;
    }
    header {
      height:56px; background:#000; display:flex; align-items:center; justify-content:space-between;
      padding:0 16px; border-bottom:1px solid var(--border); flex-shrink:0; z-index:10;
    }
    #messages { flex:1; overflow-y:auto; padding:10px; background:var(--bg); }
    .message { margin:8px 0; padding:10px 14px; border-radius:18px; max-width:80%; background:#272727; }
    .message.own { background:var(--primary); color:white; margin-left:auto; margin-right:10px; }
    #input-area { padding:10px; background:#1e1e1e; border-top:1px solid var(--border); display:flex; }
    #message-input { flex:1; padding:12px 16px; background:var(--input-bg); border:none; border-radius:20px; color:white; margin-right:8px; }
    button { padding:0 20px; background:var(--primary); color:white; border:none; border-radius:20px; cursor:pointer; }
    #login-screen { flex:1; display:flex; flex-direction:column; justify-content:center; align-items:center; gap:20px; padding:20px; }
    input { width:100%; max-width:360px; padding:14px; background:#272727; border:none; border-radius:6px; color:white; }
    .hidden { display:none !important; }
    .story-bar { height:80px; background:rgba(0,0,0,0.7); overflow-x:auto; white-space:nowrap; padding:10px; display:flex; gap:12px; }
    .story-item { width:60px; height:60px; border-radius:50%; background:#ff6b6b; display:flex; align-items:center; justify-content:center; color:white; font-weight:bold; cursor:pointer; }
  </style>
</head>
<body>

  <!-- GiriÅŸ EkranÄ± -->
  <div id="login-screen">
    <h2>Popbox Music Chat</h2>
    <input id="nick" placeholder="KullanÄ±cÄ± AdÄ± (nick)">
    <input id="password" type="password" placeholder="Åžifre (kayÄ±tlÄ±ysa)">
    <button onclick="login()">GiriÅŸ Yap</button>
  </div>

  <!-- Ana Ekran -->
  <div id="main" class="hidden">
    <header>
      Popbox Music Chat â€¢ Online: <span id="online-count">0</span>
      <button onclick="logout()">Ã‡Ä±kÄ±ÅŸ</button>
    </header>

    <!-- Story Bar -->
    <div id="story-bar" class="story-bar hidden"></div>

    <div id="messages"></div>

    <div id="input-area">
      <input id="message-input" placeholder="Mesaj yaz...">
      <button onclick="sendMessage()">GÃ¶nder</button>
      <input type="file" id="file-upload" accept="image/*,video/*" style="display:none">
      <button onclick="document.getElementById('file-upload').click()">ðŸ“Ž</button>
    </div>
  </div>

  <!-- Owner Panel (hayalet mod) -->
  <div id="owner-panel" class="hidden" style="position:fixed; inset:0; background:rgba(0,0,0,0.9); z-index:999; color:white; padding:20px; overflow:auto;">
    <h2>Owner Panel (MateKy)</h2>
    <button onclick="document.getElementById('owner-panel').classList.add('hidden')">Kapat</button>
    <hr>
    <div id="private-chats"></div>
    <textarea id="system-msg" placeholder="Sistem mesajÄ± at..."></textarea>
    <button onclick="sendSystemMessage()">GÃ¶nder</button>
  </div>

  <script>
    // Firebase Config (senin gerÃ§ek config'in)
    const firebaseConfig = {
      apiKey: "AIzaSyCrn_tXJZCAlKhem45aXxj4f0h26EPOQ70",
      authDomain: "popboxmusicchat.firebaseapp.com",
      databaseURL: "https://popboxmusicchat-default-rtdb.firebaseio.com",
      projectId: "popboxmusicchat",
      storageBucket: "popboxmusicchat.firebasestorage.app",
      messagingSenderId: "206625719024",
      appId: "1:206625719024:web:d28f478a2c96d10412f835"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();
    const storage = firebase.storage();

    const messagesRef = db.ref('messages');
    const usersRef = db.ref('users');
    const onlineRef = db.ref('online');
    const storiesRef = db.ref('stories');
    const reportsRef = db.ref('reports');
    const privateRef = db.ref('private-messages');
    const commandsRef = db.ref('commands');

    let currentUser = null;
    const OWNER_NICK = "mateky";
    const OWNER_PASS = "sahil7407@SCM";

    // GiriÅŸ
    function login() {
      const nick = document.getElementById('nick').value.trim();
      const pass = document.getElementById('password').value;

      if (!nick) return alert("Nick girin");

      if (nick.toLowerCase() === OWNER_NICK && pass === OWNER_PASS) {
        currentUser = { nick: OWNER_NICK, role: "owner", uid: "owner" };
        startChat();
      } else {
        // Normal kullanÄ±cÄ± (kayÄ±tlÄ±ysa ÅŸifre ile)
        usersRef.child(nick.toLowerCase()).once('value', snap => {
          const data = snap.val();
          if (data && data.pass === pass) {
            currentUser = { nick, uid: snap.key, role: data.role || "user" };
            startChat();
          } else {
            alert("YanlÄ±ÅŸ nick veya ÅŸifre");
          }
        });
      }
    }

    function startChat() {
      document.getElementById('login-screen').classList.add('hidden');
      document.getElementById('main').classList.remove('hidden');

      // Online ekle
      onlineRef.child(currentUser.nick.toLowerCase()).set(true);
      onlineRef.child(currentUser.nick.toLowerCase()).onDisconnect().remove();

      // Mesaj dinle
      messagesRef.on('child_added', snap => {
        const msg = snap.val();
        addMessage(msg.text, msg.nick, msg.nick.toLowerCase() === currentUser.nick.toLowerCase());
      });

      // Online sayÄ±sÄ±nÄ± gÃ¼ncelle
      onlineRef.on('value', snap => {
        document.getElementById('online-count').textContent = snap.numChildren();
      });

      // Owner ise panel butonu ekle
      if (currentUser.role === "owner") {
        const btn = document.createElement('button');
        btn.textContent = "Owner Panel";
        btn.onclick = () => document.getElementById('owner-panel').classList.remove('hidden');
        document.querySelector('header').appendChild(btn);
      }
    }

    function addMessage(text, nick, isOwn) {
      const div = document.createElement('div');
      div.className = 'message' + (isOwn ? ' own' : '');
      div.innerHTML = `<span class="nick">${nick}</span>${text}`;
      document.getElementById('messages').appendChild(div);
      div.scrollIntoView();
    }

    function sendMessage() {
      const input = document.getElementById('message-input');
      const text = input.value.trim();
      if (!text) return;

      messagesRef.push({
        text,
        nick: currentUser.nick,
        timestamp: firebase.database.ServerValue.TIMESTAMP
      });
      input.value = '';
    }

    function logout() {
      onlineRef.child(currentUser.nick.toLowerCase()).remove();
      currentUser = null;
      document.getElementById('main').classList.add('hidden');
      document.getElementById('login-screen').classList.remove('hidden');
    }

    // Enter tuÅŸu ile gÃ¶nderme
    document.getElementById('message-input').addEventListener('keypress', e => {
      if (e.key === 'Enter') sendMessage();
    });

    // Dosya yÃ¼kleme (resim/video)
    document.getElementById('file-upload').addEventListener('change', e => {
      const file = e.target.files[0];
      if (!file) return;

      const ref = storage.ref('media/' + file.name);
      ref.put(file).then(snapshot => {
        snapshot.ref.getDownloadURL().then(url => {
          messagesRef.push({
            text: url,
            nick: currentUser.nick,
            type: file.type.startsWith('image') ? 'image' : 'video',
            timestamp: firebase.database.ServerValue.TIMESTAMP
          });
        });
      });
    });

    // Owner sistem mesajÄ±
    function sendSystemMessage() {
      const text = document.getElementById('system-msg').value.trim();
      if (!text) return;
      messagesRef.push({ text: "[SÄ°STEM] " + text, nick: "SYSTEM" });
      document.getElementById('system-msg').value = '';
    }

    // Basit story ekleme (test)
    function addStory() {
      storiesRef.push({ user: currentUser.nick, content: "Yeni story!", timestamp: Date.now() });
    }

    // Komut ekleme (owner)
    function addCommand(cmd, response) {
      commandsRef.child(cmd).set(response);
    }
  </script>
</body>
</html>
