<!-- CETCETY - T√úM MEDYA √ñZELLƒ∞KLERƒ∞ + YETKƒ∞ ƒ∞KONLARI -->
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>CETCETY</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- YouTube API -->
    <script src="https://www.youtube.com/iframe_api"></script>
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background: #0f0f0f; color: #fff; height: 100vh; display: flex; }
        
        /* Giri≈ü */
        #login {
            position: fixed; inset: 0; background: rgba(0,0,0,0.9); backdrop-filter: blur(10px);
            display: flex; align-items: center; justify-content: center; z-index: 1000;
        }
        .login-box {
            width: 320px; background: #1a1a1a; padding: 30px; border-radius: 16px;
            border: 1px solid #333; text-align: center;
        }
        .login-box h2 { margin-bottom: 20px; color: #f00; }
        .login-box input {
            width: 100%; padding: 12px; margin: 8px 0; background: #2a2a2a;
            border: 1px solid #333; border-radius: 8px; color: #fff;
        }
        .login-box button {
            width: 100%; padding: 12px; margin-top: 16px; background: #f00;
            border: none; border-radius: 8px; color: #fff; font-weight: bold; cursor: pointer;
        }

        /* Ana uygulama */
        .app { display: flex; width: 100%; height: 100vh; }

        /* Sol ikon panel */
        .icon-panel {
            width: 70px; background: #0a0a0a; border-right: 1px solid #2a2a2a;
            display: flex; flex-direction: column; align-items: center; padding: 20px 0; gap: 20px;
        }
        .icon-item {
            width: 46px; height: 46px; border-radius: 50%; display: flex; align-items: center;
            justify-content: center; color: #888; cursor: pointer; font-size: 20px;
            position: relative;
        }
        .icon-item:hover { background: #2a2a2a; color: #fff; }
        .icon-item.active { background: #f00; color: #fff; }
        .icon-badge {
            position: absolute; top: -4px; right: -4px; width: 18px; height: 18px;
            background: #ff4444; border-radius: 50%; color: white; font-size: 10px;
            display: flex; align-items: center; justify-content: center;
            border: 2px solid #0a0a0a;
        }
        .profile-avatar {
            width: 46px; height: 46px; border-radius: 50%; background: #f00;
            display: flex; align-items: center; justify-content: center; font-weight: bold;
            margin-top: auto; cursor: pointer;
            overflow: hidden;
        }
        .profile-avatar img {
            width: 100%; height: 100%; object-fit: cover;
        }

        /* Sol panel */
        .left-panel {
            width: 260px; background: #0a0a0a; border-right: 1px solid #2a2a2a;
            display: flex; flex-direction: column;
        }
        .panel-header {
            padding: 16px; border-bottom: 1px solid #2a2a2a; display: flex;
            align-items: center; justify-content: space-between;
        }
        .panel-content { flex: 1; overflow-y: auto; padding: 16px; }
        .channel-item, .online-item {
            display: flex; align-items: center; gap: 12px; padding: 10px;
            border-radius: 8px; cursor: pointer; margin-bottom: 4px;
        }
        .channel-item:hover, .online-item:hover { background: #1a1a1a; }
        .channel-avatar, .online-avatar {
            width: 36px; height: 36px; border-radius: 50%; background: #2a2a2a;
            display: flex; align-items: center; justify-content: center; color: #f00;
        }
        .online-avatar { background: #0a5c36; color: #fff; }
        .online-status {
            width: 8px; height: 8px; background: #2ecc71; border-radius: 50%; display: inline-block; margin-right: 8px;
        }

        /* Chat */
        .chat-container {
            flex: 1; display: flex; flex-direction: column; background: #0f0f0f;
        }
        .chat-header {
            padding: 16px 24px; border-bottom: 1px solid #2a2a2a;
            display: flex; align-items: center; justify-content: space-between;
        }
        .chat-title i { color: #f00; margin-right: 8px; }
        .messages {
            flex: 1; overflow-y: auto; padding: 24px; display: flex; flex-direction: column; gap: 12px;
        }
        .message {
            max-width: 70%; padding: 10px 14px; border-radius: 18px; background: #2a2a2a;
            align-self: flex-start;
        }
        .message.right {
            align-self: flex-end; background: #f00;
        }
        .message small { display: block; font-size: 11px; opacity: 0.7; margin-bottom: 4px; }
        
        .message-input {
            padding: 20px 24px; border-top: 1px solid #2a2a2a; display: flex; gap: 12px;
        }
        .message-input input {
            flex: 1; padding: 12px 16px; background: #1a1a1a; border: 1px solid #2a2a2a;
            border-radius: 24px; color: #fff; outline: none;
        }
        .message-input button {
            width: 48px; height: 48px; border-radius: 50%; background: #f00;
            border: none; color: #fff; cursor: pointer;
        }

        /* Medya paneli */
        .media-panel {
            width: 380px; background: #0a0a0a; border-left: 1px solid #2a2a2a;
            display: flex; flex-direction: column;
        }
        .media-header {
            padding: 16px; border-bottom: 1px solid #2a2a2a; display: flex;
            align-items: center; justify-content: space-between;
        }
        .media-title { display: flex; align-items: center; gap: 8px; font-weight: 600; }
        .media-controls { display: flex; gap: 8px; flex-wrap: wrap; }
        .media-btn {
            width: 36px; height: 36px; border-radius: 50%; background: #1a1a1a;
            display: flex; align-items: center; justify-content: center; cursor: pointer;
            border: 1px solid transparent;
            transition: 0.2s;
        }
        .media-btn:hover { background: #f00; color: #fff; }
        .media-btn.disabled { opacity: 0.3; cursor: not-allowed; pointer-events: none; }
        .media-btn.owner { border-color: #ffd700; }
        .media-btn.admin { border-color: #ff6b6b; }
        .media-btn.coadmin { border-color: #6495ed; }
        .media-btn.operator { border-color: #ffa500; }
        
        .youtube-player {
            width: 100%; aspect-ratio: 16/9; background: #000; border-bottom: 1px solid #2a2a2a;
        }
        #youtubeContainer { width: 100%; height: 100%; }
        
        .spotify-player {
            width: 100%; aspect-ratio: 16/9; background: #121212; border-bottom: 1px solid #2a2a2a;
            display: none;
        }
        .spotify-iframe { width: 100%; height: 100%; border: none; }
        
        .now-playing {
            padding: 12px 16px; background: #0f0f0f; border-bottom: 1px solid #2a2a2a;
            display: flex; align-items: center; gap: 8px; font-size: 13px;
        }
        
        .playlist {
            flex: 1; overflow-y: auto; padding: 16px;
        }
        .playlist-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 12px; padding-bottom: 8px; border-bottom: 1px solid #2a2a2a;
        }
        .playlist-item {
            display: flex; align-items: center; gap: 12px; padding: 8px;
            border-radius: 8px; cursor: pointer; margin-bottom: 4px;
        }
        .playlist-item:hover { background: #1a1a1a; }
        .playlist-thumb {
            width: 40px; height: 40px; border-radius: 4px; background: #1a1a1a;
            display: flex; align-items: center; justify-content: center;
        }
        .playlist-actions {
            margin-left: auto; display: flex; gap: 4px;
        }
        .playlist-action {
            width: 30px; height: 30px; border-radius: 50%; background: #2a2a2a;
            display: flex; align-items: center; justify-content: center; cursor: pointer;
        }
        .playlist-action:hover { background: #f00; }

        /* Badge'ler */
        .badge {
            display: inline-block; padding: 2px 6px; border-radius: 12px; font-size: 10px;
            margin-left: 6px; background: rgba(0,0,0,0.3); border: 1px solid;
        }
        .badge-owner { color: #ffd700; border-color: #ffd700; }
        .badge-admin { color: #ff6b6b; border-color: #ff6b6b; }
        .badge-coadmin { color: #6495ed; border-color: #6495ed; }
        .badge-operator { color: #ffa500; border-color: #ffa500; }
        .badge-hidden { color: #aaa; border-color: #aaa; }
        .badge-ow { color: #9370db; border-color: #9370db; }

        /* Modal */
        .modal {
            display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: #1a1a1a; border: 1px solid #333; border-radius: 12px; padding: 20px;
            z-index: 2000; width: 350px;
        }
        .modal.active { display: block; }
        .modal-overlay {
            display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 1999;
        }
        .modal-overlay.active { display: block; }
        .modal input, .modal select, .modal textarea, .modal button {
            width: 100%; padding: 8px; margin: 5px 0; border-radius: 4px; border: none;
        }
        .modal input, .modal select, .modal textarea { background: #2a2a2a; color: #fff; }
        .modal button { background: #f00; color: #fff; cursor: pointer; }
        .modal button:hover { opacity: 0.8; }
    </style>
</head>
<body>
    <!-- Giri≈ü -->
    <div id="login">
        <div class="login-box">
            <h2><i class="fas fa-headphones"></i> CETCETY</h2>
            <input type="text" id="nick" placeholder="Kullanƒ±cƒ± adƒ±">
            <input type="password" id="pass" placeholder="≈ûifre">
            <button onclick="login()">Giri≈ü Yap</button>
        </div>
    </div>

    <!-- Ana uygulama -->
    <div id="app" class="app" style="display:none;">
        <!-- Sol ikonlar -->
        <div class="icon-panel">
            <div class="icon-item" onclick="showChannels()" title="Kanallar"><i class="fas fa-list-ul"></i></div>
            <div class="icon-item" onclick="showOnline()" title="√áevrimi√ßi"><i class="fas fa-users"></i><span class="icon-badge" id="onlineBadge">0</span></div>
            <div class="profile-avatar" id="profileAvatar" onclick="showProfile()">?</div>
        </div>

        <!-- Sol panel -->
        <div class="left-panel" id="leftPanel">
            <div class="panel-header">
                <span><i class="fas fa-list-ul"></i> Kanallar</span>
                <i class="fas fa-times" onclick="showChannels()" style="cursor:pointer;"></i>
            </div>
            <div class="panel-content" id="leftPanelContent">
                <div class="channel-item" onclick="joinChannel('genel')">
                    <div class="channel-avatar"><i class="fas fa-hashtag"></i></div>
                    <div>genel</div>
                </div>
                <div class="channel-item" onclick="joinChannel('ow')">
                    <div class="channel-avatar"><i class="fas fa-crown"></i></div>
                    <div>ow <span class="badge badge-ow">üîí</span></div>
                </div>
            </div>
        </div>

        <!-- Chat -->
        <div class="chat-container">
            <div class="chat-header">
                <div class="chat-title">
                    <i class="fas fa-hashtag"></i>
                    <span id="currentChannel">genel</span>
                </div>
                <span id="onlineCount">0 √ßevrimi√ßi</span>
            </div>
            <div class="messages" id="messages"></div>
            <div class="message-input">
                <input type="text" id="messageInput" placeholder="Mesaj yaz..." onkeypress="if(event.key==='Enter') sendMessage()">
                <button onclick="sendMessage()"><i class="fas fa-paper-plane"></i></button>
            </div>
        </div>

        <!-- Medya paneli -->
        <div class="media-panel">
            <div class="media-header">
                <div class="media-title">
                    <i class="fab fa-youtube" style="color:#f00;" id="mediaIcon"></i>
                    <span id="mediaTitle">YouTube</span>
                </div>
                <div class="media-controls">
                    <!-- Yetki ikonlarƒ± - sadece yetkililer g√∂rebilir -->
                    <div id="adminIcon" class="media-btn admin" onclick="openAdminPanel()" title="Admin Paneli" style="display:none;"><i class="fas fa-shield-alt"></i></div>
                    <div id="coadminIcon" class="media-btn coadmin" onclick="openCoAdminPanel()" title="Co-Admin Paneli" style="display:none;"><i class="fas fa-user-tie"></i></div>
                    <div id="operatorIcon" class="media-btn operator" onclick="openOperatorPanel()" title="Operator Paneli" style="display:none;"><i class="fas fa-tools"></i></div>
                    
                    <!-- Video Ekle -->
                    <div class="media-btn" onclick="openAddModal()" title="Video Ekle" id="addYoutubeBtn"><i class="fab fa-youtube"></i></div>
                    
                    <!-- Spotify Ekle -->
                    <div class="media-btn" onclick="openAddSpotifyModal()" title="Spotify Ekle" id="addSpotifyBtn"><i class="fab fa-spotify"></i></div>
                    
                    <!-- Ge√ßi≈ü -->
                    <div class="media-btn" onclick="toggleMedia()" title="YouTube/Spotify Ge√ßi≈ü"><i class="fas fa-exchange-alt"></i></div>
                    
                    <!-- ≈ûikayet Et (herkes) -->
                    <div class="media-btn" onclick="reportChannel()" title="≈ûikayet Et"><i class="fas fa-flag"></i></div>
                    
                    <!-- Playlist Gizle (yetkililer) -->
                    <div id="hidePlaylistBtn" class="media-btn" onclick="togglePlaylistHidden()" title="Playlist Gizle" style="display:none;"><i class="fas fa-eye-slash"></i></div>
                </div>
            </div>
            
            <!-- YouTube Player -->
            <div id="youtubePlayer" class="youtube-player">
                <div id="youtubeContainer"></div>
            </div>
            
            <!-- Spotify Player -->
            <div id="spotifyPlayer" class="spotify-player">
                <iframe id="spotifyIframe" class="spotify-iframe"></iframe>
            </div>
            
            <!-- ≈ûu an √ßalƒ±yor -->
            <div class="now-playing">
                <i class="fas fa-circle" style="color:#f00;"></i>
                <span id="nowPlaying">CETCETY Radio</span>
                <span id="nowPlayingOwner" style="margin-left:auto; font-size:11px; color:#aaa;"></span>
            </div>
            
            <!-- Playlist -->
            <div class="playlist" id="playlistContainer">
                <div class="playlist-header">
                    <span><i class="fas fa-list"></i> <span id="playlistTitle">YouTube Playlist</span></span>
                    <span id="playlistCount">0</span>
                </div>
                <div id="playlistItems" class="playlist-items"></div>
            </div>
        </div>
    </div>

    <!-- YouTube Video Ekle Modal -->
    <div id="addYoutubeModal" class="modal">
        <h3 style="margin-bottom:15px;"><i class="fab fa-youtube" style="color:#f00;"></i> YouTube Video Ekle</h3>
        <input type="text" id="youtubeUrl" placeholder="YouTube URL veya ID">
        <input type="text" id="youtubeTitle" placeholder="Video Ba≈ülƒ±ƒüƒ±">
        <div class="info-box" style="background:#0a0a0a; padding:8px; margin:10px 0; border-left:4px solid #f00; font-size:12px;">
            <i class="fas fa-shield-alt"></i> ≈ûiddet, cinsel i√ßerik, k√ºf√ºr i√ßeren videolar filtrelenir.
        </div>
        <button onclick="addYoutubeVideo()">Videoyu Ekle</button>
    </div>

    <!-- Spotify Ekle Modal -->
    <div id="addSpotifyModal" class="modal">
        <h3 style="margin-bottom:15px;"><i class="fab fa-spotify" style="color:#1DB954;"></i> Spotify Playlist Ekle</h3>
        <input type="text" id="spotifyUrl" placeholder="Spotify Playlist URL">
        <input type="text" id="spotifyTitle" placeholder="Playlist Ba≈ülƒ±ƒüƒ±">
        <div class="info-box" style="background:#0a0a0a; padding:8px; margin:10px 0; border-left:4px solid #1DB954; font-size:12px;">
            <i class="fas fa-info-circle"></i> √ñrnek: https://open.spotify.com/playlist/37i9dQZF1DXcBWIGoYBM5M
        </div>
        <button onclick="addSpotifyPlaylist()" style="background:#1DB954;">Playlist'i Ekle</button>
    </div>

    <!-- ≈ûikayet Modal -->
    <div id="reportModal" class="modal">
        <h3 style="margin-bottom:15px;"><i class="fas fa-flag" style="color:#f00;"></i> Kanal ≈ûikayet Et</h3>
        <select id="reportReason">
            <option value="spam">Spam</option>
            <option value="harassment">Taciz</option>
            <option value="inappropriate">Uygunsuz ƒ∞√ßerik</option>
            <option value="other">Diƒüer</option>
        </select>
        <textarea id="reportDetail" placeholder="Detay (opsiyonel)" rows="3"></textarea>
        <button onclick="submitReport()">≈ûikayet G√∂nder</button>
    </div>

    <!-- Admin Paneli Modal -->
    <div id="adminPanelModal" class="modal">
        <h3 style="margin-bottom:15px;"><i class="fas fa-shield-alt" style="color:#ff6b6b;"></i> Admin Paneli</h3>
        <select id="adminAction">
            <option value="ban">Kullanƒ±cƒ± Banla</option>
            <option value="kick">Kullanƒ±cƒ± At</option>
            <option value="unban">Ban Kaldƒ±r</option>
            <option value="coadmin">Co-Admin Yap</option>
            <option value="operator">Operator Yap</option>
        </select>
        <input type="text" id="adminTarget" placeholder="Kullanƒ±cƒ± adƒ±">
        <input type="text" id="adminReason" placeholder="Sebep (opsiyonel)">
        <button onclick="executeAdminAction()">Uygula</button>
    </div>

    <!-- Co-Admin Paneli Modal -->
    <div id="coadminPanelModal" class="modal">
        <h3 style="margin-bottom:15px;"><i class="fas fa-user-tie" style="color:#6495ed;"></i> Co-Admin Paneli</h3>
        <select id="coadminAction">
            <option value="ban">Kullanƒ±cƒ± Banla</option>
            <option value="kick">Kullanƒ±cƒ± At</option>
            <option value="unban">Ban Kaldƒ±r</option>
            <option value="operator">Operator Yap</option>
        </select>
        <input type="text" id="coadminTarget" placeholder="Kullanƒ±cƒ± adƒ±">
        <input type="text" id="coadminReason" placeholder="Sebep (opsiyonel)">
        <button onclick="executeCoAdminAction()">Uygula</button>
    </div>

    <!-- Operator Paneli Modal -->
    <div id="operatorPanelModal" class="modal">
        <h3 style="margin-bottom:15px;"><i class="fas fa-tools" style="color:#ffa500;"></i> Operator Paneli</h3>
        <select id="operatorAction">
            <option value="ban">Kullanƒ±cƒ± Banla</option>
            <option value="kick">Kullanƒ±cƒ± At</option>
        </select>
        <input type="text" id="operatorTarget" placeholder="Kullanƒ±cƒ± adƒ±">
        <input type="text" id="operatorReason" placeholder="Sebep (opsiyonel)">
        <button onclick="executeOperatorAction()">Uygula</button>
    </div>

    <!-- Owner Paneli Modal -->
    <div id="ownerPanelModal" class="modal">
        <h3 style="margin-bottom:15px;"><i class="fas fa-crown" style="color:#ffd700;"></i> Owner Paneli</h3>
        <select id="ownerAction">
            <option value="addadmin">Admin Yap</option>
            <option value="removeadmin">Admin √áƒ±kar</option>
            <option value="addcoadmin">Co-Admin Yap</option>
            <option value="removecoadmin">Co-Admin √áƒ±kar</option>
            <option value="addoperator">Operator Yap</option>
            <option value="removeoperator">Operator √áƒ±kar</option>
        </select>
        <input type="text" id="ownerTarget" placeholder="Kullanƒ±cƒ± adƒ±">
        <button onclick="executeOwnerAction()">Uygula</button>
    </div>

    <!-- Profil Modal -->
    <div id="profileModal" class="modal">
        <h3 style="margin-bottom:15px;"><i class="fas fa-user"></i> Profil</h3>
        <input type="text" id="newNick" placeholder="Yeni nick">
        <input type="password" id="newPass" placeholder="Yeni ≈üifre">
        <input type="file" id="avatarUpload" accept="image/*" onchange="previewAvatar(this)">
        <div style="text-align:center; margin:10px 0;">
            <img id="avatarPreview" src="" style="width:80px; height:80px; border-radius:50%; display:none;">
        </div>
        <button onclick="updateProfile()">G√ºncelle</button>
        <button onclick="logout()" style="background:#f00;">√áƒ±kƒ±≈ü</button>
    </div>

    <!-- Engelle Modal -->
    <div id="blockModal" class="modal">
        <h3 style="margin-bottom:15px;"><i class="fas fa-ban"></i> Kullanƒ±cƒ± Engelle</h3>
        <input type="text" id="blockUser" placeholder="Kullanƒ±cƒ± adƒ±">
        <button onclick="blockUser()">Engelle</button>
    </div>

    <!-- Modal Arkaplan -->
    <div id="modalOverlay" class="modal-overlay" onclick="closeModal()"></div>

    <script>
        // Firebase
        firebase.initializeApp({
            apiKey: "AIzaSyCrn_tXJZCAlKhem45aXxj4f0h26EPOQ70",
            authDomain: "popboxmusicchat.firebaseapp.com",
            databaseURL: "https://popboxmusicchat-default-rtdb.firebaseio.com",
            projectId: "popboxmusicchat",
            storageBucket: "popboxmusicchat.appspot.com",
            messagingSenderId: "206625719024",
            appId: "1:206625719024:web:d28f478a2c96d10412f835"
        });
        const db = firebase.database();

        // Yetki seviyeleri
        const ROLES = { 'owner': 5, 'admin': 4, 'coadmin': 3, 'operator': 2, 'user': 1 };

        let user = null;
        let channel = 'genel';
        let currentMedia = 'youtube';
        let ytPlayer = null;
        let blockedUsers = JSON.parse(localStorage.getItem('blocked') || '[]');
        let usersDB = JSON.parse(localStorage.getItem('users') || '[]');
        let playlistHidden = false;
        let bannedWords = ['≈üiddet', 'cinsel', 'porn', 'sex', '√∂l√ºm', 'kan', 'silah', 'ter√∂r', 'k√ºf√ºr', 'hakaret'];

        // Giri≈ü
        function login() {
            const nick = document.getElementById('nick').value.trim();
            const pass = document.getElementById('pass').value.trim();
            if (!nick) return alert('Nick girin');

            let role = 'user';
            if (nick === 'MateKy') {
                if (pass !== 'Sahi17407@SCM') return alert('≈ûifre hatalƒ±');
                role = 'owner';
            }

            user = {
                id: Date.now().toString(),
                name: nick,
                role: role,
                roleLevel: ROLES[role],
                password: pass,
                avatar: null
            };
            
            let existing = usersDB.find(u => u.name === nick);
            if (!existing) {
                usersDB.push(user);
                localStorage.setItem('users', JSON.stringify(usersDB));
            }
            
            localStorage.setItem('user', JSON.stringify(user));
            
            document.getElementById('login').style.display = 'none';
            document.getElementById('app').style.display = 'flex';
            updateAvatar();
            
            db.ref(`online/${channel}/${user.id}`).set({ name: user.name, role: user.role });
            listenMessages();
            listenOnline();
            initYouTube();
            loadPlaylists();
            updateMediaButtons();
            showChannels();
        }

        // Avatar
        function updateAvatar() {
            if (user.avatar) {
                document.getElementById('profileAvatar').innerHTML = `<img src="${user.avatar}">`;
            } else {
                document.getElementById('profileAvatar').innerText = user.name[0];
            }
        }

        function previewAvatar(input) {
            if (!input.files || !input.files[0]) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                document.getElementById('avatarPreview').src = e.target.result;
                document.getElementById('avatarPreview').style.display = 'block';
            };
            reader.readAsDataURL(input.files[0]);
        }

        // Yetki kontrol√º
        function hasPermission(requiredRole) {
            if (!user) return false;
            if (user.role === 'owner') return true;
            if (user.role === 'admin') return requiredRole !== 'owner';
            if (user.role === 'coadmin') return requiredRole === 'coadmin' || requiredRole === 'operator' || requiredRole === 'user';
            if (user.role === 'operator') return requiredRole === 'operator' || requiredRole === 'user';
            return false;
        }

        // Medya butonlarƒ±nƒ± g√ºncelle
        function updateMediaButtons() {
            document.getElementById('addYoutubeBtn').style.display = hasPermission('coadmin') ? 'flex' : 'none';
            document.getElementById('addSpotifyBtn').style.display = hasPermission('coadmin') ? 'flex' : 'none';
            document.getElementById('hidePlaylistBtn').style.display = hasPermission('coadmin') ? 'flex' : 'none';
            
            document.getElementById('adminIcon').style.display = user.role === 'admin' || user.role === 'owner' ? 'flex' : 'none';
            document.getElementById('coadminIcon').style.display = user.role === 'coadmin' || user.role === 'admin' || user.role === 'owner' ? 'flex' : 'none';
            document.getElementById('operatorIcon').style.display = user.role === 'operator' || user.role === 'coadmin' || user.role === 'admin' || user.role === 'owner' ? 'flex' : 'none';
        }

        // Paneller
        function openAdminPanel() {
            document.getElementById('adminPanelModal').style.display = 'block';
            document.getElementById('modalOverlay').style.display = 'block';
        }

        function openCoAdminPanel() {
            document.getElementById('coadminPanelModal').style.display = 'block';
            document.getElementById('modalOverlay').style.display = 'block';
        }

        function openOperatorPanel() {
            document.getElementById('operatorPanelModal').style.display = 'block';
            document.getElementById('modalOverlay').style.display = 'block';
        }

        function openOwnerPanel() {
            document.getElementById('ownerPanelModal').style.display = 'block';
            document.getElementById('modalOverlay').style.display = 'block';
        }

        // Admin i≈ülemleri
        function executeAdminAction() {
            const action = document.getElementById('adminAction').value;
            const target = document.getElementById('adminTarget').value.trim();
            const reason = document.getElementById('adminReason').value.trim();
            
            if (!target) return alert('Kullanƒ±cƒ± adƒ± girin');
            
            let msg = '';
            if (action === 'ban') msg = `üö´ ${target} yasaklandƒ±${reason ? ': ' + reason : ''}`;
            else if (action === 'kick') msg = `üë¢ ${target} kanaldan atƒ±ldƒ±${reason ? ': ' + reason : ''}`;
            else if (action === 'unban') msg = `‚úÖ ${target} yasaƒüƒ± kaldƒ±rƒ±ldƒ±`;
            else if (action === 'coadmin') msg = `üîß ${target} co-admin yapƒ±ldƒ±`;
            else if (action === 'operator') msg = `üõ†Ô∏è ${target} operator yapƒ±ldƒ±`;
            
            addSystemMessage(msg);
            closeModal();
        }

        function executeCoAdminAction() {
            const action = document.getElementById('coadminAction').value;
            const target = document.getElementById('coadminTarget').value.trim();
            const reason = document.getElementById('coadminReason').value.trim();
            
            if (!target) return alert('Kullanƒ±cƒ± adƒ± girin');
            
            let msg = '';
            if (action === 'ban') msg = `üö´ ${target} yasaklandƒ±${reason ? ': ' + reason : ''}`;
            else if (action === 'kick') msg = `üë¢ ${target} kanaldan atƒ±ldƒ±${reason ? ': ' + reason : ''}`;
            else if (action === 'unban') msg = `‚úÖ ${target} yasaƒüƒ± kaldƒ±rƒ±ldƒ±`;
            else if (action === 'operator') msg = `üõ†Ô∏è ${target} operator yapƒ±ldƒ±`;
            
            addSystemMessage(msg);
            closeModal();
        }

        function executeOperatorAction() {
            const action = document.getElementById('operatorAction').value;
            const target = document.getElementById('operatorTarget').value.trim();
            const reason = document.getElementById('operatorReason').value.trim();
            
            if (!target) return alert('Kullanƒ±cƒ± adƒ± girin');
            
            let msg = '';
            if (action === 'ban') msg = `üö´ ${target} yasaklandƒ±${reason ? ': ' + reason : ''}`;
            else if (action === 'kick') msg = `üë¢ ${target} kanaldan atƒ±ldƒ±${reason ? ': ' + reason : ''}`;
            
            addSystemMessage(msg);
            closeModal();
        }

        function executeOwnerAction() {
            const action = document.getElementById('ownerAction').value;
            const target = document.getElementById('ownerTarget').value.trim();
            
            if (!target) return alert('Kullanƒ±cƒ± adƒ± girin');
            
            let targetUser = usersDB.find(u => u.name === target);
            if (!targetUser) return alert('Kullanƒ±cƒ± bulunamadƒ±');

            let msg = '';
            if (action === 'addadmin') {
                targetUser.role = 'admin';
                targetUser.roleLevel = 4;
                msg = `‚úÖ ${target} admin yapƒ±ldƒ±`;
            } else if (action === 'removeadmin') {
                targetUser.role = 'user';
                targetUser.roleLevel = 1;
                msg = `‚úÖ ${target} admin yetkisi alƒ±ndƒ±`;
            } else if (action === 'addcoadmin') {
                targetUser.role = 'coadmin';
                targetUser.roleLevel = 3;
                msg = `üîß ${target} co-admin yapƒ±ldƒ±`;
            } else if (action === 'removecoadmin') {
                targetUser.role = 'user';
                targetUser.roleLevel = 1;
                msg = `üî® ${target} co-admin yetkisi alƒ±ndƒ±`;
            } else if (action === 'addoperator') {
                targetUser.role = 'operator';
                targetUser.roleLevel = 2;
                msg = `üõ†Ô∏è ${target} operator yapƒ±ldƒ±`;
            } else if (action === 'removeoperator') {
                targetUser.role = 'user';
                targetUser.roleLevel = 1;
                msg = `üî® ${target} operator yetkisi alƒ±ndƒ±`;
            }

            localStorage.setItem('users', JSON.stringify(usersDB));
            addSystemMessage(msg);
            closeModal();
        }

        // YouTube
        function initYouTube() {
            if (!window.YT) { setTimeout(initYouTube, 500); return; }
            ytPlayer = new YT.Player('youtubeContainer', {
                height: '100%', width: '100%',
                videoId: 'jfKfPfyJRdk',
                playerVars: { autoplay: 1, controls: 0 }
            });
        }

        // Medya ge√ßi≈ü
        function toggleMedia() {
            const youtube = document.getElementById('youtubePlayer');
            const spotify = document.getElementById('spotifyPlayer');
            const icon = document.getElementById('mediaIcon');
            const title = document.getElementById('mediaTitle');
            const playlistTitle = document.getElementById('playlistTitle');

            if (currentMedia === 'youtube') {
                youtube.style.display = 'none';
                spotify.style.display = 'block';
                icon.className = 'fab fa-spotify';
                icon.style.color = '#1DB954';
                title.innerText = 'Spotify';
                playlistTitle.innerText = 'Spotify Playlist';
                currentMedia = 'spotify';
            } else {
                youtube.style.display = 'block';
                spotify.style.display = 'none';
                icon.className = 'fab fa-youtube';
                icon.style.color = '#f00';
                title.innerText = 'YouTube';
                playlistTitle.innerText = 'YouTube Playlist';
                currentMedia = 'youtube';
            }
            loadPlaylists();
        }

        // Playlist gizle
        function togglePlaylistHidden() {
            playlistHidden = !playlistHidden;
            const container = document.getElementById('playlistContainer');
            if (playlistHidden) {
                container.style.display = 'none';
                addSystemMessage('üëÅÔ∏è Playlist gizlendi');
            } else {
                container.style.display = 'block';
                addSystemMessage('üëÅÔ∏è Playlist g√∂steriliyor');
            }
        }

        // Playlist
        function getPlaylist(type) {
            const saved = localStorage.getItem(type + '_playlist');
            return saved ? JSON.parse(saved) : [];
        }

        function savePlaylist(type, list) {
            localStorage.setItem(type + '_playlist', JSON.stringify(list));
            loadPlaylists();
        }

        function loadPlaylists() {
            const youtube = getPlaylist('youtube');
            const spotify = getPlaylist('spotify');
            const container = document.getElementById('playlistItems');
            let html = '';

            if (currentMedia === 'youtube') {
                youtube.forEach((item, index) => {
                    const canDelete = hasPermission('coadmin') || item.addedBy === user.name;
                    html += `<div class="playlist-item" onclick="playYoutube('${item.id}')">
                        <div class="playlist-thumb"><i class="fab fa-youtube"></i></div>
                        <div style="flex:1;">
                            <div>${item.title}</div>
                            <div style="font-size:10px; color:#aaa;">${item.addedBy}</div>
                        </div>
                        ${canDelete ? `
                        <div class="playlist-actions">
                            <div class="playlist-action" onclick="event.stopPropagation(); deleteFromPlaylist('youtube', ${index})"><i class="fas fa-trash"></i></div>
                        </div>` : ''}
                    </div>`;
                });
                document.getElementById('playlistCount').innerText = youtube.length;
            } else {
                spotify.forEach((item, index) => {
                    const canDelete = hasPermission('coadmin') || item.addedBy === user.name;
                    html += `<div class="playlist-item" onclick="playSpotify('${item.url}')">
                        <div class="playlist-thumb" style="background:#1DB954;"><i class="fab fa-spotify"></i></div>
                        <div style="flex:1;">
                            <div>${item.title}</div>
                            <div style="font-size:10px; color:#aaa;">${item.addedBy}</div>
                        </div>
                        ${canDelete ? `
                        <div class="playlist-actions">
                            <div class="playlist-action" onclick="event.stopPropagation(); deleteFromPlaylist('spotify', ${index})"><i class="fas fa-trash"></i></div>
                        </div>` : ''}
                    </div>`;
                });
                document.getElementById('playlistCount').innerText = spotify.length;
            }
            container.innerHTML = html || '<div style="color:#aaa; padding:20px; text-align:center;">Liste bo≈ü</div>';
        }

        function deleteFromPlaylist(type, index) {
            const list = getPlaylist(type);
            list.splice(index, 1);
            savePlaylist(type, list);
            addSystemMessage('üóëÔ∏è Medya kaldƒ±rƒ±ldƒ±');
        }

        function playYoutube(id) {
            if (ytPlayer) ytPlayer.loadVideoById(id);
            document.getElementById('nowPlaying').innerText = 'YouTube Video';
            document.getElementById('nowPlayingOwner').innerText = '';
        }

        function playSpotify(url) {
            document.getElementById('spotifyIframe').src = url;
            document.getElementById('nowPlaying').innerText = 'Spotify Playlist';
            document.getElementById('nowPlayingOwner').innerText = '';
        }

        // YouTube video ekle
        function openAddModal() {
            if (!hasPermission('coadmin')) return alert('Yetkiniz yok!');
            document.getElementById('addYoutubeModal').style.display = 'block';
            document.getElementById('modalOverlay').style.display = 'block';
        }

        function addYoutubeVideo() {
            const url = document.getElementById('youtubeUrl').value.trim();
            let title = document.getElementById('youtubeTitle').value.trim();

            if (!url) return alert('URL girin');

            let videoId = '';
            if (url.includes('youtube.com/watch?v=')) videoId = url.split('v=')[1]?.split('&')[0];
            else if (url.includes('youtu.be/')) videoId = url.split('youtu.be/')[1]?.split('?')[0];
            else videoId = url;

            if (!videoId || videoId.length < 5) return alert('Ge√ßersiz URL');

            // Filtre kontrol√º
            const lowerTitle = title.toLowerCase();
            for (let word of bannedWords) {
                if (lowerTitle.includes(word)) {
                    return alert(`üö´ Yasaklƒ± kelime: ${word}`);
                }
            }

            if (!title) title = 'Video ' + (getPlaylist('youtube').length + 1);

            const list = getPlaylist('youtube');
            list.push({ id: videoId, title: title, addedBy: user.name });
            savePlaylist('youtube', list);
            addSystemMessage(`‚úÖ Video eklendi: ${title}`);

            closeModal();
            document.getElementById('youtubeUrl').value = '';
            document.getElementById('youtubeTitle').value = '';
        }

        // Spotify ekle
        function openAddSpotifyModal() {
            if (!hasPermission('coadmin')) return alert('Yetkiniz yok!');
            document.getElementById('addSpotifyModal').style.display = 'block';
            document.getElementById('modalOverlay').style.display = 'block';
        }

        function addSpotifyPlaylist() {
            const url = document.getElementById('spotifyUrl').value.trim();
            let title = document.getElementById('spotifyTitle').value.trim();

            if (!url) return alert('URL girin');

            let embedUrl = url;
            if (url.includes('open.spotify.com/playlist/')) {
                const id = url.split('playlist/')[1]?.split('?')[0];
                embedUrl = `https://open.spotify.com/embed/playlist/${id}`;
            }

            if (!title) title = 'Spotify ' + (getPlaylist('spotify').length + 1);

            const list = getPlaylist('spotify');
            list.push({ url: embedUrl, title: title, addedBy: user.name });
            savePlaylist('spotify', list);
            addSystemMessage(`‚úÖ Spotify playlist eklendi: ${title}`);

            closeModal();
            document.getElementById('spotifyUrl').value = '';
            document.getElementById('spotifyTitle').value = '';
        }

        // ≈ûikayet
        function reportChannel() {
            document.getElementById('reportModal').style.display = 'block';
            document.getElementById('modalOverlay').style.display = 'block';
        }

        function submitReport() {
            const reason = document.getElementById('reportReason').value;
            const detail = document.getElementById('reportDetail').value.trim();
            
            let reasonText = '';
            if (reason === 'spam') reasonText = 'Spam';
            else if (reason === 'harassment') reasonText = 'Taciz';
            else if (reason === 'inappropriate') reasonText = 'Uygunsuz ƒ∞√ßerik';
            else reasonText = 'Diƒüer';
            
            addSystemMessage(`üö© #${channel} ≈üikayet edildi (${reasonText})${detail ? ': ' + detail : ''}`);
            
            if (user.role === 'owner' || user.role === 'admin') {
                addSystemMessage(`ü§ñ ≈ûikayet alƒ±ndƒ±, incelenecek.`);
            }
            
            closeModal();
        }

        // Mesajlar
        function listenMessages() {
            db.ref('messages').orderByChild('timestamp').on('child_added', (data) => {
                const msg = data.val();
                if (msg.channel === channel) addMessage(msg);
            });
        }

        function addMessage(msg) {
            let roleIcon = '';
            if (msg.role === 'owner') roleIcon = 'üëë ';
            else if (msg.role === 'admin') roleIcon = '‚ö° ';
            else if (msg.role === 'coadmin') roleIcon = 'üîß ';
            else if (msg.role === 'operator') roleIcon = 'üõ†Ô∏è ';

            const div = document.createElement('div');
            div.className = `message${msg.sender === user.name ? ' right' : ''}`;
            div.innerHTML = `<small>${roleIcon}${msg.sender}</small><br>${msg.text}`;
            document.getElementById('messages').appendChild(div);
            div.scrollIntoView();
        }

        function sendMessage() {
            const input = document.getElementById('messageInput');
            const text = input.value.trim();
            if (!text) return;

            // Yasaklƒ± kelime kontrol√º
            const lowerText = text.toLowerCase();
            for (let word of bannedWords) {
                if (lowerText.includes(word)) {
                    addSystemMessage(`üö´ Yasaklƒ± kelime tespit edildi: "${word}"`);
                    return;
                }
            }

            db.ref('messages').push({
                sender: user.name,
                role: user.role,
                text: text,
                channel: channel,
                timestamp: Date.now()
            });

            input.value = '';
        }

        // Online
        function listenOnline() {
            db.ref(`online/${channel}`).on('value', (data) => {
                const users = data.val() || {};
                const count = Object.keys(users).length;
                document.getElementById('onlineCount').innerText = count + ' √ßevrimi√ßi';
                document.getElementById('onlineBadge').innerText = count;
            });
        }

        // Kanal
        function joinChannel(ch) {
            if (ch === 'ow' && user?.name !== 'MateKy') return alert('Eri≈üemezsin');
            
            db.ref(`online/${channel}/${user.id}`).remove();
            channel = ch;
            document.getElementById('currentChannel').innerText = ch;
            document.getElementById('messages').innerHTML = '';
            db.ref(`online/${ch}/${user.id}`).set({ name: user.name, role: user.role });
            showChannels();
        }

        // Paneller
        function showChannels() {
            let html = `
                <div class="channel-item" onclick="joinChannel('genel')">
                    <div class="channel-avatar"><i class="fas fa-hashtag"></i></div>
                    <div>genel</div>
                </div>
                <div class="channel-item" onclick="joinChannel('ow')">
                    <div class="channel-avatar"><i class="fas fa-crown"></i></div>
                    <div>ow <span class="badge badge-ow">üîí</span></div>
                </div>
            `;
            
            if (user.role === 'owner') {
                html += `<div class="channel-item" onclick="openOwnerPanel()">
                    <div class="channel-avatar"><i class="fas fa-crown" style="color:#ffd700;"></i></div>
                    <div>üëë Owner Paneli</div>
                </div>`;
            }
            
            document.getElementById('leftPanelContent').innerHTML = html;
        }

        function showOnline() {
            db.ref(`online/${channel}`).once('value', (data) => {
                const users = data.val() || {};
                let html = '';
                for (let id in users) {
                    let roleIcon = '';
                    if (users[id].role === 'owner') roleIcon = 'üëë ';
                    else if (users[id].role === 'admin') roleIcon = '‚ö° ';
                    else if (users[id].role === 'coadmin') roleIcon = 'üîß ';
                    else if (users[id].role === 'operator') roleIcon = 'üõ†Ô∏è ';
                    
                    html += `<div class="online-item" onclick="openPrivate('${users[id].name}')">
                        <div class="online-avatar">${users[id].name[0]}</div>
                        <div><span class="online-status"></span> ${roleIcon}${users[id].name}</div>
                    </div>`;
                }
                document.getElementById('leftPanelContent').innerHTML = html || '<div style="padding:20px;">Kimse yok</div>';
            });
        }

        function showProfile() {
            let buttons = `
                <button onclick="openProfileModal()" style="margin:5px; padding:8px; background:#00f; border:none; color:#fff; border-radius:5px;">Profili D√ºzenle</button>
                <button onclick="openBlockModal()" style="margin:5px; padding:8px; background:#ff0; border:none; color:#000; border-radius:5px;">Engelle</button>
            `;
            
            if (user.role === 'owner') {
                buttons += `<button onclick="openOwnerPanel()" style="margin:5px; padding:8px; background:#ffd700; border:none; color:#000; border-radius:5px;">üëë Owner Paneli</button>`;
            }
            
            document.getElementById('leftPanelContent').innerHTML = `
                <div style="text-align:center; padding:20px;">
                    <div style="width:80px; height:80px; background:#f00; border-radius:50%; margin:0 auto 10px; display:flex; align-items:center; justify-content:center; font-size:32px;">
                        ${user.name[0]}
                    </div>
                    <h3>${user.name}</h3>
                    <p>${user.role === 'owner' ? 'üëë Owner' : 
                         user.role === 'admin' ? '‚ö° Admin' : 
                         user.role === 'coadmin' ? 'üîß Co-Admin' : 
                         user.role === 'operator' ? 'üõ†Ô∏è Operator' : 'üë§ User'}</p>
                    ${buttons}
                    <button onclick="logout()" style="margin-top:20px; padding:8px 20px; background:#f00; border:none; color:#fff; border-radius:5px; cursor:pointer;">√áƒ±kƒ±≈ü</button>
                </div>
            `;
        }

        function openPrivate(name) {
            if (name === user.name) return;
            if (blockedUsers.includes(name)) return alert('Bu kullanƒ±cƒ±yƒ± engellediniz');
            
            const msg = prompt(`${name} ile √∂zel mesaj:`, '');
            if (msg) addSystemMessage(`üì® ${user.name} ‚Üí ${name}: ${msg}`);
        }

        function addSystemMessage(t) {
            const div = document.createElement('div');
            div.className = 'message';
            div.style.background = '#333';
            div.style.textAlign = 'center';
            div.style.maxWidth = '90%';
            div.style.alignSelf = 'center';
            div.innerText = t;
            document.getElementById('messages').appendChild(div);
            div.scrollIntoView();
        }

        // Profil i≈ülemleri
        function openProfileModal() {
            document.getElementById('profileModal').style.display = 'block';
            document.getElementById('modalOverlay').style.display = 'block';
        }

        function updateProfile() {
            const newNick = document.getElementById('newNick').value.trim();
            const newPass = document.getElementById('newPass').value.trim();
            const avatar = document.getElementById('avatarPreview').src;

            if (newNick) user.name = newNick;
            if (newPass) user.password = newPass;
            if (avatar && avatar !== '') user.avatar = avatar;

            localStorage.setItem('user', JSON.stringify(user));
            updateAvatar();
            closeModal();
            alert('Profil g√ºncellendi');
        }

        function openBlockModal() {
            document.getElementById('blockModal').style.display = 'block';
            document.getElementById('modalOverlay').style.display = 'block';
        }

        function blockUser() {
            const name = document.getElementById('blockUser').value.trim();
            if (!name) return alert('ƒ∞sim girin');
            if (!blockedUsers.includes(name)) blockedUsers.push(name);
            localStorage.setItem('blocked', JSON.stringify(blockedUsers));
            closeModal();
            alert(name + ' engellendi');
        }

        // Modal
        function closeModal() {
            document.querySelectorAll('.modal').forEach(m => m.style.display = 'none');
            document.getElementById('modalOverlay').style.display = 'none';
        }

        function logout() {
            db.ref(`online/${channel}/${user.id}`).remove();
            localStorage.removeItem('user');
            location.reload();
        }

        // Otomatik giri≈ü
        const saved = localStorage.getItem('user');
        if (saved) {
            user = JSON.parse(saved);
            blockedUsers = JSON.parse(localStorage.getItem('blocked') || '[]');
            usersDB = JSON.parse(localStorage.getItem('users') || '[]');
            document.getElementById('login').style.display = 'none';
            document.getElementById('app').style.display = 'flex';
            updateAvatar();
            db.ref(`online/${channel}/${user.id}`).set({ name: user.name, role: user.role });
            listenMessages();
            listenOnline();
            initYouTube();
            loadPlaylists();
            updateMediaButtons();
            showChannels();
        }
    </script>
</body>
</html>
