<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>YouTube Live + IRC Sohbet</title>
    
    <!-- CSS DOSYASI -->
    <link rel="stylesheet" href="style.css">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- YouTube IFrame API -->
    <script src="https://www.youtube.com/iframe_api"></script>
    <!-- Socket.io -->
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
</head>
<body>
    <!-- Mobile Menu Butonu -->
    <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="Sohbeti aÃ§/kapat">
        <i class="fas fa-comments"></i>
    </button>
    
    <div class="container">
        <!-- YouTube CanlÄ± YayÄ±n -->
        <section class="stream-section">
            <div class="stream-container">
                <div id="youtube-player"></div>
            </div>
            
            <div class="stream-info">
                <h2 id="stream-title">YouTube CanlÄ± YayÄ±n</h2>
                <p id="stream-status">ğŸ“¡ YayÄ±n yÃ¼kleniyor...</p>
                <div id="stream-stats">
                    <span>ğŸ‘ï¸ <span id="view-count">0</span> izleyici</span>
                    <span> | </span>
                    <span>ğŸ’¬ <span id="chat-count">0</span> mesaj</span>
                </div>
            </div>
        </section>
        
        <!-- Sohbet -->
        <section class="chat-section">
            <div class="chat-header">
                <div class="channel-info">
                    <div class="channel-name">#canli-yayin</div>
                    <div class="online-count">
                        <i class="fas fa-users"></i>
                        <span id="online-count">1</span>
                    </div>
                </div>
                <div class="channel-topic">
                    <small id="channel-topic">YouTube canlÄ± yayÄ±n sohbeti</small>
                </div>
            </div>
            
            <!-- Online KullanÄ±cÄ±lar -->
            <div class="users-container">
                <h4><i class="fas fa-user-friends"></i> Ã‡evrimiÃ§i</h4>
                <ul class="user-list" id="user-list">
                    <!-- KullanÄ±cÄ±lar buraya eklenecek -->
                </ul>
            </div>
            
            <!-- Mesajlar -->
            <div class="messages-container" id="messages-container">
                <div class="message system-message">
                    <div class="message-header">
                        <span class="message-user">Sistem</span>
                        <span class="message-time">HoÅŸ Geldin</span>
                    </div>
                    <div class="message-content">
                        Sohbete hoÅŸ geldiniz! /help yazarak komutlarÄ± gÃ¶rebilirsiniz.
                    </div>
                </div>
            </div>
            
            <!-- Mesaj GÃ¶nderme -->
            <div class="message-input-container">
                <div class="input-group">
                    <input type="text" 
                           id="message-input" 
                           placeholder="Mesaj yazÄ±n... (/help iÃ§in)"
                           autocomplete="off">
                    
                    <!-- Resim YÃ¼kle -->
                    <label for="image-upload" class="btn btn-upload" title="Resim YÃ¼kle">
                        <i class="fas fa-image"></i>
                    </label>
                    <input type="file" 
                           id="image-upload" 
                           accept="image/*" 
                           style="display: none;">
                    
                    <button id="send-button" class="btn">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
                <div id="command-hint" style="display: none;">
                    <strong>Komutlar:</strong> /nick, /msg, /me, /help
                </div>
            </div>
        </section>
    </div>
    
    <!-- Modal (BÃ¼yÃ¼k Resim) -->
    <div id="image-modal">
        <img id="modal-image" src="" alt="BÃ¼yÃ¼tÃ¼lmÃ¼ÅŸ resim">
        <button id="close-modal">Kapat</button>
    </div>
    
    <script>
        // YouTube Player
        let youtubePlayer;
        
        function onYouTubeIframeAPIReady() {
            youtubePlayer = new YT.Player('youtube-player', {
                height: '100%',
                width: '100%',
                videoId: 'dQw4w9WgXcQ', // DEÄÄ°ÅTÄ°R: Kendi video ID'n
                playerVars: {
                    'autoplay': 0,
                    'controls': 1,
                    'rel': 0
                },
                events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange
                }
            });
        }
        
        function onPlayerReady(event) {
            console.log('YouTube player hazÄ±r');
            document.getElementById('stream-title').textContent = 
                event.target.getVideoData().title || 'YouTube Live';
        }
        
        function onPlayerStateChange(event) {
            const status = ['Bitti', 'OynatÄ±lÄ±yor', 'DuraklatÄ±ldÄ±', 'YÃ¼kleniyor', '?'];
            document.getElementById('stream-status').textContent = 
                'ğŸ“¡ ' + (status[event.data] || 'YayÄ±n');
        }
        
        // Mobile Menu
        const mobileMenuToggle = document.getElementById('mobileMenuToggle');
        const chatSection = document.querySelector('.chat-section');
        
        if (mobileMenuToggle && chatSection) {
            mobileMenuToggle.addEventListener('click', () => {
                chatSection.classList.toggle('active');
                mobileMenuToggle.innerHTML = chatSection.classList.contains('active') 
                    ? '<i class="fas fa-times"></i>' 
                    : '<i class="fas fa-comments"></i>';
            });
        }
        
        // Socket.io (client.js'den gelecek)
        const socket = io('http://localhost:3000');
        
        // Nickname sor
        document.addEventListener('DOMContentLoaded', function() {
            const nickname = prompt('Nickname girin:', 'KullanÄ±cÄ±' + Math.floor(Math.random() * 1000));
            if (nickname) {
                socket.emit('join', { nickname: nickname, room: 'main' });
            }
            
            // Mesaj gÃ¶nderme
            document.getElementById('send-button').addEventListener('click', sendMessage);
            document.getElementById('message-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') sendMessage();
            });
            
            // Resim yÃ¼kleme
            document.getElementById('image-upload').addEventListener('change', handleImageUpload);
            
            // Modal
            document.getElementById('close-modal').addEventListener('click', function() {
                document.getElementById('image-modal').style.display = 'none';
            });
        });
        
        function sendMessage() {
            const input = document.getElementById('message-input');
            const message = input.value.trim();
            if (!message) return;
            
            if (message.startsWith('/')) {
                handleCommand(message);
            } else {
                socket.emit('message', {
                    room: 'main',
                    message: message
                });
            }
            
            input.value = '';
        }
        
        function handleCommand(command) {
            const parts = command.split(' ');
            const cmd = parts[0];
            
            if (cmd === '/help') {
                addMessage('Sistem', 'Komutlar: /nick [yeni], /msg [kullanÄ±cÄ±] [mesaj], /me [aksiyon]');
            } else if (cmd === '/nick' && parts[1]) {
                socket.emit('command', { command: 'nick', args: [parts[1]] });
            } else if (cmd === '/msg' && parts.length >= 3) {
                socket.emit('command', { 
                    command: 'msg', 
                    args: [parts[1], parts.slice(2).join(' ')] 
                });
            } else {
                addMessage('Sistem', 'Bilinmeyen komut: ' + cmd);
            }
        }
        
        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                socket.emit('image-message', {
                    image: e.target.result,
                    filename: file.name
                });
            };
            reader.readAsDataURL(file);
        }
        
        function addMessage(user, message, isSystem = false) {
            const container = document.getElementById('messages-container');
            const div = document.createElement('div');
            div.className = isSystem ? 'message system-message' : 'message';
            
            div.innerHTML = `
                <div class="message-header">
                    <span class="message-user">${user}</span>
                    <span class="message-time">${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</span>
                </div>
                <div class="message-content">${message}</div>
            `;
            
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }
        
        // Socket.io events
        socket.on('message', (data) => {
            addMessage(data.user, data.message);
        });
        
        socket.on('system-message', (data) => {
            addMessage('Sistem', data.message, true);
        });
        
        socket.on('user-list', (users) => {
            const userList = document.getElementById('user-list');
            userList.innerHTML = '';
            document.getElementById('online-count').textContent = users.length;
            
            users.forEach(user => {
                const li = document.createElement('li');
                li.className = 'user-item';
                li.innerHTML = `
                    <span class="user-badge badge-${user.role || 'normal'}">
                        ${user.role === 'admin' ? '@' : user.role === 'mod' ? '%' : ''}
                    </span>
                    <span class="user-name">${user.nickname}</span>
                `;
                userList.appendChild(li);
            });
        });
        
        socket.on('private-message', (data) => {
            addMessage(`[Ã–zel] ${data.from}`, data.message);
        });
    </script>
</body>
</html>
