<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Popbox YouTube Live Chat</title>
    <style>
        body { margin:0; padding:20px; background:#1a1a2e; color:white; font-family:Arial; }
        .container { display:flex; gap:20px; height:90vh; }
        .player { flex:3; background:#000; border-radius:15px; overflow:hidden; }
        .chat { flex:1; background:#2d2d44; border-radius:15px; padding:20px; display:flex; flex-direction:column; }
        #messages { flex:1; overflow-y:auto; margin-bottom:15px; }
        .message { background:#3d3d5c; padding:10px; margin:8px 0; border-radius:8px; border-left:3px solid #4fc3f7; }
        .admin-btn { background:#ff5555; color:white; border:none; padding:12px; border-radius:8px; cursor:pointer; font-weight:bold; margin-top:10px; }
        input, button { padding:12px; border-radius:8px; border:none; }
        input { background:#1e1e2e; color:white; width:100%; }
        button { background:#4fc3f7; color:white; cursor:pointer; }
        @media (max-width:768px) { .container { flex-direction:column; } .player { height:300px; } }
    </style>
    <script src="https://www.youtube.com/iframe_api"></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
</head>
<body>
    <h1 style="color:#4fc3f7; text-align:center;">ğŸ¥ Popbox YouTube Live</h1>
    
    <div class="container">
        <!-- YouTube -->
        <div class="player">
            <div id="youtube-player"></div>
        </div>
        
        <!-- Sohbet -->
        <div class="chat">
            <h3 style="color:#4fc3f7; margin-top:0;">ğŸ’¬ Popbox Chat</h3>
            
            <div id="messages">
                <div class="message">
                    <strong>ğŸ¤– Sistem:</strong> HoÅŸ geldiniz! Sunucu: <span id="serverStatus">BaÄŸlanÄ±yor...</span>
                </div>
            </div>
            
            <input type="text" id="messageInput" placeholder="MesajÄ±nÄ±z..." autocomplete="off">
            <button onclick="sendMessage()" style="margin-top:10px;">ğŸ“¤ GÃ¶nder</button>
            <button class="admin-btn" onclick="adminLogin()">ğŸ‘‘ Popbox Admin GiriÅŸi</button>
            
            <div style="margin-top:15px; font-size:12px; color:#888; text-align:center;">
                ğŸ” Admin: <strong>popbox</strong> | Åifre: <strong>kumsal07@</strong>
            </div>
        </div>
    </div>
    
    <script>
        // ========== AYARLAR ==========
        const SERVER_URL = 'http://localhost:3000'; // DEÄÄ°ÅTÄ°R: Kendi sunucu URL'n
        
        // ========== DEÄÄ°ÅKENLER ==========
        let socket = null;
        let player = null;
        let currentUser = 'KullanÄ±cÄ±_' + Math.floor(Math.random() * 1000);
        
        // ========== YOUTUBE ==========
        function onYouTubeIframeAPIReady() {
            player = new YT.Player('youtube-player', {
                height: '100%',
                width: '100%',
                videoId: 'dQw4w9WgXcQ', // KENDÄ° VÄ°DEO ID'N
                playerVars: { autoplay: 0, controls: 1, rel: 0 }
            });
        }
        
        // ========== SOCKET BAÄLANTISI ==========
        function connectSocket() {
            console.log('ğŸ”Œ Sunucuya baÄŸlanÄ±lÄ±yor:', SERVER_URL);
            
            socket = io(SERVER_URL, {
                transports: ['websocket', 'polling'],
                reconnection: true,
                reconnectionAttempts: 5
            });
            
            socket.on('connect', () => {
                console.log('âœ… Sunucuya baÄŸlandÄ±!');
                document.getElementById('serverStatus').textContent = 'BaÄŸlÄ± âœ“';
                addMessage('Sistem', 'âœ… Sunucuya baÄŸlandÄ±!');
                
                // KullanÄ±cÄ± adÄ± iste
                const name = prompt('KullanÄ±cÄ± adÄ±nÄ±z:', currentUser);
                if (name && name.trim()) {
                    currentUser = name.trim();
                    socket.emit('join', { username: currentUser });
                    addMessage('Sistem', `ğŸ‘‹ HoÅŸ geldin, ${currentUser}!`);
                }
            });
            
            socket.on('connect_error', (error) => {
                console.error('âŒ BaÄŸlantÄ± hatasÄ±:', error);
                document.getElementById('serverStatus').textContent = 'BaÄŸlantÄ± hatasÄ±!';
                addMessage('Sistem', 'âŒ Sunucuya baÄŸlanÄ±lamadÄ±!');
                addMessage('Sistem', 'Sunucu Ã§alÄ±ÅŸÄ±yor mu? node server.js');
            });
            
            socket.on('chat-message', (data) => {
                if (data && data.username && data.message) {
                    addMessage(data.username, data.message);
                }
            });
            
            socket.on('system-message', (data) => {
                if (data && data.message) {
                    addMessage('Sistem', data.message);
                }
            });
            
            socket.on('admin-login-success', () => {
                addMessage('Sistem', 'âœ… Admin yetkileri aktif!');
                alert('ğŸ‰ Admin oldunuz!');
            });
            
            socket.on('admin-login-failed', () => {
                alert('âŒ Admin giriÅŸi baÅŸarÄ±sÄ±z!');
            });
            
            // Sayfa yÃ¼klendiÄŸinde baÄŸlan
            window.addEventListener('load', () => {
                setTimeout(connectSocket, 1000);
            });
        }
        
        // ========== FONKSÄ°YONLAR ==========
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            if (!socket || !socket.connected) {
                alert('âŒ Sunucuya baÄŸlÄ± deÄŸil!');
                return;
            }
            
            // Komut kontrolÃ¼
            if (message.startsWith('/')) {
                if (message === '/admin') {
                    adminLogin();
                } else if (message === '/help') {
                    addMessage('Sistem', 'Komutlar: /admin, /help');
                }
            } else {
                // Normal mesaj
                socket.emit('send-message', {
                    message: message,
                    username: currentUser
                });
            }
            
            input.value = '';
            input.focus();
        }
        
        function adminLogin() {
            if (!socket || !socket.connected) {
                alert('âŒ Sunucuya baÄŸlÄ± deÄŸil!');
                return;
            }
            
            socket.emit('admin-login', {
                username: 'popbox',
                password: 'kumsal07@'
            });
            
            addMessage('Sistem', 'ğŸ” Admin giriÅŸi yapÄ±lÄ±yor...');
        }
        
        function addMessage(user, text) {
            const messagesDiv = document.getElementById('messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message';
            messageDiv.innerHTML = `<strong>${user}:</strong> ${text}`;
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }
        
        // Enter tuÅŸu ile gÃ¶nder
        document.getElementById('messageInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMessage();
        });
        
        // BaÅŸlangÄ±Ã§ta baÄŸlan
        connectSocket();
    </script>
</body>
</html>
