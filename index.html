<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>PopboxMusic Chat</title>

<style>
body{margin:0;font-family:Arial;background:#0e0e0e;color:white;overflow:hidden}
#video{position:fixed;top:0;left:0;width:100%;height:220px}
#video iframe{width:100%;height:100%}
#chatArea{position:absolute;top:220px;bottom:60px;left:0;right:0;overflow:auto;padding:10px}
.msg{background:#1c1c1c;padding:8px;border-radius:8px;margin-bottom:8px}
#inputBar{position:fixed;bottom:0;left:0;right:0;height:60px;background:#111;display:flex}
#msg{flex:1;border:none;font-size:16px;padding:10px}
button{width:80px;border:none;background:#ff3c00;color:white;font-weight:bold}
img{max-width:150px;border-radius:8px;margin-top:5px}
#login{position:fixed;inset:0;background:#000;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:9999}
#login input{padding:12px;margin:5px;width:220px;font-size:16px}
</style>
</head>
<body>

<div id="login">
  <h2>Nick GiriÅŸ / KayÄ±t</h2>
  <input id="nick" placeholder="Nick">
  <input id="pass" type="password" placeholder="Åžifre">
  <button onclick="login()">GiriÅŸ</button>
</div>

<div id="video">
<iframe src="https://www.youtube.com/embed/shD--eyF8ug?autoplay=1&mute=1&playsinline=1"
allow="autoplay"></iframe>
</div>

<div id="chatArea"></div>

<div id="inputBar">
  <input id="msg" placeholder="Mesaj yaz..." />
  <button onclick="imagePick()">ðŸ“·</button>
  <button onclick="sendMessage()">GÃ¶nder</button>
</div>

<!-- Firebase V9 compat -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
// CONFIG
const firebaseConfig = {
  apiKey: "API_KEY",
  authDomain: "AUTH_DOMAIN",
  projectId: "PROJECT_ID",
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let myNick="";

// LOGIN
async function login(){
  const nick=document.getElementById("nick").value.trim();
  const pass=document.getElementById("pass").value.trim();
  if(!nick||!pass) return alert("Nick ve ÅŸifre gir");

  const ref=db.collection("users").doc(nick);
  const doc=await ref.get();

  if(!doc.exists){
    await ref.set({pass});
    myNick=nick;
  }else{
    if(doc.data().pass!==pass) return alert("Åžifre yanlÄ±ÅŸ");
    myNick=nick;
  }

  document.getElementById("login").style.display="none";
}

// ENTER
document.addEventListener("keydown",e=>{
 if(e.key==="Enter") sendMessage();
});

// MESAJ
function sendMessage(){
 if(!myNick) return;
 const input=document.getElementById("msg");
 if(!input.value.trim()) return;

 db.collection("messages").add({
  nick:myNick,
  text:input.value,
  time:Date.now()
 });
 input.value="";
}

// RESÄ°M
function imagePick(){
 const inp=document.createElement("input");
 inp.type="file";
 inp.accept="image/*";
 inp.onchange=e=>{
   const reader=new FileReader();
   reader.onload=ev=>{
     db.collection("messages").add({
       nick:myNick,
       image:ev.target.result,
       time:Date.now()
     });
   };
   reader.readAsDataURL(e.target.files[0]);
 };
 inp.click();
}

// DÄ°NLE
db.collection("messages").orderBy("time")
.onSnapshot(snap=>{
 const area=document.getElementById("chatArea");
 area.innerHTML="";
 snap.forEach(doc=>{
  const d=doc.data();
  const el=document.createElement("div");
  el.className="msg";

  if(d.image){
    el.innerHTML=`<b>${d.nick}:</b><br><img src="${d.image}">`;
  }else{
    el.innerHTML=`<b>${d.nick}:</b> ${d.text}`;
  }

  if(d.nick===myNick){
    const del=document.createElement("span");
    del.innerText=" âŒ";
    del.onclick=()=>db.collection("messages").doc(doc.id).delete();
    el.appendChild(del);
  }

  area.appendChild(el);
  area.scrollTop=area.scrollHeight;
 });
});
</script>

</body>
</html>
