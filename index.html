<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Popbox Elite</title>
    <style>
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #fafafa;
            --bg-sidebar: #f5f7fa;
            --bg-header: #ffffff;
            --bg-input: #ffffff;
            --bg-card: #ffffff;
            --bg-modal: #ffffff;
            --bg-hover: #f0f2f5;
            --bg-overlay: rgba(0,0,0,0.65);
            --text-primary: #1a1a1a;
            --text-secondary: #595959;
            --text-light: #8c8c8c;
            --border-color: #e8e8e8;
            --primary: #1890ff;
            --primary-hover: #40a9ff;
            --danger: #ff4d4f;
            --success: #52c41a;
            --warning: #faad14;
            --purple: #722ed1;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.08);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.1);
            --radius-md: 10px;
            --transition: all 0.25s ease;
        }
        body.dark-mode {
            --bg-primary: #0f1115;
            --bg-secondary: #16181d;
            --bg-sidebar: #0c0e12;
            --bg-header: #11141a;
            --bg-input: #1a1d24;
            --bg-modal: #16181d;
            --bg-hover: #1f2229;
            --bg-overlay: rgba(0,0,0,0.85);
            --text-primary: #e0e0e0;
            --text-secondary: #a0a0a0;
            --text-light: #707070;
            --border-color: #2a2e35;
        }
        * { margin:0; padding:0; box-sizing:border-box; font-family: system-ui, -apple-system, sans-serif; }
        html, body { height:100%; overflow:hidden; background:var(--bg-primary); color:var(--text-primary); }
        .app { display:flex; height:100vh; }
        .sidebar-left { width:260px; background:var(--bg-sidebar); border-right:1px solid var(--border-color); display:flex; flex-direction:column; }
        .main { flex:1; display:flex; flex-direction:column; }
        .sidebar-right { width:220px; background:var(--bg-sidebar); border-left:1px solid var(--border-color); display:flex; flex-direction:column; }
        .story-bar { height:84px; background:var(--bg-header); border-bottom:1px solid var(--border-color); overflow-x:auto; white-space:nowrap; padding:0 16px; display:flex; align-items:center; }
        .story-item { display:inline-flex; flex-direction:column; align-items:center; margin:0 10px; cursor:pointer; text-align:center; }
        .story-avatar { width:56px; height:56px; border-radius:50%; border:3px solid var(--primary); padding:2px; background:#fff; }
        .story-avatar img { width:100%; height:100%; border-radius:50%; object-fit:cover; }
        .story-name { font-size:11px; margin-top:4px; color:var(--text-secondary); max-width:56px; overflow:hidden; text-overflow:ellipsis; }
        .header { height:56px; padding:0 16px; background:var(--bg-header); border-bottom:1px solid var(--border-color); display:flex; align-items:center; justify-content:space-between; }
        .channel-info { display:flex; align-items:center; gap:12px; }
        .channel-icon { width:32px; height:32px; border-radius:8px; background:var(--primary); color:white; display:flex; align-items:center; justify-content:center; font-weight:500; }
        .chat-area { flex:1; display:flex; flex-direction:column; overflow:hidden; }
        .messages { flex:1; overflow-y:auto; padding:16px; }
        .input-area { padding:12px 16px; border-top:1px solid var(--border-color); background:var(--bg-header); }
        .message { display:flex; margin-bottom:12px; }
        .msg-avatar { width:36px; height:36px; border-radius:50%; background:var(--primary); color:white; display:flex; align-items:center; justify-content:center; margin-right:12px; flex-shrink:0; cursor:pointer; }
        .msg-content { flex:1; }
        .msg-header { display:flex; gap:8px; align-items:center; margin-bottom:2px; }
        .msg-sender { font-weight:500; cursor:pointer; }
        .msg-time { font-size:11px; color:var(--text-light); }
        .private-overlay { position:fixed; inset:0; background:var(--bg-overlay); z-index:2000; display:none; align-items:flex-end; justify-content:flex-end; }
        .private-overlay.active { display:flex; }
        .private-window { width:calc(100% - 220px); height:100%; background:var(--bg-modal); border-left:1px solid var(--border-color); display:flex; flex-direction:column; box-shadow:-4px 0 20px rgba(0,0,0,0.3); }
        .private-header { padding:12px 16px; background:var(--primary); color:white; display:flex; justify-content:space-between; align-items:center; }
        .private-messages { flex:1; overflow-y:auto; padding:16px; }
        .profile-overlay { position:fixed; inset:0; background:var(--bg-overlay); z-index:3000; display:none; align-items:center; justify-content:center; }
        .profile-panel { width:90%; max-width:480px; background:var(--bg-modal); border-radius:var(--radius-md); overflow:hidden; box-shadow:var(--shadow-md); }
        .admin-overlay { position:fixed; inset:0; background:var(--bg-overlay); z-index:4000; display:none; }
        .admin-panel { position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); width:90%; max-width:1000px; height:85%; background:var(--bg-modal); border-radius:var(--radius-md); display:flex; flex-direction:column; overflow:hidden; box-shadow:var(--shadow-md); }
        .admin-nav { width:220px; background:var(--bg-sidebar); border-right:1px solid var(--border-color); padding:16px 0; overflow-y:auto; }
        .admin-nav-item { padding:12px 20px; cursor:pointer; transition:var(--transition); }
        .admin-nav-item:hover, .admin-nav-item.active { background:var(--bg-hover); }
        .admin-content { flex:1; padding:20px; overflow-y:auto; }
        .btn { padding:8px 16px; border:none; border-radius:6px; cursor:pointer; transition:var(--transition); }
        .btn-primary { background:var(--primary); color:white; }
        .btn-danger { background:var(--danger); color:white; }
        .btn-secondary { background:var(--bg-input); border:1px solid var(--border-color); }
        ::-webkit-scrollbar { width:5px; }
        ::-webkit-scrollbar-thumb { background:var(--border-color); border-radius:5px; }
    </style>
</head>
<body>

<div id="login" style="position:fixed;inset:0;background:linear-gradient(135deg,#e6f0ff,#ffffff);display:flex;align-items:center;justify-content:center;z-index:10000;">
    <div style="width:360px;padding:40px;background:white;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,0.15);">
        <h2 style="text-align:center;margin-bottom:8px;">Popbox Elite</h2>
        <p style="text-align:center;color:#666;margin-bottom:24px;">Modern sohbet platformu</p>
        <input id="nick" placeholder="Kullanƒ±cƒ± adƒ±" style="width:100%;padding:12px;margin-bottom:12px;border:1px solid #ddd;border-radius:8px;">
        <input id="pass" type="password" placeholder="≈ûifre (yetkili i√ßin)" style="width:100%;padding:12px;margin-bottom:16px;border:1px solid #ddd;border-radius:8px;">
        <button onclick="login()" class="btn btn-primary" style="width:100%;padding:12px;font-weight:500;">Giri≈ü Yap</button>
        <div id="loginErr" style="color:#ff4d4f;margin-top:12px;text-align:center;display:none;"></div>
        <p style="margin-top:20px;text-align:center;font-size:12px;color:#888;">
            Owner giri≈ü: mateky / kumsal07@
        </p>
    </div>
</div>

<div id="app" class="app" style="display:none;">
    <!-- Story Bar -->
    <div class="story-bar" id="storyBar">
        <!-- JS ile doldurulacak -->
    </div>

    <!-- Header -->
    <div class="header">
        <div class="channel-info">
            <div class="channel-icon">G</div>
            <div>
                <div id="chanName">Genel</div>
                <div id="chanTopic" style="font-size:12px;color:#888;">Ho≈ü geldin!</div>
            </div>
        </div>
        <div style="display:flex;gap:12px;">
            <button class="btn btn-secondary" onclick="toggleTheme()">üåô</button>
            <button class="btn btn-secondary" onclick="openProfile(currentUser.nick)">üë§</button>
            <button id="adminBtn" class="btn btn-secondary" onclick="openAdmin()" style="display:none;">‚ö° <span id="reportBadge" style="background:#ff4d4f;color:white;border-radius:10px;padding:2px 6px;font-size:10px;">0</span></button>
        </div>
    </div>

    <!-- Ana ƒ∞√ßerik -->
    <div style="flex:1;display:flex;overflow:hidden;">
        <!-- Sol Sidebar - Medya -->
        <div class="sidebar-left">
            <div style="padding:16px;font-weight:600;border-bottom:1px solid var(--border-color);">Payla≈üƒ±lan Medya</div>
            <div id="mediaList" style="flex:1;overflow-y:auto;padding:12px;display:flex;flex-direction:column;gap:12px;"></div>
        </div>

        <!-- Orta Sohbet -->
        <div class="main">
            <div id="messages" class="messages"></div>
            <div class="input-area">
                <div style="display:flex;gap:8px;margin-bottom:8px;">
                    <button class="btn btn-secondary" onclick="alert('Emoji yakƒ±nda')">üòÄ</button>
                    <button class="btn btn-secondary" onclick="alert('/help yaz')">Komutlar</button>
                </div>
                <div style="display:flex;gap:8px;">
                    <textarea id="msgInput" placeholder="Mesaj yaz... (/help i√ßin komutlar)" style="flex:1;padding:12px;border:1px solid var(--border-color);border-radius:8px;resize:none;min-height:44px;" oninput="this.style.height='auto';this.style.height=this.scrollHeight+'px'" onkeydown="if(event.key==='Enter'&&!event.shiftKey){event.preventDefault();sendMsg()}"></textarea>
                    <button onclick="sendMsg()" class="btn btn-primary">G√∂nder</button>
                </div>
            </div>
        </div>

        <!-- Saƒü Sidebar - Kullanƒ±cƒ±lar -->
        <div class="sidebar-right">
            <div style="padding:12px;border-bottom:1px solid var(--border-color);">
                <input id="userFilter" placeholder="Ara..." oninput="filterUsers()" style="width:100%;padding:8px;border:1px solid var(--border-color);border-radius:8px;">
            </div>
            <div id="userList" style="flex:1;overflow-y:auto;padding:8px;"></div>
        </div>
    </div>
</div>

<!-- √ñzel Sohbet -->
<div id="privOverlay" class="private-overlay">
    <div id="privWin" class="private-window"></div>
</div>

<!-- Profil -->
<div id="profOverlay" class="profile-overlay">
    <div id="profPanel" class="profile-panel"></div>
</div>

<!-- Y√∂netim Paneli -->
<div id="adminOverlay" class="admin-overlay" onclick="closeAdmin()"></div>
<div id="adminPanel" class="admin-panel" style="display:none;"></div>

<script>
// ====================== VERƒ∞ & AYARLAR ======================
let currentUser = null;
let currentChannel = 'general';
let activePriv = null;
let godMode = false;
let notifications = 0;
let reports = 0;

const users = {};
const channels = {
    general: { name:'Genel', messages:[], users:new Set() },
    random: { name:'Rastgele', messages:[], users:new Set() }
};

const bot = {
    name: 'MATE',
    send: (ch, txt) => {
        const msg = { sender:bot.name, text:txt, time:new Date(), role:'bot' };
        channels[ch].messages.push(msg);
        if (ch === currentChannel) addMsg(msg);
    }
};

// ====================== Gƒ∞Rƒ∞≈û ======================
function login() {
    const nick = document.getElementById('nick').value.trim();
    const pass = document.getElementById('pass').value;
    const err = document.getElementById('loginErr');

    if (!nick) return err.textContent='Nick girin', err.style.display='block';

    let role = 'user';
    if (nick.toLowerCase() === 'mateky' && pass === 'kumsal07@') role = 'owner';
    else if (nick === 'admin' && pass === 'admin123') role = 'admin';
    else if (pass) return err.textContent='≈ûifre yanlƒ±≈ü', err.style.display='block';

    currentUser = { nick, role, color:getColor(nick), joined:new Date() };
    users[nick] = currentUser;
    channels.general.users.add(nick);

    document.getElementById('login').style.display = 'none';
    document.getElementById('app').style.display = 'flex';

    if (role !== 'user') document.getElementById('adminBtn').style.display = 'inline-block';
    init();
}

// ====================== BA≈ûLATMA ======================
function init() {
    // √ñrnek kullanƒ±cƒ±lar
    ['Ahmet','Ay≈üe','Mehmet','Elif'].forEach(n => {
        users[n] = { nick:n, role:'user', color:getColor(n) };
        channels.general.users.add(n);
    });

    updateUsers();
    updateStories();
    loadChannel('general');
    bot.send('general', `Ho≈ü geldin ${currentUser.nick}! /help yaz komutlarƒ± g√∂r.`);
}

// ====================== MESAJ G√ñNDER ======================
function sendMsg() {
    const inp = document.getElementById('msgInput');
    const txt = inp.value.trim();
    if (!txt) return;

    if (txt.startsWith('/')) return runCommand(txt);

    const msg = { sender:currentUser.nick, text:txt, time:new Date(), role:currentUser.role };
    channels[currentChannel].messages.push(msg);
    addMsg(msg);
    inp.value = '';
}

// ====================== MESAJ EKLE ======================
function addMsg(m) {
    const cont = document.getElementById('messages');
    const div = document.createElement('div');
    div.className = 'message';
    div.innerHTML = `
        <div class="msg-avatar" style="background:${m.color}" onclick="openProfile('${m.sender}')">${m.sender[0].toUpperCase()}</div>
        <div class="msg-content">
            <div class="msg-header">
                <span class="msg-sender" onclick="openProfile('${m.sender}')">${m.sender}</span>
                ${m.role !== 'user' ? `<span style="font-size:10px;padding:2px 6px;border-radius:4px;background:#${m.role==='owner'?'ff4d4f':'faad14'};">${m.role.toUpperCase()}</span>` : ''}
                <span class="msg-time">${m.time.toLocaleTimeString('tr-TR',{hour:'2-digit',minute:'2-digit'})}</span>
            </div>
            <div>${m.text}</div>
        </div>
    `;
    cont.appendChild(div);
    cont.scrollTop = cont.scrollHeight;
}

// ====================== KOMUTLAR ======================
function runCommand(cmd) {
    const p = cmd.slice(1).trim().split(' ');
    const c = p[0].toLowerCase();
    const a = p.slice(1);

    if (c === 'help') {
        bot.send(currentChannel, 'Komutlar: /msg nick metin, /nick yeni, /join kanal, /kick nick, /god (tanrƒ± modu), /whois nick, /topic yeni');
    }
    else if (c === 'msg' && a.length >= 2) {
        openPrivate(a[0], a.slice(1).join(' '));
    }
    else if (c === 'nick' && a[0]) {
        currentUser.nick = a[0];
        updateUsers();
    }
    else if (c === 'join' && a[0]) {
        currentChannel = a[0];
        loadChannel(a[0]);
    }
    else if (c === 'god' && currentUser.role === 'owner') {
        godMode = !godMode;
        bot.send(currentChannel, `Tanrƒ± modu ${godMode ? 'A√áIK' : 'KAPALI'}`);
        updateUsers();
    }
    else if (c === 'whois' && a[0]) {
        const u = users[a[0]] || {nick:a[0]};
        bot.send(currentChannel, `${u.nick} - Rol: ${u.role || 'user'}, Katƒ±lƒ±m: ${u.joined?.toLocaleDateString() || 'bilinmiyor'}`);
    }
}

// ====================== PROFƒ∞L ======================
function openProfile(n) {
    const u = users[n] || currentUser;
    const own = n === currentUser.nick;
    const panel = document.getElementById('profPanel');
    panel.innerHTML = `
        <div style="padding:24px;background:linear-gradient(to right,var(--primary),var(--purple));color:white;text-align:center;">
            <div style="width:80px;height:80px;margin:0 auto;border-radius:50%;background:${u.color};display:flex;align-items:center;justify-content:center;font-size:32px;border:4px solid white;">${u.nick[0].toUpperCase()}</div>
            <h2 style="margin:12px 0 4px;">${u.nick} ${godMode && currentUser.role==='owner' ? '(Gizli)' : ''}</h2>
            <p>${u.status || 'online'}</p>
        </div>
        <div style="padding:20px;">
            <div style="margin-bottom:16px;">
                <strong>Bilgiler</strong><br>
                ‚Ä¢ Rol: ${u.role || 'Kullanƒ±cƒ±'}<br>
                ‚Ä¢ Katƒ±lƒ±m: ${u.joined?.toLocaleDateString() || '‚Äî'}
            </div>
            <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:12px;">
                ${own ? `
                    <button onclick="godModeToggle()" class="btn ${godMode?'btn-danger':'btn-primary'}">${godMode?'Tanrƒ± Modu Kapat':'Tanrƒ± Modu A√ß'}</button>
                    <button onclick="alert('Durum yakƒ±nda')" class="btn btn-secondary">Durum Deƒüi≈ütir</button>
                ` : ''}
                <button onclick="alert('Takip yakƒ±nda')" class="btn btn-secondary">Takip Et</button>
                <button onclick="openPrivate('${n}')" class="btn btn-primary">√ñzel Mesaj</button>
                <button onclick="alert('Engelle yakƒ±nda')" class="btn btn-danger">Engelle</button>
                <button onclick="alert('≈ûikayet yakƒ±nda')" class="btn btn-warning">≈ûikayet Et</button>
            </div>
        </div>
    `;
    document.getElementById('profOverlay').style.display = 'flex';
}

// Tanrƒ± modu toggle
function godModeToggle() {
    godMode = !godMode;
    alert(`Tanrƒ± modu ${godMode ? 'a√ßƒ±ldƒ±' : 'kapandƒ±'}`);
    updateUsers();
    document.getElementById('profOverlay').style.display = 'none';
}

// ====================== √ñZEL SOHBET ======================
function openPrivate(nick, msg='') {
    activePriv = nick;
    const ov = document.getElementById('privOverlay');
    const win = document.getElementById('privWin');
    win.innerHTML = `
        <div class="private-header">
            <div style="display:flex;align-items:center;gap:12px;">
                <button onclick="closePrivate()" style="background:none;border:none;color:white;font-size:24px;cursor:pointer;">‚Üê</button>
                <div>${nick}</div>
            </div>
            <div>
                <button onclick="alert('≈ûikayet: ${nick}')" style="background:rgba(255,255,255,0.2);border:none;color:white;padding:6px 12px;border-radius:6px;margin-right:8px;">≈ûikayet</button>
                <button onclick="alert('Engelle: ${nick}')" style="background:#ff4d4f;color:white;border:none;padding:6px 12px;border-radius:6px;">Engelle</button>
            </div>
        </div>
        <div id="privMsgs" class="private-messages"></div>
        <div style="padding:12px;border-top:1px solid var(--border-color);display:flex;gap:8px;">
            <textarea id="privInp" placeholder="${nick}'a yaz..." style="flex:1;padding:10px;border:1px solid var(--border-color);border-radius:8px;resize:none;"></textarea>
            <button onclick="sendPriv()" class="btn btn-primary">G√∂nder</button>
        </div>
    `;
    ov.style.display = 'flex';
    document.addEventListener('keydown', e => { if (e.key==='Escape') closePrivate(); });
}

function closePrivate() {
    document.getElementById('privOverlay').style.display = 'none';
    document.removeEventListener('keydown', ()=>{});
    activePriv = null;
}

function sendPriv() {
    const inp = document.getElementById('privInp');
    if (!inp.value.trim()) return;
    const div = document.createElement('div');
    div.textContent = `Sen: ${inp.value}`;
    document.getElementById('privMsgs').appendChild(div);
    inp.value = '';
}

// ====================== KULLANICI Lƒ∞STESƒ∞ ======================
function updateUsers() {
    const lst = document.getElementById('userList');
    lst.innerHTML = '';
    Object.values(users).forEach(u => {
        const div = document.createElement('div');
        div.style.padding = '10px 12px';
        div.style.cursor = 'pointer';
        div.style.display = 'flex';
        div.style.alignItems = 'center';
        div.style.gap = '10px';
        div.onclick = () => openPrivate(u.nick);
        div.innerHTML = `
            <div style="width:10px;height:10px;border-radius:50%;background:#52c41a;"></div>
            <div>${u.nick} ${u.role==='owner' && !godMode ? '<small style="color:#ff4d4f;">(owner)</small>' : ''}</div>
        `;
        lst.appendChild(div);
    });
}

function filterUsers() {
    const val = document.getElementById('userFilter').value.toLowerCase();
    Array.from(document.getElementById('userList').children).forEach(el => {
        el.style.display = el.textContent.toLowerCase().includes(val) ? 'flex' : 'none';
    });
}

// ====================== KANAL Y√úKLE ======================
function loadChannel(ch) {
    currentChannel = ch;
    document.getElementById('chanName').textContent = channels[ch]?.name || ch;
    document.getElementById('messages').innerHTML = '';
    (channels[ch]?.messages || []).forEach(addMsg);
}

// ====================== STORY BAR ======================
function updateStories() {
    document.getElementById('storyBar').innerHTML = '<div style="padding:0 16px;color:#888;">Story alanƒ± (kaydƒ±rƒ±labilir)</div>';
}

// ====================== Y√ñNETƒ∞M PANELƒ∞ ======================
function openAdmin() {
    const ov = document.getElementById('adminOverlay');
    const pan = document.getElementById('adminPanel');
    pan.innerHTML = `
        <div style="padding:16px;background:linear-gradient(to right,var(--primary),var(--purple));color:white;display:flex;justify-content:space-between;align-items:center;">
            <h3>Y√∂netim Paneli</h3>
            <button onclick="closeAdmin()" style="background:none;border:none;color:white;font-size:20px;cursor:pointer;">√ó</button>
        </div>
        <div style="display:flex;flex:1;">
            <div class="admin-nav">
                <div class="admin-nav-item active" onclick="switchTab('dash')">Dashboard</div>
                <div class="admin-nav-item" onclick="switchTab('users')">Kullanƒ±cƒ±lar</div>
                <div class="admin-nav-item" onclick="switchTab('reports')">≈ûikayetler (${reports})</div>
                ${currentUser.role==='owner' ? '<div class="admin-nav-item" onclick="switchTab('god')">Tanrƒ± Dashboard</div>' : ''}
            </div>
            <div class="admin-content" id="adminContent">
                <div id="dash" style="display:block;">
                    <h4>Dashboard</h4>
                    <p>√áevrimi√ßi: ${Object.keys(users).length}</p>
                    <p>≈ûikayet bekleyen: ${reports}</p>
                </div>
                <div id="god" style="display:none;">
                    <h4>Tanrƒ± Dashboard (Owner)</h4>
                    <p>T√ºm kanallar canlƒ± akƒ±≈ü sim√ºlasyonu...</p>
                    <p>Silinen mesajlar: <button onclick="alert('Geri getirme yakƒ±nda')">Geri Getir</button></p>
                    <p>√ñzel sohbet izleme: <button onclick="alert('G√∂rseller dahil izleniyor')">ƒ∞zle</button></p>
                </div>
            </div>
        </div>
    `;
    ov.style.display = 'block';
    pan.style.display = 'flex';
}

function closeAdmin() {
    document.getElementById('adminOverlay').style.display = 'none';
    document.getElementById('adminPanel').style.display = 'none';
}

function switchTab(id) {
    document.querySelectorAll('.admin-content > div').forEach(d => d.style.display='none');
    document.getElementById(id).style.display = 'block';
    document.querySelectorAll('.admin-nav-item').forEach(i => i.classList.remove('active'));
    event.target.classList.add('active');
}

// ====================== YARDIMCILAR ======================
function getColor(str) {
    let h = 0;
    for(let i=0;i<str.length;i++) h = str.charCodeAt(i) + ((h<<5)-h);
    const c = ['#1890ff','#52c41a','#fa8c16','#ff4d4f','#722ed1','#13c2c2'];
    return c[Math.abs(h) % c.length];
}

function toggleTheme() {
    document.body.classList.toggle('dark-mode');
}

// Sayfa y√ºklenince
document.getElementById('nick').focus();
</script>
</body>
</html>
