<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>CETCETY ‚Ä¢ Mobil</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://www.youtube.com/iframe_api"></script>
    <style>
        /* RESET & TEMEL */
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            font-family: 'Inter', sans-serif;
            background: #0a0a0a;
            color: #fff;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
            position: fixed;
        }
        
        /* Giri≈ü Ekranƒ± */
        .login-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); backdrop-filter: blur(10px);
            display: flex; align-items: center; justify-content: center;
            z-index: 2000; transition: 0.3s;
        }
        .login-overlay.hidden { display: none; }
        .login-panel {
            width: 90%; max-width: 360px;
            background: rgba(20,20,20,0.95);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 28px; padding: 32px 24px;
            color: #fff; box-shadow: 0 20px 40px rgba(0,0,0,0.6);
        }
        .login-panel h2 {
            text-align: center; margin-bottom: 28px;
            font-size: 32px; font-weight: 700;
        }
        .login-panel h2 span { color: #ff0000; }
        .login-panel input {
            width: 100%; padding: 16px; margin-bottom: 16px;
            background: rgba(0,0,0,0.4); border: 1px solid rgba(255,255,255,0.1);
            border-radius: 16px; color: #fff; font-size: 16px;
        }
        .login-panel button {
            width: 100%; padding: 16px; background: #ff0000;
            border: none; border-radius: 16px; color: #fff;
            font-weight: 600; font-size: 16px; margin-top: 8px;
        }
        .login-info {
            text-align: center; margin-top: 20px; font-size: 12px;
            color: #888; line-height: 1.5;
        }
        .login-info a { color: #ff0000; text-decoration: none; font-weight: 600; }

        /* ANA UYGULAMA */
        .app {
            display: none;
            height: 100vh;
            width: 100vw;
            flex-direction: column;
            background: #0a0a0a;
            position: relative;
        }

        /* Alt Navigasyon Barƒ± */
        .mobile-nav {
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 8px 12px 12px;
            background: rgba(10,10,10,0.95);
            backdrop-filter: blur(10px);
            border-top: 1px solid rgba(255,255,255,0.1);
            position: relative;
            z-index: 100;
            flex-shrink: 0;
        }
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #888;
            font-size: 12px;
            gap: 4px;
            padding: 4px 12px;
            border-radius: 30px;
            transition: 0.2s;
        }
        .nav-item i { font-size: 22px; }
        .nav-item.active { color: #ff0000; background: rgba(255,0,0,0.1); }
        .nav-item .badge {
            position: absolute;
            top: -2px; right: -2px;
            background: #ff4444;
            color: white;
            font-size: 10px;
            min-width: 18px; height: 18px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid #0a0a0a;
        }
        .profile-nav {
            width: 44px; height: 44px;
            border-radius: 50%;
            background: rgba(26,26,26,0.8);
            border: 2px solid rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: #fff;
            overflow: hidden;
        }
        .profile-nav img { width: 100%; height: 100%; object-fit: cover; }

        /* Ana ƒ∞√ßerik Alanƒ± */
        .main-content {
            flex: 1;
            display: flex;
            overflow: hidden;
            position: relative;
            background: #0f0f0f;
        }

        /* Sohbet Panel (Her zaman g√∂r√ºn√ºr) */
        .chat-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            width: 100%;
            transition: transform 0.3s ease;
            background: #0f0f0f;
        }
        .chat-panel.slide-right { transform: translateX(-33%); }
        .chat-panel.slide-left { transform: translateX(33%); }

        .chat-header {
            padding: 12px 16px;
            background: rgba(15,15,15,0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-shrink: 0;
        }
        .channel-info {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .channel-name {
            font-weight: 700;
            font-size: 18px;
        }
        .channel-stats {
            font-size: 12px;
            color: #aaa;
            display: flex;
            gap: 8px;
        }
        .header-actions {
            display: flex;
            gap: 12px;
        }
        .header-btn {
            width: 40px; height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(26,26,26,0.8);
            color: #fff;
        }
        .subscribe-btn {
            padding: 8px 16px;
            background: rgba(26,26,26,0.8);
            border-radius: 30px;
            font-size: 13px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .subscribe-btn.subscribed { background: #ff0000; }

        .messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px 16px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .message {
            display: flex;
            flex-direction: column;
            max-width: 85%;
        }
        .message.right { align-self: flex-end; }
        .message-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 4px;
        }
        .message-sender {
            font-weight: 600;
            font-size: 13px;
        }
        .message-time {
            font-size: 10px;
            color: #aaa;
        }
        .message-text {
            font-size: 14px;
            line-height: 1.4;
            padding: 8px 0;
        }
        .right .message-text { color: #ff0000; }
        .system-message {
            align-self: center;
            background: rgba(26,26,26,0.8);
            padding: 10px 20px;
            border-radius: 30px;
            font-size: 12px;
            color: #aaa;
            max-width: 95%;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .message-input-container {
            padding: 12px 16px;
            background: rgba(10,10,10,0.95);
            border-top: 1px solid rgba(255,255,255,0.1);
            flex-shrink: 0;
        }
        .input-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(26,26,26,0.8);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 30px;
            padding: 4px 4px 4px 18px;
        }
        .message-input {
            flex: 1;
            background: transparent;
            border: none;
            color: #fff;
            font-size: 15px;
            padding: 12px 0;
            max-height: 100px;
            resize: none;
            outline: none;
        }
        .send-btn {
            width: 44px; height: 44px;
            border-radius: 50%;
            background: #ff0000;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
        }

        /* Yan Paneller (Slide-in) */
        .side-panel {
            position: absolute;
            top: 0;
            width: 75%;
            height: 100%;
            background: rgba(10,10,10,0.98);
            backdrop-filter: blur(10px);
            z-index: 150;
            display: none;
            flex-direction: column;
            border-left: 1px solid rgba(255,255,255,0.1);
        }
        .side-panel.left {
            left: 0;
            border-right: 1px solid rgba(255,255,255,0.1);
        }
        .side-panel.right {
            right: 0;
        }
        .side-panel.active { display: flex; }

        .panel-header {
            padding: 16px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(15,15,15,0.8);
        }
        .panel-header h3 {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 16px;
        }
        .panel-close {
            width: 40px; height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(26,26,26,0.8);
        }
        .panel-content {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }

        .panel-tabs {
            display: flex;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .panel-tab {
            flex: 1;
            padding: 14px;
            text-align: center;
            font-size: 14px;
            font-weight: 600;
            color: #aaa;
        }
        .panel-tab.active {
            color: #fff;
            border-bottom: 2px solid #ff0000;
        }

        .search-container {
            display: flex;
            align-items: center;
            background: rgba(26,26,26,0.8);
            border-radius: 30px;
            padding: 0 16px;
            margin-bottom: 16px;
        }
        .search-container input {
            flex: 1;
            background: transparent;
            border: none;
            color: #fff;
            padding: 14px 8px;
            font-size: 15px;
            outline: none;
        }

        .channel-item, .chat-item, .online-item, .subscription-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-radius: 12px;
            margin-bottom: 4px;
        }
        .channel-item:active, .chat-item:active { background: rgba(26,26,26,0.8); }

        .item-avatar {
            width: 44px; height: 44px;
            border-radius: 50%;
            background: rgba(26,26,26,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: #ff0000;
            flex-shrink: 0;
            overflow: hidden;
        }
        .item-avatar img { width: 100%; height: 100%; object-fit: cover; }

        .item-info {
            flex: 1;
        }
        .item-name {
            font-weight: 600;
            font-size: 15px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .item-meta {
            font-size: 12px;
            color: #aaa;
            margin-top: 2px;
        }
        .online-status {
            width: 8px; height: 8px;
            border-radius: 50%;
            background: #2ecc71;
            margin-left: 4px;
        }
        .badge {
            padding: 2px 8px;
            border-radius: 20px;
            font-size: 10px;
            font-weight: 600;
        }
        .badge-owner { color: #ffd700; border: 1px solid #ffd700; }
        .badge-admin { color: #ff6b6b; border: 1px solid #ff6b6b; }
        .badge-coadmin { color: #6495ed; border: 1px solid #6495ed; }

        .subscribe-small {
            padding: 6px 14px;
            background: rgba(26,26,26,0.8);
            border-radius: 30px;
            font-size: 12px;
            font-weight: 600;
        }
        .subscribe-small.subscribed { background: #ff0000; }

        /* YouTube Medya Paneli (Saƒü panelde) */
        .media-panel {
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        .media-player {
            width: 100%;
            aspect-ratio: 16/9;
            background: #000;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .media-controls {
            display: flex;
            gap: 20px;
            justify-content: center;
            padding: 12px;
        }
        .media-control-btn {
            width: 44px; height: 44px;
            border-radius: 50%;
            background: rgba(26,26,26,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .now-playing {
            padding: 12px 16px;
            background: rgba(15,15,15,0.8);
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .playlist-items {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }
        .playlist-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 4px;
        }
        .playlist-thumb {
            width: 48px; height: 48px;
            background: rgba(26,26,26,0.8);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #ff0000;
        }

        /* √ñzel Sohbet Paneli (Tam ekran) */
        .private-chat-panel {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(10,10,10,0.98);
            backdrop-filter: blur(10px);
            display: none;
            flex-direction: column;
            z-index: 200;
        }
        .private-chat-panel.active { display: flex; }

        .private-header {
            padding: 12px 16px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
            gap: 16px;
        }
        .private-back {
            width: 40px; height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(26,26,26,0.8);
        }
        .private-user {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .private-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        .private-input-area {
            padding: 16px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        .private-input-wrapper {
            display: flex;
            align-items: center;
            gap: 12px;
            background: rgba(26,26,26,0.8);
            border-radius: 30px;
            padding: 4px 4px 4px 18px;
        }
        .media-actions {
            display: flex;
            gap: 8px;
            padding: 8px 0;
        }
        .media-action-btn {
            width: 44px; height: 44px;
            border-radius: 50%;
            background: rgba(26,26,26,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Baƒülantƒ± Durumu */
        .connection-status {
            position: fixed;
            bottom: 70px; right: 10px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 11px;
            background: rgba(42,42,42,0.9);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            backdrop-filter: blur(5px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 300;
        }
        .modal-overlay.active { display: flex; }
        .modal-panel {
            width: 90%;
            max-width: 400px;
            background: rgba(26,26,26,0.95);
            border-radius: 24px;
            overflow: hidden;
        }
        .modal-header {
            padding: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex;
            justify-content: space-between;
        }
        .modal-content {
            padding: 20px;
            max-height: 60vh;
            overflow-y: auto;
        }
        .modal-footer {
            padding: 16px 20px;
            border-top: 1px solid rgba(255,255,255,0.1);
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }
        .form-button {
            padding: 14px 24px;
            border-radius: 30px;
            border: none;
            font-weight: 600;
        }
        .form-button.primary { background: #ff0000; color: #fff; }
        .form-button.secondary { background: rgba(42,42,42,0.8); color: #fff; }

        /* Owner √∂zel takip g√∂stergesi */
        .owner-spy-indicator {
            position: fixed;
            top: 10px; left: 10px;
            right: 10px;
            background: #ff0000;
            color: white;
            padding: 12px;
            border-radius: 30px;
            font-size: 14px;
            font-weight: 600;
            z-index: 1000;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
    </style>
</head>
<body>
    <!-- Gƒ∞Rƒ∞≈û EKRANI -->
    <div id="loginOverlay" class="login-overlay">
        <div class="login-panel">
            <h2>CETCETY <span>MOBƒ∞L</span></h2>
            <input type="text" id="loginNick" placeholder="Kullanƒ±cƒ± Adƒ±">
            <input type="password" id="loginPassword" placeholder="≈ûifre">
            <button onclick="handleLogin()">Giri≈ü Yap / Kayƒ±t Ol</button>
            <div class="login-info">
                Kayƒ±tsƒ±z nickler ≈üifresiz giri≈ü yapabilir.<br>
                Giri≈ü yaparak <a onclick="openKvkkModal()">KVKK</a> ve <a onclick="openTermsModal()">Kullanƒ±m ≈ûartlarƒ±</a>'nƒ± kabul edersiniz.
            </div>
        </div>
    </div>

    <!-- ANA UYGULAMA -->
    <div id="app" class="app">
        <!-- ANA ƒ∞√áERƒ∞K -->
        <div class="main-content">
            <!-- SOHBET PANELƒ∞ -->
            <div class="chat-panel" id="chatPanel">
                <div class="chat-header">
                    <div class="channel-info">
                        <i class="fas fa-hashtag" style="color:#ff0000;"></i>
                        <span class="channel-name" id="currentChannelName">genel</span>
                    </div>
                    <div class="channel-stats">
                        <span id="channelUserCount">1</span> <i class="fas fa-user"></i>
                        <span id="channelSubscribers">1</span> <i class="fas fa-users"></i>
                    </div>
                    <div class="header-actions">
                        <div class="header-btn" onclick="toggleMediaPanel()">
                            <i class="fab fa-youtube"></i>
                        </div>
                        <div class="header-btn" onclick="openRightPanel()">
                            <i class="fas fa-users"></i>
                        </div>
                    </div>
                </div>

                <div class="messages" id="messages"></div>

                <div class="message-input-container">
                    <div class="input-wrapper">
                        <textarea id="messageInput" class="message-input" placeholder="Mesaj yaz..." rows="1"></textarea>
                        <div class="send-btn" onclick="sendMessage()">
                            <i class="fas fa-paper-plane"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SOL PANEL (Kanallar / Abonelikler) -->
            <div class="side-panel left" id="leftPanel">
                <div class="panel-header">
                    <h3><i class="fas fa-bell" style="color:#ffd700;"></i> <span id="leftPanelTitle">Abonelikler</span></h3>
                    <div class="panel-close" onclick="closeLeftPanel()">
                        <i class="fas fa-times"></i>
                    </div>
                </div>
                <div class="panel-tabs">
                    <div class="panel-tab active" onclick="switchLeftTab('subscriptions')">Abonelikler</div>
                    <div class="panel-tab" onclick="switchLeftTab('channels')">Ke≈üfet</div>
                </div>
                <div class="panel-content" id="leftPanelContent"></div>
            </div>

            <!-- SAƒû PANEL (√áevrimi√ßi / Medya) -->
            <div class="side-panel right" id="rightPanel">
                <div class="panel-header">
                    <h3><i class="fas fa-users" style="color:#7289da;"></i> <span id="rightPanelTitle">√áevrimi√ßi</span></h3>
                    <div class="panel-close" onclick="closeRightPanel()">
                        <i class="fas fa-times"></i>
                    </div>
                </div>
                <div class="panel-tabs">
                    <div class="panel-tab active" onclick="switchRightTab('online')">√áevrimi√ßi</div>
                    <div class="panel-tab" onclick="switchRightTab('youtube')">YouTube</div>
                </div>
                <div class="panel-content" id="rightPanelContent"></div>
            </div>

            <!-- √ñZEL SOHBET PANELƒ∞ -->
            <div class="private-chat-panel" id="privateChatPanel">
                <div class="private-header">
                    <div class="private-back" onclick="closePrivateChat()">
                        <i class="fas fa-arrow-left"></i>
                    </div>
                    <div class="private-user">
                        <div class="item-avatar" id="privateChatAvatar">?</div>
                        <div>
                            <h4 id="privateChatName">Kullanƒ±cƒ±</h4>
                            <span style="font-size:12px; color:#aaa;">√ßevrimi√ßi</span>
                        </div>
                    </div>
                    <div class="private-back" onclick="blockUser()">
                        <i class="fas fa-ban"></i>
                    </div>
                </div>
                <div class="private-messages" id="privateChatMessages"></div>
                <div class="private-input-area">
                    <div class="media-actions">
                        <div class="media-action-btn" onclick="triggerPrivateImageUpload()">
                            <i class="fas fa-image"></i>
                        </div>
                        <div class="media-action-btn" onclick="triggerPrivateVideoUpload()">
                            <i class="fas fa-video"></i>
                        </div>
                        <input type="file" id="privateImageUpload" accept="image/*" style="display:none;">
                        <input type="file" id="privateVideoUpload" accept="video/*" style="display:none;">
                    </div>
                    <div class="private-input-wrapper">
                        <textarea id="privateMessageInput" class="message-input" placeholder="Mesaj..." rows="1"></textarea>
                        <div class="send-btn" onclick="sendPrivateMessage()">
                            <i class="fas fa-paper-plane"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ALT NAVƒ∞GASYON -->
        <div class="mobile-nav">
            <div class="nav-item" onclick="openLeftPanel()">
                <i class="fas fa-hashtag"></i>
                <span>Kanallar</span>
                <span class="badge" id="channelCountBadge">0</span>
            </div>
            <div class="nav-item" onclick="openChatList()">
                <i class="fas fa-comment"></i>
                <span>Sohbetler</span>
                <span class="badge" id="chatListBadge">0</span>
            </div>
            <div class="nav-item" onclick="openCreateChannel()">
                <i class="fas fa-plus-circle"></i>
                <span>A√ß</span>
            </div>
            <div class="nav-item" onclick="openNotifications()">
                <i class="fas fa-bell"></i>
                <span>Bildirim</span>
                <span class="badge" id="notificationBadge">0</span>
            </div>
            <div class="profile-nav" id="profileNav" onclick="openProfilePanel()">
                <span id="navAvatarText">?</span>
                <img id="navAvatarImage" style="display:none;">
            </div>
        </div>

        <!-- BAƒûLANTI DURUMU -->
        <div class="connection-status connected" id="connectionStatus">
            <span class="status-dot"></span>
            <span id="statusText">Mobil ‚Ä¢ Yerel</span>
        </div>
    </div>

    <!-- MODALLAR (KVKK, ≈ûartlar, YouTube Ekle) -->
    <div id="youtubeModal" class="modal-overlay">
        <div class="modal-panel">
            <div class="modal-header">
                <h3><i class="fab fa-youtube" style="color:#ff0000;"></i> Video Ekle</h3>
                <div class="panel-close" onclick="closeModal('youtubeModal')"><i class="fas fa-times"></i></div>
            </div>
            <div class="modal-content">
                <input type="text" id="youtubeUrlInput" class="message-input" placeholder="YouTube URL veya ID" style="width:100%; margin-bottom:12px;">
                <input type="text" id="youtubeTitleInput" class="message-input" placeholder="Video ba≈ülƒ±ƒüƒ±" style="width:100%;">
            </div>
            <div class="modal-footer">
                <button class="form-button secondary" onclick="closeModal('youtubeModal')">ƒ∞ptal</button>
                <button class="form-button primary" onclick="addYoutubeVideo()">Ekle</button>
            </div>
        </div>
    </div>

    <div id="kvkkModal" class="modal-overlay">
        <div class="modal-panel">
            <div class="modal-header">
                <h3>KVKK Aydƒ±nlatma</h3>
                <div class="panel-close" onclick="closeModal('kvkkModal')"><i class="fas fa-times"></i></div>
            </div>
            <div class="modal-content">
                <p>KVKK metni burada g√∂r√ºnecek...</p>
            </div>
        </div>
    </div>

    <div id="termsModal" class="modal-overlay">
        <div class="modal-panel">
            <div class="modal-header">
                <h3>Kullanƒ±m ≈ûartlarƒ±</h3>
                <div class="panel-close" onclick="closeModal('termsModal')"><i class="fas fa-times"></i></div>
            </div>
            <div class="modal-content">
                <p>Kullanƒ±m ≈üartlarƒ± burada g√∂r√ºnecek...</p>
            </div>
        </div>
    </div>

    <script>
        // ========== MOBƒ∞L UYUMLU CETCETY - index.html'deki t√ºm mantƒ±k buraya entegre edildi ==========
        // NOT: Bu script, index.html'deki t√ºm deƒüi≈ükenleri, fonksiyonlarƒ± ve mantƒ±ƒüƒ± i√ßerir.
        // Sadece UI element ID'leri ve mobil g√∂r√ºn√ºm i√ßin bazƒ± eklemeler yapƒ±lmƒ±≈ütƒ±r.
        
        // Ana deƒüi≈ükenler
        let ytPlayer = null;
        let ytPlayerReady = false;
        let isMuted = false;
        let isPlaying = true;
        let USERS_DB = JSON.parse(localStorage.getItem('cetcety_users')) || [];
        let ACTIVE_USER = null;
        let BLOCKED_USERS = JSON.parse(localStorage.getItem('cetcety_blocks')) || {};
        let PRIVATE_CHATS = JSON.parse(localStorage.getItem('cetcety_private_chats')) || {};
        let BANNED_WORDS = JSON.parse(localStorage.getItem('cetcety_banned_words')) || ['spam', 'reklam', '≈üiddet', 'hakaret'];
        let CUSTOM_COMMANDS = JSON.parse(localStorage.getItem('cetcety_custom_commands')) || [];
        let CHANNEL_MESSAGES = JSON.parse(localStorage.getItem('cetcety_channel_messages')) || {};
        let PRIVATE_SPY_CHANNELS = JSON.parse(localStorage.getItem('cetcety_private_spy')) || {};
        let PRIVATE_SPY_ACTIVE = false;
        let PRIVATE_SPY_CURRENT_CHANNEL = null;
        let SUPER_HIDDEN_CHANNELS = JSON.parse(localStorage.getItem('cetcety_super_hidden')) || [];
        let currentPrivateChat = null;
        let currentChannel = 'genel';
        const OWNER_PASSWORD = 'Sahi17407@SCM';

        // Kanallar
        let channels = JSON.parse(localStorage.getItem('cetcety_channels')) || {
            'genel': { 
                name:'genel', owner:'MateKy', ownerRole:'owner', coAdmins:[], subscribers:1, online:1, isHidden:false,
                isSuperHidden: false,
                youtube: { 
                    currentVideo:'jfKfPfyJRdk', currentTitle:'CETCETY Radio', currentArtist:'MateKy', 
                    playlist:[{id:'jfKfPfyJRdk', title:'CETCETY Radio', addedBy:'MateKy', role:'owner'}]
                },
                onlineUsers:[]
            },
            'admin': { 
                name:'admin', owner:'MateKy', ownerRole:'owner', coAdmins:[], subscribers:1, online:1, isHidden:false,
                isSuperHidden: false,
                youtube: { 
                    currentVideo:'jfKfPfyJRdk', currentTitle:'Admin Kanalƒ±', currentArtist:'MateKy', 
                    playlist:[{id:'jfKfPfyJRdk', title:'Admin Kanalƒ±', addedBy:'MateKy', role:'owner'}]
                },
                onlineUsers:[]
            }
        };

        // ========== STORAGE SENKRONƒ∞ZASYONU ==========
        window.addEventListener('storage', function(e) {
            if (e.key === 'cetcety_channels') {
                let newChannels = JSON.parse(e.newValue);
                if (newChannels && newChannels[currentChannel]) {
                    channels = newChannels;
                    updateChannelUI();
                    if (document.getElementById('rightPanelTitle').textContent === 'YouTube') {
                        loadYouTubePanel();
                    }
                    if (ytPlayer && ytPlayerReady) {
                        let c = channels[currentChannel];
                        if (c) ytPlayer.loadVideoById(c.youtube.currentVideo);
                    }
                }
            }
            if (e.key === 'cetcety_private_chats' && currentPrivateChat) {
                loadPrivateMessages();
            }
        });

        // ========== Gƒ∞Rƒ∞≈û ==========
        function handleLogin() {
            const nick = document.getElementById('loginNick').value.trim();
            const pass = document.getElementById('loginPassword').value.trim();
            if (!nick) { alert('Kullanƒ±cƒ± adƒ± bo≈ü olamaz!'); return; }

            let existingUser = USERS_DB.find(u => u.name.toLowerCase() === nick.toLowerCase());
            
            if (existingUser) {
                if (existingUser.password && existingUser.password !== pass) { 
                    alert('Hatalƒ± ≈üifre!'); return; 
                }
                if (nick.toLowerCase() === 'mateky' && pass !== OWNER_PASSWORD) { 
                    alert('Owner ≈üifresi hatalƒ±!'); return; 
                }
                ACTIVE_USER = existingUser;
            } else {
                if (nick.toLowerCase() === 'mateky') {
                    if (pass !== OWNER_PASSWORD) { alert('Owner ≈üifresi hatalƒ±!'); return; }
                }
                ACTIVE_USER = {
                    id: Date.now(), name: nick, role: (nick.toLowerCase() === 'mateky') ? 'owner' : 'user',
                    roleLevel: (nick.toLowerCase() === 'mateky') ? 5 : 1, subscribedChannels: ['genel'],
                    myChannel: null, joinDate: new Date().toISOString(), avatar: nick.charAt(0).toUpperCase(),
                    avatarData: null, password: pass || '', privateMode: 'all', blockedNicks: []
                };
                USERS_DB.push(ACTIVE_USER);
                localStorage.setItem('cetcety_users', JSON.stringify(USERS_DB));
            }

            localStorage.setItem('cetcety_active_user', JSON.stringify(ACTIVE_USER));

            if (!channels.genel.onlineUsers.includes(ACTIVE_USER.name)) {
                channels.genel.onlineUsers.push(ACTIVE_USER.name);
            }
            saveChannels();

            document.getElementById('loginOverlay').classList.add('hidden');
            document.getElementById('app').style.display = 'flex';

            updateUIForUser();
            updateAllBadges();
            loadChannelMessages('genel');
            addSystemMessage(`üëã Ho≈ü geldin, ${ACTIVE_USER.name}!`);

            if (ACTIVE_USER.role === 'owner' || ACTIVE_USER.role === 'admin') {
                if (!ACTIVE_USER.subscribedChannels.includes('admin')) ACTIVE_USER.subscribedChannels.push('admin');
                if (!channels.admin.onlineUsers.includes(ACTIVE_USER.name)) channels.admin.onlineUsers.push(ACTIVE_USER.name);
                saveChannels();
            }
            
            // YouTube API'yi ba≈ülat
            if (typeof YT === 'undefined' || !YT.Player) {
                let tag = document.createElement('script');
                tag.src = 'https://www.youtube.com/iframe_api';
                document.head.appendChild(tag);
            } else {
                initYouTubePlayer();
            }
        }

        // ========== YARDIMCI FONKSƒ∞YONLAR ==========
        function saveChannels() { localStorage.setItem('cetcety_channels', JSON.stringify(channels)); }
        function addSystemMessage(t) {
            let d = document.createElement('div');
            d.className = 'system-message';
            d.innerHTML = `<i class="fas fa-info-circle"></i> ${escapeHTML(t)}`;
            document.getElementById('messages').appendChild(d);
            document.getElementById('messages').scrollTop = document.getElementById('messages').scrollHeight;
        }
        function escapeHTML(t) { if (!t) return ''; let d = document.createElement('div'); d.textContent = t; return d.innerHTML; }

        function updateUIForUser() {
            let avatarSpan = document.getElementById('navAvatarText');
            let avatarImg = document.getElementById('navAvatarImage');
            if (ACTIVE_USER.avatarData) {
                avatarSpan.style.display = 'none';
                avatarImg.style.display = 'block';
                avatarImg.src = ACTIVE_USER.avatarData;
            } else {
                avatarSpan.style.display = 'block';
                avatarImg.style.display = 'none';
                avatarSpan.textContent = ACTIVE_USER.avatar || ACTIVE_USER.name.charAt(0).toUpperCase();
            }
        }

        function updateAllBadges() {
            document.getElementById('channelCountBadge').textContent = Object.keys(channels).length;
            let totalUnread = 0;
            for (let chatId in PRIVATE_CHATS) {
                if (PRIVATE_CHATS[chatId]) {
                    totalUnread += PRIVATE_CHATS[chatId].filter(m => m.senderId != ACTIVE_USER?.id && !m.read).length;
                }
            }
            document.getElementById('chatListBadge').textContent = totalUnread || 0;
        }

        // ========== KANAL ƒ∞≈ûLEMLERƒ∞ ==========
        function joinChannel(ch) {
            if (!channels[ch]) return;
            if (channels[ch].isSuperHidden && ACTIVE_USER.role !== 'owner') {
                addSystemMessage('‚ùå Bu kanala eri≈üim yetkiniz yok.'); return;
            }
            if (ch === 'admin' && !(ACTIVE_USER.role === 'owner' || ACTIVE_USER.role === 'admin')) {
                addSystemMessage('‚ùå Bu kanala eri≈üim yetkiniz yok.'); return;
            }

            if (currentChannel && channels[currentChannel]) {
                channels[currentChannel].onlineUsers = channels[currentChannel].onlineUsers.filter(u => u !== ACTIVE_USER.name);
            }

            currentChannel = ch;
            let c = channels[ch];
            if (!c.onlineUsers.includes(ACTIVE_USER.name)) c.onlineUsers.push(ACTIVE_USER.name);
            saveChannels();

            document.getElementById('currentChannelName').textContent = ch;
            document.getElementById('channelUserCount').textContent = c.onlineUsers.length;
            let sub = c.subscribers || 1;
            document.getElementById('channelSubscribers').textContent = sub >= 1000 ? (sub/1000).toFixed(1)+'K' : sub;

            loadChannelMessages(ch);
            addSystemMessage(`üì¢ #${ch} kanalƒ±na katƒ±ldƒ±n!`);
            
            // Saƒü panelde YouTube varsa g√ºncelle
            if (document.getElementById('rightPanelTitle').textContent === 'YouTube') {
                loadYouTubePanel();
            }
        }

        function loadChannelMessages(channel) {
            let container = document.getElementById('messages');
            container.innerHTML = '';
            addSystemMessage(`üì¢ #${channel} kanalƒ±na katƒ±ldƒ±n!`);

            if (!CHANNEL_MESSAGES[channel]) CHANNEL_MESSAGES[channel] = [];
            CHANNEL_MESSAGES[channel].forEach(msg => {
                if (msg.isHtml) {
                    let msgDiv = document.createElement('div');
                    msgDiv.className = msg.sender === 'üîî Sƒ∞STEM' ? 'system-message' : 'system-message';
                    msgDiv.innerHTML = `<i class="fas fa-copy"></i> ${msg.text}`;
                    container.appendChild(msgDiv);
                } else {
                    let isMe = msg.sender === ACTIVE_USER?.name;
                    let msgDiv = document.createElement('div');
                    msgDiv.className = `message ${isMe ? 'right' : ''}`;
                    msgDiv.innerHTML = `<div class="message-header"><span class="message-time">${msg.time || ''}</span><span class="message-sender">${escapeHTML(msg.sender)}</span></div><div class="message-text">${escapeHTML(msg.text)}</div>`;
                    container.appendChild(msgDiv);
                }
            });
            container.scrollTop = container.scrollHeight;
        }

        function sendMessage() {
            let inp = document.getElementById('messageInput');
            let txt = inp.value.trim();
            if (!txt) return;
            if (txt.startsWith('/')) {
                handleCommand(txt);
                inp.value = ''; return;
            }

            let banned = checkBannedWords(txt);
            if (banned) { addSystemMessage(`üö´ Yasaklƒ± kelime: "${banned}"`); inp.value = ''; return; }

            let time = new Date().toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' });
            let msg = { sender: ACTIVE_USER.name, text: txt, time: time, timestamp: Date.now() };

            if (!CHANNEL_MESSAGES[currentChannel]) CHANNEL_MESSAGES[currentChannel] = [];
            CHANNEL_MESSAGES[currentChannel].push(msg);
            localStorage.setItem('cetcety_channel_messages', JSON.stringify(CHANNEL_MESSAGES));

            let msgDiv = document.createElement('div');
            msgDiv.className = 'message right';
            msgDiv.innerHTML = `<div class="message-header" style="justify-content:flex-end;"><span class="message-time">${time}</span><span class="message-sender">${ACTIVE_USER.name}</span></div><div class="message-text">${escapeHTML(txt)}</div>`;
            document.getElementById('messages').appendChild(msgDiv);
            document.getElementById('messages').scrollTop = document.getElementById('messages').scrollHeight;
            inp.value = '';
        }

        function checkBannedWords(text) {
            if (!text) return false;
            const lower = text.toLowerCase();
            for (let word of BANNED_WORDS) if (lower.includes(word.toLowerCase())) return word;
            return false;
        }

        // ========== KOMUT ƒ∞≈ûLEYƒ∞Cƒ∞ ==========
        function handleCommand(cmd) {
            let parts = cmd.substring(1).split(' ');
            let main = parts[0].toLowerCase();

            if (main === 'help') {
                addSystemMessage('üìã Komutlar: /join #kanal, /part, /msg kullanƒ±cƒ± mesaj, /users, /ping, /temizle, /abonelikler, /populer, /kanal, /kick, /ban (yetkiye g√∂re)');
            }
            else if (main === 'join') {
                let ch = parts[1]?.replace('#', '');
                if (ch && channels[ch]) joinChannel(ch);
                else addSystemMessage('‚ùå Kanal bulunamadƒ±.');
            }
            else if (main === 'part') {
                if (currentChannel === 'genel') addSystemMessage('‚ùå Genel kanaldan ayrƒ±lamazsƒ±n.');
                else {
                    if (channels[currentChannel]) channels[currentChannel].onlineUsers = channels[currentChannel].onlineUsers.filter(u => u !== ACTIVE_USER.name);
                    saveChannels();
                    joinChannel('genel');
                }
            }
            else if (main === 'msg') {
                let target = parts[1];
                let msg = parts.slice(2).join(' ');
                if (target && msg) {
                    openPrivateChat(target);
                    setTimeout(() => {
                        document.getElementById('privateMessageInput').value = msg;
                        sendPrivateMessage();
                    }, 300);
                }
            }
            else if (main === 'users') {
                let list = channels[currentChannel].onlineUsers.join(', ');
                addSystemMessage(`üë• #${currentChannel} √ßevrimi√ßi: ${list || 'Kimse yok'}`);
            }
            else if (main === 'ping') addSystemMessage('üèì Pong!');
            else if (main === 'temizle') document.getElementById('messages').innerHTML = '';
            else {
                addSystemMessage(`‚ùå Bilinmeyen komut: ${cmd}`);
            }
        }

        // ========== YOUTUBE ==========
        function initYouTubePlayer() {
            let c = channels[currentChannel];
            if (!c || !document.getElementById('youtubeContainer')) return;
            try {
                ytPlayer = new YT.Player('youtubeContainer', {
                    height: '100%', width: '100%',
                    videoId: c.youtube.currentVideo,
                    playerVars: { autoplay: 1, controls: 0, modestbranding: 1, rel: 0 },
                    events: {
                        onReady: (e) => { ytPlayerReady = true; e.target.playVideo(); },
                        onStateChange: (e) => { isPlaying = e.data === YT.PlayerState.PLAYING; }
                    }
                });
            } catch (e) {}
        }

        function onYouTubeIframeAPIReady() { initYouTubePlayer(); }

        function openAddYoutubeModal() {
            let c = channels[currentChannel];
            if (!ACTIVE_USER || !(ACTIVE_USER.role === 'owner' || ACTIVE_USER.role === 'admin' || c.coAdmins?.includes(ACTIVE_USER.name))) {
                addSystemMessage('‚ùå Video ekleme yetkiniz yok!'); return;
            }
            document.getElementById('youtubeUrlInput').value = '';
            document.getElementById('youtubeTitleInput').value = '';
            document.getElementById('youtubeModal').classList.add('active');
        }

        function addYoutubeVideo() {
            let url = document.getElementById('youtubeUrlInput').value.trim();
            let title = document.getElementById('youtubeTitleInput').value.trim();
            if (!url) return;

            let vid = '';
            if (url.includes('v=')) vid = url.split('v=')[1]?.split('&')[0];
            else if (url.includes('youtu.be/')) vid = url.split('youtu.be/')[1]?.split('?')[0];
            else if (url.match(/^[a-zA-Z0-9_-]{11}$/)) vid = url;
            else { addSystemMessage('‚ùå Ge√ßersiz URL'); return; }

            let c = channels[currentChannel];
            if (!title) title = `Video ${c.youtube.playlist.length + 1}`;
            
            c.youtube.playlist.push({
                id: vid, title: title, addedBy: ACTIVE_USER.name,
                role: ACTIVE_USER.role === 'owner' ? 'owner' : ACTIVE_USER.role === 'admin' ? 'admin' : 'coadmin'
            });
            saveChannels();
            closeModal('youtubeModal');
            addSystemMessage(`‚úÖ "${title}" eklendi!`);
            if (document.getElementById('rightPanelTitle').textContent === 'YouTube') loadYouTubePanel();
        }

        function loadYouTubePanel() {
            let c = channels[currentChannel];
            let html = `<div class="media-panel">
                <div class="media-player"><div id="youtubeContainer" style="width:100%;height:100%;"></div></div>
                <div class="media-controls">
                    <div class="media-control-btn" onclick="toggleMute()"><i class="fas ${isMuted ? 'fa-volume-mute' : 'fa-volume-up'}" id="muteIcon"></i></div>
                    <div class="media-control-btn" onclick="togglePlayPause()"><i class="fas ${isPlaying ? 'fa-pause' : 'fa-play'}" id="playPauseIcon"></i></div>
                </div>
                <div class="now-playing">
                    <div style="font-weight:600;">${c.youtube.currentTitle}</div>
                    <div style="font-size:12px; color:#aaa;">${c.youtube.currentArtist}</div>
                </div>
                <div class="playlist-items" id="playlistItems">`;
            
            c.youtube.playlist.forEach((item, i) => {
                let canDel = ACTIVE_USER && (ACTIVE_USER.role === 'owner' || ACTIVE_USER.role === 'admin' || (c.coAdmins?.includes(ACTIVE_USER.name) && item.addedBy === ACTIVE_USER.name));
                html += `<div class="playlist-item" onclick="playYoutubeVideo('${item.id}', '${escapeHTML(item.title)}', '${escapeHTML(item.addedBy)}', '${item.role}')">
                    <div class="playlist-thumb"><i class="fab fa-youtube"></i></div>
                    <div class="item-info">
                        <div class="item-name">${escapeHTML(item.title)}</div>
                        <div class="item-meta">${item.addedBy}</div>
                    </div>
                    ${canDel ? `<div class="subscribe-small" onclick="event.stopPropagation(); removeYoutubeFromPlaylist(${i})"><i class="fas fa-trash"></i></div>` : ''}
                </div>`;
            });
            html += `</div><div style="padding:16px;"><button class="subscribe-btn" onclick="openAddYoutubeModal()" style="width:100%;"><i class="fas fa-plus"></i> Video Ekle</button></div></div>`;
            document.getElementById('rightPanelContent').innerHTML = html;
            initYouTubePlayer();
        }

        function playYoutubeVideo(vid, title, by, role) {
            let c = channels[currentChannel];
            c.youtube.currentVideo = vid;
            c.youtube.currentTitle = title;
            c.youtube.currentArtist = by;
            saveChannels();
            if (ytPlayer && ytPlayerReady) ytPlayer.loadVideoById(vid);
            if (document.getElementById('rightPanelTitle').textContent === 'YouTube') loadYouTubePanel();
        }

        function removeYoutubeFromPlaylist(i) {
            let c = channels[currentChannel];
            c.youtube.playlist.splice(i, 1);
            if (c.youtube.playlist.length > 0) {
                let n = c.youtube.playlist[0];
                playYoutubeVideo(n.id, n.title, n.addedBy, n.role);
            }
            saveChannels();
            if (document.getElementById('rightPanelTitle').textContent === 'YouTube') loadYouTubePanel();
        }

        function toggleMute() {
            if (!ytPlayer || !ytPlayerReady) return;
            if (isMuted) { ytPlayer.unMute(); } else { ytPlayer.mute(); }
            isMuted = !isMuted;
            document.getElementById('muteIcon').className = isMuted ? 'fas fa-volume-mute' : 'fas fa-volume-up';
        }

        function togglePlayPause() {
            if (!ytPlayer || !ytPlayerReady) return;
            let state = ytPlayer.getPlayerState();
            if (state === YT.PlayerState.PLAYING) ytPlayer.pauseVideo();
            else ytPlayer.playVideo();
        }

        // ========== √ñZEL SOHBET ==========
        function openPrivateChat(username) {
            if (!username || !ACTIVE_USER) return;
            if (ACTIVE_USER.role !== 'owner' && ACTIVE_USER.blockedNicks?.includes(username)) {
                addSystemMessage(`üö´ ${username} engellenmi≈ü.`); return;
            }
            currentPrivateChat = { name: username, id: username };
            document.getElementById('privateChatName').textContent = username;
            document.getElementById('privateChatAvatar').innerHTML = username.charAt(0).toUpperCase();
            document.getElementById('privateChatPanel').classList.add('active');
            loadPrivateMessages();
        }

        function closePrivateChat() {
            document.getElementById('privateChatPanel').classList.remove('active');
            currentPrivateChat = null;
        }

        function loadPrivateMessages() {
            if (!currentPrivateChat || !ACTIVE_USER) return;
            let chatId = [ACTIVE_USER.id, currentPrivateChat.id].sort().join('_');
            let msgs = PRIVATE_CHATS[chatId] || [];
            let container = document.getElementById('privateChatMessages');
            let html = '';
            msgs.forEach((msg, index) => {
                let isMe = msg.senderId === ACTIVE_USER.id;
                let time = new Date(msg.timestamp).toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' });
                if (msg.type === 'text') {
                    html += `<div class="message ${isMe ? 'right' : ''}"><div class="message-header"><span class="message-time">${time}</span><span class="message-sender">${msg.senderName}</span></div><div class="message-text">${escapeHTML(msg.content)}</div></div>`;
                } else if (msg.type === 'image') {
                    html += `<div class="message ${isMe ? 'right' : ''}"><div class="message-header"><span class="message-time">${time}</span><span class="message-sender">${msg.senderName}</span></div><img src="${escapeHTML(msg.content)}" style="max-width:200px; border-radius:12px;" onclick="window.open(this.src)"></div>`;
                } else if (msg.type === 'video') {
                    html += `<div class="message ${isMe ? 'right' : ''}"><div class="message-header"><span class="message-time">${time}</span><span class="message-sender">${msg.senderName}</span></div><video controls src="${escapeHTML(msg.content)}" style="max-width:200px; border-radius:12px;"></video></div>`;
                }
            });
            container.innerHTML = html;
            container.scrollTop = container.scrollHeight;
        }

        function sendPrivateMessage() {
            let input = document.getElementById('privateMessageInput');
            let text = input.value.trim();
            if (!text || !currentPrivateChat || !ACTIVE_USER) return;

            let chatId = [ACTIVE_USER.id, currentPrivateChat.id].sort().join('_');
            if (!PRIVATE_CHATS[chatId]) PRIVATE_CHATS[chatId] = [];

            PRIVATE_CHATS[chatId].push({
                id: Date.now(), senderId: ACTIVE_USER.id, senderName: ACTIVE_USER.name,
                type: 'text', content: text, timestamp: Date.now()
            });
            localStorage.setItem('cetcety_private_chats', JSON.stringify(PRIVATE_CHATS));

            input.value = '';
            loadPrivateMessages();
            updateAllBadges();
        }

        function triggerPrivateImageUpload() { document.getElementById('privateImageUpload').click(); }
        function triggerPrivateVideoUpload() { document.getElementById('privateVideoUpload').click(); }

        document.getElementById('privateImageUpload').addEventListener('change', function(e) {
            if (!e.target.files[0] || !currentPrivateChat) return;
            let reader = new FileReader();
            reader.onload = (e) => {
                let chatId = [ACTIVE_USER.id, currentPrivateChat.id].sort().join('_');
                if (!PRIVATE_CHATS[chatId]) PRIVATE_CHATS[chatId] = [];
                PRIVATE_CHATS[chatId].push({
                    id: Date.now(), senderId: ACTIVE_USER.id, senderName: ACTIVE_USER.name,
                    type: 'image', content: e.target.result, timestamp: Date.now()
                });
                localStorage.setItem('cetcety_private_chats', JSON.stringify(PRIVATE_CHATS));
                loadPrivateMessages();
            };
            reader.readAsDataURL(e.target.files[0]);
        });

        document.getElementById('privateVideoUpload').addEventListener('change', function(e) {
            if (!e.target.files[0] || !currentPrivateChat) return;
            let reader = new FileReader();
            reader.onload = (e) => {
                let chatId = [ACTIVE_USER.id, currentPrivateChat.id].sort().join('_');
                if (!PRIVATE_CHATS[chatId]) PRIVATE_CHATS[chatId] = [];
                PRIVATE_CHATS[chatId].push({
                    id: Date.now(), senderId: ACTIVE_USER.id, senderName: ACTIVE_USER.name,
                    type: 'video', content: e.target.result, timestamp: Date.now()
                });
                localStorage.setItem('cetcety_private_chats', JSON.stringify(PRIVATE_CHATS));
                loadPrivateMessages();
            };
            reader.readAsDataURL(e.target.files[0]);
        });

        function blockUser() {
            if (currentPrivateChat) {
                addSystemMessage(`üö´ ${currentPrivateChat.name} engellendi.`);
                closePrivateChat();
            }
        }

        // ========== PANEL KONTROLLERƒ∞ ==========
        function openLeftPanel() {
            document.getElementById('leftPanel').classList.add('active');
            loadLeftPanelContent('subscriptions');
        }
        function closeLeftPanel() { document.getElementById('leftPanel').classList.remove('active'); }
        function openRightPanel() {
            document.getElementById('rightPanel').classList.add('active');
            loadOnlineUsers();
        }
        function closeRightPanel() { document.getElementById('rightPanel').classList.remove('active'); }
        function toggleMediaPanel() {
            if (document.getElementById('rightPanel').classList.contains('active')) {
                closeRightPanel();
            } else {
                document.getElementById('rightPanel').classList.add('active');
                switchRightTab('youtube');
            }
        }

        function switchLeftTab(tab) {
            document.querySelectorAll('#leftPanel .panel-tab').forEach((t, i) => {
                t.classList.toggle('active', (i === 0 && tab === 'subscriptions') || (i === 1 && tab === 'channels'));
            });
            document.getElementById('leftPanelTitle').textContent = tab === 'subscriptions' ? 'Abonelikler' : 'Ke≈üfet';
            loadLeftPanelContent(tab);
        }

        function loadLeftPanelContent(tab) {
            let html = '<div class="search-container"><i class="fas fa-search"></i><input type="text" placeholder="Ara..." class="search-input"></div>';
            if (tab === 'subscriptions') {
                ACTIVE_USER.subscribedChannels.forEach(ch => {
                    let c = channels[ch] || { owner: 'Bilinmiyor', subscribers: 0, onlineUsers: [] };
                    html += `<div class="channel-item" onclick="joinChannel('${ch}'); closeLeftPanel();">
                        <div class="item-avatar"><i class="fas fa-hashtag"></i></div>
                        <div class="item-info">
                            <div class="item-name">${ch}</div>
                            <div class="item-meta">${c.owner} ‚Ä¢ ${c.subscribers || 0} abone</div>
                        </div>
                        <div class="subscribe-small">${c.onlineUsers?.length || 0}</div>
                    </div>`;
                });
            } else {
                Object.values(channels).forEach(c => {
                    if (c.isSuperHidden && ACTIVE_USER.role !== 'owner') return;
                    html += `<div class="channel-item" onclick="joinChannel('${c.name}'); closeLeftPanel();">
                        <div class="item-avatar"><i class="fas fa-hashtag"></i></div>
                        <div class="item-info">
                            <div class="item-name">${c.name}</div>
                            <div class="item-meta">${c.owner} ‚Ä¢ ${c.subscribers || 0} abone</div>
                        </div>
                        <div class="subscribe-small">${c.onlineUsers?.length || 0}</div>
                    </div>`;
                });
            }
            document.getElementById('leftPanelContent').innerHTML = html;
        }

        function switchRightTab(tab) {
            document.querySelectorAll('#rightPanel .panel-tab').forEach((t, i) => {
                t.classList.toggle('active', (i === 0 && tab === 'online') || (i === 1 && tab === 'youtube'));
            });
            document.getElementById('rightPanelTitle').textContent = tab === 'online' ? '√áevrimi√ßi' : 'YouTube';
            if (tab === 'online') loadOnlineUsers();
            else loadYouTubePanel();
        }

        function loadOnlineUsers() {
            let users = channels[currentChannel]?.onlineUsers || [];
            let html = '';
            users.forEach(u => {
                html += `<div class="channel-item" onclick="openPrivateChat('${u}'); closeRightPanel();">
                    <div class="item-avatar"><span>${u.charAt(0)}</span></div>
                    <div class="item-info">
                        <div class="item-name">${u} <span class="online-status"></span></div>
                        <div class="item-meta">#${currentChannel}</div>
                    </div>
                </div>`;
            });
            document.getElementById('rightPanelContent').innerHTML = html;
        }

        function openChatList() {
            let html = '<div class="panel-tabs" style="display:none;"></div>';
            let chats = [];
            for (let chatId in PRIVATE_CHATS) {
                if (!PRIVATE_CHATS[chatId]) continue;
                let ids = chatId.split('_');
                let otherId = ids[0] == ACTIVE_USER.id ? ids[1] : ids[0];
                let otherUser = USERS_DB.find(u => u.id == otherId) || { name: 'Kullanƒ±cƒ±' };
                let lastMsg = PRIVATE_CHATS[chatId].slice(-1)[0];
                chats.push({ name: otherUser.name, lastMsg: lastMsg ? (lastMsg.type === 'text' ? lastMsg.content : 'üìé medya') : '...' });
            }
            chats.forEach(chat => {
                html += `<div class="chat-item" onclick="openPrivateChat('${chat.name}'); closeLeftPanel();">
                    <div class="item-avatar"><span>${chat.name.charAt(0)}</span></div>
                    <div class="item-info">
                        <div class="item-name">${chat.name}</div>
                        <div class="item-meta">${escapeHTML(chat.lastMsg)}</div>
                    </div>
                </div>`;
            });
            document.getElementById('leftPanelTitle').textContent = 'Sohbetlerim';
            document.getElementById('leftPanelContent').innerHTML = html;
            document.getElementById('leftPanel').classList.add('active');
        }

        function openCreateChannel() {
            document.getElementById('leftPanelTitle').textContent = 'Kanal A√ß';
            let html = '<div class="panel-content"><input type="text" id="newChannelName" class="message-input" placeholder="Kanal adƒ±" style="width:100%; margin-bottom:12px;"><textarea id="newChannelDesc" class="message-input" placeholder="A√ßƒ±klama" style="width:100%; margin-bottom:12px;"></textarea><button class="subscribe-btn" onclick="createChannel()" style="width:100%;">Kanal Olu≈ütur</button></div>';
            document.getElementById('leftPanelContent').innerHTML = html;
            document.getElementById('leftPanel').classList.add('active');
        }

        function createChannel() {
            let name = document.getElementById('newChannelName')?.value?.toLowerCase().trim();
            if (!name || !/^[a-z0-9-]+$/.test(name)) { alert('Ge√ßersiz kanal adƒ±!'); return; }
            if (channels[name]) { alert('Kanal zaten var!'); return; }

            channels[name] = {
                name, owner: ACTIVE_USER.name, ownerRole: 'coadmin', coAdmins: [ACTIVE_USER.name],
                subscribers: 1, online: 1, description: document.getElementById('newChannelDesc')?.value || '',
                isHidden: false, isSuperHidden: false,
                youtube: { currentVideo: 'jfKfPfyJRdk', currentTitle: 'CETCETY Radio', currentArtist: ACTIVE_USER.name,
                    playlist: [{ id: 'jfKfPfyJRdk', title: 'CETCETY Radio', addedBy: ACTIVE_USER.name, role: 'coadmin' }]
                },
                onlineUsers: [ACTIVE_USER.name]
            };
            saveChannels();
            ACTIVE_USER.myChannel = name;
            if (ACTIVE_USER.role !== 'owner') ACTIVE_USER.role = 'coadmin';
            if (!ACTIVE_USER.subscribedChannels.includes(name)) ACTIVE_USER.subscribedChannels.push(name);
            localStorage.setItem('cetcety_active_user', JSON.stringify(ACTIVE_USER));
            
            let index = USERS_DB.findIndex(u => u.id === ACTIVE_USER.id);
            if (index !== -1) USERS_DB[index] = ACTIVE_USER;
            localStorage.setItem('cetcety_users', JSON.stringify(USERS_DB));
            
            addSystemMessage(`‚úÖ #${name} kanalƒ± olu≈üturuldu!`);
            joinChannel(name);
            closeLeftPanel();
        }

        function openNotifications() {
            document.getElementById('leftPanelTitle').textContent = 'Bildirimler';
            document.getElementById('leftPanelContent').innerHTML = '<div style="text-align:center; color:#aaa; padding:20px;">Hen√ºz bildirim yok.</div>';
            document.getElementById('leftPanel').classList.add('active');
        }

        function openProfilePanel() {
            document.getElementById('leftPanelTitle').textContent = 'Profil';
            let html = `<div style="text-align:center; padding:20px;">
                <div class="item-avatar" style="width:80px; height:80px; margin:0 auto 12px; font-size:40px;">${ACTIVE_USER.name.charAt(0)}</div>
                <h3>${ACTIVE_USER.name}</h3>
                <span class="badge ${ACTIVE_USER.role === 'owner' ? 'badge-owner' : ACTIVE_USER.role === 'admin' ? 'badge-admin' : 'badge-coadmin'}" style="margin:8px 0;">${ACTIVE_USER.role}</span>
                <div style="display:flex; gap:16px; justify-content:center; margin:20px 0;">
                    <div><div style="font-weight:700;">${ACTIVE_USER.subscribedChannels.length}</div><div style="font-size:12px; color:#aaa;">Abonelik</div></div>
                    <div><div style="font-weight:700;">${ACTIVE_USER.myChannel ? '1' : '0'}</div><div style="font-size:12px; color:#aaa;">Kanalƒ±m</div></div>
                </div>
                <button class="subscribe-btn" onclick="logout()" style="width:100%; margin-top:16px;">√áƒ±kƒ±≈ü Yap</button>
            </div>`;
            document.getElementById('leftPanelContent').innerHTML = html;
            document.getElementById('leftPanel').classList.add('active');
        }

        function logout() {
            if (ACTIVE_USER && channels[currentChannel]) {
                channels[currentChannel].onlineUsers = channels[currentChannel].onlineUsers.filter(u => u !== ACTIVE_USER.name);
                saveChannels();
            }
            localStorage.removeItem('cetcety_active_user');
            location.reload();
        }

        // ========== MODAL ==========
        function openKvkkModal() { document.getElementById('kvkkModal').classList.add('active'); }
        function openTermsModal() { document.getElementById('termsModal').classList.add('active'); }
        function closeModal(modalId) { document.getElementById(modalId).classList.remove('active'); }

        // ========== BA≈ûLANGI√á ==========
        document.addEventListener('DOMContentLoaded', function() {
            ACTIVE_USER = JSON.parse(localStorage.getItem('cetcety_active_user'));
            if (ACTIVE_USER) {
                if (!channels.genel.onlineUsers.includes(ACTIVE_USER.name)) channels.genel.onlineUsers.push(ACTIVE_USER.name);
                saveChannels();
                document.getElementById('loginOverlay').classList.add('hidden');
                document.getElementById('app').style.display = 'flex';
                updateUIForUser();
                updateAllBadges();
                loadChannelMessages('genel');
                addSystemMessage(`üëã Tekrar ho≈ü geldin, ${ACTIVE_USER.name}!`);
                if (typeof YT === 'undefined') {
                    let tag = document.createElement('script');
                    tag.src = 'https://www.youtube.com/iframe_api';
                    document.head.appendChild(tag);
                }
            }
        });

        // Enter ile mesaj g√∂nderme
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                if (document.activeElement && document.activeElement.id === 'messageInput') {
                    e.preventDefault(); sendMessage();
                } else if (document.activeElement && document.activeElement.id === 'privateMessageInput') {
                    e.preventDefault(); sendPrivateMessage();
                }
            }
        });
    </script>
</body>
</html>
